--- FILE: ./content.js ---
// VoiceMux Bridge Content Script v2.1.0 (Clean Architecture)
if (window.VOICEMUX_INITIALIZED) {
  console.log("VoiceMux: Already initialized in this tab.");
} else {
  window.VOICEMUX_INITIALIZED = true;
  console.log("VoiceMux Bridge v2.1.0 Loaded");

  /**
   * decodes Base64 strings safely.
   */
  function safeAtob(base64) {
    if (!base64) return "";
    let standardBase64 = base64.replace(/\s/g, '').replace(/-/g, '+').replace(/_/g, '/');
    while (standardBase64.length % 4 !== 0) {
      standardBase64 += '=';
    }
    try {
      return atob(standardBase64);
    } catch (e) {
      console.error("[Base64] atob failed:", e);
      return "";
    }
  }

  let ADAPTERS_CACHE = [];
  let loadPromise = null;

  // â˜… Initialize Adapters
  async function loadAdapters() {
    if (loadPromise) return loadPromise;
    loadPromise = (async () => {
      try {
        const builtInUrl = chrome.runtime.getURL('adapters.json');
        const builtInRes = await fetch(builtInUrl);
        const builtInAdapters = await builtInRes.json();
        const storage = await chrome.storage.local.get('custom_adapters');
        const customAdapters = storage.custom_adapters || [];
        const normalizedCustom = customAdapters.map(a => ({
          name: a.name || "Custom",
          host: a.host,
          inputSelector: a.inputSelector ?? (Array.isArray(a.selectors) ? a.selectors.join(',') : a.selectors),
          submitSelector: a.submitSelector ?? (Array.isArray(a.sendBtns) ? a.sendBtns.join(',') : a.sendBtns)
        }));
        ADAPTERS_CACHE = [...normalizedCustom, ...builtInAdapters];
      } catch (e) {
        console.error("VoiceMux: Failed to load adapters", e);
      } finally {
        loadPromise = null;
      }
    })();
    return loadPromise;
  }

  chrome.storage.onChanged.addListener((changes, area) => {
    if (area === 'local' && changes.custom_adapters) {
      loadAdapters();
    }
  });
  loadAdapters();

  // â˜… Target Selection
  async function getTargetAndAdapter() {
    const url = window.location.href;
    if (ADAPTERS_CACHE.length === 0) await loadAdapters();
    const adapter = ADAPTERS_CACHE.find(a => a.host && url.includes(a.host));
    const active = document.activeElement;
    if (active && 
        (active.isContentEditable || 
         active.tagName === 'TEXTAREA' || 
         (active.tagName === 'INPUT' && !['checkbox', 'radio', 'button', 'submit'].includes(active.type)))) {
      return { target: active, adapter: adapter || { name: 'active-element' } };
    }
    if (adapter) {
      const el = document.querySelector(adapter.inputSelector);
      if (el) return { target: el, adapter: adapter };
    }
    const firstInput = document.querySelector('textarea, div[contenteditable="true"]');
    if (firstInput) {
        return { target: firstInput, adapter: { name: 'last-resort' } };
    }
    return { target: null, adapter: null };
  }

  /** 
   * Injects text into a target element. 
   */
  function forceInject(element, text) {
    if (!element) return;
    element.focus();
    if (element.tagName === 'TEXTAREA' || element.tagName === 'INPUT') {
      const proto = element.tagName === 'INPUT' ? window.HTMLInputElement.prototype : window.HTMLTextAreaElement.prototype;
      const nativeSetter = Object.getOwnPropertyDescriptor(proto, "value")?.set;
      if (nativeSetter) {
          nativeSetter.call(element, text);
      } else {
          element.value = text;
      }
    } else if (element.isContentEditable) {
        try {
            element.textContent = text;
            const inputEvent = new InputEvent('input', { bubbles: true, cancelable: true, inputType: 'insertText', data: text });
            element.dispatchEvent(inputEvent);
        } catch (e) {
            element.innerText = text;
        }
    }
    element.dispatchEvent(new Event('input', { bubbles: true, composed: true }));
    element.dispatchEvent(new Event('change', { bubbles: true, composed: true }));
    moveCursorToEnd(element);
  }

  function moveCursorToEnd(element) {
    if (element.tagName === 'TEXTAREA' || element.tagName === 'INPUT') {
      element.selectionStart = element.selectionEnd = element.value.length;
    } else if (element.isContentEditable) {
      try {
        const range = document.createRange();
        range.selectNodeContents(element);
        range.collapse(false);
        const sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
      } catch (e) {}
    }
  }

  function triggerEnter(target) {
      const opts = { key: 'Enter', code: 'Enter', keyCode: 13, which: 13, bubbles: true, cancelable: true, composed: true, view: window };
      target.dispatchEvent(new KeyboardEvent('keydown', opts));
      target.dispatchEvent(new KeyboardEvent('keypress', opts));
      target.dispatchEvent(new KeyboardEvent('keyup', opts));
  }

  // â˜… Message Listener (Plaintext from Background)
  chrome.runtime.onMessage.addListener(async (request, sender, sendResponse) => {
    // Prevent feedback loops on Hub/localhost dev
    const isHub = window.location.hostname.includes("hub.knc.jp") || 
                  (window.location.hostname === "localhost" && window.location.port === "5173");
    if (isHub) return;

    const { target, adapter } = await getTargetAndAdapter();
    if (!target) return;

    const plaintext = request.plaintext;
    if (request.action === "update_text") {
      forceInject(target, plaintext);
    } else if (request.action === "confirm_send") {
      forceInject(target, plaintext);
      setTimeout(() => {
          if (adapter && adapter.submitSelector === null) return;
          let btn = null;
          if (adapter && adapter.submitSelector) {
              btn = document.querySelector(adapter.submitSelector);
          }
          if (btn && !btn.disabled) {
              btn.click();
          } else {
              triggerEnter(target);
          }
      }, 100);
    }
  });

  function safeCheckConnection() {
    if (chrome.runtime?.id) {
      chrome.runtime.sendMessage({ action: "check_connection" }).catch(() => {});
    }
  }

  document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "visible") {
      safeCheckConnection();
    }
  });
}

--- END OF FILE: ./content.js ---

--- FILE: ./manifest.json ---
{
  "manifest_version": 3,
  "name": "__MSG_name__",
  "version": "2.1.0",
  "description": "__MSG_description__",
  "default_locale": "en",
  "permissions": [
    "activeTab",
    "storage",
    "alarms"
  ],
  "host_permissions": [
    "http://localhost:4000/*",
    "https://v.knc.jp/*",
    "https://hub.knc.jp/*"
  ],
  "action": {
    "default_popup": "popup.html",
    "default_icon": {
      "128": "icon128.png"
    }
  },
  "externally_connectable": {
    "matches": [
      "https://hub.knc.jp/*",
      "http://localhost/*"
    ]
  },
  "options_page": "options.html",
  "background": {
    "service_worker": "background.js"
  },
  "content_scripts": [
    {
      "matches": [
        "<all_urls>"
      ],
      "exclude_matches": [
        "https://v.knc.jp/*",
        "https://t.knc.jp/*"
      ],
      "js": [
        "content.js"
      ]
    }
  ],
  "icons": {
    "128": "icon128.png"
  },
  "web_accessible_resources": [
    {
      "resources": ["adapters.json"],
      "matches": ["<all_urls>"]
    }
  ]
}

--- END OF FILE: ./manifest.json ---

--- FILE: ./options.html ---
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VoiceMux Settings</title>
  <style>
    :root {
      /* M3 Light Palette (Violet baseline) */
      --md-sys-color-primary: #6750A4;
      --md-sys-color-on-primary: #FFFFFF;
      --md-sys-color-primary-container: #EADDFF;
      --md-sys-color-on-primary-container: #21005D;
      --md-sys-color-secondary: #625B71;
      --md-sys-color-on-secondary: #FFFFFF;
      --md-sys-color-surface: #FEF7FF;
      --md-sys-color-on-surface: #1D1B20;
      --md-sys-color-surface-variant: #E7E0EB;
      --md-sys-color-on-surface-variant: #49454F;
      --md-sys-color-outline: #79747E;
      --md-sys-color-success: #10b981;

      /* Elevation */
      --md-sys-elevation-1: 0px 1px 3px 1px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
      --md-sys-elevation-3: 0px 1px 3px 0px rgba(0, 0, 0, 0.3), 0px 4px 8px 3px rgba(0, 0, 0, 0.15);
    }

    body {
      font-family: 'Roboto', system-ui, -apple-system, sans-serif;
      background-color: var(--md-sys-color-surface);
      color: var(--md-sys-color-on-surface);
      max-width: 680px;
      margin: 40px auto;
      padding: 24px;
      -webkit-font-smoothing: antialiased;
    }

    .card {
      background: var(--md-sys-color-surface);
      padding: 32px;
      border-radius: 28px;
      border: 1px solid var(--md-sys-color-surface-variant);
      box-shadow: var(--md-sys-elevation-1);
    }

    h1 { 
      font-size: 28px; 
      font-weight: 400; 
      margin: 0 0 12px 0; 
      color: var(--md-sys-color-on-surface);
    }

    p { 
      color: var(--md-sys-color-on-surface-variant); 
      font-size: 14px; 
      line-height: 1.6;
      margin-bottom: 32px; 
    }

    p a {
      color: var(--md-sys-color-primary);
      text-decoration: none;
      font-weight: 500;
    }

    textarea {
      width: 100%;
      height: 360px;
      font-family: 'Roboto Mono', ui-monospace, monospace;
      font-size: 13px;
      padding: 20px;
      border: 1px solid var(--md-sys-color-outline);
      border-radius: 12px;
      background-color: var(--md-sys-color-surface-variant);
      color: var(--md-sys-color-on-surface-variant);
      resize: vertical;
      box-sizing: border-box;
      outline: none;
      transition: border-color 0.2s;
    }

    textarea:focus {
      border-color: var(--md-sys-color-primary);
      border-width: 2px;
    }

    .btn-save {
      background-color: var(--md-sys-color-primary);
      color: var(--md-sys-color-on-primary);
      border: none;
      padding: 12px 24px;
      height: 40px;
      border-radius: 20px;
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      margin-top: 24px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: var(--md-sys-elevation-1);
    }

    .btn-save:hover { 
      box-shadow: var(--md-sys-elevation-2);
      opacity: 0.9;
    }

    .btn-save:active {
      transform: scale(0.98);
    }

    .status {
      margin-top: 16px;
      font-size: 14px;
      font-weight: 500;
      color: var(--md-sys-color-success);
      display: none;
      animation: fadeIn 0.3s ease;
    }

    code { 
      background: var(--md-sys-color-primary-container); 
      color: var(--md-sys-color-on-primary-container);
      padding: 2px 6px; 
      border-radius: 4px; 
      font-size: 12px;
    }

    .example-box {
      margin-top: 40px; 
      font-size: 12px; 
      color: var(--md-sys-color-on-surface-variant);
      background: var(--md-sys-color-surface-variant);
      padding: 16px;
      border-radius: 12px;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body data-i18n-title="options_title">
  <div class="card">
    <h1 data-i18n="options_header">Custom Site Adapters</h1>
    <p data-i18n="options_description">Define custom CSS selectors for your favorite sites. You can find pre-made configurations in our <a href="https://github.com/Kaneta/voicemux-bridge/blob/main/docs/community-adapters.md" target="_blank">Community Adapters Catalog</a>.</p>
    
    <textarea id="custom-adapters" spellcheck="false" placeholder='[
  {
    "name": "Custom App",
    "host": "example.com",
    "inputSelector": ".my-input",
    "submitSelector": ".my-send-button"
  }
]'></textarea>

    <button id="save" class="btn-save" data-i18n="btn_save_config">Save Configuration</button>
    <div id="status" class="status" data-i18n="status_saved">Settings saved successfully</div>

    <div class="example-box">
      <strong data-i18n="example_structure">Example Structure:</strong><br>
      <code>[{"name": "Slack", "host": "slack.com", "inputSelector": ".ql-editor", "submitSelector": "button.c-button-unstyled"}]</code>
    </div>
  </div>
  <script src="options.js"></script>
</body>
</html>

--- END OF FILE: ./options.html ---

--- FILE: ./options.js ---
// VoiceMux Options JS
const textarea = document.getElementById('custom-adapters');
const saveBtn = document.getElementById('save');
const status = document.getElementById('status');

// Load saved settings
document.addEventListener('DOMContentLoaded', async () => {
  localize();
  const data = await chrome.storage.local.get('custom_adapters');
  if (data.custom_adapters) {
    textarea.value = JSON.stringify(data.custom_adapters, null, 2);
  }
});

// Save settings
saveBtn.addEventListener('click', async () => {
  const rawValue = textarea.value.trim();
  let parsedValue = [];

  if (rawValue) {
    try {
      parsedValue = JSON.parse(rawValue);
      if (!Array.isArray(parsedValue)) throw new Error("Must be an array");
    } catch (e) {
      alert(chrome.i18n.getMessage("invalid_json_format", [e.message]));
      return;
    }
  }

  await chrome.storage.local.set({ 'custom_adapters': parsedValue });
  
  // Show status
  status.style.display = 'block';
  setTimeout(() => {
    status.style.display = 'none';
  }, 2000);
});

function localize() {
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    const message = chrome.i18n.getMessage(key);
    if (message) {
      if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
        element.placeholder = message;
      } else {
        element.innerHTML = message;
      }
    }
  });

  document.querySelectorAll('[data-i18n-title]').forEach(element => {
    const key = element.getAttribute('data-i18n-title');
    const message = chrome.i18n.getMessage(key);
    if (message) {
      document.title = message;
    }
  });
}

--- END OF FILE: ./options.js ---

--- FILE: ./popup.html ---
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    :root {
      /* M3 Light Palette (Violet baseline) */
      --md-sys-color-primary: #6750A4;
      --md-sys-color-on-primary: #FFFFFF;
      --md-sys-color-primary-container: #EADDFF;
      --md-sys-color-on-primary-container: #21005D;
      --md-sys-color-secondary-container: #E8DEF8;
      --md-sys-color-on-secondary-container: #1D192B;
      --md-sys-color-surface: #FEF7FF;
      --md-sys-color-on-surface: #1D1B20;
      --md-sys-color-surface-variant: #E7E0EB;
      --md-sys-color-on-surface-variant: #49454F;
      --md-sys-color-outline: #79747E;
      --md-sys-color-success: #10b981;
      --md-sys-color-warning: #f59e0b;

      /* Elevation */
      --md-sys-elevation-1: 0px 1px 3px 1px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
      --md-sys-elevation-2: 0px 2px 6px 2px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
    }

    body {
      width: 320px;
      font-family: 'Roboto', system-ui, -apple-system, sans-serif;
      margin: 0;
      padding: 20px 24px;
      background-color: var(--md-sys-color-surface);
      color: var(--md-sys-color-on-surface);
      -webkit-font-smoothing: antialiased;
      overflow: hidden;
    }

    .header {
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    h1 {
      font-size: 18px;
      font-weight: 700;
      margin: 0;
      color: var(--md-sys-color-primary);
      letter-spacing: -0.02em;
    }

    .status-indicator-group {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: var(--md-sys-color-warning);
      box-shadow: 0 0 0 2px var(--md-sys-color-surface);
    }

    .status-dot.online {
      background-color: var(--md-sys-color-success);
      box-shadow: 0 0 8px var(--md-sys-color-success);
    }

    /* Views */
    #unlinked-view, #linked-view {
      display: none;
      flex-direction: column;
      align-items: center;
      text-align: center;
      animation: fadeIn 0.3s ease-out;
    }

    /* Common Button Style (MD3 Tonal Capsule) */
    .btn-tonal {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 24px;
      background-color: var(--md-sys-color-secondary-container);
      color: var(--md-sys-color-on-secondary-container);
      border: none;
      border-radius: 9999px;
      font-size: 14px;
      font-weight: 700;
      text-decoration: none;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }

    .btn-tonal:hover {
      filter: brightness(0.95);
      box-shadow: var(--md-sys-elevation-1);
    }

    .btn-tonal:active {
      transform: scale(0.98);
    }

    /* Footer Links */
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-top: 16px;
      margin-bottom: 4px;
    }

    .f-link {
      font-size: 11px;
      color: var(--md-sys-color-primary);
      text-decoration: none;
      opacity: 0.7;
      font-weight: 600;
    }
    .f-link:hover { opacity: 1; text-decoration: underline; }

    /* Unlinked View Specific */
    .sync-wait-container {
      position: relative;
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
    }

    .pulse {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background-color: var(--md-sys-color-primary);
      opacity: 0.2;
      animation: pulse 2s infinite cubic-bezier(0.4, 0, 0.6, 1);
    }

    .waiting-text-main {
      font-size: 1.1rem;
      font-weight: 800;
      margin: 0 0 12px 0;
      color: var(--md-sys-color-on-surface);
      line-height: 1.3;
    }

    .waiting-text-sub {
      font-size: 13px;
      color: var(--md-sys-color-on-surface-variant);
      margin-bottom: 24px;
      line-height: 1.5;
      padding: 0 8px;
    }

    /* Linked View Specific */
    .ready-msg {
      font-size: 1.15rem;
      font-weight: 900;
      color: var(--md-sys-color-primary);
      margin: 0 0 8px 0;
      line-height: 1.2;
    }

    .sync-instruction {
      font-size: 13px;
      color: var(--md-sys-color-on-surface-variant);
      margin-bottom: 24px;
      line-height: 1.4;
      padding: 0 12px;
      white-space: nowrap;
    }

    #qrcode-link {
      display: block;
      margin-bottom: 12px;
      text-decoration: none;
      transition: transform 0.2s;
    }

    #qrcode-link:hover { transform: scale(1.02); }

    #qrcode {
      background: white;
      padding: 12px;
      border-radius: 20px;
      box-shadow: var(--md-sys-elevation-2);
      border: 1px solid var(--md-sys-color-surface-variant);
    }

    .room-info {
      font-size: 11px;
      font-weight: 500;
      color: var(--md-sys-color-on-surface-variant);
      opacity: 0.7;
      margin-bottom: 12px;
    }

    /* Subtle Copy Button */
    .btn-copy-link {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 8px 24px;
      background: transparent;
      color: var(--md-sys-color-primary);
      border: 1px solid var(--md-sys-color-outline);
      border-radius: 100px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 24px;
      transition: all 0.2s;
    }

    .btn-copy-link:hover { background-color: rgba(103, 80, 164, 0.05); }
    .btn-copy-link.success { border-color: var(--md-sys-color-success); color: var(--md-sys-color-success); }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 0.4; }
      100% { transform: scale(1.6); opacity: 0; }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1 data-i18n="name">VoiceMux Bridge</h1>
    <div class="status-indicator-group">
      <div id="status-indicator" class="status-dot"></div>
    </div>
  </div>

  <!-- View 1: Unlinked -->
  <div id="unlinked-view">
    <div class="sync-wait-container">
      <div class="pulse"></div>
      <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--md-sys-color-primary); z-index: 1;">
        <path d="M21 2v6h-6"></path><path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path><path d="M3 22v-6h6"></path><path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
      </svg>
    </div>
    <h2 class="waiting-text-main" data-i18n="waiting_hub_main">First, let's link with the Hub</h2>
    <p class="waiting-text-sub" data-i18n="waiting_hub_sub">Once you open the VoiceMux Hub site, the pairing QR code will appear here automatically.</p>
    <button id="btn-open-hub" class="btn-tonal" data-i18n="btn_open_hub">ğŸš€ Open Hub to Link</button>
  </div>

  <!-- View 2: Linked (Ready) -->
  <div id="linked-view">
    <h2 class="ready-msg" data-i18n="ready_to_sync">Ready to Pair!</h2>
    <p class="sync-instruction" data-i18n="sync_instruction">Scan with your phone to start input.</p>

    <a id="qrcode-link" href="#" target="_blank">
      <div id="qrcode"></div>
    </a>
    <div id="room-id" class="room-info" data-i18n="room_loading">Room: Loading...</div>

    <button id="copy-btn" class="btn-copy-link">
      <span id="copy-text" data-i18n="btn_copy_link">Copy Link</span>
    </button>

    <a href="https://hub.knc.jp" id="hub-link" target="_blank" class="btn-tonal" data-i18n="btn_manage_librarian">
      ğŸª„ Fix Errors & Generate Prompts
    </a>
  </div>

  <div class="footer-links">
    <a href="https://github.com/Kaneta/voicemux-bridge/issues" target="_blank" class="f-link" data-i18n="link_support">Support</a>
    <a href="https://knc.jp/ja/docs/voicemux-bridge/" id="guide-link" target="_blank" class="f-link" data-i18n="link_guide">Guide</a>
    <a href="https://github.com/Kaneta/voicemux-bridge/blob/main/PRIVACY.md" target="_blank" class="f-link" data-i18n="link_privacy">Privacy</a>
  </div>

  <script src="qrcode.min.js"></script>
  <script src="popup.js"></script>
</body>
</html>

--- END OF FILE: ./popup.html ---

--- FILE: ./popup.js ---
// VoiceMux Popup JS (v2.1.0 Finalized UI)
document.addEventListener('DOMContentLoaded', async () => {
  // Localization
  localize();

  const unlinkedView = document.getElementById("unlinked-view");
  const linkedView = document.getElementById("linked-view");
  const qrcodeContainer = document.getElementById("qrcode");
  const qrcodeLink = document.getElementById("qrcode-link");
  const roomIdDisplay = document.getElementById("room-id");
  const btnOpenHub = document.getElementById("btn-open-hub");
  const statusIndicator = document.getElementById("status-indicator");
  const hubLink = document.getElementById("hub-link");

  // 1. Retrieve credentials from storage
  async function updateUI() {
    const data = await chrome.storage.local.get(['voicemux_room_id', 'voicemux_token', 'voicemux_key', 'voicemux_hub_url']);
    const roomId = data.voicemux_room_id;
    const token = data.voicemux_token;
    const keyBase64 = data.voicemux_key;
    
    let hubOrigin = 'https://hub.knc.jp';
    try {
      const rawHubUrl = data.voicemux_hub_url || 'https://hub.knc.jp';
      hubOrigin = new URL(rawHubUrl).origin;
    } catch (e) {}

    if (roomId && token && keyBase64) {
      // --- LINKED STATE (READY) ---
      linkedView.style.display = "flex";
      unlinkedView.style.display = "none";
      statusIndicator.classList.add("online");

      // Update Hub Link
      if (hubLink) hubLink.href = `${hubOrigin}/welcome`;

      // Construct Pairing URL
      let pairingUrl = `${hubOrigin}/${roomId}/zen`;
      pairingUrl += `?token=${token}&uuid=${roomId}`;
      pairingUrl += `#key=${keyBase64}`;
      
      roomIdDisplay.innerText = chrome.i18n.getMessage("room_label", [roomId]);
      qrcodeLink.href = pairingUrl;

      // Handle Copy Button
      const copyBtn = document.getElementById("copy-btn");
      const copyText = document.getElementById("copy-text");
      copyBtn.onclick = async () => {
        try {
          await navigator.clipboard.writeText(pairingUrl);
          copyText.innerText = chrome.i18n.getMessage("btn_copy_success");
          copyBtn.classList.add("success");
          setTimeout(() => {
            copyText.innerText = chrome.i18n.getMessage("btn_copy_link");
            copyBtn.classList.remove("success");
          }, 2000);
        } catch (err) {}
      };

      // Generate QR Code
      if (qrcodeContainer.innerHTML === "") {
        new QRCode(qrcodeContainer, {
          text: pairingUrl,
          width: 160,
          height: 160,
          colorDark: "#6750A4",
          colorLight: "#ffffff",
          correctLevel: QRCode.CorrectLevel.H
        });
      }

    } else {
      // --- UNLINKED STATE ---
      unlinkedView.style.display = "flex";
      linkedView.style.display = "none";
      statusIndicator.classList.remove("online");

      btnOpenHub.onclick = () => {
        chrome.tabs.create({ url: hubOrigin });
      };

      // Signal background to check connection
      chrome.runtime.sendMessage({ action: "check_connection" });
    }
  }

  // Initial update
  updateUI();

  // Listen for storage changes
  chrome.storage.onChanged.addListener((changes, namespace) => {
    if (namespace === 'local' && (changes.voicemux_room_id || changes.voicemux_token)) {
      updateUI();
    }
  });
});

function localize() {
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    const message = chrome.i18n.getMessage(key);
    if (message) {
      if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
        element.placeholder = message;
      } else {
        element.innerHTML = message;
      }
    }
  });

  // Localize specialized links
  const guideLink = document.getElementById('guide-link');
  if (guideLink) {
    guideLink.href = chrome.i18n.getMessage('url_guide');
  }
}

--- END OF FILE: ./popup.js ---

--- FILE: ./qrcode.min.js ---
var QRCode;!function(){function a(a){this.mode=c.MODE_8BIT_BYTE,this.data=a,this.parsedData=[];for(var b=[],d=0,e=this.data.length;e>d;d++){var f=this.data.charCodeAt(d);f>65536?(b[0]=240|(1835008&f)>>>18,b[1]=128|(258048&f)>>>12,b[2]=128|(4032&f)>>>6,b[3]=128|63&f):f>2048?(b[0]=224|(61440&f)>>>12,b[1]=128|(4032&f)>>>6,b[2]=128|63&f):f>128?(b[0]=192|(1984&f)>>>6,b[1]=128|63&f):b[0]=f,this.parsedData=this.parsedData.concat(b)}this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function b(a,b){this.typeNumber=a,this.errorCorrectLevel=b,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function i(a,b){if(void 0==a.length)throw new Error(a.length+"/"+b);for(var c=0;c<a.length&&0==a[c];)c++;this.num=new Array(a.length-c+b);for(var d=0;d<a.length-c;d++)this.num[d]=a[d+c]}function j(a,b){this.totalCount=a,this.dataCount=b}function k(){this.buffer=[],this.length=0}function m(){return"undefined"!=typeof CanvasRenderingContext2D}function n(){var a=!1,b=navigator.userAgent;return/android/i.test(b)&&(a=!0,aMat=b.toString().match(/android ([0-9]\.[0-9])/i),aMat&&aMat[1]&&(a=parseFloat(aMat[1]))),a}function r(a,b){for(var c=1,e=s(a),f=0,g=l.length;g>=f;f++){var h=0;switch(b){case d.L:h=l[f][0];break;case d.M:h=l[f][1];break;case d.Q:h=l[f][2];break;case d.H:h=l[f][3]}if(h>=e)break;c++}if(c>l.length)throw new Error("Too long data");return c}function s(a){var b=encodeURI(a).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return b.length+(b.length!=a?3:0)}a.prototype={getLength:function(){return this.parsedData.length},write:function(a){for(var b=0,c=this.parsedData.length;c>b;b++)a.put(this.parsedData[b],8)}},b.prototype={addData:function(b){var c=new a(b);this.dataList.push(c),this.dataCache=null},isDark:function(a,b){if(0>a||this.moduleCount<=a||0>b||this.moduleCount<=b)throw new Error(a+","+b);return this.modules[a][b]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(a,c){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var d=0;d<this.moduleCount;d++){this.modules[d]=new Array(this.moduleCount);for(var e=0;e<this.moduleCount;e++)this.modules[d][e]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(a,c),this.typeNumber>=7&&this.setupTypeNumber(a),null==this.dataCache&&(this.dataCache=b.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,c)},setupPositionProbePattern:function(a,b){for(var c=-1;7>=c;c++)if(!(-1>=a+c||this.moduleCount<=a+c))for(var d=-1;7>=d;d++)-1>=b+d||this.moduleCount<=b+d||(this.modules[a+c][b+d]=c>=0&&6>=c&&(0==d||6==d)||d>=0&&6>=d&&(0==c||6==c)||c>=2&&4>=c&&d>=2&&4>=d?!0:!1)},getBestMaskPattern:function(){for(var a=0,b=0,c=0;8>c;c++){this.makeImpl(!0,c);var d=f.getLostPoint(this);(0==c||a>d)&&(a=d,b=c)}return b},createMovieClip:function(a,b,c){var d=a.createEmptyMovieClip(b,c),e=1;this.make();for(var f=0;f<this.modules.length;f++)for(var g=f*e,h=0;h<this.modules[f].length;h++){var i=h*e,j=this.modules[f][h];j&&(d.beginFill(0,100),d.moveTo(i,g),d.lineTo(i+e,g),d.lineTo(i+e,g+e),d.lineTo(i,g+e),d.endFill())}return d},setupTimingPattern:function(){for(var a=8;a<this.moduleCount-8;a++)null==this.modules[a][6]&&(this.modules[a][6]=0==a%2);for(var b=8;b<this.moduleCount-8;b++)null==this.modules[6][b]&&(this.modules[6][b]=0==b%2)},setupPositionAdjustPattern:function(){for(var a=f.getPatternPosition(this.typeNumber),b=0;b<a.length;b++)for(var c=0;c<a.length;c++){var d=a[b],e=a[c];if(null==this.modules[d][e])for(var g=-2;2>=g;g++)for(var h=-2;2>=h;h++)this.modules[d+g][e+h]=-2==g||2==g||-2==h||2==h||0==g&&0==h?!0:!1}},setupTypeNumber:function(a){for(var b=f.getBCHTypeNumber(this.typeNumber),c=0;18>c;c++){var d=!a&&1==(1&b>>c);this.modules[Math.floor(c/3)][c%3+this.moduleCount-8-3]=d}for(var c=0;18>c;c++){var d=!a&&1==(1&b>>c);this.modules[c%3+this.moduleCount-8-3][Math.floor(c/3)]=d}},setupTypeInfo:function(a,b){for(var c=this.errorCorrectLevel<<3|b,d=f.getBCHTypeInfo(c),e=0;15>e;e++){var g=!a&&1==(1&d>>e);6>e?this.modules[e][8]=g:8>e?this.modules[e+1][8]=g:this.modules[this.moduleCount-15+e][8]=g}for(var e=0;15>e;e++){var g=!a&&1==(1&d>>e);8>e?this.modules[8][this.moduleCount-e-1]=g:9>e?this.modules[8][15-e-1+1]=g:this.modules[8][15-e-1]=g}this.modules[this.moduleCount-8][8]=!a},mapData:function(a,b){for(var c=-1,d=this.moduleCount-1,e=7,g=0,h=this.moduleCount-1;h>0;h-=2)for(6==h&&h--;;){for(var i=0;2>i;i++)if(null==this.modules[d][h-i]){var j=!1;g<a.length&&(j=1==(1&a[g]>>>e));var k=f.getMask(b,d,h-i);k&&(j=!j),this.modules[d][h-i]=j,e--,-1==e&&(g++,e=7)}if(d+=c,0>d||this.moduleCount<=d){d-=c,c=-c;break}}}},b.PAD0=236,b.PAD1=17,b.createData=function(a,c,d){for(var e=j.getRSBlocks(a,c),g=new k,h=0;h<d.length;h++){var i=d[h];g.put(i.mode,4),g.put(i.getLength(),f.getLengthInBits(i.mode,a)),i.write(g)}for(var l=0,h=0;h<e.length;h++)l+=e[h].dataCount;if(g.getLengthInBits()>8*l)throw new Error("code length overflow. ("+g.getLengthInBits()+">"+8*l+")");for(g.getLengthInBits()+4<=8*l&&g.put(0,4);0!=g.getLengthInBits()%8;)g.putBit(!1);for(;;){if(g.getLengthInBits()>=8*l)break;if(g.put(b.PAD0,8),g.getLengthInBits()>=8*l)break;g.put(b.PAD1,8)}return b.createBytes(g,e)},b.createBytes=function(a,b){for(var c=0,d=0,e=0,g=new Array(b.length),h=new Array(b.length),j=0;j<b.length;j++){var k=b[j].dataCount,l=b[j].totalCount-k;d=Math.max(d,k),e=Math.max(e,l),g[j]=new Array(k);for(var m=0;m<g[j].length;m++)g[j][m]=255&a.buffer[m+c];c+=k;var n=f.getErrorCorrectPolynomial(l),o=new i(g[j],n.getLength()-1),p=o.mod(n);h[j]=new Array(n.getLength()-1);for(var m=0;m<h[j].length;m++){var q=m+p.getLength()-h[j].length;h[j][m]=q>=0?p.get(q):0}}for(var r=0,m=0;m<b.length;m++)r+=b[m].totalCount;for(var s=new Array(r),t=0,m=0;d>m;m++)for(var j=0;j<b.length;j++)m<g[j].length&&(s[t++]=g[j][m]);for(var m=0;e>m;m++)for(var j=0;j<b.length;j++)m<h[j].length&&(s[t++]=h[j][m]);return s};for(var c={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},d={L:1,M:0,Q:3,H:2},e={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},f={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(a){for(var b=a<<10;f.getBCHDigit(b)-f.getBCHDigit(f.G15)>=0;)b^=f.G15<<f.getBCHDigit(b)-f.getBCHDigit(f.G15);return(a<<10|b)^f.G15_MASK},getBCHTypeNumber:function(a){for(var b=a<<12;f.getBCHDigit(b)-f.getBCHDigit(f.G18)>=0;)b^=f.G18<<f.getBCHDigit(b)-f.getBCHDigit(f.G18);return a<<12|b},getBCHDigit:function(a){for(var b=0;0!=a;)b++,a>>>=1;return b},getPatternPosition:function(a){return f.PATTERN_POSITION_TABLE[a-1]},getMask:function(a,b,c){switch(a){case e.PATTERN000:return 0==(b+c)%2;case e.PATTERN001:return 0==b%2;case e.PATTERN010:return 0==c%3;case e.PATTERN011:return 0==(b+c)%3;case e.PATTERN100:return 0==(Math.floor(b/2)+Math.floor(c/3))%2;case e.PATTERN101:return 0==b*c%2+b*c%3;case e.PATTERN110:return 0==(b*c%2+b*c%3)%2;case e.PATTERN111:return 0==(b*c%3+(b+c)%2)%2;default:throw new Error("bad maskPattern:"+a)}},getErrorCorrectPolynomial:function(a){for(var b=new i([1],0),c=0;a>c;c++)b=b.multiply(new i([1,g.gexp(c)],0));return b},getLengthInBits:function(a,b){if(b>=1&&10>b)switch(a){case c.MODE_NUMBER:return 10;case c.MODE_ALPHA_NUM:return 9;case c.MODE_8BIT_BYTE:return 8;case c.MODE_KANJI:return 8;default:throw new Error("mode:"+a)}else if(27>b)switch(a){case c.MODE_NUMBER:return 12;case c.MODE_ALPHA_NUM:return 11;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 10;default:throw new Error("mode:"+a)}else{if(!(41>b))throw new Error("type:"+b);switch(a){case c.MODE_NUMBER:return 14;case c.MODE_ALPHA_NUM:return 13;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 12;default:throw new Error("mode:"+a)}}},getLostPoint:function(a){for(var b=a.getModuleCount(),c=0,d=0;b>d;d++)for(var e=0;b>e;e++){for(var f=0,g=a.isDark(d,e),h=-1;1>=h;h++)if(!(0>d+h||d+h>=b))for(var i=-1;1>=i;i++)0>e+i||e+i>=b||(0!=h||0!=i)&&g==a.isDark(d+h,e+i)&&f++;f>5&&(c+=3+f-5)}for(var d=0;b-1>d;d++)for(var e=0;b-1>e;e++){var j=0;a.isDark(d,e)&&j++,a.isDark(d+1,e)&&j++,a.isDark(d,e+1)&&j++,a.isDark(d+1,e+1)&&j++,(0==j||4==j)&&(c+=3)}for(var d=0;b>d;d++)for(var e=0;b-6>e;e++)a.isDark(d,e)&&!a.isDark(d,e+1)&&a.isDark(d,e+2)&&a.isDark(d,e+3)&&a.isDark(d,e+4)&&!a.isDark(d,e+5)&&a.isDark(d,e+6)&&(c+=40);for(var e=0;b>e;e++)for(var d=0;b-6>d;d++)a.isDark(d,e)&&!a.isDark(d+1,e)&&a.isDark(d+2,e)&&a.isDark(d+3,e)&&a.isDark(d+4,e)&&!a.isDark(d+5,e)&&a.isDark(d+6,e)&&(c+=40);for(var k=0,e=0;b>e;e++)for(var d=0;b>d;d++)a.isDark(d,e)&&k++;var l=Math.abs(100*k/b/b-50)/5;return c+=10*l}},g={glog:function(a){if(1>a)throw new Error("glog("+a+")");return g.LOG_TABLE[a]},gexp:function(a){for(;0>a;)a+=255;for(;a>=256;)a-=255;return g.EXP_TABLE[a]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},h=0;8>h;h++)g.EXP_TABLE[h]=1<<h;for(var h=8;256>h;h++)g.EXP_TABLE[h]=g.EXP_TABLE[h-4]^g.EXP_TABLE[h-5]^g.EXP_TABLE[h-6]^g.EXP_TABLE[h-8];for(var h=0;255>h;h++)g.LOG_TABLE[g.EXP_TABLE[h]]=h;i.prototype={get:function(a){return this.num[a]},getLength:function(){return this.num.length},multiply:function(a){for(var b=new Array(this.getLength()+a.getLength()-1),c=0;c<this.getLength();c++)for(var d=0;d<a.getLength();d++)b[c+d]^=g.gexp(g.glog(this.get(c))+g.glog(a.get(d)));return new i(b,0)},mod:function(a){if(this.getLength()-a.getLength()<0)return this;for(var b=g.glog(this.get(0))-g.glog(a.get(0)),c=new Array(this.getLength()),d=0;d<this.getLength();d++)c[d]=this.get(d);for(var d=0;d<a.getLength();d++)c[d]^=g.gexp(g.glog(a.get(d))+b);return new i(c,0).mod(a)}},j.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],j.getRSBlocks=function(a,b){var c=j.getRsBlockTable(a,b);if(void 0==c)throw new Error("bad rs block @ typeNumber:"+a+"/errorCorrectLevel:"+b);for(var d=c.length/3,e=[],f=0;d>f;f++)for(var g=c[3*f+0],h=c[3*f+1],i=c[3*f+2],k=0;g>k;k++)e.push(new j(h,i));return e},j.getRsBlockTable=function(a,b){switch(b){case d.L:return j.RS_BLOCK_TABLE[4*(a-1)+0];case d.M:return j.RS_BLOCK_TABLE[4*(a-1)+1];case d.Q:return j.RS_BLOCK_TABLE[4*(a-1)+2];case d.H:return j.RS_BLOCK_TABLE[4*(a-1)+3];default:return void 0}},k.prototype={get:function(a){var b=Math.floor(a/8);return 1==(1&this.buffer[b]>>>7-a%8)},put:function(a,b){for(var c=0;b>c;c++)this.putBit(1==(1&a>>>b-c-1))},getLengthInBits:function(){return this.length},putBit:function(a){var b=Math.floor(this.length/8);this.buffer.length<=b&&this.buffer.push(0),a&&(this.buffer[b]|=128>>>this.length%8),this.length++}};var l=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],o=function(){var a=function(a,b){this._el=a,this._htOption=b};return a.prototype.draw=function(a){function g(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a);for(var d in b)b.hasOwnProperty(d)&&c.setAttribute(d,b[d]);return c}var b=this._htOption,c=this._el,d=a.getModuleCount();Math.floor(b.width/d),Math.floor(b.height/d),this.clear();var h=g("svg",{viewBox:"0 0 "+String(d)+" "+String(d),width:"100%",height:"100%",fill:b.colorLight});h.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),c.appendChild(h),h.appendChild(g("rect",{fill:b.colorDark,width:"1",height:"1",id:"template"}));for(var i=0;d>i;i++)for(var j=0;d>j;j++)if(a.isDark(i,j)){var k=g("use",{x:String(i),y:String(j)});k.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),h.appendChild(k)}},a.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},a}(),p="svg"===document.documentElement.tagName.toLowerCase(),q=p?o:m()?function(){function a(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}function d(a,b){var c=this;if(c._fFail=b,c._fSuccess=a,null===c._bSupportDataURI){var d=document.createElement("img"),e=function(){c._bSupportDataURI=!1,c._fFail&&_fFail.call(c)},f=function(){c._bSupportDataURI=!0,c._fSuccess&&c._fSuccess.call(c)};return d.onabort=e,d.onerror=e,d.onload=f,d.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==",void 0}c._bSupportDataURI===!0&&c._fSuccess?c._fSuccess.call(c):c._bSupportDataURI===!1&&c._fFail&&c._fFail.call(c)}if(this._android&&this._android<=2.1){var b=1/window.devicePixelRatio,c=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(a,d,e,f,g,h,i,j){if("nodeName"in a&&/img/i.test(a.nodeName))for(var l=arguments.length-1;l>=1;l--)arguments[l]=arguments[l]*b;else"undefined"==typeof j&&(arguments[1]*=b,arguments[2]*=b,arguments[3]*=b,arguments[4]*=b);c.apply(this,arguments)}}var e=function(a,b){this._bIsPainted=!1,this._android=n(),this._htOption=b,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=b.width,this._elCanvas.height=b.height,a.appendChild(this._elCanvas),this._el=a,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return e.prototype.draw=function(a){var b=this._elImage,c=this._oContext,d=this._htOption,e=a.getModuleCount(),f=d.width/e,g=d.height/e,h=Math.round(f),i=Math.round(g);b.style.display="none",this.clear();for(var j=0;e>j;j++)for(var k=0;e>k;k++){var l=a.isDark(j,k),m=k*f,n=j*g;c.strokeStyle=l?d.colorDark:d.colorLight,c.lineWidth=1,c.fillStyle=l?d.colorDark:d.colorLight,c.fillRect(m,n,f,g),c.strokeRect(Math.floor(m)+.5,Math.floor(n)+.5,h,i),c.strokeRect(Math.ceil(m)-.5,Math.ceil(n)-.5,h,i)}this._bIsPainted=!0},e.prototype.makeImage=function(){this._bIsPainted&&d.call(this,a)},e.prototype.isPainted=function(){return this._bIsPainted},e.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},e.prototype.round=function(a){return a?Math.floor(1e3*a)/1e3:a},e}():function(){var a=function(a,b){this._el=a,this._htOption=b};return a.prototype.draw=function(a){for(var b=this._htOption,c=this._el,d=a.getModuleCount(),e=Math.floor(b.width/d),f=Math.floor(b.height/d),g=['<table style="border:0;border-collapse:collapse;">'],h=0;d>h;h++){g.push("<tr>");for(var i=0;d>i;i++)g.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+e+"px;height:"+f+"px;background-color:"+(a.isDark(h,i)?b.colorDark:b.colorLight)+';"></td>');g.push("</tr>")}g.push("</table>"),c.innerHTML=g.join("");var j=c.childNodes[0],k=(b.width-j.offsetWidth)/2,l=(b.height-j.offsetHeight)/2;k>0&&l>0&&(j.style.margin=l+"px "+k+"px")},a.prototype.clear=function(){this._el.innerHTML=""},a}();QRCode=function(a,b){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:d.H},"string"==typeof b&&(b={text:b}),b)for(var c in b)this._htOption[c]=b[c];"string"==typeof a&&(a=document.getElementById(a)),this._android=n(),this._el=a,this._oQRCode=null,this._oDrawing=new q(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},QRCode.prototype.makeCode=function(a){this._oQRCode=new b(r(a,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(a),this._oQRCode.make(),this._el.title=a,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=d}();
--- END OF FILE: ./qrcode.min.js ---

--- FILE: ./README.md ---
# VoiceMux Bridge v2.1.0 ğŸ›°ï¸

VoiceMux Bridge ã¯ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®éŸ³å£°å…¥åŠ›ã‚’ PC ä¸Šã®ã‚ã‚‰ã‚†ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆï¼ˆChatGPT, Gmail, Slack ç­‰ï¼‰ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æŒ¿å…¥ã™ã‚‹ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã§ã™ã€‚

## ğŸš€ v2.1.0 ã®æ–°æ©Ÿèƒ½: Multi-language Support & Secure Push-Sync
å¾“æ¥ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆv1.xï¼‰ã§è¡Œã£ã¦ã„ãŸã€Œå®šæœŸçš„ãªãƒšãƒ¼ã‚¸ç›£è¦–ã€ã‚„ã€Œæ‰‹å‹•ã§ã® ID å–å¾—ã€ã‚’å®Œå…¨ã«å»ƒæ­¢ã—ã¾ã—ãŸã€‚

- **å¤šè¨€èªå¯¾å¿œ (i18n)**: æ—¥æœ¬èªã¨è‹±èªã®è¡¨ç¤ºã«å®Œå…¨å¯¾å¿œã€‚
- **ã‚¼ãƒ­è¨­å®šåŒæœŸ**: [VoiceMux Hub](https://hub.knc.jp) ã‚’é–‹ãã ã‘ã§ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ãŒå®‰å…¨ã‹ã¤å³åº§ã«æ‹¡å¼µæ©Ÿèƒ½ã¸ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚
- **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ»ãƒšã‚¢ãƒªãƒ³ã‚°**: ä¸€åº¦é€£æºã™ã‚Œã°ã€æ¬¡å›ã‹ã‚‰ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ã—ã¦å³åº§ã« QR ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã€‚
- **ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ç¬¬ä¸€**: ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ã‚„æš—å·éµï¼‰ãŒ HTML ä¸Šã«éœ²å‡ºã™ã‚‹ã“ã¨ãªãã€ãƒ–ãƒ©ã‚¦ã‚¶ã®æ­£è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚° API ã§å—ã‘æ¸¡ã—ã•ã‚Œã¾ã™ã€‚

## ğŸ›  ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ä½¿ã„æ–¹
1. [Chrome ã‚¦ã‚§ãƒ–ã‚¹ãƒˆã‚¢](https://chromewebstore.google.com/detail/voicemux-bridge/agkglknmadfhdfobmgecllpgoecebdip) ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚
2. ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®ãƒ‘ã‚ºãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã‹ã‚‰ VoiceMux Bridge ã‚’ã€Œãƒ”ãƒ³ç•™ã‚ã€ã—ã¾ã™ã€‚
3. [VoiceMux Hub](https://hub.knc.jp) ã‚’é–‹ãã€åˆæœŸåŒ–ã‚’å®Œäº†ã•ã›ã¾ã™ï¼ˆè‡ªå‹•çš„ã«æ‹¡å¼µæ©Ÿèƒ½ã¸åŒæœŸã•ã‚Œã¾ã™ï¼‰ã€‚
4. æ‹¡å¼µã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€è¡¨ç¤ºã•ã‚ŒãŸ QR ã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ãƒãƒ›ã§ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚Œã°æº–å‚™å®Œäº†ã§ã™ã€‚

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ (E2EE)
VoiceMux ã¯ **End-to-End æš—å·åŒ– (E2EE)** ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚
éŸ³å£°ã‹ã‚‰å¤‰æ›ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é›¢ã‚Œã‚‹å‰ã«**ã‚ãªãŸã®ãƒ‡ãƒã‚¤ã‚¹ä¸Š**ã§æš—å·åŒ–ã•ã‚Œã¾ã™ã€‚ä¸­ç¶™ã‚µãƒ¼ãƒãƒ¼ï¼ˆv.knc.jpï¼‰ã¯æš—å·åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’è»¢é€ã—ã€ãã®ä¸­èº«ã‚’è§£èª­ã™ã‚‹ã“ã¨ã¯æš—å·å­¦çš„ã«ä¸å¯èƒ½ã§ã™ã€‚

è©³ç´°ãªå®Ÿè£…ã®è¨¼æ‹ ã¯ [E2EEå®Ÿè£…æŠ€è¡“ãƒ¬ãƒãƒ¼ãƒˆ](./docs/E2EE_IMPLEMENTATION_JA.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸ“Š ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçµ±è¨ˆ (v2.1.0)
VoiceMux Bridge ã¯ã€è»½é‡ã§é€æ˜æ€§ã®é«˜ã„è¨­è¨ˆã‚’ç¶­æŒã—ã¦ã„ã¾ã™ã€‚
- **ç·ã‚³ãƒ¼ãƒ‰è¡Œæ•°**: ç´„ 1,050 è¡Œ (JS/HTML/Manifest)
- **ä¾å­˜é–¢ä¿‚**: ã‚¼ãƒ­ (QRç”Ÿæˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª 1ã¤ã®ã¿ã‚’åŒæ¢±)
- **é€šä¿¡å…ˆ**: `knc.jp` ãƒ‰ãƒ¡ã‚¤ãƒ³ã«é™å®š

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹
ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ [LICENSE](./LICENSE) ã«åŸºã¥ã„ã¦å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®ã‚³ãƒ¼ãƒ‰ã¯å®Œå…¨ã«ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã‚ã‚Šã€èª°ã§ã‚‚ç›£æŸ»å¯èƒ½ã§ã™ã€‚

--- END OF FILE: ./README.md ---

--- FILE: ./LICENSE ---
MIT License

Copyright (c) 2026 Kohei Kaneta

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

--- END OF FILE: ./LICENSE ---

--- FILE: ./adapters.json ---
[
  {
    "id": "gemini",
    "name": "Google Gemini",
    "host": "gemini.google.com",
    "inputSelector": "div[contenteditable='true'], .rich-textarea, div[role='textbox']",
    "submitSelector": "button[aria-label*='é€ä¿¡'], button[aria-label*='Send'], button.send-button, button:has(span.material-symbols-outlined)"
  },
  {
    "id": "chatgpt",
    "name": "ChatGPT",
    "host": "chatgpt.com",
    "inputSelector": "#prompt-textarea",
    "submitSelector": "button[data-testid='send-button']"
  },
  {
    "id": "claude",
    "name": "Claude",
    "host": "claude.ai",
    "inputSelector": "div[contenteditable='true']",
    "submitSelector": "button[aria-label*='Send'], button[aria-label*='é€ä¿¡']"
  },
  {
    "id": "perplexity",
    "name": "Perplexity",
    "host": "perplexity.ai",
    "inputSelector": "textarea",
    "submitSelector": "button[aria-label*='Submit'], button[aria-label*='Ask']"
  },
  {
    "id": "treenote",
    "name": "Treenote",
    "host": "treenoteweb.pages.dev",
    "inputSelector": "textarea.auto-resize-textarea, textarea, div[contenteditable='true']",
    "submitSelector": "button.submit-btn"
  },
  {
    "id": "gmail",
    "name": "Gmail",
    "host": "mail.google.com",
    "inputSelector": "div[role='textbox'][contenteditable='true']",
    "submitSelector": null
  },
  {
    "id": "deepl",
    "name": "DeepL",
    "host": "deepl.com",
    "inputSelector": "div[contenteditable='true'], d-textarea",
    "submitSelector": null
  }
]

--- END OF FILE: ./adapters.json ---

--- FILE: ./docs/WHY_PERMISSIONS_JA.md ---
# Chromeæ‹¡å¼µæ©Ÿèƒ½ã®ã€Œå¼·åŠ›ãªæ¨©é™ã€ã¨UXã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã«ã¤ã„ã¦

**VoiceMux Bridge** ã¯ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®éŸ³å£°å…¥åŠ›ã‚’PCã®ã‚ã‚‰ã‚†ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã¸ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«è»¢é€ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ã€Œã™ã¹ã¦ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆä¸Šã®å…¨ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å–ã‚Šã¨å¤‰æ›´ã€ã¨ã„ã†è­¦å‘Šã®æ„å›³ã¨ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¸ã®é…æ…®ã«ã¤ã„ã¦é–‹ç™ºãƒãƒ¼ãƒ ã®è¦‹è§£ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚

---

## 1. ãªãœã€Œä¿¡é ¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€ã¨ã„ã†è­¦å‘ŠãŒå‡ºã‚‹ã®ã‹ï¼Ÿ

### èƒŒæ™¯
Chrome ã‚¦ã‚§ãƒ–ã‚¹ãƒˆã‚¢ã‹ã‚‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

> **è­¦å‘Š:** ã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ã‚»ãƒ¼ãƒ• ãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ä¿è­·å¼·åŒ–æ©Ÿèƒ½ã§ä¿¡é ¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

### ç†ç”±
ã“ã‚Œã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æ¬ é™¥ã§ã¯ãªãã€Google Chrome ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è©•ä¾¡ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™ã€‚ä¸»ã«ä»¥ä¸‹ã®æ¡ä»¶ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

- **é–‹ç™ºè€…å®Ÿç¸¾ã®è“„ç©æœŸé–“:** ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ç™»éŒ²ã‹ã‚‰ã®æœŸé–“ãŒçŸ­ã„ã€‚
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°:** å…¬é–‹ç›´å¾Œã§åˆ©ç”¨è€…ãŒé™å®šçš„ã§ã‚ã‚‹ã€‚

**VoiceMux ã®å¯¾å¿œ:**
ç§ãŸã¡ã¯ã™ã¹ã¦ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ GitHub ã§å…¬é–‹ã—ã¦ãŠã‚Šã€èª°ã§ã‚‚å®‰å…¨æ€§ã‚’ç›£æŸ»ã§ãã‚‹çŠ¶æ…‹ã«ã—ã¦ã„ã¾ã™ã€‚åˆ©ç”¨è€…ãŒå¢—ãˆã‚‹ã«ã¤ã‚Œã¦ã€ã“ã®è­¦å‘Šã¯è‡ªå‹•çš„ã«è¡¨ç¤ºã•ã‚Œãªããªã‚Šã¾ã™ã€‚

---

## 2. ãªãœã€Œå…¨ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã€ãŒå¿…è¦ãªã®ã‹ï¼Ÿ

### ç†ç”±ï¼šã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªã€Œãƒãƒ³ã‚ºãƒ•ãƒªãƒ¼ä½“é¨“ã€ã®å®Ÿç¾
VoiceMux Bridge ã®æ ¸å¿ƒã¯ã€**ã€ŒPCå´ã«è§¦ã‚Œã‚‹ã“ã¨ãªãã€ã‚¹ãƒãƒ›ã«è©±ã—ã‹ã‘ã‚‹ã ã‘ã§æ–‡å­—ãŒå…¥åŠ›ã•ã‚Œã‚‹ã€**ã¨ã„ã†ä½“é¨“ã§ã™ã€‚

ã“ã®ã€Œé­”æ³•ã®ã‚ˆã†ãªä½“é¨“ã€ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€æ‹¡å¼µæ©Ÿèƒ½ãŒä»¥ä¸‹ã®å‹•ä½œã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

1. **å¾…æ©Ÿ:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã©ã®ã‚¿ãƒ–ï¼ˆGemini, ChatGPT, Gmailç­‰ï¼‰ã‚’é–‹ã„ã¦ã‚‚ã€éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Œã‚‹çŠ¶æ…‹ã«ã™ã‚‹ã€‚
2. **è‡ªå‹•æ¤œçŸ¥:** ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆãŸéš›ã€æ–°ã—ã„ãƒšãƒ¼ã‚¸ä¸Šã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å³åº§ã«ç‰¹å®šã—ã¦æ–‡å­—ã‚’æµã—è¾¼ã‚€ã€‚

ã‚‚ã—æ¨©é™ã‚’ã€Œã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã ã‘ã€ã«åˆ¶é™ã—ãŸå ´åˆã€**ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã³ã«æ¯å›æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¨±å¯ã‚’ä¸ãˆã‚‹**æ“ä½œãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã§ã¯éŸ³å£°å…¥åŠ›ã®åˆ©ä¾¿æ€§ãŒæãªã‚ã‚Œã€ãƒ„ãƒ¼ãƒ«ã®å­˜åœ¨æ„ç¾©ãŒå¤±ã‚ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚

---

## 3. ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¨å®‰å…¨æ€§ã«ã¤ã„ã¦

ç§ãŸã¡ã¯ã€å¼·åŠ›ãªæ¨©é™ã‚’è¦æ±‚ã™ã‚‹è²¬ä»»ã¨ã—ã¦ã€ä»¥ä¸‹ã®è¨­è¨ˆã¨æƒ…å ±å…¬é–‹ã‚’å¾¹åº•ã—ã¦ã„ã¾ã™ã€‚

- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹åŒ–:** æ‹¡å¼µæ©Ÿèƒ½ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã™ã¹ã¦ GitHub ã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã€Œãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰é€ä¿¡ã•ã‚Œã‚‹å‰ã«ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãæš—å·åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ã€ã€Œå…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆä»¥å¤–ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã„ãªã„ã‹ã€ã‚’èª°ã§ã‚‚ç›£æŸ»å¯èƒ½ã§ã™ã€‚
- **ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰æš—å·åŒ– (E2EE):** éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚„ãƒ†ã‚­ã‚¹ãƒˆã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã¨ã‚¹ãƒãƒ›ã®é–“ã§ç›´æ¥æš—å·åŒ–ã•ã‚Œã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼å´ã¯ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰éå…¬é–‹ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆç’°å¢ƒã§é‹ç”¨ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§æš—å·åŒ–ãŒå®Œçµã—ã¦ã„ã‚‹ãŸã‚ã€ã‚µãƒ¼ãƒãƒ¼ï¼ˆå½“ã‚µã‚¤ãƒˆï¼‰ã§ã•ãˆä¸­èº«ã‚’èª­ã¿å–ã‚‹ã“ã¨ã¯ç‰©ç†çš„ã«ä¸å¯èƒ½ã§ã™ã€‚
- **ã‚µãƒ¼ãƒãƒ¼ã«éµã‚’æ¸¡ã•ãªã„ä»•çµ„ã¿:** ã‚¹ãƒãƒ›ã¨ã®ãƒšã‚¢ãƒªãƒ³ã‚°ã«ä½¿ç”¨ã™ã‚‹æš—å·éµã¯ã€URLã®ãƒãƒƒã‚·ãƒ¥ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆ`#` ä»¥é™ã®éƒ¨åˆ†ï¼‰ã¨ã—ã¦å…±æœ‰ã•ã‚Œã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ä»•æ§˜ä¸Šã€ã“ã®éƒ¨åˆ†ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œãªã„ãŸã‚ã€éµã®æƒ…å ±ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æµã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
- **æœ€å°é™ã®ãƒ‡ãƒ¼ã‚¿åé›†:** æ‹¡å¼µæ©Ÿèƒ½ã¯è¨­å®šï¼ˆRoom ID / Keyï¼‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã™ã‚‹ã®ã¿ã§ã€é–²è¦§å±¥æ­´ã‚„å€‹äººæƒ…å ±ã‚’å¤–éƒ¨ã¸é€ä¿¡ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

---

## 4. ä»–ã®ãƒ„ãƒ¼ãƒ«ã¨ã®æ¯”è¼ƒ

å¤šãã®ã‚¤ãƒ³ãƒ•ãƒ©ç³»ãƒ„ãƒ¼ãƒ«ï¼ˆ1Password, Grammarly, DeepLç­‰ï¼‰ã‚‚ã€åŒæ§˜ã®ç†ç”±ã§ã€Œå…¨ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã€ã‚’è¦æ±‚ã—ã¾ã™ã€‚ã€Œã„ã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã‚’å¿…è¦ã¨ã™ã‚‹ã‹äºˆæ¸¬ã§ããªã„ã€ãƒ„ãƒ¼ãƒ«ã«ã¨ã£ã¦ã€ã“ã®æ¨©é™ã¯åˆ©ä¾¿æ€§ã¨å®‰å…¨æ€§ã‚’ä¸¡ç«‹ã™ã‚‹ãŸã‚ã®æ¨™æº–çš„ãªé¸æŠã§ã™ã€‚

---

## çµè«–

VoiceMux Bridge ã¯ã€**ã€Œç©¶æ¥µã®å…¥åŠ›ä½“é¨“ã€ã‚’æä¾›ã™ã‚‹ãŸã‚ã«ç¾åœ¨ã®æ¨©é™è¨­å®šã‚’é¸æŠã—ã¾ã—ãŸã€‚** è­¦å‘Šã¯å¼·åŠ›ã«è¦‹ãˆã¾ã™ãŒã€ç§ãŸã¡ã¯é€æ˜æ€§ã¨æŠ€è¡“ï¼ˆE2EEï¼‰ã«ã‚ˆã£ã¦ãã®ä¿¡é ¼ã«å¿œãˆã¾ã™ã€‚

---
*æœ€çµ‚æ›´æ–°: 2026-02-17*

--- END OF FILE: ./docs/WHY_PERMISSIONS_JA.md ---

--- FILE: ./docs/WHY_PERMISSIONS_EN.md ---
# Transparency Report: Why VoiceMux Bridge Requests "Access to All Sites"

**VoiceMux Bridge** is designed to provide a seamless bridge between your smartphone's voice recognition and your desktop browser. This document explains our technical decisions regarding Chrome Extension permissions and our commitment to user privacy.

---

## 1. Why does Chrome say this extension is "Not Trusted"?

### The Issue
When installing from the Chrome Web Store, you might see this message:

> **Warning:** This extension is not trusted by Enhanced Safe Browsing.

### The Reason
This is not due to a bug or malware. It is a standard automated security check by Google based on:

- **Developer Longevity:** The developer account is relatively new.
- **User Base:** The extension was recently published and has a growing but still small number of users.

**Our Commitment:**
VoiceMux Bridge is fully open-source. We provide the source code on GitHub for public auditing to ensure complete transparency while Google's automated trust score accumulates.

---

## 2. Why "Read and Change All Your Data on All Websites"?

### The Reason: Ensuring a "Frictionless" UX
The core value of VoiceMux is the **"Magic Experience"**â€”speak into your phone, and text appears on your PC instantly without you having to touch your mouse.

To achieve this, the extension must be able to:

1. **Standby:** Listen for incoming encrypted data regardless of which tab (ChatGPT, Gemini, Notion, etc.) you are currently using.
2. **Auto-Injection:** Detect the active input field as soon as you switch tabs and inject the text without manual intervention.

If we restricted permissions to "activeTab" (only when clicked), **you would have to click the extension icon every single time you switch a tab.** This would destroy the hands-free utility that makes VoiceMux valuable.

---

## 3. Privacy and Security by Design

We understand that "All Site Access" is a powerful permission. We balance this responsibility with the following transparency measures:

- **Open Source Client:** The source code for the Chrome Extension is fully public on GitHub. This allows anyone to verify that data is encrypted *before* it leaves your browser and that we are not touching sensitive data like passwords.
- **End-to-End Encryption (E2EE):** While our relay server operates in a private environment, it only handles encrypted blobs. Since the encryption happens in the open-source client, the server remains a "black box" that cannot see or log your actual text.
- **Zero-Knowledge Key Exchange:** Your encryption keys are shared with your phone via URL hash fragments (`#key=...`). By technical design, these fragments are never sent to any server, ensuring your keys never touch the network.
- **No Tracking:** We do not collect browsing history or analytics. Your encryption keys and Room IDs stay stored locally on your devices.

---

## 4. Industry Standards

Most essential productivity tools, such as **1Password, Grammarly, and DeepL**, require the same level of permission. Because these tools must be ready to assist you the moment you start typing, constant presence is a technical necessity.

---

## Conclusion

We chose this permission model to deliver the **fastest, most seamless input experience possible.** While the system warning looks intimidating, we stand behind our transparent, E2EE-secured architecture to earn your trust.

---
*Last Updated: 2026-02-17*

--- END OF FILE: ./docs/WHY_PERMISSIONS_EN.md ---

--- FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION.md ---
# ã€é–‹ç™ºãƒ­ã‚°ã€‘Chromeæ‹¡å¼µã®ã€Œæ€–ã„è­¦å‘Šã€ã«ã¤ã„ã¦AIã¨ç›¸è«‡ã—ãŸè¨˜éŒ²

VoiceMux Bridge ã®ãƒªãƒªãƒ¼ã‚¹ã«ã‚ãŸã‚Šã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­¦å‘Šã«ã¤ã„ã¦ã€AIï¼ˆGeminiï¼‰ã¨æŠ€è¡“çš„ãªç›¸è«‡ã‚’ã—ãŸéš›ã®ãƒ­ã‚°ã‚’å…¬é–‹ã—ã¾ã™ã€‚ãªãœã“ã®ä»•æ§˜ï¼ˆæ¨©é™ï¼‰ã«ãªã£ã¦ã„ã‚‹ã®ã‹ã€ãã®çµŒç·¯ãŒã‚ã‹ã‚Šã¾ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
è‡ªä½œã®æ‹¡å¼µæ©Ÿèƒ½ã‚’å…¬é–‹ã—ã¾ã—ãŸãŒã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€Œã‚»ãƒ¼ãƒ• ãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ä¿è­·å¼·åŒ–æ©Ÿèƒ½ã§ä¿¡é ¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€ã¨ã„ã†è­¦å‘ŠãŒå‡ºã¦ãã¾ã™ã€‚ä½•ã‹ãƒã‚°ãŒã‚ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

#### ğŸ¤– AI
çµè«–ã‹ã‚‰è¨€ã†ã¨ã€ã“ã‚Œã¯**ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒã‚°ã‚„è¦ç´„é•åã§ã¯ãªãã€ä¸»ã«ã€Œé–‹ç™ºè€…ã¨ã—ã¦ã®å®Ÿç¸¾ï¼ˆä¿¡é ¼ï¼‰ãŒã¾ã è“„ç©ã•ã‚Œã¦ã„ãªã„ã€ã“ã¨ãŒåŸå› **ã§ã™ã€‚

Google Chromeã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä»•æ§˜ã«ã‚ˆã‚‹ã‚‚ã®ã§ã€ä»¥ä¸‹ã®ãƒã‚¤ãƒ³ãƒˆãŒå½±éŸ¿ã—ã¦ã„ã¾ã™ã€‚

1.  **ã€Œä¿¡é ¼ã§ãã‚‹é–‹ç™ºè€…ã€ã®åŸºæº–ã‚’æº€ãŸã—ã¦ã„ãªã„:** ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ç™»éŒ²ã‹ã‚‰æ—¥ãŒæµ…ã„ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ•°ãŒã¾ã å°‘ãªã„ãªã©ã€‚
2.  **å…¬é–‹ç›´å¾Œã§ã‚ã‚‹:** å…¬é–‹ã•ã‚ŒãŸã°ã‹ã‚Šã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€Googleå´ã®ã‚¹ã‚­ãƒ£ãƒ³ã‚„è©•ä¾¡ãŒçµ‚ã‚ã£ã¦ã„ãªã„ãŸã‚ã€è­¦å‘ŠãŒå‡ºã‚„ã™ã„å‚¾å‘ã«ã‚ã‚Šã¾ã™ã€‚

æ®‹å¿µãªãŒã‚‰ãƒœã‚¿ãƒ³ä¸€ã¤ã§æ¶ˆã™è¨­å®šã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€**ã€Œæ™‚é–“ãŒè§£æ±ºã™ã‚‹ï¼ˆå®Ÿç¸¾ã‚’ç©ã‚€ï¼‰ã€**ã®ã‚’å¾…ã¤ã®ãŒæ­£æ”»æ³•ã§ã™ã€‚å…¬é–‹ç›´å¾Œã«ã‚ˆãã‚ã‚‹ç¾è±¡ãªã®ã§ã€ã¾ãšã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€Œå®‰å…¨ã§ã™ã€ã¨ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã—ã¦å®Ÿç¸¾ã‚’ä½œã‚‹ã®ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’é€²ã‚ã‚‹ã¨ã€ä»Šåº¦ã¯ã€Œã™ã¹ã¦ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆä¸Šã«ã‚ã‚‹è‡ªåˆ†ã®å…¨ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å–ã‚Šã¨å¤‰æ›´ã€ã¨ã„ã†ã•ã‚‰ã«æ€–ã„è­¦å‘ŠãŒå‡ºã¾ã™ã€‚ã“ã‚Œã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¼•ã„ã¦ã—ã¾ã„ã¾ã™ã‚ˆã­ã€‚

#### ğŸ¤– AI
ãã®è­¦å‘Šã¯ã€**ã€Œç‰¹å®šã®ãƒšãƒ¼ã‚¸é™å®šã€ã‹ã‚‰ã€Œä»»æ„ã®ãƒšãƒ¼ã‚¸ï¼ˆã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ï¼‰ã€ã¸å…¥åŠ›å¯¾è±¡ã‚’åºƒã’ãŸã“ã¨**ãŒåŸå› ã§ã™ã­ã€‚

`manifest.json` ã§ `<all_urls>` ã¨ã„ã†æ¨©é™ã‚’ä½¿ã£ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ

VoiceMux Bridgeã®ã€Œã‚¹ãƒãƒ›ã«å‘ã‹ã£ã¦è©±ã›ã°ã€ä»Šé–‹ã„ã¦ã„ã‚‹ãƒšãƒ¼ã‚¸ã«å³åº§ã«å…¥åŠ›ã•ã‚Œã‚‹ã€ã¨ã„ã†ä½“é¨“ã‚’å®Ÿç¾ã™ã‚‹ã«ã¯ã€**ã‚ã‚‰ã‹ã˜ã‚ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ã§å—ä¿¡ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å¾…æ©Ÿã•ã›ã¦ãŠã**å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
Chromeã®ä»•æ§˜ä¸Šã€ã“ã®ã€Œå…¨ãƒšãƒ¼ã‚¸å¾…æ©Ÿã€ã®æ¨©é™ã‚’æ±‚ã‚ã‚‹ã¨ã€è‡ªå‹•çš„ã«ãã®å¼·ã„è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®æ­£å¸¸ãªä»£å„Ÿã§ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ã‚‚ã—ãã®æ¨©é™ã‚’ç‹­ã‚ãŸã‚‰ã©ã†ãªã‚Šã¾ã™ã‹ï¼Ÿ è­¦å‘Šã¯æ¶ˆãˆã¾ã™ã‹ï¼Ÿ

#### ğŸ¤– AI
æ¨©é™ã‚’ `activeTab` ã ã‘ã«ç‹­ã‚ã‚Œã°è­¦å‘Šã¯æ¶ˆãˆã¾ã™ã€‚ã—ã‹ã—ã€**ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«å‘¼ã³å‡ºã•ãªã„é™ã‚Šã€æ‹¡å¼µæ©Ÿèƒ½ã¯ä½•ã‚‚ã—ãªã„ï¼ˆã§ããªã„ï¼‰ã€** ã¨ã„ã†æŒ™å‹•ã«å¤‰ã‚ã‚Šã¾ã™ã€‚

å…·ä½“çš„ã«ã¯ã“ã†ãªã‚Šã¾ã™ï¼š

1.  Gemini Web ã‚’é–‹ã â†’ **ã‚¹ãƒãƒ›ã§è©±ã—ã¦ã‚‚ä½•ã‚‚èµ·ããªã„**ï¼ˆå—ä¿¡ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒå‹•ã„ã¦ã„ãªã„ï¼‰ã€‚
2.  æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’**ã‚¯ãƒªãƒƒã‚¯**ã™ã‚‹ â†’ ã‚„ã£ã¨å…¥åŠ›å¯èƒ½ã«ãªã‚‹ã€‚
3.  Gmail ã®ã‚¿ãƒ–ã¸ç§»å‹•ã™ã‚‹ â†’ **ã¾ãŸã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯**ã—ãªã„ã¨å‹•ã‹ãªã„ã€‚

æœ€å¤§ã®å•é¡Œã¯ã€**ã€Œã‚¯ãƒªãƒƒã‚¯ã‚’å¿˜ã‚Œã¦è©±ã—å§‹ã‚ãŸæ™‚ã€** ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€Œã›ã£ã‹ãé•·æ–‡ã‚’å–‹ã£ãŸã®ã«ã€PCã«å…¥åŠ›ã•ã‚Œãªã‹ã£ãŸï¼ã€ã¨ã„ã†ã‚¹ãƒˆãƒ¬ã‚¹ã‚’æ„Ÿã˜ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

VoiceMuxã®ã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ã®å ´åˆã€**ã€ŒPCå´ã¯ä½•ã‚‚ã—ãªãã¦ã„ã„ï¼ˆãƒãƒ³ã‚ºãƒ•ãƒªãƒ¼ï¼‰ã€** ã¨ã„ã†ã®ãŒæœ€å¤§ã®ä¾¡å€¤ãªã®ã§ã€ã‚¯ãƒªãƒƒã‚¯å¿…é ˆã«ã™ã‚‹ã®ã¯ã€Œä½¿ã„å‹æ‰‹ã®æ­»ã€ã‚’æ„å‘³ã—ã¾ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ãªã‚‹ã»ã©â€¦ã€‚ä»–ã®ä¼¼ãŸã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ï¼ˆVoiceInã¨ã‹ï¼‰ã¯ã©ã†ã—ã¦ã„ã‚‹ã‚“ã§ã™ã‹ï¼Ÿ

#### ğŸ¤– AI
èª¿ã¹ã¾ã—ãŸãŒã€**VoiceIn ã¯ã‚ãªãŸã¨åŒã˜ã€Œè­¦å‘ŠãŒå‡ºã‚‹æ–¹å¼ï¼ˆå…¨æ¨©é™ï¼‰ã€ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚**
å½¼ã‚‰ã¯ã€Œè­¦å‘Šã¯å‡ºã‚‹ã‘ã‚Œã©ã€ãã®ã¶ã‚“é­”æ³•ã®ã‚ˆã†ã«ä¾¿åˆ©ã§ã™ã‚ˆã€ã¨ã„ã†ã‚¹ã‚¿ãƒ³ã‚¹ã§ã€ä¿¡é ¼ã¨å®Ÿç¸¾ã§ã‚«ãƒãƒ¼ã—ã¦ã„ã¾ã™ã€‚

ä¸€æ–¹ã€Typeless ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µã§ã¯ãªãã€ŒOSã®ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒªã€ã‚’ä½œã‚‹ã“ã¨ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¶ç´„è‡ªä½“ã‚’å›é¿ã—ã¦ã„ã¾ã™ï¼ˆé–‹ç™ºã‚³ã‚¹ãƒˆã¯è·³ã­ä¸ŠãŒã‚Šã¾ã™ãŒï¼‰ã€‚

ã¾ãŸã€Honeyï¼ˆã‚¯ãƒ¼ãƒãƒ³ã‚¢ãƒ—ãƒªï¼‰ã®ã‚ˆã†ã«ã€Œä½¿ã†æ™‚ã ã‘è¨±å¯ã‚’æ±‚ã‚ã‚‹ã€æ–¹å¼ã‚‚ã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯ã€Œè²·ã„ç‰©ã€ã¨ã„ã†æ˜ç¢ºãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒã‚ã‚‹ãƒ„ãƒ¼ãƒ«ã ã‹ã‚‰æˆç«‹ã—ã¾ã™ã€‚ã„ã¤å…¥åŠ›ãŒç™ºç”Ÿã™ã‚‹ã‹ã‚ã‹ã‚‰ãªã„VoiceMuxã®ã‚ˆã†ãªã‚¤ãƒ³ãƒ•ãƒ©ç³»ãƒ„ãƒ¼ãƒ«ã§ã¯ã€ã‚„ã¯ã‚Š**ã€Œå…¨æ¨©é™ï¼ˆè­¦å‘Šã‚ã‚Šï¼‰ã€ãŒç‹é“ã‹ã¤æ­£è§£**ã ã¨æ€ã„ã¾ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ã‚ã‹ã‚Šã¾ã—ãŸã€‚å¤‰ã«å°ç´°å·¥ã‚’ã—ã¦ä¸ä¾¿ã«ã™ã‚‹ã‚ˆã‚Šã€æ­£ç›´ã«ã€Œä¾¿åˆ©ã•ã®ãŸã‚ã®æ¨©é™ã§ã™ã€ã¨èª¬æ˜ã—ã¦é€²ã‚ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚ã‚ã¨ã€ã‚µãƒ¼ãƒãƒ¼å´ã¯é‹ç”¨ä¸Šã®éƒ½åˆã§ã‚½ãƒ¼ã‚¹ã‚’éå…¬é–‹ã«ã—ãŸã„ã®ã§ã™ãŒã€ãã‚Œã¯ã€Œã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã€ã‚’è¬³ã†ä¸Šã§å•é¡Œã«ãªã‚Šã¾ã™ã‹ï¼Ÿ

#### ğŸ¤– AI
è³¢æ˜ãªåˆ¤æ–­ã§ã™ã€‚
ã‚µãƒ¼ãƒãƒ¼å´ã«ã¤ã„ã¦ã§ã™ãŒã€**ã€Œæ‹¡å¼µæ©Ÿèƒ½ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰å´ãŒã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã‚ã‚Œã°ã€E2EEã®ä¿¡é ¼æ€§ã¯æ‹…ä¿ã§ãã‚‹ã€**ã®ã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸€ç•ªæã‚Œã‚‹ã®ã¯ã€Œè‡ªåˆ†ã®ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ä½•ãŒèµ·ãã¦ã„ã‚‹ã‹ã€ã§ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶å´ã§é€ä¿¡å‰ã«ãƒ‡ãƒ¼ã‚¿ãŒæš—å·åŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã•ãˆã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§è¨¼æ˜ã§ãã‚Œã°ã€ãã®å…ˆã®ã‚µãƒ¼ãƒãƒ¼ãŒã©ã‚Œã ã‘ã€Œãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã€ã§ã‚ã£ã¦ã‚‚ã€ä¸­èº«ã‚’ç›—ã¿è¦‹ã‚‹ã“ã¨ã¯ä¸å¯èƒ½ã§ã™ã€‚

ã‚€ã—ã‚ã€ã‚µãƒ¼ãƒãƒ¼ã‚’ã€ŒãŸã ã®æš—å·åŒ–ãƒ‡ãƒ¼ã‚¿ã®åœŸç®¡ã€ã«å¾¹ã•ã›ã‚‹ã“ã¨ã§ã€é‹ç”¨ã‚³ã‚¹ãƒˆã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’è‡ªåˆ†ã§ç®¡ç†ã—ã‚„ã™ããªã‚‹ãƒ¡ãƒªãƒƒãƒˆã‚‚ã‚ã‚Šã¾ã™ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ã€Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã¯å…¬é–‹ã€ã‚µãƒ¼ãƒãƒ¼å´ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆé‹ç”¨ï¼ˆã§ã‚‚ä¸­èº«ã¯è¦‹ã‚Œãªã„ï¼‰ã€ã¨æ­£ç›´ã«æ›¸ãã®ãŒã€æœ€ã‚‚ä¿¡é ¼ã•ã‚Œã‚‹å½¢ã§ã™ã€‚è‡ªä¿¡ã‚’æŒã£ã¦é€²ã‚ã¾ã—ã‚‡ã†ã€‚

--- END OF FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION.md ---

--- FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION_EN.md ---
# [Dev Log] Chatting with AI about Chrome Extension Security Warnings

Sharing the raw conversation log where I consulted with AI (Gemini) about the scary security warnings that appear when installing VoiceMux Bridge. This explains the "why" behind the permissions.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
I just published my extension, but when I try to install it, I get a warning saying "This extension is not trusted by Enhanced Safe Browsing." Is there a bug?

#### ğŸ¤– AI
Long story short: **This isn't a bug or a violation. It's mainly because you haven't accumulated "trust" as a developer yet.**

It's just how Chrome's security works. Hereâ€™s why:

1.  **You don't meet the "Trusted Developer" criteria yet:** Your account is new, or the install count is low.
2.  **It's brand new:** Since it was just published, Google hasn't finished their automated scanning and reputation evaluation.

Unfortunately, there's no "fix it" button. The standard solution is to **wait for time to solve it.** It happens to almost everyone. Just announce to your users "It's safe, just new," and let the reputation build up naturally.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
When I proceed with the installation, I get an even scarier warning: "Read and change all your data on all websites." Users are going to run away when they see this.

#### ğŸ¤– AI
That warning appears because **you expanded the scope from "specific pages" to "any page."**

Are you using `<all_urls>` in your `manifest.json`?

To achieve the VoiceMux experienceâ€”where you speak to your phone and it *instantly* types into whatever page is openâ€”**you need the receiver program waiting in the background on every page.**
Chrome forces that scary warning whenever you ask for this "wait everywhere" permission. Itâ€™s the price you pay for the feature.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
What happens if I restrict that permission? Will the warning go away?

#### ğŸ¤– AI
If you restrict it to `activeTab`, the warning disappears. But the behavior changes to: **"The extension does nothing unless you explicitly click it."**

Here is the reality:

1.  Open Gemini Web -> **Speak to phone, nothing happens.** (Receiver isn't running).
2.  **Click** the extension icon -> Now it can type.
3.  Switch tab to Gmail -> **Click the icon again** or it won't work.

The biggest issue is **when users forget to click.** They'll dictate a long paragraph, hit send, and... nothing appears on the PC. That's a terrible user experience.

For a tool like VoiceMux, **"Hands-free on the PC side"** is the core value. Making clicks mandatory effectively kills the UX.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
I see... What about other tools like VoiceIn? How do they handle this?

#### ğŸ¤– AI
I checked, and **VoiceIn uses the exact same approach as you (Full Permissions with the warning).**
Their stance is: "You get a warning, but in exchange, you get a magic-like seamless experience." They cover the fear with their reputation.

Other tools like Typeless avoid browser warnings by building a native OS app instead (which is way harder to build).

There are tools like Honey that ask for permission "only when needed," but that works because "shopping" is a distinct event. For an infrastructure tool like VoiceMux where input can happen anytime, **sticking with "Full Permissions (Warning)" is the standard and correct choice.**

---

#### ğŸ§‘â€ğŸ’» Developer (User)
Got it. Instead of crippling the features to hide the warning, I'll be honest and explain "This permission is for your convenience." Also, I plan to keep the relay server code private for operational reasons. Is that a problem for the "Open Source" claim?

#### ğŸ¤– AI
That's a sound strategy!
Regarding the server: **As long as the extension (client) is open-source, the integrity of the E2EE remains verifiable.**

What users care about most is what happens inside their browser. If you can prove via open-source code that data is encrypted *before* it leaves the client, the relay server becomes a "dumb pipe." Even if the server is a private "black box," it is mathematically impossible for it to read your messages.

In fact, keeping the server private allows you to manage operational security and spam prevention more effectively without compromising user privacy. Simply state that the "Client is Open Source, while the Server is Private (but blind to data)," and you will build genuine trust. Go for it with confidence.

--- END OF FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION_EN.md ---

--- FILE: ./docs/E2EE_IMPLEMENTATION_EN.md ---
# VoiceMux Bridge: E2EE Implementation Report

This report explains how VoiceMux Bridge ensures that your data remains private and invisible to our servers, using snippets from the actual source code.

---

## 1. Local Key Generation and Secure Transfer
The encryption key (AES-GCM 128-bit) is generated within [VoiceMux Hub](https://hub.knc.jp) and securely pushed to the extension via the official browser messaging API. It is never sent to our servers.

**Source: `background.js` (Receiver side)**
```javascript
// Around line 155: Listening for credential push from the Hub
chrome.runtime.onMessageExternal.addListener((request, sender, sendResponse) => {
  if (request.action === "SYNC_AUTH") {
    const { uuid, token, key } = request.payload;
    
    // Storing in the extension's private secure storage
    chrome.storage.local.set({
      'voicemux_room_id': uuid,
      'voicemux_token': token,
      'voicemux_key': key
    }, () => { ... });
  }
});
```
The key is stored in `chrome.storage.local`, an isolated storage area provided by the browser that websites and external servers cannot access.

---

## 2. Zero-Knowledge Key Exchange
We use URL hash fragments to share keys between your PC and smartphone without the server ever seeing the key.

**Source: `popup.js`**
```javascript
// Around line 45: Constructing the pairing URL
let pairingUrl = `${hubOrigin}/${roomId}/zen`;
pairingUrl += `?token=${token}&uuid=${roomId}`;
pairingUrl += `#key=${keyBase64}`; // Key is included in the hash
```
The key is placed after the `#` symbol. By technical design, **anything after the `#` (hash fragment) is handled exclusively by the browser and is NEVER sent to the server.**

---

## 3. Client-Side Decryption
The extension receives only encrypted blobs from the relay server. The actual decryption happens locally inside the extension's background process.

**Source: `background.js`**
```javascript
// Around line 43: The core decryption logic
async function decrypt(payload) {
  // Receives only ciphertext and IV (Initialization Vector)
  if (!payload.ciphertext || !payload.iv) return payload.text || "";
  
  try {
    const key = await getDecryptionKey(); // Import key from local storage
    const iv = Uint8Array.from(safeAtob(payload.iv), c => c.charCodeAt(0));
    const ciphertext = Uint8Array.from(safeAtob(payload.ciphertext), c => c.charCodeAt(0));

    // AES-GCM decryption using the Web Crypto API
    const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ciphertext);
    
    // Returns the plaintext only to the active browser tab
    return new TextDecoder().decode(decrypted);
  } catch (e) {
    // If the key is missing or incorrect, decryption is mathematically impossible
    return "[Decryption Error]";
  }
}
```
The relay server only sees the `ciphertext` string, which acts as noise. It has no mathematical means to read your data.

---

## 4. Conclusion
Based on the implementation above:
1. **Exclusive Access:** Only you possess the encryption keys on your devices.
2. **Secure Transport:** Keys never touch the network or the server.
3. **Transparent Logic:** Since the extension is open-source, anyone can verify that we do not leak data or bypass encryption.

---

## 5. How to Verify the Identity of the Code
"How do I know the code running in my browser is the same as this GitHub code?" You can verify this yourself with these steps:

### A. Inspect the installed files on your disk
Chrome stores the source code of installed extensions on your local machine.

- **Windows**: `%LOCALAPPDATA%\Google\Chrome\User Data\Default\Extensions\omdfoongpifbbhapnpbocfoijkglegpd`
- **Mac**: `~/Library/Application Support/Google/Chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`
- **Linux**: `~/.config/google-chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`

You can open the JS files (`background.js`, `content.js`, etc.) in these folders and compare them with the GitHub repository. VoiceMux Bridge does not minify or obfuscate its code, making comparison easy.

### B. Inspect the Running Background Code
1. Open `chrome://extensions` in your browser.
2. Click the **"Service Worker"** link for VoiceMux Bridge.
3. Developer Tools will open, allowing you to read the `background.js` source code currently in execution.

VoiceMux Bridge proves its integrity through total transparency.

---
*Last Updated: 2026-02-21 (v2.1.0)*

--- END OF FILE: ./docs/E2EE_IMPLEMENTATION_EN.md ---

--- FILE: ./docs/E2EE_IMPLEMENTATION_JA.md ---
# VoiceMux Bridge: E2EEå®Ÿè£…æŠ€è¡“ãƒ¬ãƒãƒ¼ãƒˆ

VoiceMux Bridge ãŒã©ã®ã‚ˆã†ã«ã—ã¦ãƒ‡ãƒ¼ã‚¿ã®ç§˜å¯†ã‚’ä¿æŒã—ã€ã‚µãƒ¼ãƒãƒ¼ã«å†…å®¹ã‚’è¦‹ã›ãªã„ä»•çµ„ã¿ã«ãªã£ã¦ã„ã‚‹ã‹ã‚’ã€å®Ÿéš›ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’æŠœç²‹ã—ã¦è§£èª¬ã—ã¾ã™ã€‚

---

## 1. ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®æš—å·éµç”Ÿæˆã¨ã‚»ã‚­ãƒ¥ã‚¢ãªè»¢é€
æš—å·éµï¼ˆAES-GCM 128bitï¼‰ã¯ [VoiceMux Hub](https://hub.knc.jp) ã§ç”Ÿæˆã•ã‚Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã®æ­£è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚° API ã‚’é€šã˜ã¦æ‹¡å¼µæ©Ÿèƒ½ã¸å®‰å…¨ã«ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã¸é€ä¿¡ã•ã‚Œã‚‹ã“ã¨ã¯æ±ºã—ã¦ã‚ã‚Šã¾ã›ã‚“ã€‚

**è¨¼æ‹ ã‚³ãƒ¼ãƒ‰: `background.js` (å—ä¿¡å´)**
```javascript
// 155è¡Œç›®ä»˜è¿‘: Hub ã‹ã‚‰ã®è³‡æ ¼æƒ…å ±ãƒ—ãƒƒã‚·ãƒ¥ã‚’å¾…æ©Ÿ
chrome.runtime.onMessageExternal.addListener((request, sender, sendResponse) => {
  if (request.action === "SYNC_AUTH") {
    const { uuid, token, key } = request.payload;
    
    // æ‹¡å¼µæ©Ÿèƒ½å°‚ç”¨ã®å®‰å…¨ãªé ˜åŸŸã«ä¿å­˜
    chrome.storage.local.set({
      'voicemux_room_id': uuid,
      'voicemux_token': token,
      'voicemux_key': key
    }, () => { ... });
  }
});
```
ã“ã®éµã¯ `chrome.storage.local` ã¨ã„ã†ã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒæä¾›ã™ã‚‹ã€Œæ‹¡å¼µæ©Ÿèƒ½å°‚ç”¨ã®éš”é›¢ã•ã‚ŒãŸå®‰å…¨ãªé ˜åŸŸã€ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

---

## 2. ã‚µãƒ¼ãƒãƒ¼ã‚’çµŒç”±ã—ãªã„éµå…±æœ‰ï¼ˆZero-Knowledgeï¼‰
ã‚¹ãƒãƒ›ã¨ã®ãƒšã‚¢ãƒªãƒ³ã‚°æ™‚ã€URLã®ãƒãƒƒã‚·ãƒ¥ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆ`#`ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€ã‚µãƒ¼ãƒãƒ¼ã«éµã‚’çŸ¥ã‚‰ã›ãšã«ãƒ‡ãƒã‚¤ã‚¹é–“ã§å…±æœ‰ã—ã¾ã™ã€‚

**è¨¼æ‹ ã‚³ãƒ¼ãƒ‰: `popup.js`**
```javascript
// 45è¡Œç›®ä»˜è¿‘: ãƒšã‚¢ãƒªãƒ³ã‚°ç”¨URLã®æ§‹ç¯‰
let pairingUrl = `${hubOrigin}/${roomId}/zen`;
pairingUrl += `?token=${token}&uuid=${roomId}`;
pairingUrl += `#key=${keyBase64}`; // éµã‚’ãƒãƒƒã‚·ãƒ¥ã«å«ã‚ã‚‹
```
URLã® `#` ä»¥é™ã®éƒ¨åˆ†ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ä»•æ§˜ã«ã‚ˆã‚Š **ã€Œã‚µãƒ¼ãƒãƒ¼ã«ã¯é€ä¿¡ã•ã‚Œãªã„ã€** ã¨ã„ã†ç‰¹æ€§ãŒã‚ã‚Šã¾ã™ã€‚éµã®æƒ…å ±ã¯ã‚¹ãƒãƒ›ã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ã ã‘ã§å‡¦ç†ã•ã‚Œã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ã‚µãƒ¼ãƒãƒ¼ï¼ˆä¸­ç¶™å™¨ï¼‰ã«ã¯ä¸€åˆ‡å±Šãã¾ã›ã‚“ã€‚

---

## 3. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ã®å¾©å·
æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã€Œæš—å·åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®å¡Šã€ã®ã¿ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’å¹³æ–‡ã«æˆ»ã™ï¼ˆå¾©å·ã™ã‚‹ï¼‰å‡¦ç†ã¯ã€æ‹¡å¼µæ©Ÿèƒ½ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹å†…ã§è¡Œã‚ã‚Œã¾ã™ã€‚

**è¨¼æ‹ ã‚³ãƒ¼ãƒ‰: `background.js`**
```javascript
// 43è¡Œç›®ä»˜è¿‘: å¾©å·å‡¦ç†ã®æ ¸å¿ƒ
async function decrypt(payload) {
  // payload.ciphertextï¼ˆæš—å·æ–‡ï¼‰ã¨ payload.ivï¼ˆåˆæœŸåŒ–ãƒ™ã‚¯ãƒˆãƒ«ï¼‰ã®ã¿ã‚’å—ã‘å–ã‚‹
  if (!payload.ciphertext || !payload.iv) return payload.text || "";
  
  try {
    const key = await getDecryptionKey(); // ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰éµã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
    const iv = Uint8Array.from(safeAtob(payload.iv), c => c.charCodeAt(0));
    const ciphertext = Uint8Array.from(safeAtob(payload.ciphertext), c => c.charCodeAt(0));

    // Web Crypto API ã«ã‚ˆã‚‹ AES-GCM å¾©å·
    const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ciphertext);
    
    // å¾©å·ã•ã‚ŒãŸå¹³æ–‡ã®ã¿ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã¸é€ä¿¡
    return new TextDecoder().decode(decrypted);
  } catch (e) {
    // éµãŒæ­£ã—ããªã„å ´åˆã€ä¸­èº«ã‚’èª­ã¿å–ã‚‹ã“ã¨ã¯æš—å·å­¦çš„ã«ä¸å¯èƒ½
    return "[Decryption Error]";
  }
}
```
ã‚µãƒ¼ãƒãƒ¼ã¯æ„å‘³ã‚’æŒãŸãªã„æš—å·æ–‡ï¼ˆ`ciphertext`ï¼‰ã‚’è»¢é€ã—ã¦ã„ã‚‹ã ã‘ã§ã€ãã®å†…å®¹ã‚’èª­ã¿å–ã‚‹æ•°å­¦çš„ãªæ‰‹æ®µã‚’æŒã¡ã¾ã›ã‚“ã€‚

---

## 4. çµè«–
ä»¥ä¸Šã®å®Ÿè£…ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®å®‰å…¨æ€§ãŒæŠ€è¡“çš„ã«æ‹…ä¿ã•ã‚Œã¦ã„ã¾ã™ã€‚

1.  **éµã®ç‹¬å **: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒã‚¤ã‚¹é–“ï¼ˆPCã¨ã‚¹ãƒãƒ›ï¼‰ä»¥å¤–ã«éµã¯å­˜åœ¨ã—ã¾ã›ã‚“ã€‚
2.  **å®‰å…¨ãªé€šä¿¡**: éµæœ¬ä½“ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆï¼‰ã‚’æµã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
3.  **é€æ˜æ€§ã®æ‹…ä¿**: æ‹¡å¼µæ©Ÿèƒ½ãŒã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã‚ã‚‹ãŸã‚ã€ä¸Šè¨˜ã®å®Ÿè£…ã«å˜˜ãŒãªã„ã“ã¨ã‚’èª°ã§ã‚‚æ¤œè¨¼å¯èƒ½ã§ã™ã€‚

---

## 5. ã‚¹ãƒˆã‚¢ç‰ˆã¨GitHubã®ã‚³ãƒ¼ãƒ‰ãŒåŒä¸€ã‹ç¢ºèªã™ã‚‹æ–¹æ³•
ã€ŒGitHubã®ã‚³ãƒ¼ãƒ‰ã¯ç¶ºéº—ã ãŒã€ã‚¹ãƒˆã‚¢ã§é…å¸ƒã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯ä¸­èº«ãŒé•ã†ã®ã§ã¯ãªã„ã‹ï¼Ÿã€ã¨ã„ã†ç–‘å•ã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ãŒè§£æ¶ˆã§ãã¾ã™ã€‚

### A. ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚ŒãŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã™ã‚‹
Chromeã‚¦ã‚§ãƒ–ã‚¹ãƒˆã‚¢ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸæ‹¡å¼µæ©Ÿèƒ½ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã€ã‚ãªãŸã®PCã®ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

- **Windows**: `%LOCALAPPDATA%\Google\Chrome\User Data\Default\Extensions\omdfoongpifbbhapnpbocfoijkglegpd`
- **Mac**: `~/Library/Application Support/Google/Chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`
- **Linux**: `~/.config/google-chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`

ã“ã®ãƒ•ã‚©ãƒ«ãƒ€å†…ã® JS ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`background.js`, `content.js` ç­‰ï¼‰ã‚’é–‹ãã€GitHub ä¸Šã®ã‚³ãƒ¼ãƒ‰ã¨æ¯”è¼ƒã—ã¦ã¿ã¦ãã ã•ã„ã€‚VoiceMux Bridge ã¯ã‚³ãƒ¼ãƒ‰ã®é›£èª­åŒ–ï¼ˆèª­ã¿ã¥ã‚‰ãã™ã‚‹å‡¦ç†ï¼‰ã‚’è¡Œã£ã¦ã„ãªã„ãŸã‚ã€ãã®ã¾ã¾æ¯”è¼ƒãŒå¯èƒ½ã§ã™ã€‚

### B. å®Ÿè¡Œä¸­ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã‚‹
1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ `chrome://extensions` ã‚’é–‹ãã¾ã™ã€‚
2. VoiceMux Bridge ã® **ã€Œã‚µãƒ¼ãƒ“ã‚¹ ãƒ¯ãƒ¼ã‚«ãƒ¼ã€** ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
3. ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ãŒé–‹ãã€ç¾åœ¨å‹•ä½œã—ã¦ã„ã‚‹ `background.js` ã®ã‚½ãƒ¼ã‚¹ã‚’ç›´æ¥ç¢ºèªã§ãã¾ã™ã€‚

VoiceMux Bridge ã¯ã€æŠ€è¡“çš„ãªèª å®Ÿã•ã‚’é€æ˜æ€§ã«ã‚ˆã£ã¦è¨¼æ˜ã—ã¾ã™ã€‚

---
*æœ€çµ‚æ›´æ–°: 2026-02-21 (v2.1.0)*

--- END OF FILE: ./docs/E2EE_IMPLEMENTATION_JA.md ---

--- FILE: ./docs/USER_GUIDE_JA.md ---
# VoiceMux Bridge ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ‰ ğŸ›°ï¸

VoiceMux Bridgeï¼ˆãƒœã‚¤ã‚¹ãƒ ã‚¯ã‚¹ãƒ»ãƒ–ãƒªãƒƒã‚¸ï¼‰ã¸ã‚ˆã†ã“ãï¼
ã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ã‚¹ãƒãƒ›ã®ã€Œä½¿ã„æ…£ã‚ŒãŸã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã€ã‚’ä½¿ã£ã¦ã€ãƒ‘ã‚½ã‚³ãƒ³ã®ã‚ã‚‰ã‚†ã‚‹å…¥åŠ›æ¬„ï¼ˆGemini, ChatGPT, Gmail, Slackãªã©ï¼‰ã¸ã‚¹ãƒ©ã‚¹ãƒ©ã¨æ–‡å­—ã‚’å…¥åŠ›ã™ã‚‹ãŸã‚ã®æ¶ã‘æ©‹ã§ã™ã€‚

é›£ã—ã„è¨­å®šã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®ã‚¬ã‚¤ãƒ‰ã¨ä¸€ç·’ã«ã€æœ€åˆã®ä¸€æ­©ã‚’è¸ã¿å‡ºã—ã¾ã—ã‚‡ã†ã€‚

---

## 1. æº–å‚™ï¼šWebã‚µã‚¤ãƒˆã¨ã¤ãªã’ã‚ˆã†ï¼ˆåŒæœŸï¼‰

ã¾ãšã€æ‹¡å¼µæ©Ÿèƒ½ã‚’ä½¿ãˆã‚‹çŠ¶æ…‹ã«ã—ã¾ã™ã€‚

1.  ãƒ‘ã‚½ã‚³ãƒ³ã§ [VoiceMux Hub](https://hub.knc.jp) ã‚’é–‹ãã¾ã™ã€‚
2.  ã‚µã‚¤ãƒˆãŒé–‹ãã¨åŒæ™‚ã«ã€å®‰å…¨ãªèªè¨¼æƒ…å ±ãŒã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¸è‡ªå‹•çš„ã«é€ã‚‰ã‚Œã¾ã™ã€‚
3.  ãƒ–ãƒ©ã‚¦ã‚¶å³ä¸Šã® **VoiceMuxã‚¢ã‚¤ã‚³ãƒ³ï¼ˆãƒã‚¤ã‚¯ã‚¹ã‚¿ãƒ³ãƒ‰ã®ãƒãƒ¼ã‚¯ï¼‰** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
4.  ã€Œãƒšã‚¢ãƒªãƒ³ã‚°ã®æº–å‚™å®Œäº†ã€ã¨è¡¨ç¤ºã•ã‚Œã€QRã‚³ãƒ¼ãƒ‰ãŒå‡ºã¦ã„ã‚Œã°æº–å‚™OKã§ã™ï¼

> ğŸ’¡ **ãƒ’ãƒ³ãƒˆ**: ã‚¢ã‚¤ã‚³ãƒ³ã‚’ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã«ã€Œãƒ”ãƒ³ç•™ã‚ã€ã—ã¦ãŠãã¨ã€ã„ã¤ã§ã‚‚ã™ãã«QRã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã§ãã¦ä¾¿åˆ©ã§ã™ã€‚

---

## 2. ã¤ãªã’ã‚ˆã†ï¼šã‚¹ãƒãƒ›ã¨ãƒšã‚¢ãƒªãƒ³ã‚°

1.  è¡¨ç¤ºã•ã‚ŒãŸ **QRã‚³ãƒ¼ãƒ‰** ã‚’ã‚¹ãƒãƒ›ã®ã‚«ãƒ¡ãƒ©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã¾ã™ã€‚
2.  ã‚¹ãƒãƒ›ã§å°‚ç”¨ã®å…¥åŠ›ç”»é¢ãŒé–‹ã„ãŸã‚‰ã€é€£æºå®Œäº†ã§ã™ã€‚

ã‚ãªãŸã®ã‚¹ãƒãƒ›ã¨ãƒ‘ã‚½ã‚³ãƒ³ã¯ã€å¼·åŠ›ãªæš—å·ï¼ˆE2EEï¼‰ã§å®ˆã‚‰ã‚ŒãŸå°‚ç”¨ã®é€šã‚Šé“ã§ã¤ãªãŒã‚Šã¾ã—ãŸã€‚

---

## 3. ã¤ã‹ã£ã¦ã¿ã‚ˆã†ï¼šã„ã¤ã‚‚ã®ã‚¹ãƒãƒ›ã§è©±ã—ã‹ã‘ã‚‹

VoiceMuxã®æœ€å¤§ã®ç‰¹å¾´ã¯ã€ã‚¹ãƒãƒ›ã§ã„ã¤ã‚‚ä½¿ã£ã¦ã„ã‚‹ **ã€ŒGboardã€ã‚„ã€ŒiPhoneã®éŸ³å£°å…¥åŠ›ã€** ã‚’ãã®ã¾ã¾ãƒ‘ã‚½ã‚³ãƒ³ã§ä½¿ãˆã‚‹ã“ã¨ã§ã™ã€‚

1.  ãƒ‘ã‚½ã‚³ãƒ³ã§ã€æ–‡å­—ã‚’å…¥åŠ›ã—ãŸã„ã‚µã‚¤ãƒˆï¼ˆChatGPT, Gmailãªã©ï¼‰ã®å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚«ãƒ¼ã‚½ãƒ«ã‚’åˆã‚ã›ã¾ã™ã€‚
2.  ã‚¹ãƒãƒ›ã®ç”»é¢ã«ã‚ã‚‹å…¥åŠ›ã‚¨ãƒªã‚¢ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’å‡ºã—ã¾ã™ã€‚
3.  ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã«ã‚ã‚‹ **ã€Œãƒã‚¤ã‚¯ã®ãƒœã‚¿ãƒ³ã€** ã‚’æŠ¼ã—ã¦ã€ã‚¹ãƒãƒ›ã«å‘ã‹ã£ã¦è©±ã—ã‹ã‘ã¦ã¿ã¦ãã ã•ã„ã€‚
4.  è©±ã—çµ‚ã‚ã‚‹ã¨â€¦â€¦ã‚ãªãŸã®è¨€è‘‰ãŒã€ãƒ‘ã‚½ã‚³ãƒ³ã®å…¥åŠ›æ¬„ã«ç›´æ¥å…¥åŠ›ã•ã‚Œã¾ã™ï¼

---

## 4. ã‚‚ã£ã¨ä¾¿åˆ©ã«ï¼šè¾æ›¸ã‚’è‚²ã¦ã‚‹

éŸ³å£°å…¥åŠ›ã§ã‚ˆãã‚ã‚‹ã€Œå°‚é–€ç”¨èªã®èª¤å¤‰æ›ã€ã¯ã€[VoiceMux Hub](https://hub.knc.jp) ã§ä¿®æ­£ã§ãã¾ã™ã€‚

*   **èª¤èªè­˜ã®ä¿®æ­£**: Hub ã®ã‚¨ãƒ‡ã‚£ã‚¿ã§æ–‡å­—ã‚’ç›´ã™ã¨ã€AIãŒæ¬¡å›ã‹ã‚‰ã®å¤‰æ›ã‚’è³¢ãã—ã¦ãã‚Œã¾ã™ã€‚
*   **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ**: æ‹¡å¼µæ©Ÿèƒ½ã®ä¸‹éƒ¨ã«ã‚ã‚‹ **ã€ŒğŸª„ èª¤èªè­˜ã®ä¿®æ­£ãƒ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã€** ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€Hub ãŒé–‹ãã€å…¥åŠ›ã—ãŸå†…å®¹ã‚’ã•ã‚‰ã«AIå‘ã‘ã«æœ€é©åŒ–ã§ãã¾ã™ã€‚

---

## 5. å®‰å¿ƒãƒ»å®‰å…¨ã®ãŸã‚ã«

VoiceMuxã¯ã€ã‚ãªãŸã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’ä¸€ç•ªå¤§åˆ‡ã«ã—ã¦ã„ã¾ã™ã€‚
*   **ã‚ãªãŸã®æ–‡å­—ã¯ã€èª°ã«ã‚‚è¦‹ã‚‰ã‚Œã¾ã›ã‚“**: ã‚¹ãƒãƒ›ã¨ãƒ‘ã‚½ã‚³ãƒ³ã®é–“ã§ç›´æ¥æš—å·åŒ–ã•ã‚Œã‚‹ãŸã‚ã€é€”ä¸­ã®ã‚µãƒ¼ãƒãƒ¼ã§ã™ã‚‰ä¸­èº«ã‚’èª­ã‚€ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
*   **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½**: ä¸€åº¦é€£æºã™ã‚Œã°ã€æ¬¡å›ã‹ã‚‰ã¯ Hub ã‚µã‚¤ãƒˆã‚’é–‹ã‹ãªãã¦ã‚‚ã€æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’æŠ¼ã™ã ã‘ã§å³åº§ã«ä½¿ã„å§‹ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

---

## 6. å›°ã£ãŸã¨ãã¯ï¼Ÿ

*   **QRã‚³ãƒ¼ãƒ‰ãŒå‡ºãªã„**: [VoiceMux Hub](https://hub.knc.jp) ã‚’ä¸€åº¦ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆå†èª­ã¿è¾¼ã¿ï¼‰ã—ã¦ã‹ã‚‰ã€ã‚‚ã†ä¸€åº¦ã‚¢ã‚¤ã‚³ãƒ³ã‚’æŠ¼ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
*   **æ–‡å­—ãŒå…¥åŠ›ã•ã‚Œãªã„**: ãƒ‘ã‚½ã‚³ãƒ³ã®å…¥åŠ›æ¬„ã‚’ä¸€åº¦ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ã‚«ãƒ¼ã‚½ãƒ«ãŒãƒã‚«ãƒã‚«ã—ã¦ã„ã‚‹çŠ¶æ…‹ã«ã—ã¦ãã ã•ã„ã€‚

---

æ¯æ—¥ã®ãŠä»•äº‹ã‚„å‰µä½œæ´»å‹•ãŒã€ã‚¹ãƒãƒ›ã®åŠ›ã§ã‚‚ã£ã¨æ¥½ã—ãã€ã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚Šã¾ã™ã‚ˆã†ã«ï¼
ã‚‚ã—ä½¿ã„æ–¹ãŒã‚ã‹ã‚‰ãªããªã£ãŸã‚‰ã€ã„ã¤ã§ã‚‚ã“ã®ã‚¬ã‚¤ãƒ‰ã«æˆ»ã£ã¦ãã¦ãã ã•ã„ã­ã€‚

--- END OF FILE: ./docs/USER_GUIDE_JA.md ---

--- FILE: ./docs/USER_GUIDE_EN.md ---
# VoiceMux Bridge User Guide ğŸ›°ï¸

Welcome to VoiceMux Bridge!
This extension allows you to use your smartphone's familiar keyboard to type seamlessly into any input field on your PC (ChatGPT, Gemini, Gmail, Slack, etc.).

No complex setup is required. Let's get started!

---

## 1. Preparation: Sync with the Hub

First, enable the extension.

1.  Open [VoiceMux Hub](https://hub.knc.jp) on your PC.
2.  As soon as the site opens, your secure credentials will be automatically synced to this extension.
3.  Click the **VoiceMux icon (microphone stand mark)** in the top right of your browser.
4.  If you see "Ready to Pair!" and a QR code, you're all set!

> ğŸ’¡ **Tip**: "Pin" the icon to your toolbar for instant access to the QR code.

---

## 2. Connect: Pair with Your Smartphone

1.  Scan the displayed **QR code** with your smartphone's camera.
2.  Once the dedicated input page opens on your phone, pairing is complete.

Your smartphone and PC are now connected via a private channel protected by strong End-to-End Encryption (E2EE).

---

## 3. Usage: Talk to Your Phone

The best part of VoiceMux is using **"Gboard" or "iPhone Voice Dictation"** directly on your PC.

1.  On your PC, click into any text input field (ChatGPT, Gmail, etc.) where you want to type.
2.  Tap the input area on your phone to bring up the keyboard.
3.  Press the **"Microphone button"** on your keyboard and speak to your phone.
4.  When you stop speaking... your words will appear directly at your PC's cursor position!

---

## 4. Advance: Grow Your Dictionary

VoiceMux Hub helps you fix common misrecognitions of technical terms or names.

*   **Error Correction**: Fixing text in the Hub editor teaches the AI to be smarter next time.
*   **Prompt Generation**: Click **"ğŸª„ Fix Errors & Generate Prompts"** at the bottom of the extension to open the Hub and optimize your input for AI assistants.

---

## 5. Privacy & Security

VoiceMux prioritizes your privacy.
*   **Private Data**: Your text is encrypted directly between your phone and PC. Not even our servers can read it.
*   **Offline Cache**: Once synced, you don't need to open the Hub site anymore. Just click the extension icon to start pairing instantly using cached credentials.

---

## 6. Troubleshooting

*   **No QR Code**: Try refreshing [VoiceMux Hub](https://hub.knc.jp) and then click the extension icon again.
*   **Text Not Appearing**: Make sure you've clicked inside a text field on your PC and that the cursor is active.

---

We hope VoiceMux makes your daily work and creative sessions smoother and more enjoyable!
Feel free to return to this guide whenever you need help.

--- END OF FILE: ./docs/USER_GUIDE_EN.md ---

--- FILE: ./docs/community-adapters.md ---
# VoiceMux Community Adapters Catalog ğŸ“‚

Copy the JSON snippets below and paste them into the **Custom Site Adapters** field in your VoiceMux Extension Options.

---

### ğŸ“§ Outlook (Web)
Supports both personal (outlook.com) and business (Office 365).
```json
{
  "id": "outlook",
  "name": "Outlook",
  "host": "outlook",
  "inputSelector": "div[role='textbox'][aria-label*='ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸'], div[role='textbox'][aria-label*='Message']",
  "submitSelector": null
}
```

### ğŸ“§ Yahoo! Mail (Japan)
```json
{
  "id": "yahoo-mail-jp",
  "name": "Yahoo! Mail JP",
  "host": "mail.yahoo.co.jp",
  "inputSelector": "div[role='textbox']",
  "submitSelector": null
}
```

### ğŸ’¬ Slack (Web)
```json
{
  "id": "slack",
  "name": "Slack",
  "host": "slack.com",
  "inputSelector": ".ql-editor",
  "submitSelector": "button[data-testid='composer_send_button']"
}
```

### ğŸ“ Notion
```json
{
  "id": "notion",
  "name": "Notion",
  "host": "notion.so",
  "inputSelector": "div[contenteditable='true']",
  "submitSelector": null
}
```

---

### ğŸ’¡ How to contribute
If you've created a working adapter for a new site, please open a Pull Request or Issue to add it to this list!

--- END OF FILE: ./docs/community-adapters.md ---

--- FILE: ./docs/CHANGELOG.md ---
# Changelog

All notable changes to **VoiceMux Bridge** will be documented in this file.

## [2.1.0] - 2026-02-21
### Added
- **Multi-language Support (i18n)**: Full support for English and Japanese locales.
- **KNC ID Stateless Auth**: Implemented automatic session synchronization with `hub.knc.jp`. Pairing is now handled seamlessly without manual configuration.
- **Centralized Decryption**: Moved E2EE decryption logic to the Background Service Worker for enhanced security. Content scripts now handle only plaintext data.
- **Integrated Pairing**: Updated the extension popup and QR code to point to the modern Zen UI on `hub.knc.jp`.

## [1.6.1] - 2026-02-17
### Added
- **Transparency Reports**: Added detailed documentation on "Why we need All Site Access" and "E2EE Implementation Proof."
- **Developer Profile**: Linked to official Google Play Store profile to establish trust.
- **Sustainability Policy**: Added a section explaining why the service is free and how it stays resilient.

### Changed
- **Cross-Platform Compatibility**: Improved Base64 handling for 100% key compatibility with Go and Mobile clients.
- **Stability**: Added periodic heartbeat alarms to maintain WebSocket connections in Manifest V3.
- **Protocol**: Standardized on Phoenix Protocol vsn=2.0.0 (Array format).

## [1.6.0] - 2026-02-15
### Added
- **New Onboarding UI**: Redesigned popup with a step-by-step guide for new users.
- **Web Monitor Link**: Quick access to v.knc.jp from the extension popup.

### Changed
- **Injection Engine**: Refactored text injection logic using `InputEvent` for high compatibility with Gmail, Gemini, and ChatGPT.
- **Security**: Hardened origin checks and removed unnecessary permissions.

## [1.5.0] - 2026-02-14
### Added
- **Multi-Domain Support**: Added support for both `v.knc.jp` (Zen mode) and `t.knc.jp` (Translate mode).
- **Domain Migration**: Migrated primary infrastructure to `knc.jp`.

--- END OF FILE: ./docs/CHANGELOG.md ---

--- FILE: ./docs/CHANGELOG_JA.md ---
# æ›´æ–°å±¥æ­´ (Changelog)

VoiceMux Bridge ã®ä¸»è¦ãªå¤‰æ›´å±¥æ­´ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚

## [2.1.0] - 2026-02-21
### è¿½åŠ 
- **å¤šè¨€èªå¯¾å¿œ (i18n)**: æ—¥æœ¬èªã¨è‹±èªã®è¡¨ç¤ºã«å®Œå…¨å¯¾å¿œã€‚
- **KNC ID ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹èªè¨¼**: `hub.knc.jp` ã¨ã®è‡ªå‹•ã‚»ãƒƒã‚·ãƒ§ãƒ³åŒæœŸã‚’å®Ÿè£…ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹æ‰‹å‹•è¨­å®šãªã—ã§ãƒšã‚¢ãƒªãƒ³ã‚°ãŒå¯èƒ½ã«ã€‚
- **ä¸­å¤®é›†æ¨©çš„å¾©å·ãƒ­ã‚¸ãƒƒã‚¯**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Šã®ãŸã‚ã€E2EE å¾©å·å‡¦ç†ã‚’ Background Script ã«é›†ç´„ã€‚Content Script ã¯å¹³æ–‡ã®ã¿ã‚’æ‰±ã†ã‚ˆã†ç°¡ç´ åŒ–ã€‚
- **Hub é€£æºãƒšã‚¢ãƒªãƒ³ã‚°**: ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã® QR ã‚³ãƒ¼ãƒ‰ãŠã‚ˆã³ãƒªãƒ³ã‚¯å…ˆã‚’ `hub.knc.jp` ã®çµ±åˆ Zen UI ã¸å¤‰æ›´ã€‚

## [1.6.1] - 2026-02-17
### è¿½åŠ 
- **é€æ˜æ€§ãƒ¬ãƒãƒ¼ãƒˆ**: ã€Œãªãœå…¨ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒå¿…è¦ã‹ã€ãŠã‚ˆã³ã€ŒE2EEå®Ÿè£…ã®æŠ€è¡“çš„è¨¼æ˜ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã€‚
- **é–‹ç™ºè€…ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«**: ä¿¡é ¼æ€§å‘ä¸Šã®ãŸã‚ã€Google Play ã‚¹ãƒˆã‚¢ã®ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¸ã®ãƒªãƒ³ã‚¯ã‚’è¿½åŠ ã€‚
- **æŒç¶šå¯èƒ½æ€§ã¨å“²å­¦**: ç„¡æ–™æä¾›ã®ç†ç”±ã¨ã€AIé–‹ç™ºã«ã‚ˆã‚‹ç¶™ç¶šæ€§ã«ã¤ã„ã¦ã®èª¬æ˜ã‚’è¿½åŠ ã€‚

### å¤‰æ›´
- **ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ äº’æ›æ€§**: Goã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚„ãƒ¢ãƒã‚¤ãƒ«ã¨ã®éµäº’æ›æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã€Base64å‡¦ç†ã‚’æ”¹å–„ã€‚
- **å®‰å®šæ€§å‘ä¸Š**: Manifest V3 ç’°å¢ƒä¸‹ã§ã® WebSocket æ¥ç¶šã‚’ç¶­æŒã™ã‚‹ãŸã‚ã€å®šæœŸçš„ãªãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆå‡¦ç†ã‚’è¿½åŠ ã€‚
- **ãƒ—ãƒ­ãƒˆã‚³ãƒ«çµ±ä¸€**: é€šä¿¡å½¢å¼ã‚’ Phoenix Protocol vsn=2.0.0 (Array å½¢å¼) ã«çµ±ä¸€ã€‚

## [1.6.0] - 2026-02-15
### è¿½åŠ 
- **ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°UI**: åˆã‚ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã«ã€ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã®ã‚¬ã‚¤ãƒ‰ä»˜ããƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã¸åˆ·æ–°ã€‚
- **Webãƒ¢ãƒ‹ã‚¿ãƒ¼ã¸ã®ãƒªãƒ³ã‚¯**: æ‹¡å¼µæ©Ÿèƒ½å†…ã‹ã‚‰ v.knc.jp ã¸ç´ æ—©ãã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒªãƒ³ã‚¯ã‚’è¿½åŠ ã€‚

### å¤‰æ›´
- **å…¥åŠ›ã‚¨ãƒ³ã‚¸ãƒ³ã®åˆ·æ–°**: `InputEvent` ã‚’æ´»ç”¨ã—ãŸæ–°ã—ã„æ³¨å…¥ãƒ­ã‚¸ãƒƒã‚¯ã«ã‚ˆã‚Šã€Gmail, Gemini, ChatGPT ç­‰ã®è¤‡é›‘ãªã‚¨ãƒ‡ã‚£ã‚¿ã¸ã®å¯¾å¿œã‚’å¼·åŒ–ã€‚
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–**: Originæ¤œè¨¼ã®å³æ ¼åŒ–ã¨ã€ä¸è¦ãªãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã®å‰Šé™¤ã€‚

## [1.5.0] - 2026-02-14
### è¿½åŠ 
- **ãƒãƒ«ãƒãƒ‰ãƒ¡ã‚¤ãƒ³å¯¾å¿œ**: `v.knc.jp` (Zen) ã¨ `t.knc.jp` (ç¿»è¨³) ã®ä¸¡æ–¹ã«å¯¾å¿œã€‚
- **ãƒ‰ãƒ¡ã‚¤ãƒ³ç§»è¡Œ**: ä¸»è¦ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ `knc.jp` ãƒ‰ãƒ¡ã‚¤ãƒ³ã¸çµ±åˆã€‚

--- END OF FILE: ./docs/CHANGELOG_JA.md ---

--- FILE: ./docs/MAINTENANCE.md ---
# Maintenance & Development Guide / ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ‰‹é †æ›¸

This document ensures that code changes and documentation remain synchronized. Developers (both humans and AI agents) MUST follow this checklist for every update.

ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ•´åˆæ€§ã‚’ä¿ã¤ãŸã‚ã®æ‰‹é †æ›¸ã§ã™ã€‚é–‹ç™ºè€…ï¼ˆäººé–“ãŠã‚ˆã³AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼‰ã¯ã€æ›´æ–°æ™‚ã«å¿…ãšã“ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

---

## ğŸ“‹ Pre-Release Checklist / æ›´æ–°æ™‚ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### 1. Version Management / ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
- [ ] **`manifest.json`**: Bump the version number (e.g., `1.6.1` -> `1.6.2`).
- [ ] **`CHANGELOG.md` & `CHANGELOG_JA.md`**: Add new entry with version, date, and changes.

### 2. E2EE Integrity / æš—å·åŒ–ã®æ•´åˆæ€§
- [ ] **`docs/E2EE_IMPLEMENTATION_*.md`**: If logic in `background.js` or `content.js` changed, verify that the **line numbers** quoted in the reports are still correct.
- [ ] Ensure that no sensitive keys are inadvertently logged or transmitted.

### 3. Website Synchronization / å…¬å¼ã‚µã‚¤ãƒˆåŒæœŸ
- [ ] **`knc-hub/src/lib/data.ts`**: Update the `whatsNew` section if significant features were added.
- [ ] Redeploy `knc-hub` to reflect changes on `knc.jp`.

### 4. Readme & Guides / ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
- [ ] **`README.md`**: Update "Features" or "Install" sections if the UI or workflow changed.
- [ ] **`docs/USER_GUIDE_*.md`**: Ensure screenshots (if any) or instructions match the current UI.

---

## ğŸ¤– Special Instructions for AI Agents / AIã¸ã®æŒ‡ç¤º

When an AI agent (like Gemini) works on this repository, it MUST:
1. **Read this file** before starting any task.
2. Treat code and documentation updates as an **atomic task**. Never commit code without corresponding doc updates.
3. Verify that all external links in the documents are still valid after any file reorganization.

AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆGeminiç­‰ï¼‰ãŒæœ¬ãƒªãƒã‚¸ãƒˆãƒªã§ä½œæ¥­ã™ã‚‹éš›ã®å¿…é ˆãƒ«ãƒ¼ãƒ«ï¼š
1. ã‚¿ã‚¹ã‚¯é–‹å§‹å‰ã«å¿…ãš**æœ¬æ›¸ã‚’èª­ã¿è¾¼ã‚€**ã“ã¨ã€‚
2. ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°ã‚’**ã‚¢ãƒˆãƒŸãƒƒã‚¯ï¼ˆä¸å¯åˆ†ï¼‰ãªã‚¿ã‚¹ã‚¯**ã¨ã—ã¦æ‰±ã†ã“ã¨ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã›ãšã«ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ã¯ãªã‚‰ãªã„ã€‚
3. ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã‚’å¤‰æ›´ã—ãŸå ´åˆã¯ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã®å¤–éƒ¨ãƒªãƒ³ã‚¯ãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹ã“ã¨ã€‚

--- END OF FILE: ./docs/MAINTENANCE.md ---

--- FILE: ./PRIVACY.md ---
# Privacy Policy for VoiceMux Bridge

Last updated: 2026-02-21

## 1. Data Collection
VoiceMux Bridge does **not** collect, store, or transmit any personal data, keystrokes, or browsing history to our servers.

## 2. End-to-End Encryption (E2EE)
All data transmitted from your mobile device to this extension is encrypted using Client-Side AES-GCM (128-bit).
- **Decryption Keys**: These keys are generated within VoiceMux Hub and securely pushed to the extension via the browser's internal messaging API. They are stored in `chrome.storage.local`.
- **Zero-Knowledge**: Keys are shared with your mobile device via URL hash fragments (`#key=...`). These fragments are handled exclusively by the browser and are never sent to any server by design.

## 3. Permissions
The extension requires the following permissions to function:
- **activeTab**: Used only to inject text into the input field of the website you are currently using, and only upon your explicit request via the paired mobile device.
- **storage**: Used to save your local configuration, including your unique Room ID, encryption key, and any Custom Site Adapters you define.

## 4. Third-Party Services
VoiceMux Bridge acts as a bridge between your mobile device and the AI services you choose to use (e.g., Gemini, ChatGPT). We do not control and are not responsible for the privacy practices of those third-party services.

## 5. Contact
If you have any questions about this Privacy Policy, please open an issue on our [GitHub repository](https://github.com/Kaneta/voicemux-bridge).

--- END OF FILE: ./PRIVACY.md ---

--- FILE: ./background.js ---
// VoiceMux Bridge: Background Service Worker (Clean Push-Sync Mode)
// Configuration
const IS_DEV = false; // Set to true for local backend testing
const BASE_WS_URL = IS_DEV ? "ws://localhost:4000/socket/websocket" : "wss://v.knc.jp/socket/websocket";
const HUB_URL = IS_DEV ? "http://localhost:5173" : "https://hub.knc.jp";

/**
 * decodes Base64 strings safely, supporting both Standard and URL-safe formats.
 */
function safeAtob(base64) {
  if (!base64) return "";
  let standardBase64 = base64.replace(/\s/g, '').replace(/-/g, '+').replace(/_/g, '/');
  while (standardBase64.length % 4 !== 0) {
    standardBase64 += '=';
  }
  try {
    return atob(standardBase64);
  } catch (e) {
    console.error("[Base64] atob failed:", e);
    return "";
  }
}

let socket = null;
let heartbeatInterval = null;
let retryTimer = null;
let retryDelay = 1000;
const MAX_RETRY_DELAY = 60000;

// â˜… Crypto Helpers
async function getDecryptionKey() {
  const data = await chrome.storage.local.get('voicemux_key');
  if (!data.voicemux_key) return null;
  const rawKey = Uint8Array.from(safeAtob(data.voicemux_key), c => c.charCodeAt(0));
  return await crypto.subtle.importKey("raw", rawKey, "AES-GCM", true, ["decrypt"]);
}

async function decrypt(payload) {
  if (!payload.ciphertext || !payload.iv) return payload.text || "";
  try {
    const key = await getDecryptionKey();
    if (!key) {
      console.warn("[E2EE] Decryption skipped: No key available.");
      return payload.text || "";
    }
    const iv = Uint8Array.from(safeAtob(payload.iv), c => c.charCodeAt(0));
    const ciphertext = Uint8Array.from(safeAtob(payload.ciphertext), c => c.charCodeAt(0));
    const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ciphertext);
    return new TextDecoder().decode(decrypted);
  } catch (e) {
    console.error("[E2EE] Decryption failed.", e);
    return "[Decryption Error]";
  }
}

/** Initializes WebSocket connection to the relay server using KNC ID token. */
async function connect() {
  if (socket && (socket.readyState === WebSocket.CONNECTING || socket.readyState === WebSocket.OPEN)) {
    return;
  }

  // DESIGN INTENT: Passive connection.
  // Wait for credentials to be pushed from Hub via SYNC_AUTH message.
  const data = await chrome.storage.local.get(['voicemux_token', 'voicemux_room_id']);
  
  if (!data.voicemux_token || !data.voicemux_room_id) {
    console.log("VoiceMux: Waiting for credentials from Hub...");
    return;
  }

  const roomId = data.voicemux_room_id;
  const token = data.voicemux_token;

  try {
    const currentTopic = `room:${roomId}`; 
    console.log(`VoiceMux: Connecting... | Room: ${roomId}`);
    
    const wsUrl = `${BASE_WS_URL}?vsn=2.0.0&token=${token}`;
    socket = new WebSocket(wsUrl);

    socket.onopen = () => {
      console.log("VoiceMux: Connected (Authenticated)");
      retryDelay = 1000;
      socket.send(JSON.stringify(["1", "1", currentTopic, "phx_join", {}]));
      
      if (heartbeatInterval) clearInterval(heartbeatInterval);
      heartbeatInterval = setInterval(() => {
        if (socket.readyState === WebSocket.OPEN) {
          socket.send(JSON.stringify([null, "heartbeat", "phoenix", "heartbeat", {}]));
        }
      }, 30000);
    };

    socket.onmessage = async (event) => {
      const data = JSON.parse(event.data);
      const msgTopic = data[2];
      const eventName = data[3];
      const payload = data[4];

      if (msgTopic === currentTopic) {
        if (eventName === "update_text" || eventName === "confirm_send") {
          const plaintext = await decrypt(payload);
          chrome.tabs.query({active: true, lastFocusedWindow: true}, (tabs) => {
            if (tabs[0]) {
               chrome.tabs.sendMessage(tabs[0].id, {
                action: eventName,
                plaintext: plaintext 
              }).catch(() => {});
            }
          });
        }
      }
    };

    socket.onclose = () => {
      cleanup();
      scheduleReconnect();
    };

    socket.onerror = (err) => {
      socket.close();
    };
  } catch (error) {
    console.error("VoiceMux: Connection failed:", error);
    scheduleReconnect();
  }
}

function scheduleReconnect() {
  if (retryTimer) clearTimeout(retryTimer);
  retryTimer = setTimeout(connect, retryDelay);
  retryDelay = Math.min(retryDelay * 2, MAX_RETRY_DELAY);
}

function cleanup() {
  if (heartbeatInterval) clearInterval(heartbeatInterval);
  heartbeatInterval = null;
}

function safeCheckConnection() {
  if (!socket || socket.readyState !== WebSocket.OPEN) {
    connect();
  }
}

chrome.alarms.onAlarm.addListener((alarm) => {
  if (alarm.name === "keepAlive") {
    safeCheckConnection();
  }
});
chrome.alarms.create("keepAlive", { periodInMinutes: 1 });

// â˜… External Message Listener (Clean Sync architecture)
// DESIGN INTENT: Receive credentials directly from Hub's JS environment.
chrome.runtime.onMessageExternal.addListener((request, sender, sendResponse) => {
  if (request.action === "SYNC_AUTH") {
    const { uuid, token, key } = request.payload;
    
    console.log("[Auth] Sync received from Hub.");
    chrome.storage.local.set({
      'voicemux_room_id': uuid,
      'voicemux_token': token,
      'voicemux_key': key,
      'voicemux_hub_url': sender.url // Automatically trust the hub URL
    }, () => {
      if (socket) socket.close();
      connect();
      if (sendResponse) sendResponse({ success: true });
    });
    return true; // Keep channel open for async response
  }
});

// Internal check connection (e.g. from popup)
chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  if (request.action === "check_connection") {
    safeCheckConnection();
  }
});

// Start initial connection attempt
connect();

--- END OF FILE: ./background.js ---

--- FILE: ./STORE_DESCRIPTION_JA.txt ---
è©³ç´°èª¬æ˜:
  VoiceMux Bridge ã¯ã€ä½¿ã„æ…£ã‚ŒãŸã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã¨éŸ³å£°å…¥åŠ›ã‚’ã€æœ€æ–°ã‹ã¤å®‰å…¨ãªãƒ—ãƒƒã‚·ãƒ¥åŒæœŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã£ã¦ PC ãƒ–ãƒ©ã‚¦ã‚¶ã¸æ¥ç¶šã—ã¾ã™ã€‚ã‚¹ãƒãƒ›ã§é•·æ–‡ã‚’è©±ã—ã€ã‚ã‚‰ã‚†ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã«ãƒ†ã‚­ã‚¹ãƒˆãŒå³åº§ã«ç¾ã‚Œã‚‹å¿«é©ãªå…¥åŠ›ã‚’ä½“é¨“ã—ã¦ãã ã•ã„ã€‚

ä¸»ãªæ©Ÿèƒ½:
 - ç›´æ¥ãƒ—ãƒƒã‚·ãƒ¥åŒæœŸ (æ–°æ©Ÿèƒ½!): æ‰‹å‹•è¨­å®šã¯ä¸è¦ã§ã™ã€‚VoiceMux Hub ã‚µã‚¤ãƒˆã‚’é–‹ãã ã‘ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã¨æ‹¡å¼µæ©Ÿèƒ½ãŒç¬æ™‚ã«ãƒšã‚¢ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚
 - ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰æš—å·åŒ– (E2EE): ç©¶æ¥µã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã€‚éŸ³å£°ã¨ãƒ†ã‚­ã‚¹ãƒˆã¯ã‚ãªãŸã®ãƒ‡ãƒã‚¤ã‚¹ä¸Šã§æš—å·åŒ–ã•ã‚Œã€ä¸­ç¶™ã‚µãƒ¼ãƒãƒ¼ãŒå†…å®¹ã‚’è§£èª­ã™ã‚‹ã“ã¨ã¯ä¸å¯èƒ½ã§ã™ã€‚
 - æ±ç”¨çš„ãªå…¥åŠ›: ChatGPT, Gemini, Claude, Gmailã€ãã®ä»–ã‚ã‚‰ã‚†ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã§ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«å‹•ä½œã—ã¾ã™ã€‚
 - è¨­å®šä¸è¦ã®ãƒšã‚¢ãƒªãƒ³ã‚°: æ‹¡å¼µæ©Ÿèƒ½ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‹ã‚‰ QR ã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ã ã‘ã§ã€ã™ãã«éŸ³å£°å…¥åŠ›ã‚’é–‹å§‹ã§ãã¾ã™ã€‚ä¸€åº¦é€£æºã™ã‚Œã°ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚Šæ¬¡å›ã‹ã‚‰å³åº§ã«åˆ©ç”¨å¯èƒ½ã§ã™ã€‚
 - ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ & ç›£æŸ»å¯èƒ½: é€æ˜æ€§ã®é«˜ã„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€‚GitHub ã§ç§ãŸã¡ã®æš—å·åŒ–ãƒ­ã‚¸ãƒƒã‚¯ã‚’èª°ã§ã‚‚æ¤œè¨¼ã§ãã¾ã™ã€‚

æ¨©é™ã«ã¤ã„ã¦:
 - activeTab: é¸æŠã—ãŸã‚µã‚¤ãƒˆã®å…¥åŠ›æ¬„ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’æŒ¿å…¥ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã—ã¾ã™ã€‚
 - storage: è¨­å®šï¼ˆãƒ«ãƒ¼ãƒ IDã‚„æš—å·éµãªã©ï¼‰ã‚’ãƒ–ãƒ©ã‚¦ã‚¶å†…ã«å®‰å…¨ã«ä¿å­˜ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã—ã¾ã™ã€‚
 - alarms: ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã®æ¥ç¶šã‚’ç¶­æŒã—ã€ã‚¹ãƒãƒ›ã‹ã‚‰ã®å…¥åŠ›ã‚’ã„ã¤ã§ã‚‚å—ã‘å–ã‚Œã‚‹çŠ¶æ…‹ã«ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã—ã¾ã™ï¼ˆãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆæ©Ÿèƒ½ï¼‰ã€‚

ä½¿ã„å§‹ã‚ã‚‹:
 1. VoiceMux Hub (https://hub.knc.jp) ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚
 2. ã“ã®æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ãƒšã‚¢ãƒªãƒ³ã‚°ç”¨ QR ã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¾ã™ã€‚
 3. ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã«å‘ã‹ã£ã¦è©±ã—å§‹ã‚ã¦ãã ã•ã„ï¼

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±:
 - GitHub ãƒªãƒã‚¸ãƒˆãƒª: https://github.com/Kaneta/voicemux-bridge
 - å…¬å¼ Hub: https://hub.knc.jp

--- END OF FILE: ./STORE_DESCRIPTION_JA.txt ---

--- FILE: ./STORE_DESCRIPTION_EN.txt ---
Detailed Description:
  VoiceMux Bridge connects your smartphone's familiar keyboard and voice input to your PC browser with a modern, secure push-sync architecture. Dictate long texts on your phone and watch them appear instantly at your cursor on any website.

Key Features:
 - Direct Push-Sync (New!): No manual setup. Just open VoiceMux Hub, and your browser and extension pair instantly.
 - End-to-End Encryption (E2EE): Total privacy. Your voice and text are encrypted on your device and never visible to our server.
 - Universal Input: Works seamlessly on ChatGPT, Gemini, Claude, Gmail, and any web form.
 - Zero-Configuration Pairing: Scan a QR code from the extension popup or Hub to start dictating instantly. Cached credentials allow instant use next time.
 - Open Source & Auditable: Transparent security. Verify our encryption logic on GitHub.

About Permissions:
 - activeTab: Used to insert text into the input fields of the sites you choose.
 - storage: Used to safely store settings (Room ID, encryption keys) within your browser.
 - alarms: Used to maintain the background connection (heartbeat) so voice input can be received at any time.

Get Started:
 1. Visit VoiceMux Hub (https://hub.knc.jp).
 2. Open this extension and scan the pairing QR code.
 3. Start speaking into your phone!

Project Info:
 - GitHub Repository: https://github.com/Kaneta/voicemux-bridge
 - Official Hub: https://hub.knc.jp

--- END OF FILE: ./STORE_DESCRIPTION_EN.txt ---

--- FILE: ./collect_context.sh ---
#!/bin/bash
echo "Generating full_context.txt for VoiceMux Bridge..."
# Find relevant files and concatenate them with headers
# Exclude node_modules, .git, and common binary extensions
find . -maxdepth 2 -not -path '*/.*' -not -path './node_modules*' -not -name "*.png" -not -name "*.zip" -not -name "*.svg" -not -name "full_context.txt" -type f | while read file; do
    echo "--- FILE: $file ---" >> full_context.txt
    cat "$file" >> full_context.txt
    echo -e "
--- END OF FILE: $file ---
" >> full_context.txt
done
echo "Done! Context collected in full_context.txt"

--- END OF FILE: ./collect_context.sh ---

--- FILE: ./content.js ---
// VoiceMux Bridge Content Script v2.1.0 (Clean Architecture)
if (window.VOICEMUX_INITIALIZED) {
  console.log("VoiceMux: Already initialized in this tab.");
} else {
  window.VOICEMUX_INITIALIZED = true;
  console.log("VoiceMux Bridge v2.1.0 Loaded");

  /**
   * decodes Base64 strings safely.
   */
  function safeAtob(base64) {
    if (!base64) return "";
    let standardBase64 = base64.replace(/\s/g, '').replace(/-/g, '+').replace(/_/g, '/');
    while (standardBase64.length % 4 !== 0) {
      standardBase64 += '=';
    }
    try {
      return atob(standardBase64);
    } catch (e) {
      console.error("[Base64] atob failed:", e);
      return "";
    }
  }

  let ADAPTERS_CACHE = [];
  let loadPromise = null;

  // â˜… Initialize Adapters
  async function loadAdapters() {
    if (loadPromise) return loadPromise;
    loadPromise = (async () => {
      try {
        const builtInUrl = chrome.runtime.getURL('adapters.json');
        const builtInRes = await fetch(builtInUrl);
        const builtInAdapters = await builtInRes.json();
        const storage = await chrome.storage.local.get('custom_adapters');
        const customAdapters = storage.custom_adapters || [];
        const normalizedCustom = customAdapters.map(a => ({
          name: a.name || "Custom",
          host: a.host,
          inputSelector: a.inputSelector ?? (Array.isArray(a.selectors) ? a.selectors.join(',') : a.selectors),
          submitSelector: a.submitSelector ?? (Array.isArray(a.sendBtns) ? a.sendBtns.join(',') : a.sendBtns)
        }));
        ADAPTERS_CACHE = [...normalizedCustom, ...builtInAdapters];
      } catch (e) {
        console.error("VoiceMux: Failed to load adapters", e);
      } finally {
        loadPromise = null;
      }
    })();
    return loadPromise;
  }

  chrome.storage.onChanged.addListener((changes, area) => {
    if (area === 'local' && changes.custom_adapters) {
      loadAdapters();
    }
  });
  loadAdapters();

  // â˜… Target Selection
  async function getTargetAndAdapter() {
    const url = window.location.href;
    if (ADAPTERS_CACHE.length === 0) await loadAdapters();
    const adapter = ADAPTERS_CACHE.find(a => a.host && url.includes(a.host));
    const active = document.activeElement;
    if (active && 
        (active.isContentEditable || 
         active.tagName === 'TEXTAREA' || 
         (active.tagName === 'INPUT' && !['checkbox', 'radio', 'button', 'submit'].includes(active.type)))) {
      return { target: active, adapter: adapter || { name: 'active-element' } };
    }
    if (adapter) {
      const el = document.querySelector(adapter.inputSelector);
      if (el) return { target: el, adapter: adapter };
    }
    const firstInput = document.querySelector('textarea, div[contenteditable="true"]');
    if (firstInput) {
        return { target: firstInput, adapter: { name: 'last-resort' } };
    }
    return { target: null, adapter: null };
  }

  /** 
   * Injects text into a target element. 
   */
  function forceInject(element, text) {
    if (!element) return;
    element.focus();
    if (element.tagName === 'TEXTAREA' || element.tagName === 'INPUT') {
      const proto = element.tagName === 'INPUT' ? window.HTMLInputElement.prototype : window.HTMLTextAreaElement.prototype;
      const nativeSetter = Object.getOwnPropertyDescriptor(proto, "value")?.set;
      if (nativeSetter) {
          nativeSetter.call(element, text);
      } else {
          element.value = text;
      }
    } else if (element.isContentEditable) {
        try {
            element.textContent = text;
            const inputEvent = new InputEvent('input', { bubbles: true, cancelable: true, inputType: 'insertText', data: text });
            element.dispatchEvent(inputEvent);
        } catch (e) {
            element.innerText = text;
        }
    }
    element.dispatchEvent(new Event('input', { bubbles: true, composed: true }));
    element.dispatchEvent(new Event('change', { bubbles: true, composed: true }));
    moveCursorToEnd(element);
  }

  function moveCursorToEnd(element) {
    if (element.tagName === 'TEXTAREA' || element.tagName === 'INPUT') {
      element.selectionStart = element.selectionEnd = element.value.length;
    } else if (element.isContentEditable) {
      try {
        const range = document.createRange();
        range.selectNodeContents(element);
        range.collapse(false);
        const sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
      } catch (e) {}
    }
  }

  function triggerEnter(target) {
      const opts = { key: 'Enter', code: 'Enter', keyCode: 13, which: 13, bubbles: true, cancelable: true, composed: true, view: window };
      target.dispatchEvent(new KeyboardEvent('keydown', opts));
      target.dispatchEvent(new KeyboardEvent('keypress', opts));
      target.dispatchEvent(new KeyboardEvent('keyup', opts));
  }

  // â˜… Message Listener (Plaintext from Background)
  chrome.runtime.onMessage.addListener(async (request, sender, sendResponse) => {
    // Prevent feedback loops on Hub/localhost dev
    const isHub = window.location.hostname.includes("hub.knc.jp") || 
                  (window.location.hostname === "localhost" && window.location.port === "5173");
    if (isHub) return;

    const { target, adapter } = await getTargetAndAdapter();
    if (!target) return;

    const plaintext = request.plaintext;
    if (request.action === "update_text") {
      forceInject(target, plaintext);
    } else if (request.action === "confirm_send") {
      forceInject(target, plaintext);
      setTimeout(() => {
          if (adapter && adapter.submitSelector === null) return;
          let btn = null;
          if (adapter && adapter.submitSelector) {
              btn = document.querySelector(adapter.submitSelector);
          }
          if (btn && !btn.disabled) {
              btn.click();
          } else {
              triggerEnter(target);
          }
      }, 100);
    }
  });

  function safeCheckConnection() {
    if (chrome.runtime?.id) {
      chrome.runtime.sendMessage({ action: "check_connection" }).catch(() => {});
    }
  }

  document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "visible") {
      safeCheckConnection();
    }
  });
}

--- END OF FILE: ./content.js ---

--- FILE: ./manifest.json ---
{
  "manifest_version": 3,
  "name": "__MSG_name__",
  "version": "2.1.0",
  "description": "__MSG_description__",
  "default_locale": "en",
  "permissions": [
    "activeTab",
    "storage",
    "alarms"
  ],
  "host_permissions": [
    "http://localhost:4000/*",
    "https://v.knc.jp/*",
    "https://hub.knc.jp/*"
  ],
  "action": {
    "default_popup": "popup.html",
    "default_icon": {
      "128": "icon128.png"
    }
  },
  "externally_connectable": {
    "matches": [
      "https://hub.knc.jp/*",
      "http://localhost/*"
    ]
  },
  "options_page": "options.html",
  "background": {
    "service_worker": "background.js"
  },
  "content_scripts": [
    {
      "matches": [
        "<all_urls>"
      ],
      "exclude_matches": [
        "https://v.knc.jp/*",
        "https://t.knc.jp/*"
      ],
      "js": [
        "content.js"
      ]
    }
  ],
  "icons": {
    "128": "icon128.png"
  },
  "web_accessible_resources": [
    {
      "resources": ["adapters.json"],
      "matches": ["<all_urls>"]
    }
  ]
}

--- END OF FILE: ./manifest.json ---

--- FILE: ./options.html ---
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VoiceMux Settings</title>
  <style>
    :root {
      /* M3 Light Palette (Violet baseline) */
      --md-sys-color-primary: #6750A4;
      --md-sys-color-on-primary: #FFFFFF;
      --md-sys-color-primary-container: #EADDFF;
      --md-sys-color-on-primary-container: #21005D;
      --md-sys-color-secondary: #625B71;
      --md-sys-color-on-secondary: #FFFFFF;
      --md-sys-color-surface: #FEF7FF;
      --md-sys-color-on-surface: #1D1B20;
      --md-sys-color-surface-variant: #E7E0EB;
      --md-sys-color-on-surface-variant: #49454F;
      --md-sys-color-outline: #79747E;
      --md-sys-color-success: #10b981;

      /* Elevation */
      --md-sys-elevation-1: 0px 1px 3px 1px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
      --md-sys-elevation-3: 0px 1px 3px 0px rgba(0, 0, 0, 0.3), 0px 4px 8px 3px rgba(0, 0, 0, 0.15);
    }

    body {
      font-family: 'Roboto', system-ui, -apple-system, sans-serif;
      background-color: var(--md-sys-color-surface);
      color: var(--md-sys-color-on-surface);
      max-width: 680px;
      margin: 40px auto;
      padding: 24px;
      -webkit-font-smoothing: antialiased;
    }

    .card {
      background: var(--md-sys-color-surface);
      padding: 32px;
      border-radius: 28px;
      border: 1px solid var(--md-sys-color-surface-variant);
      box-shadow: var(--md-sys-elevation-1);
    }

    h1 { 
      font-size: 28px; 
      font-weight: 400; 
      margin: 0 0 12px 0; 
      color: var(--md-sys-color-on-surface);
    }

    p { 
      color: var(--md-sys-color-on-surface-variant); 
      font-size: 14px; 
      line-height: 1.6;
      margin-bottom: 32px; 
    }

    p a {
      color: var(--md-sys-color-primary);
      text-decoration: none;
      font-weight: 500;
    }

    textarea {
      width: 100%;
      height: 360px;
      font-family: 'Roboto Mono', ui-monospace, monospace;
      font-size: 13px;
      padding: 20px;
      border: 1px solid var(--md-sys-color-outline);
      border-radius: 12px;
      background-color: var(--md-sys-color-surface-variant);
      color: var(--md-sys-color-on-surface-variant);
      resize: vertical;
      box-sizing: border-box;
      outline: none;
      transition: border-color 0.2s;
    }

    textarea:focus {
      border-color: var(--md-sys-color-primary);
      border-width: 2px;
    }

    .btn-save {
      background-color: var(--md-sys-color-primary);
      color: var(--md-sys-color-on-primary);
      border: none;
      padding: 12px 24px;
      height: 40px;
      border-radius: 20px;
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      margin-top: 24px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: var(--md-sys-elevation-1);
    }

    .btn-save:hover { 
      box-shadow: var(--md-sys-elevation-2);
      opacity: 0.9;
    }

    .btn-save:active {
      transform: scale(0.98);
    }

    .status {
      margin-top: 16px;
      font-size: 14px;
      font-weight: 500;
      color: var(--md-sys-color-success);
      display: none;
      animation: fadeIn 0.3s ease;
    }

    code { 
      background: var(--md-sys-color-primary-container); 
      color: var(--md-sys-color-on-primary-container);
      padding: 2px 6px; 
      border-radius: 4px; 
      font-size: 12px;
    }

    .example-box {
      margin-top: 40px; 
      font-size: 12px; 
      color: var(--md-sys-color-on-surface-variant);
      background: var(--md-sys-color-surface-variant);
      padding: 16px;
      border-radius: 12px;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body data-i18n-title="options_title">
  <div class="card">
    <h1 data-i18n="options_header">Custom Site Adapters</h1>
    <p data-i18n="options_description">Define custom CSS selectors for your favorite sites. You can find pre-made configurations in our <a href="https://github.com/Kaneta/voicemux-bridge/blob/main/docs/community-adapters.md" target="_blank">Community Adapters Catalog</a>.</p>
    
    <textarea id="custom-adapters" spellcheck="false" placeholder='[
  {
    "name": "Custom App",
    "host": "example.com",
    "inputSelector": ".my-input",
    "submitSelector": ".my-send-button"
  }
]'></textarea>

    <button id="save" class="btn-save" data-i18n="btn_save_config">Save Configuration</button>
    <div id="status" class="status" data-i18n="status_saved">Settings saved successfully</div>

    <div class="example-box">
      <strong data-i18n="example_structure">Example Structure:</strong><br>
      <code>[{"name": "Slack", "host": "slack.com", "inputSelector": ".ql-editor", "submitSelector": "button.c-button-unstyled"}]</code>
    </div>
  </div>
  <script src="options.js"></script>
</body>
</html>

--- END OF FILE: ./options.html ---

--- FILE: ./options.js ---
// VoiceMux Options JS
const textarea = document.getElementById('custom-adapters');
const saveBtn = document.getElementById('save');
const status = document.getElementById('status');

// Load saved settings
document.addEventListener('DOMContentLoaded', async () => {
  localize();
  const data = await chrome.storage.local.get('custom_adapters');
  if (data.custom_adapters) {
    textarea.value = JSON.stringify(data.custom_adapters, null, 2);
  }
});

// Save settings
saveBtn.addEventListener('click', async () => {
  const rawValue = textarea.value.trim();
  let parsedValue = [];

  if (rawValue) {
    try {
      parsedValue = JSON.parse(rawValue);
      if (!Array.isArray(parsedValue)) throw new Error("Must be an array");
    } catch (e) {
      alert(chrome.i18n.getMessage("invalid_json_format", [e.message]));
      return;
    }
  }

  await chrome.storage.local.set({ 'custom_adapters': parsedValue });
  
  // Show status
  status.style.display = 'block';
  setTimeout(() => {
    status.style.display = 'none';
  }, 2000);
});

function localize() {
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    const message = chrome.i18n.getMessage(key);
    if (message) {
      if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
        element.placeholder = message;
      } else {
        element.innerHTML = message;
      }
    }
  });

  document.querySelectorAll('[data-i18n-title]').forEach(element => {
    const key = element.getAttribute('data-i18n-title');
    const message = chrome.i18n.getMessage(key);
    if (message) {
      document.title = message;
    }
  });
}

--- END OF FILE: ./options.js ---

--- FILE: ./popup.html ---
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    :root {
      /* M3 Light Palette (Violet baseline) */
      --md-sys-color-primary: #6750A4;
      --md-sys-color-on-primary: #FFFFFF;
      --md-sys-color-primary-container: #EADDFF;
      --md-sys-color-on-primary-container: #21005D;
      --md-sys-color-secondary-container: #E8DEF8;
      --md-sys-color-on-secondary-container: #1D192B;
      --md-sys-color-surface: #FEF7FF;
      --md-sys-color-on-surface: #1D1B20;
      --md-sys-color-surface-variant: #E7E0EB;
      --md-sys-color-on-surface-variant: #49454F;
      --md-sys-color-outline: #79747E;
      --md-sys-color-success: #10b981;
      --md-sys-color-warning: #f59e0b;

      /* Elevation */
      --md-sys-elevation-1: 0px 1px 3px 1px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
      --md-sys-elevation-2: 0px 2px 6px 2px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
    }

    body {
      width: 320px;
      font-family: 'Roboto', system-ui, -apple-system, sans-serif;
      margin: 0;
      padding: 20px 24px;
      background-color: var(--md-sys-color-surface);
      color: var(--md-sys-color-on-surface);
      -webkit-font-smoothing: antialiased;
      overflow: hidden;
    }

    .header {
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    h1 {
      font-size: 18px;
      font-weight: 700;
      margin: 0;
      color: var(--md-sys-color-primary);
      letter-spacing: -0.02em;
    }

    .status-indicator-group {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: var(--md-sys-color-warning);
      box-shadow: 0 0 0 2px var(--md-sys-color-surface);
    }

    .status-dot.online {
      background-color: var(--md-sys-color-success);
      box-shadow: 0 0 8px var(--md-sys-color-success);
    }

    /* Views */
    #unlinked-view, #linked-view {
      display: none;
      flex-direction: column;
      align-items: center;
      text-align: center;
      animation: fadeIn 0.3s ease-out;
    }

    /* Common Button Style (MD3 Tonal Capsule) */
    .btn-tonal {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 24px;
      background-color: var(--md-sys-color-secondary-container);
      color: var(--md-sys-color-on-secondary-container);
      border: none;
      border-radius: 9999px;
      font-size: 14px;
      font-weight: 700;
      text-decoration: none;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }

    .btn-tonal:hover {
      filter: brightness(0.95);
      box-shadow: var(--md-sys-elevation-1);
    }

    .btn-tonal:active {
      transform: scale(0.98);
    }

    /* Footer Links */
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-top: 16px;
      margin-bottom: 4px;
    }

    .f-link {
      font-size: 11px;
      color: var(--md-sys-color-primary);
      text-decoration: none;
      opacity: 0.7;
      font-weight: 600;
    }
    .f-link:hover { opacity: 1; text-decoration: underline; }

    /* Unlinked View Specific */
    .sync-wait-container {
      position: relative;
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
    }

    .pulse {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background-color: var(--md-sys-color-primary);
      opacity: 0.2;
      animation: pulse 2s infinite cubic-bezier(0.4, 0, 0.6, 1);
    }

    .waiting-text-main {
      font-size: 1.1rem;
      font-weight: 800;
      margin: 0 0 12px 0;
      color: var(--md-sys-color-on-surface);
      line-height: 1.3;
    }

    .waiting-text-sub {
      font-size: 13px;
      color: var(--md-sys-color-on-surface-variant);
      margin-bottom: 24px;
      line-height: 1.5;
      padding: 0 8px;
    }

    /* Linked View Specific */
    .ready-msg {
      font-size: 1.15rem;
      font-weight: 900;
      color: var(--md-sys-color-primary);
      margin: 0 0 8px 0;
      line-height: 1.2;
    }

    .sync-instruction {
      font-size: 13px;
      color: var(--md-sys-color-on-surface-variant);
      margin-bottom: 24px;
      line-height: 1.4;
      padding: 0 12px;
      white-space: nowrap;
    }

    #qrcode-link {
      display: block;
      margin-bottom: 12px;
      text-decoration: none;
      transition: transform 0.2s;
    }

    #qrcode-link:hover { transform: scale(1.02); }

    #qrcode {
      background: white;
      padding: 12px;
      border-radius: 20px;
      box-shadow: var(--md-sys-elevation-2);
      border: 1px solid var(--md-sys-color-surface-variant);
    }

    .room-info {
      font-size: 11px;
      font-weight: 500;
      color: var(--md-sys-color-on-surface-variant);
      opacity: 0.7;
      margin-bottom: 12px;
    }

    /* Subtle Copy Button */
    .btn-copy-link {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 8px 24px;
      background: transparent;
      color: var(--md-sys-color-primary);
      border: 1px solid var(--md-sys-color-outline);
      border-radius: 100px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 24px;
      transition: all 0.2s;
    }

    .btn-copy-link:hover { background-color: rgba(103, 80, 164, 0.05); }
    .btn-copy-link.success { border-color: var(--md-sys-color-success); color: var(--md-sys-color-success); }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 0.4; }
      100% { transform: scale(1.6); opacity: 0; }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1 data-i18n="name">VoiceMux Bridge</h1>
    <div class="status-indicator-group">
      <div id="status-indicator" class="status-dot"></div>
    </div>
  </div>

  <!-- View 1: Unlinked -->
  <div id="unlinked-view">
    <div class="sync-wait-container">
      <div class="pulse"></div>
      <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--md-sys-color-primary); z-index: 1;">
        <path d="M21 2v6h-6"></path><path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path><path d="M3 22v-6h6"></path><path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
      </svg>
    </div>
    <h2 class="waiting-text-main" data-i18n="waiting_hub_main">First, let's link with the Hub</h2>
    <p class="waiting-text-sub" data-i18n="waiting_hub_sub">Once you open the VoiceMux Hub site, the pairing QR code will appear here automatically.</p>
    <button id="btn-open-hub" class="btn-tonal" data-i18n="btn_open_hub">ğŸš€ Open Hub to Link</button>
  </div>

  <!-- View 2: Linked (Ready) -->
  <div id="linked-view">
    <h2 class="ready-msg" data-i18n="ready_to_sync">Ready to Pair!</h2>
    <p class="sync-instruction" data-i18n="sync_instruction">Scan with your phone to start input.</p>

    <a id="qrcode-link" href="#" target="_blank">
      <div id="qrcode"></div>
    </a>
    <div id="room-id" class="room-info" data-i18n="room_loading">Room: Loading...</div>

    <button id="copy-btn" class="btn-copy-link">
      <span id="copy-text" data-i18n="btn_copy_link">Copy Link</span>
    </button>

    <a href="https://hub.knc.jp" id="hub-link" target="_blank" class="btn-tonal" data-i18n="btn_manage_librarian">
      ğŸª„ Fix Errors & Generate Prompts
    </a>
  </div>

  <div class="footer-links">
    <a href="https://github.com/Kaneta/voicemux-bridge/issues" target="_blank" class="f-link" data-i18n="link_support">Support</a>
    <a href="https://knc.jp/ja/docs/voicemux-bridge/" id="guide-link" target="_blank" class="f-link" data-i18n="link_guide">Guide</a>
    <a href="https://github.com/Kaneta/voicemux-bridge/blob/main/PRIVACY.md" target="_blank" class="f-link" data-i18n="link_privacy">Privacy</a>
  </div>

  <script src="qrcode.min.js"></script>
  <script src="popup.js"></script>
</body>
</html>

--- END OF FILE: ./popup.html ---

--- FILE: ./popup.js ---
// VoiceMux Popup JS (v2.1.0 Finalized UI)
document.addEventListener('DOMContentLoaded', async () => {
  // Localization
  localize();

  const unlinkedView = document.getElementById("unlinked-view");
  const linkedView = document.getElementById("linked-view");
  const qrcodeContainer = document.getElementById("qrcode");
  const qrcodeLink = document.getElementById("qrcode-link");
  const roomIdDisplay = document.getElementById("room-id");
  const btnOpenHub = document.getElementById("btn-open-hub");
  const statusIndicator = document.getElementById("status-indicator");
  const hubLink = document.getElementById("hub-link");

  // 1. Retrieve credentials from storage
  async function updateUI() {
    const data = await chrome.storage.local.get(['voicemux_room_id', 'voicemux_token', 'voicemux_key', 'voicemux_hub_url']);
    const roomId = data.voicemux_room_id;
    const token = data.voicemux_token;
    const keyBase64 = data.voicemux_key;
    
    let hubOrigin = 'https://hub.knc.jp';
    try {
      const rawHubUrl = data.voicemux_hub_url || 'https://hub.knc.jp';
      hubOrigin = new URL(rawHubUrl).origin;
    } catch (e) {}

    if (roomId && token && keyBase64) {
      // --- LINKED STATE (READY) ---
      linkedView.style.display = "flex";
      unlinkedView.style.display = "none";
      statusIndicator.classList.add("online");

      // Update Hub Link
      if (hubLink) hubLink.href = `${hubOrigin}/welcome`;

      // Construct Pairing URL
      let pairingUrl = `${hubOrigin}/${roomId}/zen`;
      pairingUrl += `?token=${token}&uuid=${roomId}`;
      pairingUrl += `#key=${keyBase64}`;
      
      roomIdDisplay.innerText = chrome.i18n.getMessage("room_label", [roomId]);
      qrcodeLink.href = pairingUrl;

      // Handle Copy Button
      const copyBtn = document.getElementById("copy-btn");
      const copyText = document.getElementById("copy-text");
      copyBtn.onclick = async () => {
        try {
          await navigator.clipboard.writeText(pairingUrl);
          copyText.innerText = chrome.i18n.getMessage("btn_copy_success");
          copyBtn.classList.add("success");
          setTimeout(() => {
            copyText.innerText = chrome.i18n.getMessage("btn_copy_link");
            copyBtn.classList.remove("success");
          }, 2000);
        } catch (err) {}
      };

      // Generate QR Code
      if (qrcodeContainer.innerHTML === "") {
        new QRCode(qrcodeContainer, {
          text: pairingUrl,
          width: 160,
          height: 160,
          colorDark: "#6750A4",
          colorLight: "#ffffff",
          correctLevel: QRCode.CorrectLevel.H
        });
      }

    } else {
      // --- UNLINKED STATE ---
      unlinkedView.style.display = "flex";
      linkedView.style.display = "none";
      statusIndicator.classList.remove("online");

      btnOpenHub.onclick = () => {
        chrome.tabs.create({ url: hubOrigin });
      };

      // Signal background to check connection
      chrome.runtime.sendMessage({ action: "check_connection" });
    }
  }

  // Initial update
  updateUI();

  // Listen for storage changes
  chrome.storage.onChanged.addListener((changes, namespace) => {
    if (namespace === 'local' && (changes.voicemux_room_id || changes.voicemux_token)) {
      updateUI();
    }
  });
});

function localize() {
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    const message = chrome.i18n.getMessage(key);
    if (message) {
      if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
        element.placeholder = message;
      } else {
        element.innerHTML = message;
      }
    }
  });

  // Localize specialized links
  const guideLink = document.getElementById('guide-link');
  if (guideLink) {
    guideLink.href = chrome.i18n.getMessage('url_guide');
  }
}

--- END OF FILE: ./popup.js ---

--- FILE: ./qrcode.min.js ---
var QRCode;!function(){function a(a){this.mode=c.MODE_8BIT_BYTE,this.data=a,this.parsedData=[];for(var b=[],d=0,e=this.data.length;e>d;d++){var f=this.data.charCodeAt(d);f>65536?(b[0]=240|(1835008&f)>>>18,b[1]=128|(258048&f)>>>12,b[2]=128|(4032&f)>>>6,b[3]=128|63&f):f>2048?(b[0]=224|(61440&f)>>>12,b[1]=128|(4032&f)>>>6,b[2]=128|63&f):f>128?(b[0]=192|(1984&f)>>>6,b[1]=128|63&f):b[0]=f,this.parsedData=this.parsedData.concat(b)}this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function b(a,b){this.typeNumber=a,this.errorCorrectLevel=b,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function i(a,b){if(void 0==a.length)throw new Error(a.length+"/"+b);for(var c=0;c<a.length&&0==a[c];)c++;this.num=new Array(a.length-c+b);for(var d=0;d<a.length-c;d++)this.num[d]=a[d+c]}function j(a,b){this.totalCount=a,this.dataCount=b}function k(){this.buffer=[],this.length=0}function m(){return"undefined"!=typeof CanvasRenderingContext2D}function n(){var a=!1,b=navigator.userAgent;return/android/i.test(b)&&(a=!0,aMat=b.toString().match(/android ([0-9]\.[0-9])/i),aMat&&aMat[1]&&(a=parseFloat(aMat[1]))),a}function r(a,b){for(var c=1,e=s(a),f=0,g=l.length;g>=f;f++){var h=0;switch(b){case d.L:h=l[f][0];break;case d.M:h=l[f][1];break;case d.Q:h=l[f][2];break;case d.H:h=l[f][3]}if(h>=e)break;c++}if(c>l.length)throw new Error("Too long data");return c}function s(a){var b=encodeURI(a).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return b.length+(b.length!=a?3:0)}a.prototype={getLength:function(){return this.parsedData.length},write:function(a){for(var b=0,c=this.parsedData.length;c>b;b++)a.put(this.parsedData[b],8)}},b.prototype={addData:function(b){var c=new a(b);this.dataList.push(c),this.dataCache=null},isDark:function(a,b){if(0>a||this.moduleCount<=a||0>b||this.moduleCount<=b)throw new Error(a+","+b);return this.modules[a][b]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(a,c){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var d=0;d<this.moduleCount;d++){this.modules[d]=new Array(this.moduleCount);for(var e=0;e<this.moduleCount;e++)this.modules[d][e]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(a,c),this.typeNumber>=7&&this.setupTypeNumber(a),null==this.dataCache&&(this.dataCache=b.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,c)},setupPositionProbePattern:function(a,b){for(var c=-1;7>=c;c++)if(!(-1>=a+c||this.moduleCount<=a+c))for(var d=-1;7>=d;d++)-1>=b+d||this.moduleCount<=b+d||(this.modules[a+c][b+d]=c>=0&&6>=c&&(0==d||6==d)||d>=0&&6>=d&&(0==c||6==c)||c>=2&&4>=c&&d>=2&&4>=d?!0:!1)},getBestMaskPattern:function(){for(var a=0,b=0,c=0;8>c;c++){this.makeImpl(!0,c);var d=f.getLostPoint(this);(0==c||a>d)&&(a=d,b=c)}return b},createMovieClip:function(a,b,c){var d=a.createEmptyMovieClip(b,c),e=1;this.make();for(var f=0;f<this.modules.length;f++)for(var g=f*e,h=0;h<this.modules[f].length;h++){var i=h*e,j=this.modules[f][h];j&&(d.beginFill(0,100),d.moveTo(i,g),d.lineTo(i+e,g),d.lineTo(i+e,g+e),d.lineTo(i,g+e),d.endFill())}return d},setupTimingPattern:function(){for(var a=8;a<this.moduleCount-8;a++)null==this.modules[a][6]&&(this.modules[a][6]=0==a%2);for(var b=8;b<this.moduleCount-8;b++)null==this.modules[6][b]&&(this.modules[6][b]=0==b%2)},setupPositionAdjustPattern:function(){for(var a=f.getPatternPosition(this.typeNumber),b=0;b<a.length;b++)for(var c=0;c<a.length;c++){var d=a[b],e=a[c];if(null==this.modules[d][e])for(var g=-2;2>=g;g++)for(var h=-2;2>=h;h++)this.modules[d+g][e+h]=-2==g||2==g||-2==h||2==h||0==g&&0==h?!0:!1}},setupTypeNumber:function(a){for(var b=f.getBCHTypeNumber(this.typeNumber),c=0;18>c;c++){var d=!a&&1==(1&b>>c);this.modules[Math.floor(c/3)][c%3+this.moduleCount-8-3]=d}for(var c=0;18>c;c++){var d=!a&&1==(1&b>>c);this.modules[c%3+this.moduleCount-8-3][Math.floor(c/3)]=d}},setupTypeInfo:function(a,b){for(var c=this.errorCorrectLevel<<3|b,d=f.getBCHTypeInfo(c),e=0;15>e;e++){var g=!a&&1==(1&d>>e);6>e?this.modules[e][8]=g:8>e?this.modules[e+1][8]=g:this.modules[this.moduleCount-15+e][8]=g}for(var e=0;15>e;e++){var g=!a&&1==(1&d>>e);8>e?this.modules[8][this.moduleCount-e-1]=g:9>e?this.modules[8][15-e-1+1]=g:this.modules[8][15-e-1]=g}this.modules[this.moduleCount-8][8]=!a},mapData:function(a,b){for(var c=-1,d=this.moduleCount-1,e=7,g=0,h=this.moduleCount-1;h>0;h-=2)for(6==h&&h--;;){for(var i=0;2>i;i++)if(null==this.modules[d][h-i]){var j=!1;g<a.length&&(j=1==(1&a[g]>>>e));var k=f.getMask(b,d,h-i);k&&(j=!j),this.modules[d][h-i]=j,e--,-1==e&&(g++,e=7)}if(d+=c,0>d||this.moduleCount<=d){d-=c,c=-c;break}}}},b.PAD0=236,b.PAD1=17,b.createData=function(a,c,d){for(var e=j.getRSBlocks(a,c),g=new k,h=0;h<d.length;h++){var i=d[h];g.put(i.mode,4),g.put(i.getLength(),f.getLengthInBits(i.mode,a)),i.write(g)}for(var l=0,h=0;h<e.length;h++)l+=e[h].dataCount;if(g.getLengthInBits()>8*l)throw new Error("code length overflow. ("+g.getLengthInBits()+">"+8*l+")");for(g.getLengthInBits()+4<=8*l&&g.put(0,4);0!=g.getLengthInBits()%8;)g.putBit(!1);for(;;){if(g.getLengthInBits()>=8*l)break;if(g.put(b.PAD0,8),g.getLengthInBits()>=8*l)break;g.put(b.PAD1,8)}return b.createBytes(g,e)},b.createBytes=function(a,b){for(var c=0,d=0,e=0,g=new Array(b.length),h=new Array(b.length),j=0;j<b.length;j++){var k=b[j].dataCount,l=b[j].totalCount-k;d=Math.max(d,k),e=Math.max(e,l),g[j]=new Array(k);for(var m=0;m<g[j].length;m++)g[j][m]=255&a.buffer[m+c];c+=k;var n=f.getErrorCorrectPolynomial(l),o=new i(g[j],n.getLength()-1),p=o.mod(n);h[j]=new Array(n.getLength()-1);for(var m=0;m<h[j].length;m++){var q=m+p.getLength()-h[j].length;h[j][m]=q>=0?p.get(q):0}}for(var r=0,m=0;m<b.length;m++)r+=b[m].totalCount;for(var s=new Array(r),t=0,m=0;d>m;m++)for(var j=0;j<b.length;j++)m<g[j].length&&(s[t++]=g[j][m]);for(var m=0;e>m;m++)for(var j=0;j<b.length;j++)m<h[j].length&&(s[t++]=h[j][m]);return s};for(var c={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},d={L:1,M:0,Q:3,H:2},e={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},f={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(a){for(var b=a<<10;f.getBCHDigit(b)-f.getBCHDigit(f.G15)>=0;)b^=f.G15<<f.getBCHDigit(b)-f.getBCHDigit(f.G15);return(a<<10|b)^f.G15_MASK},getBCHTypeNumber:function(a){for(var b=a<<12;f.getBCHDigit(b)-f.getBCHDigit(f.G18)>=0;)b^=f.G18<<f.getBCHDigit(b)-f.getBCHDigit(f.G18);return a<<12|b},getBCHDigit:function(a){for(var b=0;0!=a;)b++,a>>>=1;return b},getPatternPosition:function(a){return f.PATTERN_POSITION_TABLE[a-1]},getMask:function(a,b,c){switch(a){case e.PATTERN000:return 0==(b+c)%2;case e.PATTERN001:return 0==b%2;case e.PATTERN010:return 0==c%3;case e.PATTERN011:return 0==(b+c)%3;case e.PATTERN100:return 0==(Math.floor(b/2)+Math.floor(c/3))%2;case e.PATTERN101:return 0==b*c%2+b*c%3;case e.PATTERN110:return 0==(b*c%2+b*c%3)%2;case e.PATTERN111:return 0==(b*c%3+(b+c)%2)%2;default:throw new Error("bad maskPattern:"+a)}},getErrorCorrectPolynomial:function(a){for(var b=new i([1],0),c=0;a>c;c++)b=b.multiply(new i([1,g.gexp(c)],0));return b},getLengthInBits:function(a,b){if(b>=1&&10>b)switch(a){case c.MODE_NUMBER:return 10;case c.MODE_ALPHA_NUM:return 9;case c.MODE_8BIT_BYTE:return 8;case c.MODE_KANJI:return 8;default:throw new Error("mode:"+a)}else if(27>b)switch(a){case c.MODE_NUMBER:return 12;case c.MODE_ALPHA_NUM:return 11;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 10;default:throw new Error("mode:"+a)}else{if(!(41>b))throw new Error("type:"+b);switch(a){case c.MODE_NUMBER:return 14;case c.MODE_ALPHA_NUM:return 13;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 12;default:throw new Error("mode:"+a)}}},getLostPoint:function(a){for(var b=a.getModuleCount(),c=0,d=0;b>d;d++)for(var e=0;b>e;e++){for(var f=0,g=a.isDark(d,e),h=-1;1>=h;h++)if(!(0>d+h||d+h>=b))for(var i=-1;1>=i;i++)0>e+i||e+i>=b||(0!=h||0!=i)&&g==a.isDark(d+h,e+i)&&f++;f>5&&(c+=3+f-5)}for(var d=0;b-1>d;d++)for(var e=0;b-1>e;e++){var j=0;a.isDark(d,e)&&j++,a.isDark(d+1,e)&&j++,a.isDark(d,e+1)&&j++,a.isDark(d+1,e+1)&&j++,(0==j||4==j)&&(c+=3)}for(var d=0;b>d;d++)for(var e=0;b-6>e;e++)a.isDark(d,e)&&!a.isDark(d,e+1)&&a.isDark(d,e+2)&&a.isDark(d,e+3)&&a.isDark(d,e+4)&&!a.isDark(d,e+5)&&a.isDark(d,e+6)&&(c+=40);for(var e=0;b>e;e++)for(var d=0;b-6>d;d++)a.isDark(d,e)&&!a.isDark(d+1,e)&&a.isDark(d+2,e)&&a.isDark(d+3,e)&&a.isDark(d+4,e)&&!a.isDark(d+5,e)&&a.isDark(d+6,e)&&(c+=40);for(var k=0,e=0;b>e;e++)for(var d=0;b>d;d++)a.isDark(d,e)&&k++;var l=Math.abs(100*k/b/b-50)/5;return c+=10*l}},g={glog:function(a){if(1>a)throw new Error("glog("+a+")");return g.LOG_TABLE[a]},gexp:function(a){for(;0>a;)a+=255;for(;a>=256;)a-=255;return g.EXP_TABLE[a]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},h=0;8>h;h++)g.EXP_TABLE[h]=1<<h;for(var h=8;256>h;h++)g.EXP_TABLE[h]=g.EXP_TABLE[h-4]^g.EXP_TABLE[h-5]^g.EXP_TABLE[h-6]^g.EXP_TABLE[h-8];for(var h=0;255>h;h++)g.LOG_TABLE[g.EXP_TABLE[h]]=h;i.prototype={get:function(a){return this.num[a]},getLength:function(){return this.num.length},multiply:function(a){for(var b=new Array(this.getLength()+a.getLength()-1),c=0;c<this.getLength();c++)for(var d=0;d<a.getLength();d++)b[c+d]^=g.gexp(g.glog(this.get(c))+g.glog(a.get(d)));return new i(b,0)},mod:function(a){if(this.getLength()-a.getLength()<0)return this;for(var b=g.glog(this.get(0))-g.glog(a.get(0)),c=new Array(this.getLength()),d=0;d<this.getLength();d++)c[d]=this.get(d);for(var d=0;d<a.getLength();d++)c[d]^=g.gexp(g.glog(a.get(d))+b);return new i(c,0).mod(a)}},j.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],j.getRSBlocks=function(a,b){var c=j.getRsBlockTable(a,b);if(void 0==c)throw new Error("bad rs block @ typeNumber:"+a+"/errorCorrectLevel:"+b);for(var d=c.length/3,e=[],f=0;d>f;f++)for(var g=c[3*f+0],h=c[3*f+1],i=c[3*f+2],k=0;g>k;k++)e.push(new j(h,i));return e},j.getRsBlockTable=function(a,b){switch(b){case d.L:return j.RS_BLOCK_TABLE[4*(a-1)+0];case d.M:return j.RS_BLOCK_TABLE[4*(a-1)+1];case d.Q:return j.RS_BLOCK_TABLE[4*(a-1)+2];case d.H:return j.RS_BLOCK_TABLE[4*(a-1)+3];default:return void 0}},k.prototype={get:function(a){var b=Math.floor(a/8);return 1==(1&this.buffer[b]>>>7-a%8)},put:function(a,b){for(var c=0;b>c;c++)this.putBit(1==(1&a>>>b-c-1))},getLengthInBits:function(){return this.length},putBit:function(a){var b=Math.floor(this.length/8);this.buffer.length<=b&&this.buffer.push(0),a&&(this.buffer[b]|=128>>>this.length%8),this.length++}};var l=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],o=function(){var a=function(a,b){this._el=a,this._htOption=b};return a.prototype.draw=function(a){function g(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a);for(var d in b)b.hasOwnProperty(d)&&c.setAttribute(d,b[d]);return c}var b=this._htOption,c=this._el,d=a.getModuleCount();Math.floor(b.width/d),Math.floor(b.height/d),this.clear();var h=g("svg",{viewBox:"0 0 "+String(d)+" "+String(d),width:"100%",height:"100%",fill:b.colorLight});h.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),c.appendChild(h),h.appendChild(g("rect",{fill:b.colorDark,width:"1",height:"1",id:"template"}));for(var i=0;d>i;i++)for(var j=0;d>j;j++)if(a.isDark(i,j)){var k=g("use",{x:String(i),y:String(j)});k.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),h.appendChild(k)}},a.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},a}(),p="svg"===document.documentElement.tagName.toLowerCase(),q=p?o:m()?function(){function a(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}function d(a,b){var c=this;if(c._fFail=b,c._fSuccess=a,null===c._bSupportDataURI){var d=document.createElement("img"),e=function(){c._bSupportDataURI=!1,c._fFail&&_fFail.call(c)},f=function(){c._bSupportDataURI=!0,c._fSuccess&&c._fSuccess.call(c)};return d.onabort=e,d.onerror=e,d.onload=f,d.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==",void 0}c._bSupportDataURI===!0&&c._fSuccess?c._fSuccess.call(c):c._bSupportDataURI===!1&&c._fFail&&c._fFail.call(c)}if(this._android&&this._android<=2.1){var b=1/window.devicePixelRatio,c=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(a,d,e,f,g,h,i,j){if("nodeName"in a&&/img/i.test(a.nodeName))for(var l=arguments.length-1;l>=1;l--)arguments[l]=arguments[l]*b;else"undefined"==typeof j&&(arguments[1]*=b,arguments[2]*=b,arguments[3]*=b,arguments[4]*=b);c.apply(this,arguments)}}var e=function(a,b){this._bIsPainted=!1,this._android=n(),this._htOption=b,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=b.width,this._elCanvas.height=b.height,a.appendChild(this._elCanvas),this._el=a,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return e.prototype.draw=function(a){var b=this._elImage,c=this._oContext,d=this._htOption,e=a.getModuleCount(),f=d.width/e,g=d.height/e,h=Math.round(f),i=Math.round(g);b.style.display="none",this.clear();for(var j=0;e>j;j++)for(var k=0;e>k;k++){var l=a.isDark(j,k),m=k*f,n=j*g;c.strokeStyle=l?d.colorDark:d.colorLight,c.lineWidth=1,c.fillStyle=l?d.colorDark:d.colorLight,c.fillRect(m,n,f,g),c.strokeRect(Math.floor(m)+.5,Math.floor(n)+.5,h,i),c.strokeRect(Math.ceil(m)-.5,Math.ceil(n)-.5,h,i)}this._bIsPainted=!0},e.prototype.makeImage=function(){this._bIsPainted&&d.call(this,a)},e.prototype.isPainted=function(){return this._bIsPainted},e.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},e.prototype.round=function(a){return a?Math.floor(1e3*a)/1e3:a},e}():function(){var a=function(a,b){this._el=a,this._htOption=b};return a.prototype.draw=function(a){for(var b=this._htOption,c=this._el,d=a.getModuleCount(),e=Math.floor(b.width/d),f=Math.floor(b.height/d),g=['<table style="border:0;border-collapse:collapse;">'],h=0;d>h;h++){g.push("<tr>");for(var i=0;d>i;i++)g.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+e+"px;height:"+f+"px;background-color:"+(a.isDark(h,i)?b.colorDark:b.colorLight)+';"></td>');g.push("</tr>")}g.push("</table>"),c.innerHTML=g.join("");var j=c.childNodes[0],k=(b.width-j.offsetWidth)/2,l=(b.height-j.offsetHeight)/2;k>0&&l>0&&(j.style.margin=l+"px "+k+"px")},a.prototype.clear=function(){this._el.innerHTML=""},a}();QRCode=function(a,b){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:d.H},"string"==typeof b&&(b={text:b}),b)for(var c in b)this._htOption[c]=b[c];"string"==typeof a&&(a=document.getElementById(a)),this._android=n(),this._el=a,this._oQRCode=null,this._oDrawing=new q(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},QRCode.prototype.makeCode=function(a){this._oQRCode=new b(r(a,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(a),this._oQRCode.make(),this._el.title=a,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=d}();
--- END OF FILE: ./qrcode.min.js ---

--- FILE: ./README.md ---
# VoiceMux Bridge v2.1.0 ğŸ›°ï¸

VoiceMux Bridge ã¯ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®éŸ³å£°å…¥åŠ›ã‚’ PC ä¸Šã®ã‚ã‚‰ã‚†ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆï¼ˆChatGPT, Gmail, Slack ç­‰ï¼‰ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æŒ¿å…¥ã™ã‚‹ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã§ã™ã€‚

## ğŸš€ v2.1.0 ã®æ–°æ©Ÿèƒ½: Multi-language Support & Secure Push-Sync
å¾“æ¥ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆv1.xï¼‰ã§è¡Œã£ã¦ã„ãŸã€Œå®šæœŸçš„ãªãƒšãƒ¼ã‚¸ç›£è¦–ã€ã‚„ã€Œæ‰‹å‹•ã§ã® ID å–å¾—ã€ã‚’å®Œå…¨ã«å»ƒæ­¢ã—ã¾ã—ãŸã€‚

- **å¤šè¨€èªå¯¾å¿œ (i18n)**: æ—¥æœ¬èªã¨è‹±èªã®è¡¨ç¤ºã«å®Œå…¨å¯¾å¿œã€‚
- **ã‚¼ãƒ­è¨­å®šåŒæœŸ**: [VoiceMux Hub](https://hub.knc.jp) ã‚’é–‹ãã ã‘ã§ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ãŒå®‰å…¨ã‹ã¤å³åº§ã«æ‹¡å¼µæ©Ÿèƒ½ã¸ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚
- **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ»ãƒšã‚¢ãƒªãƒ³ã‚°**: ä¸€åº¦é€£æºã™ã‚Œã°ã€æ¬¡å›ã‹ã‚‰ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ã—ã¦å³åº§ã« QR ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã€‚
- **ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ç¬¬ä¸€**: ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ã‚„æš—å·éµï¼‰ãŒ HTML ä¸Šã«éœ²å‡ºã™ã‚‹ã“ã¨ãªãã€ãƒ–ãƒ©ã‚¦ã‚¶ã®æ­£è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚° API ã§å—ã‘æ¸¡ã—ã•ã‚Œã¾ã™ã€‚

## ğŸ›  ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ä½¿ã„æ–¹
1. [Chrome ã‚¦ã‚§ãƒ–ã‚¹ãƒˆã‚¢](https://chromewebstore.google.com/detail/voicemux-bridge/agkglknmadfhdfobmgecllpgoecebdip) ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚
2. ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®ãƒ‘ã‚ºãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã‹ã‚‰ VoiceMux Bridge ã‚’ã€Œãƒ”ãƒ³ç•™ã‚ã€ã—ã¾ã™ã€‚
3. [VoiceMux Hub](https://hub.knc.jp) ã‚’é–‹ãã€åˆæœŸåŒ–ã‚’å®Œäº†ã•ã›ã¾ã™ï¼ˆè‡ªå‹•çš„ã«æ‹¡å¼µæ©Ÿèƒ½ã¸åŒæœŸã•ã‚Œã¾ã™ï¼‰ã€‚
4. æ‹¡å¼µã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€è¡¨ç¤ºã•ã‚ŒãŸ QR ã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ãƒãƒ›ã§ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚Œã°æº–å‚™å®Œäº†ã§ã™ã€‚

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ (E2EE)
VoiceMux ã¯ **End-to-End æš—å·åŒ– (E2EE)** ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚
éŸ³å£°ã‹ã‚‰å¤‰æ›ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é›¢ã‚Œã‚‹å‰ã«**ã‚ãªãŸã®ãƒ‡ãƒã‚¤ã‚¹ä¸Š**ã§æš—å·åŒ–ã•ã‚Œã¾ã™ã€‚ä¸­ç¶™ã‚µãƒ¼ãƒãƒ¼ï¼ˆv.knc.jpï¼‰ã¯æš—å·åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’è»¢é€ã—ã€ãã®ä¸­èº«ã‚’è§£èª­ã™ã‚‹ã“ã¨ã¯æš—å·å­¦çš„ã«ä¸å¯èƒ½ã§ã™ã€‚

è©³ç´°ãªå®Ÿè£…ã®è¨¼æ‹ ã¯ [E2EEå®Ÿè£…æŠ€è¡“ãƒ¬ãƒãƒ¼ãƒˆ](./docs/E2EE_IMPLEMENTATION_JA.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸ“Š ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçµ±è¨ˆ (v2.1.0)
VoiceMux Bridge ã¯ã€è»½é‡ã§é€æ˜æ€§ã®é«˜ã„è¨­è¨ˆã‚’ç¶­æŒã—ã¦ã„ã¾ã™ã€‚
- **ç·ã‚³ãƒ¼ãƒ‰è¡Œæ•°**: ç´„ 1,050 è¡Œ (JS/HTML/Manifest)
- **ä¾å­˜é–¢ä¿‚**: ã‚¼ãƒ­ (QRç”Ÿæˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª 1ã¤ã®ã¿ã‚’åŒæ¢±)
- **é€šä¿¡å…ˆ**: `knc.jp` ãƒ‰ãƒ¡ã‚¤ãƒ³ã«é™å®š

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹
ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ [LICENSE](./LICENSE) ã«åŸºã¥ã„ã¦å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®ã‚³ãƒ¼ãƒ‰ã¯å®Œå…¨ã«ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã‚ã‚Šã€èª°ã§ã‚‚ç›£æŸ»å¯èƒ½ã§ã™ã€‚

--- END OF FILE: ./README.md ---

--- FILE: ./LICENSE ---
MIT License

Copyright (c) 2026 Kohei Kaneta

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

--- END OF FILE: ./LICENSE ---

--- FILE: ./adapters.json ---
[
  {
    "id": "gemini",
    "name": "Google Gemini",
    "host": "gemini.google.com",
    "inputSelector": "div[contenteditable='true'], .rich-textarea, div[role='textbox']",
    "submitSelector": "button[aria-label*='é€ä¿¡'], button[aria-label*='Send'], button.send-button, button:has(span.material-symbols-outlined)"
  },
  {
    "id": "chatgpt",
    "name": "ChatGPT",
    "host": "chatgpt.com",
    "inputSelector": "#prompt-textarea",
    "submitSelector": "button[data-testid='send-button']"
  },
  {
    "id": "claude",
    "name": "Claude",
    "host": "claude.ai",
    "inputSelector": "div[contenteditable='true']",
    "submitSelector": "button[aria-label*='Send'], button[aria-label*='é€ä¿¡']"
  },
  {
    "id": "perplexity",
    "name": "Perplexity",
    "host": "perplexity.ai",
    "inputSelector": "textarea",
    "submitSelector": "button[aria-label*='Submit'], button[aria-label*='Ask']"
  },
  {
    "id": "treenote",
    "name": "Treenote",
    "host": "treenoteweb.pages.dev",
    "inputSelector": "textarea.auto-resize-textarea, textarea, div[contenteditable='true']",
    "submitSelector": "button.submit-btn"
  },
  {
    "id": "gmail",
    "name": "Gmail",
    "host": "mail.google.com",
    "inputSelector": "div[role='textbox'][contenteditable='true']",
    "submitSelector": null
  },
  {
    "id": "deepl",
    "name": "DeepL",
    "host": "deepl.com",
    "inputSelector": "div[contenteditable='true'], d-textarea",
    "submitSelector": null
  }
]

--- END OF FILE: ./adapters.json ---

--- FILE: ./docs/WHY_PERMISSIONS_JA.md ---
# Chromeæ‹¡å¼µæ©Ÿèƒ½ã®ã€Œå¼·åŠ›ãªæ¨©é™ã€ã¨UXã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã«ã¤ã„ã¦

**VoiceMux Bridge** ã¯ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®éŸ³å£°å…¥åŠ›ã‚’PCã®ã‚ã‚‰ã‚†ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã¸ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«è»¢é€ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ã€Œã™ã¹ã¦ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆä¸Šã®å…¨ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å–ã‚Šã¨å¤‰æ›´ã€ã¨ã„ã†è­¦å‘Šã®æ„å›³ã¨ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¸ã®é…æ…®ã«ã¤ã„ã¦é–‹ç™ºãƒãƒ¼ãƒ ã®è¦‹è§£ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚

---

## 1. ãªãœã€Œä¿¡é ¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€ã¨ã„ã†è­¦å‘ŠãŒå‡ºã‚‹ã®ã‹ï¼Ÿ

### èƒŒæ™¯
Chrome ã‚¦ã‚§ãƒ–ã‚¹ãƒˆã‚¢ã‹ã‚‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

> **è­¦å‘Š:** ã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ã‚»ãƒ¼ãƒ• ãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ä¿è­·å¼·åŒ–æ©Ÿèƒ½ã§ä¿¡é ¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

### ç†ç”±
ã“ã‚Œã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æ¬ é™¥ã§ã¯ãªãã€Google Chrome ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è©•ä¾¡ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™ã€‚ä¸»ã«ä»¥ä¸‹ã®æ¡ä»¶ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

- **é–‹ç™ºè€…å®Ÿç¸¾ã®è“„ç©æœŸé–“:** ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ç™»éŒ²ã‹ã‚‰ã®æœŸé–“ãŒçŸ­ã„ã€‚
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°:** å…¬é–‹ç›´å¾Œã§åˆ©ç”¨è€…ãŒé™å®šçš„ã§ã‚ã‚‹ã€‚

**VoiceMux ã®å¯¾å¿œ:**
ç§ãŸã¡ã¯ã™ã¹ã¦ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ GitHub ã§å…¬é–‹ã—ã¦ãŠã‚Šã€èª°ã§ã‚‚å®‰å…¨æ€§ã‚’ç›£æŸ»ã§ãã‚‹çŠ¶æ…‹ã«ã—ã¦ã„ã¾ã™ã€‚åˆ©ç”¨è€…ãŒå¢—ãˆã‚‹ã«ã¤ã‚Œã¦ã€ã“ã®è­¦å‘Šã¯è‡ªå‹•çš„ã«è¡¨ç¤ºã•ã‚Œãªããªã‚Šã¾ã™ã€‚

---

## 2. ãªãœã€Œå…¨ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã€ãŒå¿…è¦ãªã®ã‹ï¼Ÿ

### ç†ç”±ï¼šã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªã€Œãƒãƒ³ã‚ºãƒ•ãƒªãƒ¼ä½“é¨“ã€ã®å®Ÿç¾
VoiceMux Bridge ã®æ ¸å¿ƒã¯ã€**ã€ŒPCå´ã«è§¦ã‚Œã‚‹ã“ã¨ãªãã€ã‚¹ãƒãƒ›ã«è©±ã—ã‹ã‘ã‚‹ã ã‘ã§æ–‡å­—ãŒå…¥åŠ›ã•ã‚Œã‚‹ã€**ã¨ã„ã†ä½“é¨“ã§ã™ã€‚

ã“ã®ã€Œé­”æ³•ã®ã‚ˆã†ãªä½“é¨“ã€ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€æ‹¡å¼µæ©Ÿèƒ½ãŒä»¥ä¸‹ã®å‹•ä½œã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

1. **å¾…æ©Ÿ:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã©ã®ã‚¿ãƒ–ï¼ˆGemini, ChatGPT, Gmailç­‰ï¼‰ã‚’é–‹ã„ã¦ã‚‚ã€éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Œã‚‹çŠ¶æ…‹ã«ã™ã‚‹ã€‚
2. **è‡ªå‹•æ¤œçŸ¥:** ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆãŸéš›ã€æ–°ã—ã„ãƒšãƒ¼ã‚¸ä¸Šã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å³åº§ã«ç‰¹å®šã—ã¦æ–‡å­—ã‚’æµã—è¾¼ã‚€ã€‚

ã‚‚ã—æ¨©é™ã‚’ã€Œã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã ã‘ã€ã«åˆ¶é™ã—ãŸå ´åˆã€**ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã³ã«æ¯å›æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¨±å¯ã‚’ä¸ãˆã‚‹**æ“ä½œãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã§ã¯éŸ³å£°å…¥åŠ›ã®åˆ©ä¾¿æ€§ãŒæãªã‚ã‚Œã€ãƒ„ãƒ¼ãƒ«ã®å­˜åœ¨æ„ç¾©ãŒå¤±ã‚ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚

---

## 3. ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¨å®‰å…¨æ€§ã«ã¤ã„ã¦

ç§ãŸã¡ã¯ã€å¼·åŠ›ãªæ¨©é™ã‚’è¦æ±‚ã™ã‚‹è²¬ä»»ã¨ã—ã¦ã€ä»¥ä¸‹ã®è¨­è¨ˆã¨æƒ…å ±å…¬é–‹ã‚’å¾¹åº•ã—ã¦ã„ã¾ã™ã€‚

- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹åŒ–:** æ‹¡å¼µæ©Ÿèƒ½ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã™ã¹ã¦ GitHub ã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã€Œãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰é€ä¿¡ã•ã‚Œã‚‹å‰ã«ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãæš—å·åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ã€ã€Œå…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆä»¥å¤–ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã„ãªã„ã‹ã€ã‚’èª°ã§ã‚‚ç›£æŸ»å¯èƒ½ã§ã™ã€‚
- **ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰æš—å·åŒ– (E2EE):** éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚„ãƒ†ã‚­ã‚¹ãƒˆã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã¨ã‚¹ãƒãƒ›ã®é–“ã§ç›´æ¥æš—å·åŒ–ã•ã‚Œã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼å´ã¯ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰éå…¬é–‹ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆç’°å¢ƒã§é‹ç”¨ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§æš—å·åŒ–ãŒå®Œçµã—ã¦ã„ã‚‹ãŸã‚ã€ã‚µãƒ¼ãƒãƒ¼ï¼ˆå½“ã‚µã‚¤ãƒˆï¼‰ã§ã•ãˆä¸­èº«ã‚’èª­ã¿å–ã‚‹ã“ã¨ã¯ç‰©ç†çš„ã«ä¸å¯èƒ½ã§ã™ã€‚
- **ã‚µãƒ¼ãƒãƒ¼ã«éµã‚’æ¸¡ã•ãªã„ä»•çµ„ã¿:** ã‚¹ãƒãƒ›ã¨ã®ãƒšã‚¢ãƒªãƒ³ã‚°ã«ä½¿ç”¨ã™ã‚‹æš—å·éµã¯ã€URLã®ãƒãƒƒã‚·ãƒ¥ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆ`#` ä»¥é™ã®éƒ¨åˆ†ï¼‰ã¨ã—ã¦å…±æœ‰ã•ã‚Œã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ä»•æ§˜ä¸Šã€ã“ã®éƒ¨åˆ†ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œãªã„ãŸã‚ã€éµã®æƒ…å ±ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æµã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
- **æœ€å°é™ã®ãƒ‡ãƒ¼ã‚¿åé›†:** æ‹¡å¼µæ©Ÿèƒ½ã¯è¨­å®šï¼ˆRoom ID / Keyï¼‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã™ã‚‹ã®ã¿ã§ã€é–²è¦§å±¥æ­´ã‚„å€‹äººæƒ…å ±ã‚’å¤–éƒ¨ã¸é€ä¿¡ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

---

## 4. ä»–ã®ãƒ„ãƒ¼ãƒ«ã¨ã®æ¯”è¼ƒ

å¤šãã®ã‚¤ãƒ³ãƒ•ãƒ©ç³»ãƒ„ãƒ¼ãƒ«ï¼ˆ1Password, Grammarly, DeepLç­‰ï¼‰ã‚‚ã€åŒæ§˜ã®ç†ç”±ã§ã€Œå…¨ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã€ã‚’è¦æ±‚ã—ã¾ã™ã€‚ã€Œã„ã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã‚’å¿…è¦ã¨ã™ã‚‹ã‹äºˆæ¸¬ã§ããªã„ã€ãƒ„ãƒ¼ãƒ«ã«ã¨ã£ã¦ã€ã“ã®æ¨©é™ã¯åˆ©ä¾¿æ€§ã¨å®‰å…¨æ€§ã‚’ä¸¡ç«‹ã™ã‚‹ãŸã‚ã®æ¨™æº–çš„ãªé¸æŠã§ã™ã€‚

---

## çµè«–

VoiceMux Bridge ã¯ã€**ã€Œç©¶æ¥µã®å…¥åŠ›ä½“é¨“ã€ã‚’æä¾›ã™ã‚‹ãŸã‚ã«ç¾åœ¨ã®æ¨©é™è¨­å®šã‚’é¸æŠã—ã¾ã—ãŸã€‚** è­¦å‘Šã¯å¼·åŠ›ã«è¦‹ãˆã¾ã™ãŒã€ç§ãŸã¡ã¯é€æ˜æ€§ã¨æŠ€è¡“ï¼ˆE2EEï¼‰ã«ã‚ˆã£ã¦ãã®ä¿¡é ¼ã«å¿œãˆã¾ã™ã€‚

---
*æœ€çµ‚æ›´æ–°: 2026-02-17*

--- END OF FILE: ./docs/WHY_PERMISSIONS_JA.md ---

--- FILE: ./docs/WHY_PERMISSIONS_EN.md ---
# Transparency Report: Why VoiceMux Bridge Requests "Access to All Sites"

**VoiceMux Bridge** is designed to provide a seamless bridge between your smartphone's voice recognition and your desktop browser. This document explains our technical decisions regarding Chrome Extension permissions and our commitment to user privacy.

---

## 1. Why does Chrome say this extension is "Not Trusted"?

### The Issue
When installing from the Chrome Web Store, you might see this message:

> **Warning:** This extension is not trusted by Enhanced Safe Browsing.

### The Reason
This is not due to a bug or malware. It is a standard automated security check by Google based on:

- **Developer Longevity:** The developer account is relatively new.
- **User Base:** The extension was recently published and has a growing but still small number of users.

**Our Commitment:**
VoiceMux Bridge is fully open-source. We provide the source code on GitHub for public auditing to ensure complete transparency while Google's automated trust score accumulates.

---

## 2. Why "Read and Change All Your Data on All Websites"?

### The Reason: Ensuring a "Frictionless" UX
The core value of VoiceMux is the **"Magic Experience"**â€”speak into your phone, and text appears on your PC instantly without you having to touch your mouse.

To achieve this, the extension must be able to:

1. **Standby:** Listen for incoming encrypted data regardless of which tab (ChatGPT, Gemini, Notion, etc.) you are currently using.
2. **Auto-Injection:** Detect the active input field as soon as you switch tabs and inject the text without manual intervention.

If we restricted permissions to "activeTab" (only when clicked), **you would have to click the extension icon every single time you switch a tab.** This would destroy the hands-free utility that makes VoiceMux valuable.

---

## 3. Privacy and Security by Design

We understand that "All Site Access" is a powerful permission. We balance this responsibility with the following transparency measures:

- **Open Source Client:** The source code for the Chrome Extension is fully public on GitHub. This allows anyone to verify that data is encrypted *before* it leaves your browser and that we are not touching sensitive data like passwords.
- **End-to-End Encryption (E2EE):** While our relay server operates in a private environment, it only handles encrypted blobs. Since the encryption happens in the open-source client, the server remains a "black box" that cannot see or log your actual text.
- **Zero-Knowledge Key Exchange:** Your encryption keys are shared with your phone via URL hash fragments (`#key=...`). By technical design, these fragments are never sent to any server, ensuring your keys never touch the network.
- **No Tracking:** We do not collect browsing history or analytics. Your encryption keys and Room IDs stay stored locally on your devices.

---

## 4. Industry Standards

Most essential productivity tools, such as **1Password, Grammarly, and DeepL**, require the same level of permission. Because these tools must be ready to assist you the moment you start typing, constant presence is a technical necessity.

---

## Conclusion

We chose this permission model to deliver the **fastest, most seamless input experience possible.** While the system warning looks intimidating, we stand behind our transparent, E2EE-secured architecture to earn your trust.

---
*Last Updated: 2026-02-17*

--- END OF FILE: ./docs/WHY_PERMISSIONS_EN.md ---

--- FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION.md ---
# ã€é–‹ç™ºãƒ­ã‚°ã€‘Chromeæ‹¡å¼µã®ã€Œæ€–ã„è­¦å‘Šã€ã«ã¤ã„ã¦AIã¨ç›¸è«‡ã—ãŸè¨˜éŒ²

VoiceMux Bridge ã®ãƒªãƒªãƒ¼ã‚¹ã«ã‚ãŸã‚Šã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­¦å‘Šã«ã¤ã„ã¦ã€AIï¼ˆGeminiï¼‰ã¨æŠ€è¡“çš„ãªç›¸è«‡ã‚’ã—ãŸéš›ã®ãƒ­ã‚°ã‚’å…¬é–‹ã—ã¾ã™ã€‚ãªãœã“ã®ä»•æ§˜ï¼ˆæ¨©é™ï¼‰ã«ãªã£ã¦ã„ã‚‹ã®ã‹ã€ãã®çµŒç·¯ãŒã‚ã‹ã‚Šã¾ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
è‡ªä½œã®æ‹¡å¼µæ©Ÿèƒ½ã‚’å…¬é–‹ã—ã¾ã—ãŸãŒã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€Œã‚»ãƒ¼ãƒ• ãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ä¿è­·å¼·åŒ–æ©Ÿèƒ½ã§ä¿¡é ¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€ã¨ã„ã†è­¦å‘ŠãŒå‡ºã¦ãã¾ã™ã€‚ä½•ã‹ãƒã‚°ãŒã‚ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

#### ğŸ¤– AI
çµè«–ã‹ã‚‰è¨€ã†ã¨ã€ã“ã‚Œã¯**ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒã‚°ã‚„è¦ç´„é•åã§ã¯ãªãã€ä¸»ã«ã€Œé–‹ç™ºè€…ã¨ã—ã¦ã®å®Ÿç¸¾ï¼ˆä¿¡é ¼ï¼‰ãŒã¾ã è“„ç©ã•ã‚Œã¦ã„ãªã„ã€ã“ã¨ãŒåŸå› **ã§ã™ã€‚

Google Chromeã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä»•æ§˜ã«ã‚ˆã‚‹ã‚‚ã®ã§ã€ä»¥ä¸‹ã®ãƒã‚¤ãƒ³ãƒˆãŒå½±éŸ¿ã—ã¦ã„ã¾ã™ã€‚

1.  **ã€Œä¿¡é ¼ã§ãã‚‹é–‹ç™ºè€…ã€ã®åŸºæº–ã‚’æº€ãŸã—ã¦ã„ãªã„:** ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ç™»éŒ²ã‹ã‚‰æ—¥ãŒæµ…ã„ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ•°ãŒã¾ã å°‘ãªã„ãªã©ã€‚
2.  **å…¬é–‹ç›´å¾Œã§ã‚ã‚‹:** å…¬é–‹ã•ã‚ŒãŸã°ã‹ã‚Šã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€Googleå´ã®ã‚¹ã‚­ãƒ£ãƒ³ã‚„è©•ä¾¡ãŒçµ‚ã‚ã£ã¦ã„ãªã„ãŸã‚ã€è­¦å‘ŠãŒå‡ºã‚„ã™ã„å‚¾å‘ã«ã‚ã‚Šã¾ã™ã€‚

æ®‹å¿µãªãŒã‚‰ãƒœã‚¿ãƒ³ä¸€ã¤ã§æ¶ˆã™è¨­å®šã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€**ã€Œæ™‚é–“ãŒè§£æ±ºã™ã‚‹ï¼ˆå®Ÿç¸¾ã‚’ç©ã‚€ï¼‰ã€**ã®ã‚’å¾…ã¤ã®ãŒæ­£æ”»æ³•ã§ã™ã€‚å…¬é–‹ç›´å¾Œã«ã‚ˆãã‚ã‚‹ç¾è±¡ãªã®ã§ã€ã¾ãšã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€Œå®‰å…¨ã§ã™ã€ã¨ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã—ã¦å®Ÿç¸¾ã‚’ä½œã‚‹ã®ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’é€²ã‚ã‚‹ã¨ã€ä»Šåº¦ã¯ã€Œã™ã¹ã¦ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆä¸Šã«ã‚ã‚‹è‡ªåˆ†ã®å…¨ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å–ã‚Šã¨å¤‰æ›´ã€ã¨ã„ã†ã•ã‚‰ã«æ€–ã„è­¦å‘ŠãŒå‡ºã¾ã™ã€‚ã“ã‚Œã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¼•ã„ã¦ã—ã¾ã„ã¾ã™ã‚ˆã­ã€‚

#### ğŸ¤– AI
ãã®è­¦å‘Šã¯ã€**ã€Œç‰¹å®šã®ãƒšãƒ¼ã‚¸é™å®šã€ã‹ã‚‰ã€Œä»»æ„ã®ãƒšãƒ¼ã‚¸ï¼ˆã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ï¼‰ã€ã¸å…¥åŠ›å¯¾è±¡ã‚’åºƒã’ãŸã“ã¨**ãŒåŸå› ã§ã™ã­ã€‚

`manifest.json` ã§ `<all_urls>` ã¨ã„ã†æ¨©é™ã‚’ä½¿ã£ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ

VoiceMux Bridgeã®ã€Œã‚¹ãƒãƒ›ã«å‘ã‹ã£ã¦è©±ã›ã°ã€ä»Šé–‹ã„ã¦ã„ã‚‹ãƒšãƒ¼ã‚¸ã«å³åº§ã«å…¥åŠ›ã•ã‚Œã‚‹ã€ã¨ã„ã†ä½“é¨“ã‚’å®Ÿç¾ã™ã‚‹ã«ã¯ã€**ã‚ã‚‰ã‹ã˜ã‚ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ã§å—ä¿¡ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å¾…æ©Ÿã•ã›ã¦ãŠã**å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
Chromeã®ä»•æ§˜ä¸Šã€ã“ã®ã€Œå…¨ãƒšãƒ¼ã‚¸å¾…æ©Ÿã€ã®æ¨©é™ã‚’æ±‚ã‚ã‚‹ã¨ã€è‡ªå‹•çš„ã«ãã®å¼·ã„è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®æ­£å¸¸ãªä»£å„Ÿã§ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ã‚‚ã—ãã®æ¨©é™ã‚’ç‹­ã‚ãŸã‚‰ã©ã†ãªã‚Šã¾ã™ã‹ï¼Ÿ è­¦å‘Šã¯æ¶ˆãˆã¾ã™ã‹ï¼Ÿ

#### ğŸ¤– AI
æ¨©é™ã‚’ `activeTab` ã ã‘ã«ç‹­ã‚ã‚Œã°è­¦å‘Šã¯æ¶ˆãˆã¾ã™ã€‚ã—ã‹ã—ã€**ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«å‘¼ã³å‡ºã•ãªã„é™ã‚Šã€æ‹¡å¼µæ©Ÿèƒ½ã¯ä½•ã‚‚ã—ãªã„ï¼ˆã§ããªã„ï¼‰ã€** ã¨ã„ã†æŒ™å‹•ã«å¤‰ã‚ã‚Šã¾ã™ã€‚

å…·ä½“çš„ã«ã¯ã“ã†ãªã‚Šã¾ã™ï¼š

1.  Gemini Web ã‚’é–‹ã â†’ **ã‚¹ãƒãƒ›ã§è©±ã—ã¦ã‚‚ä½•ã‚‚èµ·ããªã„**ï¼ˆå—ä¿¡ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒå‹•ã„ã¦ã„ãªã„ï¼‰ã€‚
2.  æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’**ã‚¯ãƒªãƒƒã‚¯**ã™ã‚‹ â†’ ã‚„ã£ã¨å…¥åŠ›å¯èƒ½ã«ãªã‚‹ã€‚
3.  Gmail ã®ã‚¿ãƒ–ã¸ç§»å‹•ã™ã‚‹ â†’ **ã¾ãŸã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯**ã—ãªã„ã¨å‹•ã‹ãªã„ã€‚

æœ€å¤§ã®å•é¡Œã¯ã€**ã€Œã‚¯ãƒªãƒƒã‚¯ã‚’å¿˜ã‚Œã¦è©±ã—å§‹ã‚ãŸæ™‚ã€** ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€Œã›ã£ã‹ãé•·æ–‡ã‚’å–‹ã£ãŸã®ã«ã€PCã«å…¥åŠ›ã•ã‚Œãªã‹ã£ãŸï¼ã€ã¨ã„ã†ã‚¹ãƒˆãƒ¬ã‚¹ã‚’æ„Ÿã˜ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

VoiceMuxã®ã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ã®å ´åˆã€**ã€ŒPCå´ã¯ä½•ã‚‚ã—ãªãã¦ã„ã„ï¼ˆãƒãƒ³ã‚ºãƒ•ãƒªãƒ¼ï¼‰ã€** ã¨ã„ã†ã®ãŒæœ€å¤§ã®ä¾¡å€¤ãªã®ã§ã€ã‚¯ãƒªãƒƒã‚¯å¿…é ˆã«ã™ã‚‹ã®ã¯ã€Œä½¿ã„å‹æ‰‹ã®æ­»ã€ã‚’æ„å‘³ã—ã¾ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ãªã‚‹ã»ã©â€¦ã€‚ä»–ã®ä¼¼ãŸã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ï¼ˆVoiceInã¨ã‹ï¼‰ã¯ã©ã†ã—ã¦ã„ã‚‹ã‚“ã§ã™ã‹ï¼Ÿ

#### ğŸ¤– AI
èª¿ã¹ã¾ã—ãŸãŒã€**VoiceIn ã¯ã‚ãªãŸã¨åŒã˜ã€Œè­¦å‘ŠãŒå‡ºã‚‹æ–¹å¼ï¼ˆå…¨æ¨©é™ï¼‰ã€ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚**
å½¼ã‚‰ã¯ã€Œè­¦å‘Šã¯å‡ºã‚‹ã‘ã‚Œã©ã€ãã®ã¶ã‚“é­”æ³•ã®ã‚ˆã†ã«ä¾¿åˆ©ã§ã™ã‚ˆã€ã¨ã„ã†ã‚¹ã‚¿ãƒ³ã‚¹ã§ã€ä¿¡é ¼ã¨å®Ÿç¸¾ã§ã‚«ãƒãƒ¼ã—ã¦ã„ã¾ã™ã€‚

ä¸€æ–¹ã€Typeless ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µã§ã¯ãªãã€ŒOSã®ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒªã€ã‚’ä½œã‚‹ã“ã¨ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¶ç´„è‡ªä½“ã‚’å›é¿ã—ã¦ã„ã¾ã™ï¼ˆé–‹ç™ºã‚³ã‚¹ãƒˆã¯è·³ã­ä¸ŠãŒã‚Šã¾ã™ãŒï¼‰ã€‚

ã¾ãŸã€Honeyï¼ˆã‚¯ãƒ¼ãƒãƒ³ã‚¢ãƒ—ãƒªï¼‰ã®ã‚ˆã†ã«ã€Œä½¿ã†æ™‚ã ã‘è¨±å¯ã‚’æ±‚ã‚ã‚‹ã€æ–¹å¼ã‚‚ã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯ã€Œè²·ã„ç‰©ã€ã¨ã„ã†æ˜ç¢ºãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒã‚ã‚‹ãƒ„ãƒ¼ãƒ«ã ã‹ã‚‰æˆç«‹ã—ã¾ã™ã€‚ã„ã¤å…¥åŠ›ãŒç™ºç”Ÿã™ã‚‹ã‹ã‚ã‹ã‚‰ãªã„VoiceMuxã®ã‚ˆã†ãªã‚¤ãƒ³ãƒ•ãƒ©ç³»ãƒ„ãƒ¼ãƒ«ã§ã¯ã€ã‚„ã¯ã‚Š**ã€Œå…¨æ¨©é™ï¼ˆè­¦å‘Šã‚ã‚Šï¼‰ã€ãŒç‹é“ã‹ã¤æ­£è§£**ã ã¨æ€ã„ã¾ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ã‚ã‹ã‚Šã¾ã—ãŸã€‚å¤‰ã«å°ç´°å·¥ã‚’ã—ã¦ä¸ä¾¿ã«ã™ã‚‹ã‚ˆã‚Šã€æ­£ç›´ã«ã€Œä¾¿åˆ©ã•ã®ãŸã‚ã®æ¨©é™ã§ã™ã€ã¨èª¬æ˜ã—ã¦é€²ã‚ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚ã‚ã¨ã€ã‚µãƒ¼ãƒãƒ¼å´ã¯é‹ç”¨ä¸Šã®éƒ½åˆã§ã‚½ãƒ¼ã‚¹ã‚’éå…¬é–‹ã«ã—ãŸã„ã®ã§ã™ãŒã€ãã‚Œã¯ã€Œã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã€ã‚’è¬³ã†ä¸Šã§å•é¡Œã«ãªã‚Šã¾ã™ã‹ï¼Ÿ

#### ğŸ¤– AI
è³¢æ˜ãªåˆ¤æ–­ã§ã™ã€‚
ã‚µãƒ¼ãƒãƒ¼å´ã«ã¤ã„ã¦ã§ã™ãŒã€**ã€Œæ‹¡å¼µæ©Ÿèƒ½ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰å´ãŒã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã‚ã‚Œã°ã€E2EEã®ä¿¡é ¼æ€§ã¯æ‹…ä¿ã§ãã‚‹ã€**ã®ã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸€ç•ªæã‚Œã‚‹ã®ã¯ã€Œè‡ªåˆ†ã®ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ä½•ãŒèµ·ãã¦ã„ã‚‹ã‹ã€ã§ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶å´ã§é€ä¿¡å‰ã«ãƒ‡ãƒ¼ã‚¿ãŒæš—å·åŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã•ãˆã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§è¨¼æ˜ã§ãã‚Œã°ã€ãã®å…ˆã®ã‚µãƒ¼ãƒãƒ¼ãŒã©ã‚Œã ã‘ã€Œãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã€ã§ã‚ã£ã¦ã‚‚ã€ä¸­èº«ã‚’ç›—ã¿è¦‹ã‚‹ã“ã¨ã¯ä¸å¯èƒ½ã§ã™ã€‚

ã‚€ã—ã‚ã€ã‚µãƒ¼ãƒãƒ¼ã‚’ã€ŒãŸã ã®æš—å·åŒ–ãƒ‡ãƒ¼ã‚¿ã®åœŸç®¡ã€ã«å¾¹ã•ã›ã‚‹ã“ã¨ã§ã€é‹ç”¨ã‚³ã‚¹ãƒˆã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’è‡ªåˆ†ã§ç®¡ç†ã—ã‚„ã™ããªã‚‹ãƒ¡ãƒªãƒƒãƒˆã‚‚ã‚ã‚Šã¾ã™ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ã€Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã¯å…¬é–‹ã€ã‚µãƒ¼ãƒãƒ¼å´ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆé‹ç”¨ï¼ˆã§ã‚‚ä¸­èº«ã¯è¦‹ã‚Œãªã„ï¼‰ã€ã¨æ­£ç›´ã«æ›¸ãã®ãŒã€æœ€ã‚‚ä¿¡é ¼ã•ã‚Œã‚‹å½¢ã§ã™ã€‚è‡ªä¿¡ã‚’æŒã£ã¦é€²ã‚ã¾ã—ã‚‡ã†ã€‚

--- END OF FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION.md ---

--- FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION_EN.md ---
# [Dev Log] Chatting with AI about Chrome Extension Security Warnings

Sharing the raw conversation log where I consulted with AI (Gemini) about the scary security warnings that appear when installing VoiceMux Bridge. This explains the "why" behind the permissions.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
I just published my extension, but when I try to install it, I get a warning saying "This extension is not trusted by Enhanced Safe Browsing." Is there a bug?

#### ğŸ¤– AI
Long story short: **This isn't a bug or a violation. It's mainly because you haven't accumulated "trust" as a developer yet.**

It's just how Chrome's security works. Hereâ€™s why:

1.  **You don't meet the "Trusted Developer" criteria yet:** Your account is new, or the install count is low.
2.  **It's brand new:** Since it was just published, Google hasn't finished their automated scanning and reputation evaluation.

Unfortunately, there's no "fix it" button. The standard solution is to **wait for time to solve it.** It happens to almost everyone. Just announce to your users "It's safe, just new," and let the reputation build up naturally.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
When I proceed with the installation, I get an even scarier warning: "Read and change all your data on all websites." Users are going to run away when they see this.

#### ğŸ¤– AI
That warning appears because **you expanded the scope from "specific pages" to "any page."**

Are you using `<all_urls>` in your `manifest.json`?

To achieve the VoiceMux experienceâ€”where you speak to your phone and it *instantly* types into whatever page is openâ€”**you need the receiver program waiting in the background on every page.**
Chrome forces that scary warning whenever you ask for this "wait everywhere" permission. Itâ€™s the price you pay for the feature.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
What happens if I restrict that permission? Will the warning go away?

#### ğŸ¤– AI
If you restrict it to `activeTab`, the warning disappears. But the behavior changes to: **"The extension does nothing unless you explicitly click it."**

Here is the reality:

1.  Open Gemini Web -> **Speak to phone, nothing happens.** (Receiver isn't running).
2.  **Click** the extension icon -> Now it can type.
3.  Switch tab to Gmail -> **Click the icon again** or it won't work.

The biggest issue is **when users forget to click.** They'll dictate a long paragraph, hit send, and... nothing appears on the PC. That's a terrible user experience.

For a tool like VoiceMux, **"Hands-free on the PC side"** is the core value. Making clicks mandatory effectively kills the UX.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
I see... What about other tools like VoiceIn? How do they handle this?

#### ğŸ¤– AI
I checked, and **VoiceIn uses the exact same approach as you (Full Permissions with the warning).**
Their stance is: "You get a warning, but in exchange, you get a magic-like seamless experience." They cover the fear with their reputation.

Other tools like Typeless avoid browser warnings by building a native OS app instead (which is way harder to build).

There are tools like Honey that ask for permission "only when needed," but that works because "shopping" is a distinct event. For an infrastructure tool like VoiceMux where input can happen anytime, **sticking with "Full Permissions (Warning)" is the standard and correct choice.**

---

#### ğŸ§‘â€ğŸ’» Developer (User)
Got it. Instead of crippling the features to hide the warning, I'll be honest and explain "This permission is for your convenience." Also, I plan to keep the relay server code private for operational reasons. Is that a problem for the "Open Source" claim?

#### ğŸ¤– AI
That's a sound strategy!
Regarding the server: **As long as the extension (client) is open-source, the integrity of the E2EE remains verifiable.**

What users care about most is what happens inside their browser. If you can prove via open-source code that data is encrypted *before* it leaves the client, the relay server becomes a "dumb pipe." Even if the server is a private "black box," it is mathematically impossible for it to read your messages.

In fact, keeping the server private allows you to manage operational security and spam prevention more effectively without compromising user privacy. Simply state that the "Client is Open Source, while the Server is Private (but blind to data)," and you will build genuine trust. Go for it with confidence.

--- END OF FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION_EN.md ---

--- FILE: ./docs/E2EE_IMPLEMENTATION_EN.md ---
# VoiceMux Bridge: E2EE Implementation Report

This report explains how VoiceMux Bridge ensures that your data remains private and invisible to our servers, using snippets from the actual source code.

---

## 1. Local Key Generation and Secure Transfer
The encryption key (AES-GCM 128-bit) is generated within [VoiceMux Hub](https://hub.knc.jp) and securely pushed to the extension via the official browser messaging API. It is never sent to our servers.

**Source: `background.js` (Receiver side)**
```javascript
// Around line 155: Listening for credential push from the Hub
chrome.runtime.onMessageExternal.addListener((request, sender, sendResponse) => {
  if (request.action === "SYNC_AUTH") {
    const { uuid, token, key } = request.payload;
    
    // Storing in the extension's private secure storage
    chrome.storage.local.set({
      'voicemux_room_id': uuid,
      'voicemux_token': token,
      'voicemux_key': key
    }, () => { ... });
  }
});
```
The key is stored in `chrome.storage.local`, an isolated storage area provided by the browser that websites and external servers cannot access.

---

## 2. Zero-Knowledge Key Exchange
We use URL hash fragments to share keys between your PC and smartphone without the server ever seeing the key.

**Source: `popup.js`**
```javascript
// Around line 45: Constructing the pairing URL
let pairingUrl = `${hubOrigin}/${roomId}/zen`;
pairingUrl += `?token=${token}&uuid=${roomId}`;
pairingUrl += `#key=${keyBase64}`; // Key is included in the hash
```
The key is placed after the `#` symbol. By technical design, **anything after the `#` (hash fragment) is handled exclusively by the browser and is NEVER sent to the server.**

---

## 3. Client-Side Decryption
The extension receives only encrypted blobs from the relay server. The actual decryption happens locally inside the extension's background process.

**Source: `background.js`**
```javascript
// Around line 43: The core decryption logic
async function decrypt(payload) {
  // Receives only ciphertext and IV (Initialization Vector)
  if (!payload.ciphertext || !payload.iv) return payload.text || "";
  
  try {
    const key = await getDecryptionKey(); // Import key from local storage
    const iv = Uint8Array.from(safeAtob(payload.iv), c => c.charCodeAt(0));
    const ciphertext = Uint8Array.from(safeAtob(payload.ciphertext), c => c.charCodeAt(0));

    // AES-GCM decryption using the Web Crypto API
    const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ciphertext);
    
    // Returns the plaintext only to the active browser tab
    return new TextDecoder().decode(decrypted);
  } catch (e) {
    // If the key is missing or incorrect, decryption is mathematically impossible
    return "[Decryption Error]";
  }
}
```
The relay server only sees the `ciphertext` string, which acts as noise. It has no mathematical means to read your data.

---

## 4. Conclusion
Based on the implementation above:
1. **Exclusive Access:** Only you possess the encryption keys on your devices.
2. **Secure Transport:** Keys never touch the network or the server.
3. **Transparent Logic:** Since the extension is open-source, anyone can verify that we do not leak data or bypass encryption.

---

## 5. How to Verify the Identity of the Code
"How do I know the code running in my browser is the same as this GitHub code?" You can verify this yourself with these steps:

### A. Inspect the installed files on your disk
Chrome stores the source code of installed extensions on your local machine.

- **Windows**: `%LOCALAPPDATA%\Google\Chrome\User Data\Default\Extensions\omdfoongpifbbhapnpbocfoijkglegpd`
- **Mac**: `~/Library/Application Support/Google/Chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`
- **Linux**: `~/.config/google-chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`

You can open the JS files (`background.js`, `content.js`, etc.) in these folders and compare them with the GitHub repository. VoiceMux Bridge does not minify or obfuscate its code, making comparison easy.

### B. Inspect the Running Background Code
1. Open `chrome://extensions` in your browser.
2. Click the **"Service Worker"** link for VoiceMux Bridge.
3. Developer Tools will open, allowing you to read the `background.js` source code currently in execution.

VoiceMux Bridge proves its integrity through total transparency.

---
*Last Updated: 2026-02-21 (v2.1.0)*

--- END OF FILE: ./docs/E2EE_IMPLEMENTATION_EN.md ---

--- FILE: ./docs/E2EE_IMPLEMENTATION_JA.md ---
# VoiceMux Bridge: E2EEå®Ÿè£…æŠ€è¡“ãƒ¬ãƒãƒ¼ãƒˆ

VoiceMux Bridge ãŒã©ã®ã‚ˆã†ã«ã—ã¦ãƒ‡ãƒ¼ã‚¿ã®ç§˜å¯†ã‚’ä¿æŒã—ã€ã‚µãƒ¼ãƒãƒ¼ã«å†…å®¹ã‚’è¦‹ã›ãªã„ä»•çµ„ã¿ã«ãªã£ã¦ã„ã‚‹ã‹ã‚’ã€å®Ÿéš›ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’æŠœç²‹ã—ã¦è§£èª¬ã—ã¾ã™ã€‚

---

## 1. ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®æš—å·éµç”Ÿæˆã¨ã‚»ã‚­ãƒ¥ã‚¢ãªè»¢é€
æš—å·éµï¼ˆAES-GCM 128bitï¼‰ã¯ [VoiceMux Hub](https://hub.knc.jp) ã§ç”Ÿæˆã•ã‚Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã®æ­£è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚° API ã‚’é€šã˜ã¦æ‹¡å¼µæ©Ÿèƒ½ã¸å®‰å…¨ã«ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã¸é€ä¿¡ã•ã‚Œã‚‹ã“ã¨ã¯æ±ºã—ã¦ã‚ã‚Šã¾ã›ã‚“ã€‚

**è¨¼æ‹ ã‚³ãƒ¼ãƒ‰: `background.js` (å—ä¿¡å´)**
```javascript
// 155è¡Œç›®ä»˜è¿‘: Hub ã‹ã‚‰ã®è³‡æ ¼æƒ…å ±ãƒ—ãƒƒã‚·ãƒ¥ã‚’å¾…æ©Ÿ
chrome.runtime.onMessageExternal.addListener((request, sender, sendResponse) => {
  if (request.action === "SYNC_AUTH") {
    const { uuid, token, key } = request.payload;
    
    // æ‹¡å¼µæ©Ÿèƒ½å°‚ç”¨ã®å®‰å…¨ãªé ˜åŸŸã«ä¿å­˜
    chrome.storage.local.set({
      'voicemux_room_id': uuid,
      'voicemux_token': token,
      'voicemux_key': key
    }, () => { ... });
  }
});
```
ã“ã®éµã¯ `chrome.storage.local` ã¨ã„ã†ã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒæä¾›ã™ã‚‹ã€Œæ‹¡å¼µæ©Ÿèƒ½å°‚ç”¨ã®éš”é›¢ã•ã‚ŒãŸå®‰å…¨ãªé ˜åŸŸã€ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

---

## 2. ã‚µãƒ¼ãƒãƒ¼ã‚’çµŒç”±ã—ãªã„éµå…±æœ‰ï¼ˆZero-Knowledgeï¼‰
ã‚¹ãƒãƒ›ã¨ã®ãƒšã‚¢ãƒªãƒ³ã‚°æ™‚ã€URLã®ãƒãƒƒã‚·ãƒ¥ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆ`#`ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€ã‚µãƒ¼ãƒãƒ¼ã«éµã‚’çŸ¥ã‚‰ã›ãšã«ãƒ‡ãƒã‚¤ã‚¹é–“ã§å…±æœ‰ã—ã¾ã™ã€‚

**è¨¼æ‹ ã‚³ãƒ¼ãƒ‰: `popup.js`**
```javascript
// 45è¡Œç›®ä»˜è¿‘: ãƒšã‚¢ãƒªãƒ³ã‚°ç”¨URLã®æ§‹ç¯‰
let pairingUrl = `${hubOrigin}/${roomId}/zen`;
pairingUrl += `?token=${token}&uuid=${roomId}`;
pairingUrl += `#key=${keyBase64}`; // éµã‚’ãƒãƒƒã‚·ãƒ¥ã«å«ã‚ã‚‹
```
URLã® `#` ä»¥é™ã®éƒ¨åˆ†ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ä»•æ§˜ã«ã‚ˆã‚Š **ã€Œã‚µãƒ¼ãƒãƒ¼ã«ã¯é€ä¿¡ã•ã‚Œãªã„ã€** ã¨ã„ã†ç‰¹æ€§ãŒã‚ã‚Šã¾ã™ã€‚éµã®æƒ…å ±ã¯ã‚¹ãƒãƒ›ã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ã ã‘ã§å‡¦ç†ã•ã‚Œã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ã‚µãƒ¼ãƒãƒ¼ï¼ˆä¸­ç¶™å™¨ï¼‰ã«ã¯ä¸€åˆ‡å±Šãã¾ã›ã‚“ã€‚

---

## 3. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ã®å¾©å·
æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã€Œæš—å·åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®å¡Šã€ã®ã¿ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’å¹³æ–‡ã«æˆ»ã™ï¼ˆå¾©å·ã™ã‚‹ï¼‰å‡¦ç†ã¯ã€æ‹¡å¼µæ©Ÿèƒ½ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹å†…ã§è¡Œã‚ã‚Œã¾ã™ã€‚

**è¨¼æ‹ ã‚³ãƒ¼ãƒ‰: `background.js`**
```javascript
// 43è¡Œç›®ä»˜è¿‘: å¾©å·å‡¦ç†ã®æ ¸å¿ƒ
async function decrypt(payload) {
  // payload.ciphertextï¼ˆæš—å·æ–‡ï¼‰ã¨ payload.ivï¼ˆåˆæœŸåŒ–ãƒ™ã‚¯ãƒˆãƒ«ï¼‰ã®ã¿ã‚’å—ã‘å–ã‚‹
  if (!payload.ciphertext || !payload.iv) return payload.text || "";
  
  try {
    const key = await getDecryptionKey(); // ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰éµã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
    const iv = Uint8Array.from(safeAtob(payload.iv), c => c.charCodeAt(0));
    const ciphertext = Uint8Array.from(safeAtob(payload.ciphertext), c => c.charCodeAt(0));

    // Web Crypto API ã«ã‚ˆã‚‹ AES-GCM å¾©å·
    const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ciphertext);
    
    // å¾©å·ã•ã‚ŒãŸå¹³æ–‡ã®ã¿ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã¸é€ä¿¡
    return new TextDecoder().decode(decrypted);
  } catch (e) {
    // éµãŒæ­£ã—ããªã„å ´åˆã€ä¸­èº«ã‚’èª­ã¿å–ã‚‹ã“ã¨ã¯æš—å·å­¦çš„ã«ä¸å¯èƒ½
    return "[Decryption Error]";
  }
}
```
ã‚µãƒ¼ãƒãƒ¼ã¯æ„å‘³ã‚’æŒãŸãªã„æš—å·æ–‡ï¼ˆ`ciphertext`ï¼‰ã‚’è»¢é€ã—ã¦ã„ã‚‹ã ã‘ã§ã€ãã®å†…å®¹ã‚’èª­ã¿å–ã‚‹æ•°å­¦çš„ãªæ‰‹æ®µã‚’æŒã¡ã¾ã›ã‚“ã€‚

---

## 4. çµè«–
ä»¥ä¸Šã®å®Ÿè£…ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®å®‰å…¨æ€§ãŒæŠ€è¡“çš„ã«æ‹…ä¿ã•ã‚Œã¦ã„ã¾ã™ã€‚

1.  **éµã®ç‹¬å **: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒã‚¤ã‚¹é–“ï¼ˆPCã¨ã‚¹ãƒãƒ›ï¼‰ä»¥å¤–ã«éµã¯å­˜åœ¨ã—ã¾ã›ã‚“ã€‚
2.  **å®‰å…¨ãªé€šä¿¡**: éµæœ¬ä½“ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆï¼‰ã‚’æµã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
3.  **é€æ˜æ€§ã®æ‹…ä¿**: æ‹¡å¼µæ©Ÿèƒ½ãŒã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã‚ã‚‹ãŸã‚ã€ä¸Šè¨˜ã®å®Ÿè£…ã«å˜˜ãŒãªã„ã“ã¨ã‚’èª°ã§ã‚‚æ¤œè¨¼å¯èƒ½ã§ã™ã€‚

---

## 5. ã‚¹ãƒˆã‚¢ç‰ˆã¨GitHubã®ã‚³ãƒ¼ãƒ‰ãŒåŒä¸€ã‹ç¢ºèªã™ã‚‹æ–¹æ³•
ã€ŒGitHubã®ã‚³ãƒ¼ãƒ‰ã¯ç¶ºéº—ã ãŒã€ã‚¹ãƒˆã‚¢ã§é…å¸ƒã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯ä¸­èº«ãŒé•ã†ã®ã§ã¯ãªã„ã‹ï¼Ÿã€ã¨ã„ã†ç–‘å•ã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ãŒè§£æ¶ˆã§ãã¾ã™ã€‚

### A. ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚ŒãŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã™ã‚‹
Chromeã‚¦ã‚§ãƒ–ã‚¹ãƒˆã‚¢ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸæ‹¡å¼µæ©Ÿèƒ½ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã€ã‚ãªãŸã®PCã®ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

- **Windows**: `%LOCALAPPDATA%\Google\Chrome\User Data\Default\Extensions\omdfoongpifbbhapnpbocfoijkglegpd`
- **Mac**: `~/Library/Application Support/Google/Chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`
- **Linux**: `~/.config/google-chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`

ã“ã®ãƒ•ã‚©ãƒ«ãƒ€å†…ã® JS ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`background.js`, `content.js` ç­‰ï¼‰ã‚’é–‹ãã€GitHub ä¸Šã®ã‚³ãƒ¼ãƒ‰ã¨æ¯”è¼ƒã—ã¦ã¿ã¦ãã ã•ã„ã€‚VoiceMux Bridge ã¯ã‚³ãƒ¼ãƒ‰ã®é›£èª­åŒ–ï¼ˆèª­ã¿ã¥ã‚‰ãã™ã‚‹å‡¦ç†ï¼‰ã‚’è¡Œã£ã¦ã„ãªã„ãŸã‚ã€ãã®ã¾ã¾æ¯”è¼ƒãŒå¯èƒ½ã§ã™ã€‚

### B. å®Ÿè¡Œä¸­ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã‚‹
1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ `chrome://extensions` ã‚’é–‹ãã¾ã™ã€‚
2. VoiceMux Bridge ã® **ã€Œã‚µãƒ¼ãƒ“ã‚¹ ãƒ¯ãƒ¼ã‚«ãƒ¼ã€** ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
3. ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ãŒé–‹ãã€ç¾åœ¨å‹•ä½œã—ã¦ã„ã‚‹ `background.js` ã®ã‚½ãƒ¼ã‚¹ã‚’ç›´æ¥ç¢ºèªã§ãã¾ã™ã€‚

VoiceMux Bridge ã¯ã€æŠ€è¡“çš„ãªèª å®Ÿã•ã‚’é€æ˜æ€§ã«ã‚ˆã£ã¦è¨¼æ˜ã—ã¾ã™ã€‚

---
*æœ€çµ‚æ›´æ–°: 2026-02-21 (v2.1.0)*

--- END OF FILE: ./docs/E2EE_IMPLEMENTATION_JA.md ---

--- FILE: ./docs/USER_GUIDE_JA.md ---
# VoiceMux Bridge ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ‰ ğŸ›°ï¸

VoiceMux Bridgeï¼ˆãƒœã‚¤ã‚¹ãƒ ã‚¯ã‚¹ãƒ»ãƒ–ãƒªãƒƒã‚¸ï¼‰ã¸ã‚ˆã†ã“ãï¼
ã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ã‚¹ãƒãƒ›ã®ã€Œä½¿ã„æ…£ã‚ŒãŸã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã€ã‚’ä½¿ã£ã¦ã€ãƒ‘ã‚½ã‚³ãƒ³ã®ã‚ã‚‰ã‚†ã‚‹å…¥åŠ›æ¬„ï¼ˆGemini, ChatGPT, Gmail, Slackãªã©ï¼‰ã¸ã‚¹ãƒ©ã‚¹ãƒ©ã¨æ–‡å­—ã‚’å…¥åŠ›ã™ã‚‹ãŸã‚ã®æ¶ã‘æ©‹ã§ã™ã€‚

é›£ã—ã„è¨­å®šã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®ã‚¬ã‚¤ãƒ‰ã¨ä¸€ç·’ã«ã€æœ€åˆã®ä¸€æ­©ã‚’è¸ã¿å‡ºã—ã¾ã—ã‚‡ã†ã€‚

---

## 1. æº–å‚™ï¼šWebã‚µã‚¤ãƒˆã¨ã¤ãªã’ã‚ˆã†ï¼ˆåŒæœŸï¼‰

ã¾ãšã€æ‹¡å¼µæ©Ÿèƒ½ã‚’ä½¿ãˆã‚‹çŠ¶æ…‹ã«ã—ã¾ã™ã€‚

1.  ãƒ‘ã‚½ã‚³ãƒ³ã§ [VoiceMux Hub](https://hub.knc.jp) ã‚’é–‹ãã¾ã™ã€‚
2.  ã‚µã‚¤ãƒˆãŒé–‹ãã¨åŒæ™‚ã«ã€å®‰å…¨ãªèªè¨¼æƒ…å ±ãŒã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¸è‡ªå‹•çš„ã«é€ã‚‰ã‚Œã¾ã™ã€‚
3.  ãƒ–ãƒ©ã‚¦ã‚¶å³ä¸Šã® **VoiceMuxã‚¢ã‚¤ã‚³ãƒ³ï¼ˆãƒã‚¤ã‚¯ã‚¹ã‚¿ãƒ³ãƒ‰ã®ãƒãƒ¼ã‚¯ï¼‰** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
4.  ã€Œãƒšã‚¢ãƒªãƒ³ã‚°ã®æº–å‚™å®Œäº†ã€ã¨è¡¨ç¤ºã•ã‚Œã€QRã‚³ãƒ¼ãƒ‰ãŒå‡ºã¦ã„ã‚Œã°æº–å‚™OKã§ã™ï¼

> ğŸ’¡ **ãƒ’ãƒ³ãƒˆ**: ã‚¢ã‚¤ã‚³ãƒ³ã‚’ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã«ã€Œãƒ”ãƒ³ç•™ã‚ã€ã—ã¦ãŠãã¨ã€ã„ã¤ã§ã‚‚ã™ãã«QRã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã§ãã¦ä¾¿åˆ©ã§ã™ã€‚

---

## 2. ã¤ãªã’ã‚ˆã†ï¼šã‚¹ãƒãƒ›ã¨ãƒšã‚¢ãƒªãƒ³ã‚°

1.  è¡¨ç¤ºã•ã‚ŒãŸ **QRã‚³ãƒ¼ãƒ‰** ã‚’ã‚¹ãƒãƒ›ã®ã‚«ãƒ¡ãƒ©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã¾ã™ã€‚
2.  ã‚¹ãƒãƒ›ã§å°‚ç”¨ã®å…¥åŠ›ç”»é¢ãŒé–‹ã„ãŸã‚‰ã€é€£æºå®Œäº†ã§ã™ã€‚

ã‚ãªãŸã®ã‚¹ãƒãƒ›ã¨ãƒ‘ã‚½ã‚³ãƒ³ã¯ã€å¼·åŠ›ãªæš—å·ï¼ˆE2EEï¼‰ã§å®ˆã‚‰ã‚ŒãŸå°‚ç”¨ã®é€šã‚Šé“ã§ã¤ãªãŒã‚Šã¾ã—ãŸã€‚

---

## 3. ã¤ã‹ã£ã¦ã¿ã‚ˆã†ï¼šã„ã¤ã‚‚ã®ã‚¹ãƒãƒ›ã§è©±ã—ã‹ã‘ã‚‹

VoiceMuxã®æœ€å¤§ã®ç‰¹å¾´ã¯ã€ã‚¹ãƒãƒ›ã§ã„ã¤ã‚‚ä½¿ã£ã¦ã„ã‚‹ **ã€ŒGboardã€ã‚„ã€ŒiPhoneã®éŸ³å£°å…¥åŠ›ã€** ã‚’ãã®ã¾ã¾ãƒ‘ã‚½ã‚³ãƒ³ã§ä½¿ãˆã‚‹ã“ã¨ã§ã™ã€‚

1.  ãƒ‘ã‚½ã‚³ãƒ³ã§ã€æ–‡å­—ã‚’å…¥åŠ›ã—ãŸã„ã‚µã‚¤ãƒˆï¼ˆChatGPT, Gmailãªã©ï¼‰ã®å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚«ãƒ¼ã‚½ãƒ«ã‚’åˆã‚ã›ã¾ã™ã€‚
2.  ã‚¹ãƒãƒ›ã®ç”»é¢ã«ã‚ã‚‹å…¥åŠ›ã‚¨ãƒªã‚¢ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’å‡ºã—ã¾ã™ã€‚
3.  ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã«ã‚ã‚‹ **ã€Œãƒã‚¤ã‚¯ã®ãƒœã‚¿ãƒ³ã€** ã‚’æŠ¼ã—ã¦ã€ã‚¹ãƒãƒ›ã«å‘ã‹ã£ã¦è©±ã—ã‹ã‘ã¦ã¿ã¦ãã ã•ã„ã€‚
4.  è©±ã—çµ‚ã‚ã‚‹ã¨â€¦â€¦ã‚ãªãŸã®è¨€è‘‰ãŒã€ãƒ‘ã‚½ã‚³ãƒ³ã®å…¥åŠ›æ¬„ã«ç›´æ¥å…¥åŠ›ã•ã‚Œã¾ã™ï¼

---

## 4. ã‚‚ã£ã¨ä¾¿åˆ©ã«ï¼šè¾æ›¸ã‚’è‚²ã¦ã‚‹

éŸ³å£°å…¥åŠ›ã§ã‚ˆãã‚ã‚‹ã€Œå°‚é–€ç”¨èªã®èª¤å¤‰æ›ã€ã¯ã€[VoiceMux Hub](https://hub.knc.jp) ã§ä¿®æ­£ã§ãã¾ã™ã€‚

*   **èª¤èªè­˜ã®ä¿®æ­£**: Hub ã®ã‚¨ãƒ‡ã‚£ã‚¿ã§æ–‡å­—ã‚’ç›´ã™ã¨ã€AIãŒæ¬¡å›ã‹ã‚‰ã®å¤‰æ›ã‚’è³¢ãã—ã¦ãã‚Œã¾ã™ã€‚
*   **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ**: æ‹¡å¼µæ©Ÿèƒ½ã®ä¸‹éƒ¨ã«ã‚ã‚‹ **ã€ŒğŸª„ èª¤èªè­˜ã®ä¿®æ­£ãƒ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã€** ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€Hub ãŒé–‹ãã€å…¥åŠ›ã—ãŸå†…å®¹ã‚’ã•ã‚‰ã«AIå‘ã‘ã«æœ€é©åŒ–ã§ãã¾ã™ã€‚

---

## 5. å®‰å¿ƒãƒ»å®‰å…¨ã®ãŸã‚ã«

VoiceMuxã¯ã€ã‚ãªãŸã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’ä¸€ç•ªå¤§åˆ‡ã«ã—ã¦ã„ã¾ã™ã€‚
*   **ã‚ãªãŸã®æ–‡å­—ã¯ã€èª°ã«ã‚‚è¦‹ã‚‰ã‚Œã¾ã›ã‚“**: ã‚¹ãƒãƒ›ã¨ãƒ‘ã‚½ã‚³ãƒ³ã®é–“ã§ç›´æ¥æš—å·åŒ–ã•ã‚Œã‚‹ãŸã‚ã€é€”ä¸­ã®ã‚µãƒ¼ãƒãƒ¼ã§ã™ã‚‰ä¸­èº«ã‚’èª­ã‚€ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
*   **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½**: ä¸€åº¦é€£æºã™ã‚Œã°ã€æ¬¡å›ã‹ã‚‰ã¯ Hub ã‚µã‚¤ãƒˆã‚’é–‹ã‹ãªãã¦ã‚‚ã€æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’æŠ¼ã™ã ã‘ã§å³åº§ã«ä½¿ã„å§‹ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

---

## 6. å›°ã£ãŸã¨ãã¯ï¼Ÿ

*   **QRã‚³ãƒ¼ãƒ‰ãŒå‡ºãªã„**: [VoiceMux Hub](https://hub.knc.jp) ã‚’ä¸€åº¦ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆå†èª­ã¿è¾¼ã¿ï¼‰ã—ã¦ã‹ã‚‰ã€ã‚‚ã†ä¸€åº¦ã‚¢ã‚¤ã‚³ãƒ³ã‚’æŠ¼ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
*   **æ–‡å­—ãŒå…¥åŠ›ã•ã‚Œãªã„**: ãƒ‘ã‚½ã‚³ãƒ³ã®å…¥åŠ›æ¬„ã‚’ä¸€åº¦ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ã‚«ãƒ¼ã‚½ãƒ«ãŒãƒã‚«ãƒã‚«ã—ã¦ã„ã‚‹çŠ¶æ…‹ã«ã—ã¦ãã ã•ã„ã€‚

---

æ¯æ—¥ã®ãŠä»•äº‹ã‚„å‰µä½œæ´»å‹•ãŒã€ã‚¹ãƒãƒ›ã®åŠ›ã§ã‚‚ã£ã¨æ¥½ã—ãã€ã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚Šã¾ã™ã‚ˆã†ã«ï¼
ã‚‚ã—ä½¿ã„æ–¹ãŒã‚ã‹ã‚‰ãªããªã£ãŸã‚‰ã€ã„ã¤ã§ã‚‚ã“ã®ã‚¬ã‚¤ãƒ‰ã«æˆ»ã£ã¦ãã¦ãã ã•ã„ã­ã€‚

--- END OF FILE: ./docs/USER_GUIDE_JA.md ---

--- FILE: ./docs/USER_GUIDE_EN.md ---
# VoiceMux Bridge User Guide ğŸ›°ï¸

Welcome to VoiceMux Bridge!
This extension allows you to use your smartphone's familiar keyboard to type seamlessly into any input field on your PC (ChatGPT, Gemini, Gmail, Slack, etc.).

No complex setup is required. Let's get started!

---

## 1. Preparation: Sync with the Hub

First, enable the extension.

1.  Open [VoiceMux Hub](https://hub.knc.jp) on your PC.
2.  As soon as the site opens, your secure credentials will be automatically synced to this extension.
3.  Click the **VoiceMux icon (microphone stand mark)** in the top right of your browser.
4.  If you see "Ready to Pair!" and a QR code, you're all set!

> ğŸ’¡ **Tip**: "Pin" the icon to your toolbar for instant access to the QR code.

---

## 2. Connect: Pair with Your Smartphone

1.  Scan the displayed **QR code** with your smartphone's camera.
2.  Once the dedicated input page opens on your phone, pairing is complete.

Your smartphone and PC are now connected via a private channel protected by strong End-to-End Encryption (E2EE).

---

## 3. Usage: Talk to Your Phone

The best part of VoiceMux is using **"Gboard" or "iPhone Voice Dictation"** directly on your PC.

1.  On your PC, click into any text input field (ChatGPT, Gmail, etc.) where you want to type.
2.  Tap the input area on your phone to bring up the keyboard.
3.  Press the **"Microphone button"** on your keyboard and speak to your phone.
4.  When you stop speaking... your words will appear directly at your PC's cursor position!

---

## 4. Advance: Grow Your Dictionary

VoiceMux Hub helps you fix common misrecognitions of technical terms or names.

*   **Error Correction**: Fixing text in the Hub editor teaches the AI to be smarter next time.
*   **Prompt Generation**: Click **"ğŸª„ Fix Errors & Generate Prompts"** at the bottom of the extension to open the Hub and optimize your input for AI assistants.

---

## 5. Privacy & Security

VoiceMux prioritizes your privacy.
*   **Private Data**: Your text is encrypted directly between your phone and PC. Not even our servers can read it.
*   **Offline Cache**: Once synced, you don't need to open the Hub site anymore. Just click the extension icon to start pairing instantly using cached credentials.

---

## 6. Troubleshooting

*   **No QR Code**: Try refreshing [VoiceMux Hub](https://hub.knc.jp) and then click the extension icon again.
*   **Text Not Appearing**: Make sure you've clicked inside a text field on your PC and that the cursor is active.

---

We hope VoiceMux makes your daily work and creative sessions smoother and more enjoyable!
Feel free to return to this guide whenever you need help.

--- END OF FILE: ./docs/USER_GUIDE_EN.md ---

--- FILE: ./docs/community-adapters.md ---
# VoiceMux Community Adapters Catalog ğŸ“‚

Copy the JSON snippets below and paste them into the **Custom Site Adapters** field in your VoiceMux Extension Options.

---

### ğŸ“§ Outlook (Web)
Supports both personal (outlook.com) and business (Office 365).
```json
{
  "id": "outlook",
  "name": "Outlook",
  "host": "outlook",
  "inputSelector": "div[role='textbox'][aria-label*='ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸'], div[role='textbox'][aria-label*='Message']",
  "submitSelector": null
}
```

### ğŸ“§ Yahoo! Mail (Japan)
```json
{
  "id": "yahoo-mail-jp",
  "name": "Yahoo! Mail JP",
  "host": "mail.yahoo.co.jp",
  "inputSelector": "div[role='textbox']",
  "submitSelector": null
}
```

### ğŸ’¬ Slack (Web)
```json
{
  "id": "slack",
  "name": "Slack",
  "host": "slack.com",
  "inputSelector": ".ql-editor",
  "submitSelector": "button[data-testid='composer_send_button']"
}
```

### ğŸ“ Notion
```json
{
  "id": "notion",
  "name": "Notion",
  "host": "notion.so",
  "inputSelector": "div[contenteditable='true']",
  "submitSelector": null
}
```

---

### ğŸ’¡ How to contribute
If you've created a working adapter for a new site, please open a Pull Request or Issue to add it to this list!

--- END OF FILE: ./docs/community-adapters.md ---

--- FILE: ./docs/CHANGELOG.md ---
# Changelog

All notable changes to **VoiceMux Bridge** will be documented in this file.

## [2.1.0] - 2026-02-21
### Added
- **Multi-language Support (i18n)**: Full support for English and Japanese locales.
- **KNC ID Stateless Auth**: Implemented automatic session synchronization with `hub.knc.jp`. Pairing is now handled seamlessly without manual configuration.
- **Centralized Decryption**: Moved E2EE decryption logic to the Background Service Worker for enhanced security. Content scripts now handle only plaintext data.
- **Integrated Pairing**: Updated the extension popup and QR code to point to the modern Zen UI on `hub.knc.jp`.

## [1.6.1] - 2026-02-17
### Added
- **Transparency Reports**: Added detailed documentation on "Why we need All Site Access" and "E2EE Implementation Proof."
- **Developer Profile**: Linked to official Google Play Store profile to establish trust.
- **Sustainability Policy**: Added a section explaining why the service is free and how it stays resilient.

### Changed
- **Cross-Platform Compatibility**: Improved Base64 handling for 100% key compatibility with Go and Mobile clients.
- **Stability**: Added periodic heartbeat alarms to maintain WebSocket connections in Manifest V3.
- **Protocol**: Standardized on Phoenix Protocol vsn=2.0.0 (Array format).

## [1.6.0] - 2026-02-15
### Added
- **New Onboarding UI**: Redesigned popup with a step-by-step guide for new users.
- **Web Monitor Link**: Quick access to v.knc.jp from the extension popup.

### Changed
- **Injection Engine**: Refactored text injection logic using `InputEvent` for high compatibility with Gmail, Gemini, and ChatGPT.
- **Security**: Hardened origin checks and removed unnecessary permissions.

## [1.5.0] - 2026-02-14
### Added
- **Multi-Domain Support**: Added support for both `v.knc.jp` (Zen mode) and `t.knc.jp` (Translate mode).
- **Domain Migration**: Migrated primary infrastructure to `knc.jp`.

--- END OF FILE: ./docs/CHANGELOG.md ---

--- FILE: ./docs/CHANGELOG_JA.md ---
# æ›´æ–°å±¥æ­´ (Changelog)

VoiceMux Bridge ã®ä¸»è¦ãªå¤‰æ›´å±¥æ­´ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚

## [2.1.0] - 2026-02-21
### è¿½åŠ 
- **å¤šè¨€èªå¯¾å¿œ (i18n)**: æ—¥æœ¬èªã¨è‹±èªã®è¡¨ç¤ºã«å®Œå…¨å¯¾å¿œã€‚
- **KNC ID ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹èªè¨¼**: `hub.knc.jp` ã¨ã®è‡ªå‹•ã‚»ãƒƒã‚·ãƒ§ãƒ³åŒæœŸã‚’å®Ÿè£…ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹æ‰‹å‹•è¨­å®šãªã—ã§ãƒšã‚¢ãƒªãƒ³ã‚°ãŒå¯èƒ½ã«ã€‚
- **ä¸­å¤®é›†æ¨©çš„å¾©å·ãƒ­ã‚¸ãƒƒã‚¯**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Šã®ãŸã‚ã€E2EE å¾©å·å‡¦ç†ã‚’ Background Script ã«é›†ç´„ã€‚Content Script ã¯å¹³æ–‡ã®ã¿ã‚’æ‰±ã†ã‚ˆã†ç°¡ç´ åŒ–ã€‚
- **Hub é€£æºãƒšã‚¢ãƒªãƒ³ã‚°**: ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã® QR ã‚³ãƒ¼ãƒ‰ãŠã‚ˆã³ãƒªãƒ³ã‚¯å…ˆã‚’ `hub.knc.jp` ã®çµ±åˆ Zen UI ã¸å¤‰æ›´ã€‚

## [1.6.1] - 2026-02-17
### è¿½åŠ 
- **é€æ˜æ€§ãƒ¬ãƒãƒ¼ãƒˆ**: ã€Œãªãœå…¨ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒå¿…è¦ã‹ã€ãŠã‚ˆã³ã€ŒE2EEå®Ÿè£…ã®æŠ€è¡“çš„è¨¼æ˜ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã€‚
- **é–‹ç™ºè€…ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«**: ä¿¡é ¼æ€§å‘ä¸Šã®ãŸã‚ã€Google Play ã‚¹ãƒˆã‚¢ã®ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¸ã®ãƒªãƒ³ã‚¯ã‚’è¿½åŠ ã€‚
- **æŒç¶šå¯èƒ½æ€§ã¨å“²å­¦**: ç„¡æ–™æä¾›ã®ç†ç”±ã¨ã€AIé–‹ç™ºã«ã‚ˆã‚‹ç¶™ç¶šæ€§ã«ã¤ã„ã¦ã®èª¬æ˜ã‚’è¿½åŠ ã€‚

### å¤‰æ›´
- **ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ äº’æ›æ€§**: Goã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚„ãƒ¢ãƒã‚¤ãƒ«ã¨ã®éµäº’æ›æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã€Base64å‡¦ç†ã‚’æ”¹å–„ã€‚
- **å®‰å®šæ€§å‘ä¸Š**: Manifest V3 ç’°å¢ƒä¸‹ã§ã® WebSocket æ¥ç¶šã‚’ç¶­æŒã™ã‚‹ãŸã‚ã€å®šæœŸçš„ãªãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆå‡¦ç†ã‚’è¿½åŠ ã€‚
- **ãƒ—ãƒ­ãƒˆã‚³ãƒ«çµ±ä¸€**: é€šä¿¡å½¢å¼ã‚’ Phoenix Protocol vsn=2.0.0 (Array å½¢å¼) ã«çµ±ä¸€ã€‚

## [1.6.0] - 2026-02-15
### è¿½åŠ 
- **ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°UI**: åˆã‚ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã«ã€ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã®ã‚¬ã‚¤ãƒ‰ä»˜ããƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã¸åˆ·æ–°ã€‚
- **Webãƒ¢ãƒ‹ã‚¿ãƒ¼ã¸ã®ãƒªãƒ³ã‚¯**: æ‹¡å¼µæ©Ÿèƒ½å†…ã‹ã‚‰ v.knc.jp ã¸ç´ æ—©ãã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒªãƒ³ã‚¯ã‚’è¿½åŠ ã€‚

### å¤‰æ›´
- **å…¥åŠ›ã‚¨ãƒ³ã‚¸ãƒ³ã®åˆ·æ–°**: `InputEvent` ã‚’æ´»ç”¨ã—ãŸæ–°ã—ã„æ³¨å…¥ãƒ­ã‚¸ãƒƒã‚¯ã«ã‚ˆã‚Šã€Gmail, Gemini, ChatGPT ç­‰ã®è¤‡é›‘ãªã‚¨ãƒ‡ã‚£ã‚¿ã¸ã®å¯¾å¿œã‚’å¼·åŒ–ã€‚
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–**: Originæ¤œè¨¼ã®å³æ ¼åŒ–ã¨ã€ä¸è¦ãªãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã®å‰Šé™¤ã€‚

## [1.5.0] - 2026-02-14
### è¿½åŠ 
- **ãƒãƒ«ãƒãƒ‰ãƒ¡ã‚¤ãƒ³å¯¾å¿œ**: `v.knc.jp` (Zen) ã¨ `t.knc.jp` (ç¿»è¨³) ã®ä¸¡æ–¹ã«å¯¾å¿œã€‚
- **ãƒ‰ãƒ¡ã‚¤ãƒ³ç§»è¡Œ**: ä¸»è¦ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ `knc.jp` ãƒ‰ãƒ¡ã‚¤ãƒ³ã¸çµ±åˆã€‚

--- END OF FILE: ./docs/CHANGELOG_JA.md ---

--- FILE: ./docs/MAINTENANCE.md ---
# Maintenance & Development Guide / ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ‰‹é †æ›¸

This document ensures that code changes and documentation remain synchronized. Developers (both humans and AI agents) MUST follow this checklist for every update.

ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ•´åˆæ€§ã‚’ä¿ã¤ãŸã‚ã®æ‰‹é †æ›¸ã§ã™ã€‚é–‹ç™ºè€…ï¼ˆäººé–“ãŠã‚ˆã³AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼‰ã¯ã€æ›´æ–°æ™‚ã«å¿…ãšã“ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

---

## ğŸ“‹ Pre-Release Checklist / æ›´æ–°æ™‚ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### 1. Version Management / ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
- [ ] **`manifest.json`**: Bump the version number (e.g., `1.6.1` -> `1.6.2`).
- [ ] **`CHANGELOG.md` & `CHANGELOG_JA.md`**: Add new entry with version, date, and changes.

### 2. E2EE Integrity / æš—å·åŒ–ã®æ•´åˆæ€§
- [ ] **`docs/E2EE_IMPLEMENTATION_*.md`**: If logic in `background.js` or `content.js` changed, verify that the **line numbers** quoted in the reports are still correct.
- [ ] Ensure that no sensitive keys are inadvertently logged or transmitted.

### 3. Website Synchronization / å…¬å¼ã‚µã‚¤ãƒˆåŒæœŸ
- [ ] **`knc-hub/src/lib/data.ts`**: Update the `whatsNew` section if significant features were added.
- [ ] Redeploy `knc-hub` to reflect changes on `knc.jp`.

### 4. Readme & Guides / ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
- [ ] **`README.md`**: Update "Features" or "Install" sections if the UI or workflow changed.
- [ ] **`docs/USER_GUIDE_*.md`**: Ensure screenshots (if any) or instructions match the current UI.

---

## ğŸ¤– Special Instructions for AI Agents / AIã¸ã®æŒ‡ç¤º

When an AI agent (like Gemini) works on this repository, it MUST:
1. **Read this file** before starting any task.
2. Treat code and documentation updates as an **atomic task**. Never commit code without corresponding doc updates.
3. Verify that all external links in the documents are still valid after any file reorganization.

AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆGeminiç­‰ï¼‰ãŒæœ¬ãƒªãƒã‚¸ãƒˆãƒªã§ä½œæ¥­ã™ã‚‹éš›ã®å¿…é ˆãƒ«ãƒ¼ãƒ«ï¼š
1. ã‚¿ã‚¹ã‚¯é–‹å§‹å‰ã«å¿…ãš**æœ¬æ›¸ã‚’èª­ã¿è¾¼ã‚€**ã“ã¨ã€‚
2. ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°ã‚’**ã‚¢ãƒˆãƒŸãƒƒã‚¯ï¼ˆä¸å¯åˆ†ï¼‰ãªã‚¿ã‚¹ã‚¯**ã¨ã—ã¦æ‰±ã†ã“ã¨ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã›ãšã«ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ã¯ãªã‚‰ãªã„ã€‚
3. ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã‚’å¤‰æ›´ã—ãŸå ´åˆã¯ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã®å¤–éƒ¨ãƒªãƒ³ã‚¯ãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹ã“ã¨ã€‚

--- END OF FILE: ./docs/MAINTENANCE.md ---

--- FILE: ./PRIVACY.md ---
# Privacy Policy for VoiceMux Bridge

Last updated: 2026-02-21

## 1. Data Collection
VoiceMux Bridge does **not** collect, store, or transmit any personal data, keystrokes, or browsing history to our servers.

## 2. End-to-End Encryption (E2EE)
All data transmitted from your mobile device to this extension is encrypted using Client-Side AES-GCM (128-bit).
- **Decryption Keys**: These keys are generated within VoiceMux Hub and securely pushed to the extension via the browser's internal messaging API. They are stored in `chrome.storage.local`.
- **Zero-Knowledge**: Keys are shared with your mobile device via URL hash fragments (`#key=...`). These fragments are handled exclusively by the browser and are never sent to any server by design.

## 3. Permissions
The extension requires the following permissions to function:
- **activeTab**: Used only to inject text into the input field of the website you are currently using, and only upon your explicit request via the paired mobile device.
- **storage**: Used to save your local configuration, including your unique Room ID, encryption key, and any Custom Site Adapters you define.

## 4. Third-Party Services
VoiceMux Bridge acts as a bridge between your mobile device and the AI services you choose to use (e.g., Gemini, ChatGPT). We do not control and are not responsible for the privacy practices of those third-party services.

## 5. Contact
If you have any questions about this Privacy Policy, please open an issue on our [GitHub repository](https://github.com/Kaneta/voicemux-bridge).

--- END OF FILE: ./PRIVACY.md ---

--- FILE: ./background.js ---
// VoiceMux Bridge: Background Service Worker (Clean Push-Sync Mode)
// Configuration
const IS_DEV = false; // Set to true for local backend testing
const BASE_WS_URL = IS_DEV ? "ws://localhost:4000/socket/websocket" : "wss://v.knc.jp/socket/websocket";
const HUB_URL = IS_DEV ? "http://localhost:5173" : "https://hub.knc.jp";

/**
 * decodes Base64 strings safely, supporting both Standard and URL-safe formats.
 */
function safeAtob(base64) {
  if (!base64) return "";
  let standardBase64 = base64.replace(/\s/g, '').replace(/-/g, '+').replace(/_/g, '/');
  while (standardBase64.length % 4 !== 0) {
    standardBase64 += '=';
  }
  try {
    return atob(standardBase64);
  } catch (e) {
    console.error("[Base64] atob failed:", e);
    return "";
  }
}

let socket = null;
let heartbeatInterval = null;
let retryTimer = null;
let retryDelay = 1000;
const MAX_RETRY_DELAY = 60000;

// â˜… Crypto Helpers
async function getDecryptionKey() {
  const data = await chrome.storage.local.get('voicemux_key');
  if (!data.voicemux_key) return null;
  const rawKey = Uint8Array.from(safeAtob(data.voicemux_key), c => c.charCodeAt(0));
  return await crypto.subtle.importKey("raw", rawKey, "AES-GCM", true, ["decrypt"]);
}

async function decrypt(payload) {
  if (!payload.ciphertext || !payload.iv) return payload.text || "";
  try {
    const key = await getDecryptionKey();
    if (!key) {
      console.warn("[E2EE] Decryption skipped: No key available.");
      return payload.text || "";
    }
    const iv = Uint8Array.from(safeAtob(payload.iv), c => c.charCodeAt(0));
    const ciphertext = Uint8Array.from(safeAtob(payload.ciphertext), c => c.charCodeAt(0));
    const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ciphertext);
    return new TextDecoder().decode(decrypted);
  } catch (e) {
    console.error("[E2EE] Decryption failed.", e);
    return "[Decryption Error]";
  }
}

/** Initializes WebSocket connection to the relay server using KNC ID token. */
async function connect() {
  if (socket && (socket.readyState === WebSocket.CONNECTING || socket.readyState === WebSocket.OPEN)) {
    return;
  }

  // DESIGN INTENT: Passive connection.
  // Wait for credentials to be pushed from Hub via SYNC_AUTH message.
  const data = await chrome.storage.local.get(['voicemux_token', 'voicemux_room_id']);
  
  if (!data.voicemux_token || !data.voicemux_room_id) {
    console.log("VoiceMux: Waiting for credentials from Hub...");
    return;
  }

  const roomId = data.voicemux_room_id;
  const token = data.voicemux_token;

  try {
    const currentTopic = `room:${roomId}`; 
    console.log(`VoiceMux: Connecting... | Room: ${roomId}`);
    
    const wsUrl = `${BASE_WS_URL}?vsn=2.0.0&token=${token}`;
    socket = new WebSocket(wsUrl);

    socket.onopen = () => {
      console.log("VoiceMux: Connected (Authenticated)");
      retryDelay = 1000;
      socket.send(JSON.stringify(["1", "1", currentTopic, "phx_join", {}]));
      
      if (heartbeatInterval) clearInterval(heartbeatInterval);
      heartbeatInterval = setInterval(() => {
        if (socket.readyState === WebSocket.OPEN) {
          socket.send(JSON.stringify([null, "heartbeat", "phoenix", "heartbeat", {}]));
        }
      }, 30000);
    };

    socket.onmessage = async (event) => {
      const data = JSON.parse(event.data);
      const msgTopic = data[2];
      const eventName = data[3];
      const payload = data[4];

      if (msgTopic === currentTopic) {
        if (eventName === "update_text" || eventName === "confirm_send") {
          const plaintext = await decrypt(payload);
          chrome.tabs.query({active: true, lastFocusedWindow: true}, (tabs) => {
            if (tabs[0]) {
               chrome.tabs.sendMessage(tabs[0].id, {
                action: eventName,
                plaintext: plaintext 
              }).catch(() => {});
            }
          });
        }
      }
    };

    socket.onclose = () => {
      cleanup();
      scheduleReconnect();
    };

    socket.onerror = (err) => {
      socket.close();
    };
  } catch (error) {
    console.error("VoiceMux: Connection failed:", error);
    scheduleReconnect();
  }
}

function scheduleReconnect() {
  if (retryTimer) clearTimeout(retryTimer);
  retryTimer = setTimeout(connect, retryDelay);
  retryDelay = Math.min(retryDelay * 2, MAX_RETRY_DELAY);
}

function cleanup() {
  if (heartbeatInterval) clearInterval(heartbeatInterval);
  heartbeatInterval = null;
}

function safeCheckConnection() {
  if (!socket || socket.readyState !== WebSocket.OPEN) {
    connect();
  }
}

chrome.alarms.onAlarm.addListener((alarm) => {
  if (alarm.name === "keepAlive") {
    safeCheckConnection();
  }
});
chrome.alarms.create("keepAlive", { periodInMinutes: 1 });

// â˜… External Message Listener (Clean Sync architecture)
// DESIGN INTENT: Receive credentials directly from Hub's JS environment.
chrome.runtime.onMessageExternal.addListener((request, sender, sendResponse) => {
  if (request.action === "SYNC_AUTH") {
    const { uuid, token, key } = request.payload;
    
    console.log("[Auth] Sync received from Hub.");
    chrome.storage.local.set({
      'voicemux_room_id': uuid,
      'voicemux_token': token,
      'voicemux_key': key,
      'voicemux_hub_url': sender.url // Automatically trust the hub URL
    }, () => {
      if (socket) socket.close();
      connect();
      if (sendResponse) sendResponse({ success: true });
    });
    return true; // Keep channel open for async response
  }
});

// Internal check connection (e.g. from popup)
chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  if (request.action === "check_connection") {
    safeCheckConnection();
  }
});

// Start initial connection attempt
connect();

--- END OF FILE: ./background.js ---

--- FILE: ./collect_context.sh ---
#!/bin/bash
echo "Generating full_context.txt for VoiceMux Bridge..."
# Find relevant files and concatenate them with headers
# Exclude node_modules, .git, and common binary extensions
find . -maxdepth 2 -not -path '*/.*' -not -path './node_modules*' -not -name "*.png" -not -name "*.zip" -not -name "*.svg" -not -name "full_context.txt" -not -name "STORE_DESCRIPTION_*.txt" -not -name "DRAFT_*" -not -name "MEMO_*" -type f | while read file; do
    echo "--- FILE: $file ---" >> full_context.txt
    cat "$file" >> full_context.txt
    echo -e "
--- END OF FILE: $file ---
" >> full_context.txt
done
echo "Done! Context collected in full_context.txt"

--- END OF FILE: ./collect_context.sh ---

--- FILE: ./options.html ---
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VoiceMux Settings</title>
  <style>
    :root {
      /* M3 Light Palette (Violet baseline) */
      --md-sys-color-primary: #6750A4;
      --md-sys-color-on-primary: #FFFFFF;
      --md-sys-color-primary-container: #EADDFF;
      --md-sys-color-on-primary-container: #21005D;
      --md-sys-color-secondary: #625B71;
      --md-sys-color-on-secondary: #FFFFFF;
      --md-sys-color-surface: #FEF7FF;
      --md-sys-color-on-surface: #1D1B20;
      --md-sys-color-surface-variant: #E7E0EB;
      --md-sys-color-on-surface-variant: #49454F;
      --md-sys-color-outline: #79747E;
      --md-sys-color-success: #10b981;

      /* Elevation */
      --md-sys-elevation-1: 0px 1px 3px 1px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
      --md-sys-elevation-3: 0px 1px 3px 0px rgba(0, 0, 0, 0.3), 0px 4px 8px 3px rgba(0, 0, 0, 0.15);
    }

    body {
      font-family: 'Roboto', system-ui, -apple-system, sans-serif;
      background-color: var(--md-sys-color-surface);
      color: var(--md-sys-color-on-surface);
      max-width: 680px;
      margin: 40px auto;
      padding: 24px;
      -webkit-font-smoothing: antialiased;
    }

    .card {
      background: var(--md-sys-color-surface);
      padding: 32px;
      border-radius: 28px;
      border: 1px solid var(--md-sys-color-surface-variant);
      box-shadow: var(--md-sys-elevation-1);
    }

    h1 { 
      font-size: 28px; 
      font-weight: 400; 
      margin: 0 0 12px 0; 
      color: var(--md-sys-color-on-surface);
    }

    p { 
      color: var(--md-sys-color-on-surface-variant); 
      font-size: 14px; 
      line-height: 1.6;
      margin-bottom: 32px; 
    }

    p a {
      color: var(--md-sys-color-primary);
      text-decoration: none;
      font-weight: 500;
    }

    textarea {
      width: 100%;
      height: 360px;
      font-family: 'Roboto Mono', ui-monospace, monospace;
      font-size: 13px;
      padding: 20px;
      border: 1px solid var(--md-sys-color-outline);
      border-radius: 12px;
      background-color: var(--md-sys-color-surface-variant);
      color: var(--md-sys-color-on-surface-variant);
      resize: vertical;
      box-sizing: border-box;
      outline: none;
      transition: border-color 0.2s;
    }

    textarea:focus {
      border-color: var(--md-sys-color-primary);
      border-width: 2px;
    }

    .btn-save {
      background-color: var(--md-sys-color-primary);
      color: var(--md-sys-color-on-primary);
      border: none;
      padding: 12px 24px;
      height: 40px;
      border-radius: 20px;
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      margin-top: 24px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: var(--md-sys-elevation-1);
    }

    .btn-save:hover { 
      box-shadow: var(--md-sys-elevation-2);
      opacity: 0.9;
    }

    .btn-save:active {
      transform: scale(0.98);
    }

    .status {
      margin-top: 16px;
      font-size: 14px;
      font-weight: 500;
      color: var(--md-sys-color-success);
      display: none;
      animation: fadeIn 0.3s ease;
    }

    code { 
      background: var(--md-sys-color-primary-container); 
      color: var(--md-sys-color-on-primary-container);
      padding: 2px 6px; 
      border-radius: 4px; 
      font-size: 12px;
    }

    .example-box {
      margin-top: 40px; 
      font-size: 12px; 
      color: var(--md-sys-color-on-surface-variant);
      background: var(--md-sys-color-surface-variant);
      padding: 16px;
      border-radius: 12px;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body data-i18n-title="options_title">
  <div class="card">
    <h1 data-i18n="options_header">Custom Site Adapters</h1>
    <p data-i18n="options_description">Define custom CSS selectors for your favorite sites. You can find pre-made configurations in our <a href="https://github.com/Kaneta/voicemux-bridge/blob/main/docs/community-adapters.md" target="_blank">Community Adapters Catalog</a>.</p>
    
    <textarea id="custom-adapters" spellcheck="false" placeholder='[
  {
    "name": "Custom App",
    "host": "example.com",
    "inputSelector": ".my-input",
    "submitSelector": ".my-send-button"
  }
]'></textarea>

    <button id="save" class="btn-save" data-i18n="btn_save_config">Save Configuration</button>
    <div id="status" class="status" data-i18n="status_saved">Settings saved successfully</div>

    <div class="example-box">
      <strong data-i18n="example_structure">Example Structure:</strong><br>
      <code>[{"name": "Slack", "host": "slack.com", "inputSelector": ".ql-editor", "submitSelector": "button.c-button-unstyled"}]</code>
    </div>
  </div>
  <script src="options.js"></script>
</body>
</html>

--- END OF FILE: ./options.html ---

--- FILE: ./options.js ---
// VoiceMux Options JS
const textarea = document.getElementById('custom-adapters');
const saveBtn = document.getElementById('save');
const status = document.getElementById('status');

// Load saved settings
document.addEventListener('DOMContentLoaded', async () => {
  localize();
  const data = await chrome.storage.local.get('custom_adapters');
  if (data.custom_adapters) {
    textarea.value = JSON.stringify(data.custom_adapters, null, 2);
  }
});

// Save settings
saveBtn.addEventListener('click', async () => {
  const rawValue = textarea.value.trim();
  let parsedValue = [];

  if (rawValue) {
    try {
      parsedValue = JSON.parse(rawValue);
      if (!Array.isArray(parsedValue)) throw new Error("Must be an array");
    } catch (e) {
      alert(chrome.i18n.getMessage("invalid_json_format", [e.message]));
      return;
    }
  }

  await chrome.storage.local.set({ 'custom_adapters': parsedValue });
  
  // Show status
  status.style.display = 'block';
  setTimeout(() => {
    status.style.display = 'none';
  }, 2000);
});

function localize() {
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    const message = chrome.i18n.getMessage(key);
    if (message) {
      if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
        element.placeholder = message;
      } else {
        element.innerHTML = message;
      }
    }
  });

  document.querySelectorAll('[data-i18n-title]').forEach(element => {
    const key = element.getAttribute('data-i18n-title');
    const message = chrome.i18n.getMessage(key);
    if (message) {
      document.title = message;
    }
  });
}

--- END OF FILE: ./options.js ---

--- FILE: ./popup.html ---
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    :root {
      /* M3 Light Palette (Violet baseline) */
      --md-sys-color-primary: #6750A4;
      --md-sys-color-on-primary: #FFFFFF;
      --md-sys-color-primary-container: #EADDFF;
      --md-sys-color-on-primary-container: #21005D;
      --md-sys-color-secondary-container: #E8DEF8;
      --md-sys-color-on-secondary-container: #1D192B;
      --md-sys-color-surface: #FEF7FF;
      --md-sys-color-on-surface: #1D1B20;
      --md-sys-color-surface-variant: #E7E0EB;
      --md-sys-color-on-surface-variant: #49454F;
      --md-sys-color-outline: #79747E;
      --md-sys-color-success: #10b981;
      --md-sys-color-warning: #f59e0b;

      /* Elevation */
      --md-sys-elevation-1: 0px 1px 3px 1px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
      --md-sys-elevation-2: 0px 2px 6px 2px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
    }

    body {
      width: 320px;
      font-family: 'Roboto', system-ui, -apple-system, sans-serif;
      margin: 0;
      padding: 20px 24px;
      background-color: var(--md-sys-color-surface);
      color: var(--md-sys-color-on-surface);
      -webkit-font-smoothing: antialiased;
      overflow: hidden;
    }

    .header {
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    h1 {
      font-size: 18px;
      font-weight: 700;
      margin: 0;
      color: var(--md-sys-color-primary);
      letter-spacing: -0.02em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .app-version {
      font-size: 10px;
      font-weight: 400;
      opacity: 0.6;
      background: var(--md-sys-color-surface-variant);
      padding: 2px 6px;
      border-radius: 4px;
    }

    .maintenance-notice {
      background: var(--md-sys-color-warning);
      color: white;
      padding: 4px 8px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 700;
      margin-bottom: 12px;
      width: 100%;
    }

    .maintenance-notice a {
      color: white;
      text-decoration: underline;
    }

    .status-indicator-group {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: var(--md-sys-color-warning);
      box-shadow: 0 0 0 2px var(--md-sys-color-surface);
    }

    .status-dot.online {
      background-color: var(--md-sys-color-success);
      box-shadow: 0 0 8px var(--md-sys-color-success);
    }

    /* Views */
    #unlinked-view, #linked-view {
      display: none;
      flex-direction: column;
      align-items: center;
      text-align: center;
      animation: fadeIn 0.3s ease-out;
    }

    /* Common Button Style (MD3 Tonal Capsule) */
    .btn-tonal {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 24px;
      background-color: var(--md-sys-color-secondary-container);
      color: var(--md-sys-color-on-secondary-container);
      border: none;
      border-radius: 9999px;
      font-size: 14px;
      font-weight: 700;
      text-decoration: none;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }

    .btn-tonal:hover {
      filter: brightness(0.95);
      box-shadow: var(--md-sys-elevation-1);
    }

    .btn-tonal:active {
      transform: scale(0.98);
    }

    /* Footer Links */
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-top: 16px;
      margin-bottom: 4px;
    }

    .f-link {
      font-size: 11px;
      color: var(--md-sys-color-primary);
      text-decoration: none;
      opacity: 0.7;
      font-weight: 600;
    }
    .f-link:hover { opacity: 1; text-decoration: underline; }

    /* Unlinked View Specific */
    .sync-wait-container {
      position: relative;
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
    }

    .pulse {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background-color: var(--md-sys-color-primary);
      opacity: 0.2;
      animation: pulse 2s infinite cubic-bezier(0.4, 0, 0.6, 1);
    }

    .waiting-text-main {
      font-size: 1.1rem;
      font-weight: 800;
      margin: 0 0 12px 0;
      color: var(--md-sys-color-on-surface);
      line-height: 1.3;
    }

    .waiting-text-sub {
      font-size: 13px;
      color: var(--md-sys-color-on-surface-variant);
      margin-bottom: 24px;
      line-height: 1.5;
      padding: 0 8px;
    }

    /* Linked View Specific */
    .ready-msg {
      font-size: 1.15rem;
      font-weight: 900;
      color: var(--md-sys-color-primary);
      margin: 0 0 8px 0;
      line-height: 1.2;
    }

    .sync-instruction {
      font-size: 13px;
      color: var(--md-sys-color-on-surface-variant);
      margin-bottom: 24px;
      line-height: 1.4;
      padding: 0 12px;
      white-space: nowrap;
    }

    #qrcode-link {
      display: block;
      margin-bottom: 12px;
      text-decoration: none;
      transition: transform 0.2s;
    }

    #qrcode-link:hover { transform: scale(1.02); }

    #qrcode {
      background: white;
      padding: 12px;
      border-radius: 20px;
      box-shadow: var(--md-sys-elevation-2);
      border: 1px solid var(--md-sys-color-surface-variant);
      /* High contrast for scannability */
      image-rendering: pixelated;
    }

    #qrcode img, #qrcode svg {
      display: block;
      width: 100%;
      height: auto;
    }

    .room-info {
      font-family: var(--font-mono, monospace);
      font-size: 18px;
      font-weight: 800;
      color: var(--md-sys-color-primary);
      background: var(--md-sys-color-secondary-container);
      padding: 4px 12px;
      border-radius: 8px;
      margin-bottom: 12px;
      letter-spacing: 2px;
    }

    /* Subtle Copy Button */
    .btn-copy-link {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 8px 24px;
      background: transparent;
      color: var(--md-sys-color-primary);
      border: 1px solid var(--md-sys-color-outline);
      border-radius: 100px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 24px;
      transition: all 0.2s;
    }

    .btn-copy-link:hover { background-color: rgba(103, 80, 164, 0.05); }
    .btn-copy-link.success { border-color: var(--md-sys-color-success); color: var(--md-sys-color-success); }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 0.4; }
      100% { transform: scale(1.6); opacity: 0; }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>
      <span data-i18n="name">VoiceMux Bridge</span>
      <span id="version-display" class="app-version">v...</span>
    </h1>
    <div class="status-indicator-group">
      <div id="status-indicator" class="status-dot"></div>
    </div>
  </div>

  <!-- View 1: Unlinked -->
  <div id="unlinked-view">
    <div class="sync-wait-container">
      <div class="pulse"></div>
      <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--md-sys-color-primary); z-index: 1;">
        <path d="M21 2v6h-6"></path><path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path><path d="M3 22v-6h6"></path><path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
      </svg>
    </div>
    <h2 class="waiting-text-main" data-i18n="waiting_hub_main">First, let's link with the Hub</h2>
    <p class="waiting-text-sub" data-i18n="waiting_hub_sub">Once you open the VoiceMux Hub site, the pairing QR code will appear here automatically.</p>
    <button id="btn-open-hub" class="btn-tonal" data-i18n="btn_open_hub">ğŸš€ Open Hub to Link</button>
  </div>

  <!-- View 2: Linked (Ready) -->
  <div id="linked-view">
    <div id="maintenance-notice" class="maintenance-notice" style="display: none;">
      <a id="maintenance-link" href="#" target="_blank">ğŸš§ Maintenance (Details)</a>
    </div>

    <h2 class="ready-msg" data-i18n="ready_to_sync">Ready to Pair!</h2>
    <p class="sync-instruction" data-i18n="sync_instruction">Scan with your phone to start input.</p>

    <a id="qrcode-link" href="#" target="_blank">
      <div id="qrcode"></div>
    </a>
    <div id="room-id" class="room-info" data-i18n="room_loading">Room: Loading...</div>

    <button id="copy-btn" class="btn-copy-link">
      <span id="copy-text" data-i18n="btn_copy_link">Copy Link</span>
    </button>

    <a href="https://hub.knc.jp" id="hub-link" target="_blank" class="btn-tonal" data-i18n="btn_manage_librarian">
      ğŸª„ Fix Errors & Generate Prompts
    </a>
  </div>

  <div class="footer-links">
    <a href="https://github.com/Kaneta/voicemux-bridge/issues" target="_blank" class="f-link" data-i18n="link_support">Support</a>
    <a href="https://knc.jp/ja/docs/voicemux-bridge/" id="guide-link" target="_blank" class="f-link" data-i18n="link_guide">Guide</a>
    <a href="https://github.com/Kaneta/voicemux-bridge/blob/main/PRIVACY.md" target="_blank" class="f-link" data-i18n="link_privacy">Privacy</a>
  </div>

  <script src="qrcode.min.js"></script>
  <script src="popup.js"></script>
</body>
</html>

--- END OF FILE: ./popup.html ---

--- FILE: ./popup.js ---
// VoiceMux Popup JS (v2.1.1 Finalized UI)
document.addEventListener('DOMContentLoaded', async () => {
  // Localization
  localize();

  // Version Display
  const versionDisplay = document.getElementById("version-display");
  if (versionDisplay) {
    versionDisplay.innerText = `v${chrome.runtime.getManifest().version}`;
  }

    const unlinkedView = document.getElementById("unlinked-view");
    const linkedView = document.getElementById("linked-view");
  
    // System Status Check (Non-blocking)
    try {
      const statusRes = await fetch("https://v.knc.jp/api/status");
      if (statusRes.ok) {
        const status = await statusRes.json();
        if (status.is_maintenance) {
          const notice = document.getElementById("maintenance-notice");
          const link = document.getElementById("maintenance-link");
          if (notice && link) {
            notice.style.display = "block";
            link.href = status.info_url;
          }
        }
      }
    } catch (e) {
      console.warn("VoiceMux: Failed to fetch system status.");
    }
  
    const qrcodeContainer = document.getElementById("qrcode");
  const qrcodeLink = document.getElementById("qrcode-link");
  const roomIdDisplay = document.getElementById("room-id");
  const btnOpenHub = document.getElementById("btn-open-hub");
  const statusIndicator = document.getElementById("status-indicator");
  const hubLink = document.getElementById("hub-link");

  // 1. Retrieve credentials from storage
  async function updateUI() {
    const data = await chrome.storage.local.get(['voicemux_room_id', 'voicemux_token', 'voicemux_key', 'voicemux_hub_url', 'voicemux_paired']);
    const roomId = data.voicemux_room_id;
    const token = data.voicemux_token;
    const keyBase64 = data.voicemux_key;
    const isPaired = data.voicemux_paired;
    
    let hubOrigin = 'https://hub.knc.jp';
    try {
      const rawHubUrl = data.voicemux_hub_url || 'https://hub.knc.jp';
      hubOrigin = new URL(rawHubUrl).origin;
    } catch (e) {}

    if (roomId && token && keyBase64) {
      // --- LINKED STATE (READY) ---
      linkedView.style.display = "flex";
      unlinkedView.style.display = "none";
      statusIndicator?.classList.add("online");

      // Check for active pairing success
      if (isPaired) {
        linkedView.innerHTML = `
          <div class="success-animation">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
          </div>
          <h2 class="ready-msg" style="color: #10b981;">Paired Successfully!</h2>
          <p class="sync-instruction">Your phone is now connected as a mic.</p>
          <button id="btn-close-popup" class="btn-tonal" style="width: 100%; margin-top: 12px; background-color: #10b981; color: white;">
            Done (Close)
          </button>
        `;
        const closeBtn = document.getElementById("btn-close-popup");
        if (closeBtn) closeBtn.onclick = () => window.close();
        return;
      }

      // Update Hub Link (Optional)
      if (hubLink) hubLink.href = `${hubOrigin}/welcome`;

      // Construct Pairing URL
      let pairingUrl = `${hubOrigin}/${roomId}`;
      pairingUrl += `?mode=zen&token=${token}`;
      pairingUrl += `#key=${keyBase64}`;
      
      const displayRoomId = roomId.substring(0, 4).toUpperCase();
      if (roomIdDisplay) roomIdDisplay.innerText = displayRoomId;
      if (qrcodeLink) qrcodeLink.href = pairingUrl;

      // Handle Copy Button
      const copyBtn = document.getElementById("copy-btn");
      const copyText = document.getElementById("copy-text");
      if (copyBtn) {
        copyBtn.onclick = async () => {
          try {
            await navigator.clipboard.writeText(pairingUrl);
            if (copyText) copyText.innerText = chrome.i18n.getMessage("btn_copy_success");
            copyBtn.classList.add("success");
            setTimeout(() => {
              if (copyText) copyText.innerText = chrome.i18n.getMessage("btn_copy_link");
              copyBtn.classList.remove("success");
            }, 2000);
          } catch (err) {}
        };
      }

      // Generate QR Code
      if (qrcodeContainer && qrcodeContainer.innerHTML === "") {
        new QRCode(qrcodeContainer, {
          text: pairingUrl,
          width: 160,
          height: 160,
          colorDark: "#000000",
          colorLight: "#ffffff",
          correctLevel: QRCode.CorrectLevel.M
        });
      }

    } else {
      // --- UNLINKED STATE ---
      unlinkedView.style.display = "flex";
      linkedView.style.display = "none";
      statusIndicator?.classList.remove("online");

      if (btnOpenHub) {
        btnOpenHub.onclick = () => {
          chrome.tabs.create({ url: hubOrigin });
        };
      }

      // Signal background to check connection
      chrome.runtime.sendMessage({ action: "check_connection" });
    }
  }

  // Initial update
  updateUI();
  
  // DESIGN INTENT: Reset pairing flag when opening to allow future re-pairs
  chrome.storage.local.set({ 'voicemux_paired': false });

  // Listen for storage changes
  chrome.storage.onChanged.addListener((changes, namespace) => {
    if (namespace === 'local' && (changes.voicemux_room_id || changes.voicemux_token || changes.voicemux_paired)) {
      updateUI();
    }
  });
});

function localize() {
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    const message = chrome.i18n.getMessage(key);
    if (message) {
      if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
        element.placeholder = message;
      } else {
        element.innerHTML = message;
      }
    }
  });

  // Localize specialized links
  const guideLink = document.getElementById('guide-link');
  if (guideLink) {
    guideLink.href = chrome.i18n.getMessage('url_guide');
  }
}

--- END OF FILE: ./popup.js ---

--- FILE: ./qrcode.min.js ---
var QRCode;!function(){function a(a){this.mode=c.MODE_8BIT_BYTE,this.data=a,this.parsedData=[];for(var b=[],d=0,e=this.data.length;e>d;d++){var f=this.data.charCodeAt(d);f>65536?(b[0]=240|(1835008&f)>>>18,b[1]=128|(258048&f)>>>12,b[2]=128|(4032&f)>>>6,b[3]=128|63&f):f>2048?(b[0]=224|(61440&f)>>>12,b[1]=128|(4032&f)>>>6,b[2]=128|63&f):f>128?(b[0]=192|(1984&f)>>>6,b[1]=128|63&f):b[0]=f,this.parsedData=this.parsedData.concat(b)}this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function b(a,b){this.typeNumber=a,this.errorCorrectLevel=b,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function i(a,b){if(void 0==a.length)throw new Error(a.length+"/"+b);for(var c=0;c<a.length&&0==a[c];)c++;this.num=new Array(a.length-c+b);for(var d=0;d<a.length-c;d++)this.num[d]=a[d+c]}function j(a,b){this.totalCount=a,this.dataCount=b}function k(){this.buffer=[],this.length=0}function m(){return"undefined"!=typeof CanvasRenderingContext2D}function n(){var a=!1,b=navigator.userAgent;return/android/i.test(b)&&(a=!0,aMat=b.toString().match(/android ([0-9]\.[0-9])/i),aMat&&aMat[1]&&(a=parseFloat(aMat[1]))),a}function r(a,b){for(var c=1,e=s(a),f=0,g=l.length;g>=f;f++){var h=0;switch(b){case d.L:h=l[f][0];break;case d.M:h=l[f][1];break;case d.Q:h=l[f][2];break;case d.H:h=l[f][3]}if(h>=e)break;c++}if(c>l.length)throw new Error("Too long data");return c}function s(a){var b=encodeURI(a).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return b.length+(b.length!=a?3:0)}a.prototype={getLength:function(){return this.parsedData.length},write:function(a){for(var b=0,c=this.parsedData.length;c>b;b++)a.put(this.parsedData[b],8)}},b.prototype={addData:function(b){var c=new a(b);this.dataList.push(c),this.dataCache=null},isDark:function(a,b){if(0>a||this.moduleCount<=a||0>b||this.moduleCount<=b)throw new Error(a+","+b);return this.modules[a][b]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(a,c){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var d=0;d<this.moduleCount;d++){this.modules[d]=new Array(this.moduleCount);for(var e=0;e<this.moduleCount;e++)this.modules[d][e]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(a,c),this.typeNumber>=7&&this.setupTypeNumber(a),null==this.dataCache&&(this.dataCache=b.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,c)},setupPositionProbePattern:function(a,b){for(var c=-1;7>=c;c++)if(!(-1>=a+c||this.moduleCount<=a+c))for(var d=-1;7>=d;d++)-1>=b+d||this.moduleCount<=b+d||(this.modules[a+c][b+d]=c>=0&&6>=c&&(0==d||6==d)||d>=0&&6>=d&&(0==c||6==c)||c>=2&&4>=c&&d>=2&&4>=d?!0:!1)},getBestMaskPattern:function(){for(var a=0,b=0,c=0;8>c;c++){this.makeImpl(!0,c);var d=f.getLostPoint(this);(0==c||a>d)&&(a=d,b=c)}return b},createMovieClip:function(a,b,c){var d=a.createEmptyMovieClip(b,c),e=1;this.make();for(var f=0;f<this.modules.length;f++)for(var g=f*e,h=0;h<this.modules[f].length;h++){var i=h*e,j=this.modules[f][h];j&&(d.beginFill(0,100),d.moveTo(i,g),d.lineTo(i+e,g),d.lineTo(i+e,g+e),d.lineTo(i,g+e),d.endFill())}return d},setupTimingPattern:function(){for(var a=8;a<this.moduleCount-8;a++)null==this.modules[a][6]&&(this.modules[a][6]=0==a%2);for(var b=8;b<this.moduleCount-8;b++)null==this.modules[6][b]&&(this.modules[6][b]=0==b%2)},setupPositionAdjustPattern:function(){for(var a=f.getPatternPosition(this.typeNumber),b=0;b<a.length;b++)for(var c=0;c<a.length;c++){var d=a[b],e=a[c];if(null==this.modules[d][e])for(var g=-2;2>=g;g++)for(var h=-2;2>=h;h++)this.modules[d+g][e+h]=-2==g||2==g||-2==h||2==h||0==g&&0==h?!0:!1}},setupTypeNumber:function(a){for(var b=f.getBCHTypeNumber(this.typeNumber),c=0;18>c;c++){var d=!a&&1==(1&b>>c);this.modules[Math.floor(c/3)][c%3+this.moduleCount-8-3]=d}for(var c=0;18>c;c++){var d=!a&&1==(1&b>>c);this.modules[c%3+this.moduleCount-8-3][Math.floor(c/3)]=d}},setupTypeInfo:function(a,b){for(var c=this.errorCorrectLevel<<3|b,d=f.getBCHTypeInfo(c),e=0;15>e;e++){var g=!a&&1==(1&d>>e);6>e?this.modules[e][8]=g:8>e?this.modules[e+1][8]=g:this.modules[this.moduleCount-15+e][8]=g}for(var e=0;15>e;e++){var g=!a&&1==(1&d>>e);8>e?this.modules[8][this.moduleCount-e-1]=g:9>e?this.modules[8][15-e-1+1]=g:this.modules[8][15-e-1]=g}this.modules[this.moduleCount-8][8]=!a},mapData:function(a,b){for(var c=-1,d=this.moduleCount-1,e=7,g=0,h=this.moduleCount-1;h>0;h-=2)for(6==h&&h--;;){for(var i=0;2>i;i++)if(null==this.modules[d][h-i]){var j=!1;g<a.length&&(j=1==(1&a[g]>>>e));var k=f.getMask(b,d,h-i);k&&(j=!j),this.modules[d][h-i]=j,e--,-1==e&&(g++,e=7)}if(d+=c,0>d||this.moduleCount<=d){d-=c,c=-c;break}}}},b.PAD0=236,b.PAD1=17,b.createData=function(a,c,d){for(var e=j.getRSBlocks(a,c),g=new k,h=0;h<d.length;h++){var i=d[h];g.put(i.mode,4),g.put(i.getLength(),f.getLengthInBits(i.mode,a)),i.write(g)}for(var l=0,h=0;h<e.length;h++)l+=e[h].dataCount;if(g.getLengthInBits()>8*l)throw new Error("code length overflow. ("+g.getLengthInBits()+">"+8*l+")");for(g.getLengthInBits()+4<=8*l&&g.put(0,4);0!=g.getLengthInBits()%8;)g.putBit(!1);for(;;){if(g.getLengthInBits()>=8*l)break;if(g.put(b.PAD0,8),g.getLengthInBits()>=8*l)break;g.put(b.PAD1,8)}return b.createBytes(g,e)},b.createBytes=function(a,b){for(var c=0,d=0,e=0,g=new Array(b.length),h=new Array(b.length),j=0;j<b.length;j++){var k=b[j].dataCount,l=b[j].totalCount-k;d=Math.max(d,k),e=Math.max(e,l),g[j]=new Array(k);for(var m=0;m<g[j].length;m++)g[j][m]=255&a.buffer[m+c];c+=k;var n=f.getErrorCorrectPolynomial(l),o=new i(g[j],n.getLength()-1),p=o.mod(n);h[j]=new Array(n.getLength()-1);for(var m=0;m<h[j].length;m++){var q=m+p.getLength()-h[j].length;h[j][m]=q>=0?p.get(q):0}}for(var r=0,m=0;m<b.length;m++)r+=b[m].totalCount;for(var s=new Array(r),t=0,m=0;d>m;m++)for(var j=0;j<b.length;j++)m<g[j].length&&(s[t++]=g[j][m]);for(var m=0;e>m;m++)for(var j=0;j<b.length;j++)m<h[j].length&&(s[t++]=h[j][m]);return s};for(var c={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},d={L:1,M:0,Q:3,H:2},e={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},f={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(a){for(var b=a<<10;f.getBCHDigit(b)-f.getBCHDigit(f.G15)>=0;)b^=f.G15<<f.getBCHDigit(b)-f.getBCHDigit(f.G15);return(a<<10|b)^f.G15_MASK},getBCHTypeNumber:function(a){for(var b=a<<12;f.getBCHDigit(b)-f.getBCHDigit(f.G18)>=0;)b^=f.G18<<f.getBCHDigit(b)-f.getBCHDigit(f.G18);return a<<12|b},getBCHDigit:function(a){for(var b=0;0!=a;)b++,a>>>=1;return b},getPatternPosition:function(a){return f.PATTERN_POSITION_TABLE[a-1]},getMask:function(a,b,c){switch(a){case e.PATTERN000:return 0==(b+c)%2;case e.PATTERN001:return 0==b%2;case e.PATTERN010:return 0==c%3;case e.PATTERN011:return 0==(b+c)%3;case e.PATTERN100:return 0==(Math.floor(b/2)+Math.floor(c/3))%2;case e.PATTERN101:return 0==b*c%2+b*c%3;case e.PATTERN110:return 0==(b*c%2+b*c%3)%2;case e.PATTERN111:return 0==(b*c%3+(b+c)%2)%2;default:throw new Error("bad maskPattern:"+a)}},getErrorCorrectPolynomial:function(a){for(var b=new i([1],0),c=0;a>c;c++)b=b.multiply(new i([1,g.gexp(c)],0));return b},getLengthInBits:function(a,b){if(b>=1&&10>b)switch(a){case c.MODE_NUMBER:return 10;case c.MODE_ALPHA_NUM:return 9;case c.MODE_8BIT_BYTE:return 8;case c.MODE_KANJI:return 8;default:throw new Error("mode:"+a)}else if(27>b)switch(a){case c.MODE_NUMBER:return 12;case c.MODE_ALPHA_NUM:return 11;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 10;default:throw new Error("mode:"+a)}else{if(!(41>b))throw new Error("type:"+b);switch(a){case c.MODE_NUMBER:return 14;case c.MODE_ALPHA_NUM:return 13;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 12;default:throw new Error("mode:"+a)}}},getLostPoint:function(a){for(var b=a.getModuleCount(),c=0,d=0;b>d;d++)for(var e=0;b>e;e++){for(var f=0,g=a.isDark(d,e),h=-1;1>=h;h++)if(!(0>d+h||d+h>=b))for(var i=-1;1>=i;i++)0>e+i||e+i>=b||(0!=h||0!=i)&&g==a.isDark(d+h,e+i)&&f++;f>5&&(c+=3+f-5)}for(var d=0;b-1>d;d++)for(var e=0;b-1>e;e++){var j=0;a.isDark(d,e)&&j++,a.isDark(d+1,e)&&j++,a.isDark(d,e+1)&&j++,a.isDark(d+1,e+1)&&j++,(0==j||4==j)&&(c+=3)}for(var d=0;b>d;d++)for(var e=0;b-6>e;e++)a.isDark(d,e)&&!a.isDark(d,e+1)&&a.isDark(d,e+2)&&a.isDark(d,e+3)&&a.isDark(d,e+4)&&!a.isDark(d,e+5)&&a.isDark(d,e+6)&&(c+=40);for(var e=0;b>e;e++)for(var d=0;b-6>d;d++)a.isDark(d,e)&&!a.isDark(d+1,e)&&a.isDark(d+2,e)&&a.isDark(d+3,e)&&a.isDark(d+4,e)&&!a.isDark(d+5,e)&&a.isDark(d+6,e)&&(c+=40);for(var k=0,e=0;b>e;e++)for(var d=0;b>d;d++)a.isDark(d,e)&&k++;var l=Math.abs(100*k/b/b-50)/5;return c+=10*l}},g={glog:function(a){if(1>a)throw new Error("glog("+a+")");return g.LOG_TABLE[a]},gexp:function(a){for(;0>a;)a+=255;for(;a>=256;)a-=255;return g.EXP_TABLE[a]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},h=0;8>h;h++)g.EXP_TABLE[h]=1<<h;for(var h=8;256>h;h++)g.EXP_TABLE[h]=g.EXP_TABLE[h-4]^g.EXP_TABLE[h-5]^g.EXP_TABLE[h-6]^g.EXP_TABLE[h-8];for(var h=0;255>h;h++)g.LOG_TABLE[g.EXP_TABLE[h]]=h;i.prototype={get:function(a){return this.num[a]},getLength:function(){return this.num.length},multiply:function(a){for(var b=new Array(this.getLength()+a.getLength()-1),c=0;c<this.getLength();c++)for(var d=0;d<a.getLength();d++)b[c+d]^=g.gexp(g.glog(this.get(c))+g.glog(a.get(d)));return new i(b,0)},mod:function(a){if(this.getLength()-a.getLength()<0)return this;for(var b=g.glog(this.get(0))-g.glog(a.get(0)),c=new Array(this.getLength()),d=0;d<this.getLength();d++)c[d]=this.get(d);for(var d=0;d<a.getLength();d++)c[d]^=g.gexp(g.glog(a.get(d))+b);return new i(c,0).mod(a)}},j.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],j.getRSBlocks=function(a,b){var c=j.getRsBlockTable(a,b);if(void 0==c)throw new Error("bad rs block @ typeNumber:"+a+"/errorCorrectLevel:"+b);for(var d=c.length/3,e=[],f=0;d>f;f++)for(var g=c[3*f+0],h=c[3*f+1],i=c[3*f+2],k=0;g>k;k++)e.push(new j(h,i));return e},j.getRsBlockTable=function(a,b){switch(b){case d.L:return j.RS_BLOCK_TABLE[4*(a-1)+0];case d.M:return j.RS_BLOCK_TABLE[4*(a-1)+1];case d.Q:return j.RS_BLOCK_TABLE[4*(a-1)+2];case d.H:return j.RS_BLOCK_TABLE[4*(a-1)+3];default:return void 0}},k.prototype={get:function(a){var b=Math.floor(a/8);return 1==(1&this.buffer[b]>>>7-a%8)},put:function(a,b){for(var c=0;b>c;c++)this.putBit(1==(1&a>>>b-c-1))},getLengthInBits:function(){return this.length},putBit:function(a){var b=Math.floor(this.length/8);this.buffer.length<=b&&this.buffer.push(0),a&&(this.buffer[b]|=128>>>this.length%8),this.length++}};var l=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],o=function(){var a=function(a,b){this._el=a,this._htOption=b};return a.prototype.draw=function(a){function g(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a);for(var d in b)b.hasOwnProperty(d)&&c.setAttribute(d,b[d]);return c}var b=this._htOption,c=this._el,d=a.getModuleCount();Math.floor(b.width/d),Math.floor(b.height/d),this.clear();var h=g("svg",{viewBox:"0 0 "+String(d)+" "+String(d),width:"100%",height:"100%",fill:b.colorLight});h.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),c.appendChild(h),h.appendChild(g("rect",{fill:b.colorDark,width:"1",height:"1",id:"template"}));for(var i=0;d>i;i++)for(var j=0;d>j;j++)if(a.isDark(i,j)){var k=g("use",{x:String(i),y:String(j)});k.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),h.appendChild(k)}},a.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},a}(),p="svg"===document.documentElement.tagName.toLowerCase(),q=p?o:m()?function(){function a(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}function d(a,b){var c=this;if(c._fFail=b,c._fSuccess=a,null===c._bSupportDataURI){var d=document.createElement("img"),e=function(){c._bSupportDataURI=!1,c._fFail&&_fFail.call(c)},f=function(){c._bSupportDataURI=!0,c._fSuccess&&c._fSuccess.call(c)};return d.onabort=e,d.onerror=e,d.onload=f,d.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==",void 0}c._bSupportDataURI===!0&&c._fSuccess?c._fSuccess.call(c):c._bSupportDataURI===!1&&c._fFail&&c._fFail.call(c)}if(this._android&&this._android<=2.1){var b=1/window.devicePixelRatio,c=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(a,d,e,f,g,h,i,j){if("nodeName"in a&&/img/i.test(a.nodeName))for(var l=arguments.length-1;l>=1;l--)arguments[l]=arguments[l]*b;else"undefined"==typeof j&&(arguments[1]*=b,arguments[2]*=b,arguments[3]*=b,arguments[4]*=b);c.apply(this,arguments)}}var e=function(a,b){this._bIsPainted=!1,this._android=n(),this._htOption=b,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=b.width,this._elCanvas.height=b.height,a.appendChild(this._elCanvas),this._el=a,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return e.prototype.draw=function(a){var b=this._elImage,c=this._oContext,d=this._htOption,e=a.getModuleCount(),f=d.width/e,g=d.height/e,h=Math.round(f),i=Math.round(g);b.style.display="none",this.clear();for(var j=0;e>j;j++)for(var k=0;e>k;k++){var l=a.isDark(j,k),m=k*f,n=j*g;c.strokeStyle=l?d.colorDark:d.colorLight,c.lineWidth=1,c.fillStyle=l?d.colorDark:d.colorLight,c.fillRect(m,n,f,g),c.strokeRect(Math.floor(m)+.5,Math.floor(n)+.5,h,i),c.strokeRect(Math.ceil(m)-.5,Math.ceil(n)-.5,h,i)}this._bIsPainted=!0},e.prototype.makeImage=function(){this._bIsPainted&&d.call(this,a)},e.prototype.isPainted=function(){return this._bIsPainted},e.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},e.prototype.round=function(a){return a?Math.floor(1e3*a)/1e3:a},e}():function(){var a=function(a,b){this._el=a,this._htOption=b};return a.prototype.draw=function(a){for(var b=this._htOption,c=this._el,d=a.getModuleCount(),e=Math.floor(b.width/d),f=Math.floor(b.height/d),g=['<table style="border:0;border-collapse:collapse;">'],h=0;d>h;h++){g.push("<tr>");for(var i=0;d>i;i++)g.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+e+"px;height:"+f+"px;background-color:"+(a.isDark(h,i)?b.colorDark:b.colorLight)+';"></td>');g.push("</tr>")}g.push("</table>"),c.innerHTML=g.join("");var j=c.childNodes[0],k=(b.width-j.offsetWidth)/2,l=(b.height-j.offsetHeight)/2;k>0&&l>0&&(j.style.margin=l+"px "+k+"px")},a.prototype.clear=function(){this._el.innerHTML=""},a}();QRCode=function(a,b){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:d.H},"string"==typeof b&&(b={text:b}),b)for(var c in b)this._htOption[c]=b[c];"string"==typeof a&&(a=document.getElementById(a)),this._android=n(),this._el=a,this._oQRCode=null,this._oDrawing=new q(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},QRCode.prototype.makeCode=function(a){this._oQRCode=new b(r(a,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(a),this._oQRCode.make(),this._el.title=a,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=d}();
--- END OF FILE: ./qrcode.min.js ---

--- FILE: ./README.md ---
# VoiceMux Bridge v2.1.0 ğŸ›°ï¸

VoiceMux Bridge ã¯ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®éŸ³å£°å…¥åŠ›ã‚’ PC ä¸Šã®ã‚ã‚‰ã‚†ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆï¼ˆChatGPT, Gmail, Slack ç­‰ï¼‰ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æŒ¿å…¥ã™ã‚‹ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã§ã™ã€‚

## ğŸš€ v2.1.0 ã®æ–°æ©Ÿèƒ½: Multi-language Support & Secure Push-Sync
å¾“æ¥ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆv1.xï¼‰ã§è¡Œã£ã¦ã„ãŸã€Œå®šæœŸçš„ãªãƒšãƒ¼ã‚¸ç›£è¦–ã€ã‚„ã€Œæ‰‹å‹•ã§ã® ID å–å¾—ã€ã‚’å®Œå…¨ã«å»ƒæ­¢ã—ã¾ã—ãŸã€‚

- **å¤šè¨€èªå¯¾å¿œ (i18n)**: æ—¥æœ¬èªã¨è‹±èªã®è¡¨ç¤ºã«å®Œå…¨å¯¾å¿œã€‚
- **ã‚¼ãƒ­è¨­å®šåŒæœŸ**: [VoiceMux Hub](https://hub.knc.jp) ã‚’é–‹ãã ã‘ã§ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ãŒå®‰å…¨ã‹ã¤å³åº§ã«æ‹¡å¼µæ©Ÿèƒ½ã¸ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚
- **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ»ãƒšã‚¢ãƒªãƒ³ã‚°**: ä¸€åº¦é€£æºã™ã‚Œã°ã€æ¬¡å›ã‹ã‚‰ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ã—ã¦å³åº§ã« QR ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã€‚
- **ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ç¬¬ä¸€**: ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ã‚„æš—å·éµï¼‰ãŒ HTML ä¸Šã«éœ²å‡ºã™ã‚‹ã“ã¨ãªãã€ãƒ–ãƒ©ã‚¦ã‚¶ã®æ­£è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚° API ã§å—ã‘æ¸¡ã—ã•ã‚Œã¾ã™ã€‚

## ğŸ›  ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ä½¿ã„æ–¹
1. [Chrome ã‚¦ã‚§ãƒ–ã‚¹ãƒˆã‚¢](https://chromewebstore.google.com/detail/voicemux-bridge/agkglknmadfhdfobmgecllpgoecebdip) ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚
2. ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®ãƒ‘ã‚ºãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã‹ã‚‰ VoiceMux Bridge ã‚’ã€Œãƒ”ãƒ³ç•™ã‚ã€ã—ã¾ã™ã€‚
3. [VoiceMux Hub](https://hub.knc.jp) ã‚’é–‹ãã€åˆæœŸåŒ–ã‚’å®Œäº†ã•ã›ã¾ã™ï¼ˆè‡ªå‹•çš„ã«æ‹¡å¼µæ©Ÿèƒ½ã¸åŒæœŸã•ã‚Œã¾ã™ï¼‰ã€‚
4. æ‹¡å¼µã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€è¡¨ç¤ºã•ã‚ŒãŸ QR ã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ãƒãƒ›ã§ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚Œã°æº–å‚™å®Œäº†ã§ã™ã€‚

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ (E2EE)
VoiceMux ã¯ **End-to-End æš—å·åŒ– (E2EE)** ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚
éŸ³å£°ã‹ã‚‰å¤‰æ›ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é›¢ã‚Œã‚‹å‰ã«**ã‚ãªãŸã®ãƒ‡ãƒã‚¤ã‚¹ä¸Š**ã§æš—å·åŒ–ã•ã‚Œã¾ã™ã€‚ä¸­ç¶™ã‚µãƒ¼ãƒãƒ¼ï¼ˆv.knc.jpï¼‰ã¯æš—å·åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’è»¢é€ã—ã€ãã®ä¸­èº«ã‚’è§£èª­ã™ã‚‹ã“ã¨ã¯æš—å·å­¦çš„ã«ä¸å¯èƒ½ã§ã™ã€‚

è©³ç´°ãªå®Ÿè£…ã®è¨¼æ‹ ã¯ [E2EEå®Ÿè£…æŠ€è¡“ãƒ¬ãƒãƒ¼ãƒˆ](./docs/E2EE_IMPLEMENTATION_JA.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸ“Š ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçµ±è¨ˆ (v2.1.0)
VoiceMux Bridge ã¯ã€è»½é‡ã§é€æ˜æ€§ã®é«˜ã„è¨­è¨ˆã‚’ç¶­æŒã—ã¦ã„ã¾ã™ã€‚
- **ç·ã‚³ãƒ¼ãƒ‰è¡Œæ•°**: ç´„ 1,050 è¡Œ (JS/HTML/Manifest)
- **ä¾å­˜é–¢ä¿‚**: ã‚¼ãƒ­ (QRç”Ÿæˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª 1ã¤ã®ã¿ã‚’åŒæ¢±)
- **é€šä¿¡å…ˆ**: `knc.jp` ãƒ‰ãƒ¡ã‚¤ãƒ³ã«é™å®š

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹
ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ [LICENSE](./LICENSE) ã«åŸºã¥ã„ã¦å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®ã‚³ãƒ¼ãƒ‰ã¯å®Œå…¨ã«ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã‚ã‚Šã€èª°ã§ã‚‚ç›£æŸ»å¯èƒ½ã§ã™ã€‚

--- END OF FILE: ./README.md ---

--- FILE: ./LICENSE ---
MIT License

Copyright (c) 2026 Kohei Kaneta

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

--- END OF FILE: ./LICENSE ---

--- FILE: ./adapters.json ---
[
  {
    "id": "gemini",
    "name": "Google Gemini",
    "host": "gemini.google.com",
    "inputSelector": "div[contenteditable='true'], .rich-textarea, div[role='textbox']",
    "submitSelector": "button[aria-label*='é€ä¿¡'], button[aria-label*='Send'], button.send-button, button:has(span.material-symbols-outlined)"
  },
  {
    "id": "chatgpt",
    "name": "ChatGPT",
    "host": "chatgpt.com",
    "inputSelector": "#prompt-textarea",
    "submitSelector": "button[data-testid='send-button']"
  },
  {
    "id": "claude",
    "name": "Claude",
    "host": "claude.ai",
    "inputSelector": "div[contenteditable='true']",
    "submitSelector": "button[aria-label*='Send'], button[aria-label*='é€ä¿¡']"
  },
  {
    "id": "perplexity",
    "name": "Perplexity",
    "host": "perplexity.ai",
    "inputSelector": "div[contenteditable='true'], textarea[placeholder*='Ask'], textarea",
    "submitSelector": "button[aria-label*='Submit'], button[aria-label*='Ask'], button:has(svg), .flex.items-center.justify-center.rounded-full.transition-all"
  },
  {
    "id": "treenote",
    "name": "Treenote",
    "host": "treenoteweb.pages.dev",
    "inputSelector": "textarea.auto-resize-textarea, textarea, div[contenteditable='true']",
    "submitSelector": "button.submit-btn"
  },
  {
    "id": "gmail",
    "name": "Gmail",
    "host": "mail.google.com",
    "inputSelector": "div[role='textbox'][contenteditable='true']",
    "submitSelector": null
  },
  {
    "id": "deepl",
    "name": "DeepL",
    "host": "deepl.com",
    "inputSelector": "div[contenteditable='true'], d-textarea",
    "submitSelector": null
  }
]

--- END OF FILE: ./adapters.json ---

--- FILE: ./docs/CHANGELOG.md ---
# Changelog

All notable changes to **VoiceMux Bridge** will be documented in this file.

## [2.1.0] - 2026-02-21
### Added
- **Multi-language Support (i18n)**: Full support for English and Japanese locales.
- **KNC ID Stateless Auth**: Implemented automatic session synchronization with `hub.knc.jp`. Pairing is now handled seamlessly without manual configuration.
- **Centralized Decryption**: Moved E2EE decryption logic to the Background Service Worker for enhanced security. Content scripts now handle only plaintext data.
- **Integrated Pairing**: Updated the extension popup and QR code to point to the modern Zen UI on `hub.knc.jp`.

## [1.6.1] - 2026-02-17
### Added
- **Transparency Reports**: Added detailed documentation on "Why we need All Site Access" and "E2EE Implementation Proof."
- **Developer Profile**: Linked to official Google Play Store profile to establish trust.
- **Sustainability Policy**: Added a section explaining why the service is free and how it stays resilient.

### Changed
- **Cross-Platform Compatibility**: Improved Base64 handling for 100% key compatibility with Go and Mobile clients.
- **Stability**: Added periodic heartbeat alarms to maintain WebSocket connections in Manifest V3.
- **Protocol**: Standardized on Phoenix Protocol vsn=2.0.0 (Array format).

## [1.6.0] - 2026-02-15
### Added
- **New Onboarding UI**: Redesigned popup with a step-by-step guide for new users.
- **Web Monitor Link**: Quick access to v.knc.jp from the extension popup.

### Changed
- **Injection Engine**: Refactored text injection logic using `InputEvent` for high compatibility with Gmail, Gemini, and ChatGPT.
- **Security**: Hardened origin checks and removed unnecessary permissions.

## [1.5.0] - 2026-02-14
### Added
- **Multi-Domain Support**: Added support for both `v.knc.jp` (Zen mode) and `t.knc.jp` (Translate mode).
- **Domain Migration**: Migrated primary infrastructure to `knc.jp`.

--- END OF FILE: ./docs/CHANGELOG.md ---

--- FILE: ./docs/CHANGELOG_JA.md ---
# æ›´æ–°å±¥æ­´ (Changelog)

VoiceMux Bridge ã®ä¸»è¦ãªå¤‰æ›´å±¥æ­´ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚

## [2.1.0] - 2026-02-21
### è¿½åŠ 
- **å¤šè¨€èªå¯¾å¿œ (i18n)**: æ—¥æœ¬èªã¨è‹±èªã®è¡¨ç¤ºã«å®Œå…¨å¯¾å¿œã€‚
- **KNC ID ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹èªè¨¼**: `hub.knc.jp` ã¨ã®è‡ªå‹•ã‚»ãƒƒã‚·ãƒ§ãƒ³åŒæœŸã‚’å®Ÿè£…ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹æ‰‹å‹•è¨­å®šãªã—ã§ãƒšã‚¢ãƒªãƒ³ã‚°ãŒå¯èƒ½ã«ã€‚
- **ä¸­å¤®é›†æ¨©çš„å¾©å·ãƒ­ã‚¸ãƒƒã‚¯**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Šã®ãŸã‚ã€E2EE å¾©å·å‡¦ç†ã‚’ Background Script ã«é›†ç´„ã€‚Content Script ã¯å¹³æ–‡ã®ã¿ã‚’æ‰±ã†ã‚ˆã†ç°¡ç´ åŒ–ã€‚
- **Hub é€£æºãƒšã‚¢ãƒªãƒ³ã‚°**: ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã® QR ã‚³ãƒ¼ãƒ‰ãŠã‚ˆã³ãƒªãƒ³ã‚¯å…ˆã‚’ `hub.knc.jp` ã®çµ±åˆ Zen UI ã¸å¤‰æ›´ã€‚

## [1.6.1] - 2026-02-17
### è¿½åŠ 
- **é€æ˜æ€§ãƒ¬ãƒãƒ¼ãƒˆ**: ã€Œãªãœå…¨ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒå¿…è¦ã‹ã€ãŠã‚ˆã³ã€ŒE2EEå®Ÿè£…ã®æŠ€è¡“çš„è¨¼æ˜ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã€‚
- **é–‹ç™ºè€…ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«**: ä¿¡é ¼æ€§å‘ä¸Šã®ãŸã‚ã€Google Play ã‚¹ãƒˆã‚¢ã®ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¸ã®ãƒªãƒ³ã‚¯ã‚’è¿½åŠ ã€‚
- **æŒç¶šå¯èƒ½æ€§ã¨å“²å­¦**: ç„¡æ–™æä¾›ã®ç†ç”±ã¨ã€AIé–‹ç™ºã«ã‚ˆã‚‹ç¶™ç¶šæ€§ã«ã¤ã„ã¦ã®èª¬æ˜ã‚’è¿½åŠ ã€‚

### å¤‰æ›´
- **ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ äº’æ›æ€§**: Goã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚„ãƒ¢ãƒã‚¤ãƒ«ã¨ã®éµäº’æ›æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã€Base64å‡¦ç†ã‚’æ”¹å–„ã€‚
- **å®‰å®šæ€§å‘ä¸Š**: Manifest V3 ç’°å¢ƒä¸‹ã§ã® WebSocket æ¥ç¶šã‚’ç¶­æŒã™ã‚‹ãŸã‚ã€å®šæœŸçš„ãªãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆå‡¦ç†ã‚’è¿½åŠ ã€‚
- **ãƒ—ãƒ­ãƒˆã‚³ãƒ«çµ±ä¸€**: é€šä¿¡å½¢å¼ã‚’ Phoenix Protocol vsn=2.0.0 (Array å½¢å¼) ã«çµ±ä¸€ã€‚

## [1.6.0] - 2026-02-15
### è¿½åŠ 
- **ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°UI**: åˆã‚ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã«ã€ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã®ã‚¬ã‚¤ãƒ‰ä»˜ããƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã¸åˆ·æ–°ã€‚
- **Webãƒ¢ãƒ‹ã‚¿ãƒ¼ã¸ã®ãƒªãƒ³ã‚¯**: æ‹¡å¼µæ©Ÿèƒ½å†…ã‹ã‚‰ v.knc.jp ã¸ç´ æ—©ãã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒªãƒ³ã‚¯ã‚’è¿½åŠ ã€‚

### å¤‰æ›´
- **å…¥åŠ›ã‚¨ãƒ³ã‚¸ãƒ³ã®åˆ·æ–°**: `InputEvent` ã‚’æ´»ç”¨ã—ãŸæ–°ã—ã„æ³¨å…¥ãƒ­ã‚¸ãƒƒã‚¯ã«ã‚ˆã‚Šã€Gmail, Gemini, ChatGPT ç­‰ã®è¤‡é›‘ãªã‚¨ãƒ‡ã‚£ã‚¿ã¸ã®å¯¾å¿œã‚’å¼·åŒ–ã€‚
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–**: Originæ¤œè¨¼ã®å³æ ¼åŒ–ã¨ã€ä¸è¦ãªãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã®å‰Šé™¤ã€‚

## [1.5.0] - 2026-02-14
### è¿½åŠ 
- **ãƒãƒ«ãƒãƒ‰ãƒ¡ã‚¤ãƒ³å¯¾å¿œ**: `v.knc.jp` (Zen) ã¨ `t.knc.jp` (ç¿»è¨³) ã®ä¸¡æ–¹ã«å¯¾å¿œã€‚
- **ãƒ‰ãƒ¡ã‚¤ãƒ³ç§»è¡Œ**: ä¸»è¦ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ `knc.jp` ãƒ‰ãƒ¡ã‚¤ãƒ³ã¸çµ±åˆã€‚

--- END OF FILE: ./docs/CHANGELOG_JA.md ---

--- FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION.md ---
# ã€é–‹ç™ºãƒ­ã‚°ã€‘Chromeæ‹¡å¼µã®ã€Œæ€–ã„è­¦å‘Šã€ã«ã¤ã„ã¦AIã¨ç›¸è«‡ã—ãŸè¨˜éŒ²

VoiceMux Bridge ã®ãƒªãƒªãƒ¼ã‚¹ã«ã‚ãŸã‚Šã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­¦å‘Šã«ã¤ã„ã¦ã€AIï¼ˆGeminiï¼‰ã¨æŠ€è¡“çš„ãªç›¸è«‡ã‚’ã—ãŸéš›ã®ãƒ­ã‚°ã‚’å…¬é–‹ã—ã¾ã™ã€‚ãªãœã“ã®ä»•æ§˜ï¼ˆæ¨©é™ï¼‰ã«ãªã£ã¦ã„ã‚‹ã®ã‹ã€ãã®çµŒç·¯ãŒã‚ã‹ã‚Šã¾ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
è‡ªä½œã®æ‹¡å¼µæ©Ÿèƒ½ã‚’å…¬é–‹ã—ã¾ã—ãŸãŒã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€Œã‚»ãƒ¼ãƒ• ãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ä¿è­·å¼·åŒ–æ©Ÿèƒ½ã§ä¿¡é ¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€ã¨ã„ã†è­¦å‘ŠãŒå‡ºã¦ãã¾ã™ã€‚ä½•ã‹ãƒã‚°ãŒã‚ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

#### ğŸ¤– AI
çµè«–ã‹ã‚‰è¨€ã†ã¨ã€ã“ã‚Œã¯**ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒã‚°ã‚„è¦ç´„é•åã§ã¯ãªãã€ä¸»ã«ã€Œé–‹ç™ºè€…ã¨ã—ã¦ã®å®Ÿç¸¾ï¼ˆä¿¡é ¼ï¼‰ãŒã¾ã è“„ç©ã•ã‚Œã¦ã„ãªã„ã€ã“ã¨ãŒåŸå› **ã§ã™ã€‚

Google Chromeã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä»•æ§˜ã«ã‚ˆã‚‹ã‚‚ã®ã§ã€ä»¥ä¸‹ã®ãƒã‚¤ãƒ³ãƒˆãŒå½±éŸ¿ã—ã¦ã„ã¾ã™ã€‚

1.  **ã€Œä¿¡é ¼ã§ãã‚‹é–‹ç™ºè€…ã€ã®åŸºæº–ã‚’æº€ãŸã—ã¦ã„ãªã„:** ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ç™»éŒ²ã‹ã‚‰æ—¥ãŒæµ…ã„ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ•°ãŒã¾ã å°‘ãªã„ãªã©ã€‚
2.  **å…¬é–‹ç›´å¾Œã§ã‚ã‚‹:** å…¬é–‹ã•ã‚ŒãŸã°ã‹ã‚Šã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€Googleå´ã®ã‚¹ã‚­ãƒ£ãƒ³ã‚„è©•ä¾¡ãŒçµ‚ã‚ã£ã¦ã„ãªã„ãŸã‚ã€è­¦å‘ŠãŒå‡ºã‚„ã™ã„å‚¾å‘ã«ã‚ã‚Šã¾ã™ã€‚

æ®‹å¿µãªãŒã‚‰ãƒœã‚¿ãƒ³ä¸€ã¤ã§æ¶ˆã™è¨­å®šã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€**ã€Œæ™‚é–“ãŒè§£æ±ºã™ã‚‹ï¼ˆå®Ÿç¸¾ã‚’ç©ã‚€ï¼‰ã€**ã®ã‚’å¾…ã¤ã®ãŒæ­£æ”»æ³•ã§ã™ã€‚å…¬é–‹ç›´å¾Œã«ã‚ˆãã‚ã‚‹ç¾è±¡ãªã®ã§ã€ã¾ãšã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€Œå®‰å…¨ã§ã™ã€ã¨ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã—ã¦å®Ÿç¸¾ã‚’ä½œã‚‹ã®ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’é€²ã‚ã‚‹ã¨ã€ä»Šåº¦ã¯ã€Œã™ã¹ã¦ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆä¸Šã«ã‚ã‚‹è‡ªåˆ†ã®å…¨ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å–ã‚Šã¨å¤‰æ›´ã€ã¨ã„ã†ã•ã‚‰ã«æ€–ã„è­¦å‘ŠãŒå‡ºã¾ã™ã€‚ã“ã‚Œã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¼•ã„ã¦ã—ã¾ã„ã¾ã™ã‚ˆã­ã€‚

#### ğŸ¤– AI
ãã®è­¦å‘Šã¯ã€**ã€Œç‰¹å®šã®ãƒšãƒ¼ã‚¸é™å®šã€ã‹ã‚‰ã€Œä»»æ„ã®ãƒšãƒ¼ã‚¸ï¼ˆã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ï¼‰ã€ã¸å…¥åŠ›å¯¾è±¡ã‚’åºƒã’ãŸã“ã¨**ãŒåŸå› ã§ã™ã­ã€‚

`manifest.json` ã§ `<all_urls>` ã¨ã„ã†æ¨©é™ã‚’ä½¿ã£ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ

VoiceMux Bridgeã®ã€Œã‚¹ãƒãƒ›ã«å‘ã‹ã£ã¦è©±ã›ã°ã€ä»Šé–‹ã„ã¦ã„ã‚‹ãƒšãƒ¼ã‚¸ã«å³åº§ã«å…¥åŠ›ã•ã‚Œã‚‹ã€ã¨ã„ã†ä½“é¨“ã‚’å®Ÿç¾ã™ã‚‹ã«ã¯ã€**ã‚ã‚‰ã‹ã˜ã‚ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ã§å—ä¿¡ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å¾…æ©Ÿã•ã›ã¦ãŠã**å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
Chromeã®ä»•æ§˜ä¸Šã€ã“ã®ã€Œå…¨ãƒšãƒ¼ã‚¸å¾…æ©Ÿã€ã®æ¨©é™ã‚’æ±‚ã‚ã‚‹ã¨ã€è‡ªå‹•çš„ã«ãã®å¼·ã„è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®æ­£å¸¸ãªä»£å„Ÿã§ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ã‚‚ã—ãã®æ¨©é™ã‚’ç‹­ã‚ãŸã‚‰ã©ã†ãªã‚Šã¾ã™ã‹ï¼Ÿ è­¦å‘Šã¯æ¶ˆãˆã¾ã™ã‹ï¼Ÿ

#### ğŸ¤– AI
æ¨©é™ã‚’ `activeTab` ã ã‘ã«ç‹­ã‚ã‚Œã°è­¦å‘Šã¯æ¶ˆãˆã¾ã™ã€‚ã—ã‹ã—ã€**ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«å‘¼ã³å‡ºã•ãªã„é™ã‚Šã€æ‹¡å¼µæ©Ÿèƒ½ã¯ä½•ã‚‚ã—ãªã„ï¼ˆã§ããªã„ï¼‰ã€** ã¨ã„ã†æŒ™å‹•ã«å¤‰ã‚ã‚Šã¾ã™ã€‚

å…·ä½“çš„ã«ã¯ã“ã†ãªã‚Šã¾ã™ï¼š

1.  Gemini Web ã‚’é–‹ã â†’ **ã‚¹ãƒãƒ›ã§è©±ã—ã¦ã‚‚ä½•ã‚‚èµ·ããªã„**ï¼ˆå—ä¿¡ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒå‹•ã„ã¦ã„ãªã„ï¼‰ã€‚
2.  æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’**ã‚¯ãƒªãƒƒã‚¯**ã™ã‚‹ â†’ ã‚„ã£ã¨å…¥åŠ›å¯èƒ½ã«ãªã‚‹ã€‚
3.  Gmail ã®ã‚¿ãƒ–ã¸ç§»å‹•ã™ã‚‹ â†’ **ã¾ãŸã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯**ã—ãªã„ã¨å‹•ã‹ãªã„ã€‚

æœ€å¤§ã®å•é¡Œã¯ã€**ã€Œã‚¯ãƒªãƒƒã‚¯ã‚’å¿˜ã‚Œã¦è©±ã—å§‹ã‚ãŸæ™‚ã€** ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€Œã›ã£ã‹ãé•·æ–‡ã‚’å–‹ã£ãŸã®ã«ã€PCã«å…¥åŠ›ã•ã‚Œãªã‹ã£ãŸï¼ã€ã¨ã„ã†ã‚¹ãƒˆãƒ¬ã‚¹ã‚’æ„Ÿã˜ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

VoiceMuxã®ã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ã®å ´åˆã€**ã€ŒPCå´ã¯ä½•ã‚‚ã—ãªãã¦ã„ã„ï¼ˆãƒãƒ³ã‚ºãƒ•ãƒªãƒ¼ï¼‰ã€** ã¨ã„ã†ã®ãŒæœ€å¤§ã®ä¾¡å€¤ãªã®ã§ã€ã‚¯ãƒªãƒƒã‚¯å¿…é ˆã«ã™ã‚‹ã®ã¯ã€Œä½¿ã„å‹æ‰‹ã®æ­»ã€ã‚’æ„å‘³ã—ã¾ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ãªã‚‹ã»ã©â€¦ã€‚ä»–ã®ä¼¼ãŸã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ï¼ˆVoiceInã¨ã‹ï¼‰ã¯ã©ã†ã—ã¦ã„ã‚‹ã‚“ã§ã™ã‹ï¼Ÿ

#### ğŸ¤– AI
èª¿ã¹ã¾ã—ãŸãŒã€**VoiceIn ã¯ã‚ãªãŸã¨åŒã˜ã€Œè­¦å‘ŠãŒå‡ºã‚‹æ–¹å¼ï¼ˆå…¨æ¨©é™ï¼‰ã€ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚**
å½¼ã‚‰ã¯ã€Œè­¦å‘Šã¯å‡ºã‚‹ã‘ã‚Œã©ã€ãã®ã¶ã‚“é­”æ³•ã®ã‚ˆã†ã«ä¾¿åˆ©ã§ã™ã‚ˆã€ã¨ã„ã†ã‚¹ã‚¿ãƒ³ã‚¹ã§ã€ä¿¡é ¼ã¨å®Ÿç¸¾ã§ã‚«ãƒãƒ¼ã—ã¦ã„ã¾ã™ã€‚

ä¸€æ–¹ã€Typeless ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µã§ã¯ãªãã€ŒOSã®ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒªã€ã‚’ä½œã‚‹ã“ã¨ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¶ç´„è‡ªä½“ã‚’å›é¿ã—ã¦ã„ã¾ã™ï¼ˆé–‹ç™ºã‚³ã‚¹ãƒˆã¯è·³ã­ä¸ŠãŒã‚Šã¾ã™ãŒï¼‰ã€‚

ã¾ãŸã€Honeyï¼ˆã‚¯ãƒ¼ãƒãƒ³ã‚¢ãƒ—ãƒªï¼‰ã®ã‚ˆã†ã«ã€Œä½¿ã†æ™‚ã ã‘è¨±å¯ã‚’æ±‚ã‚ã‚‹ã€æ–¹å¼ã‚‚ã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯ã€Œè²·ã„ç‰©ã€ã¨ã„ã†æ˜ç¢ºãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒã‚ã‚‹ãƒ„ãƒ¼ãƒ«ã ã‹ã‚‰æˆç«‹ã—ã¾ã™ã€‚ã„ã¤å…¥åŠ›ãŒç™ºç”Ÿã™ã‚‹ã‹ã‚ã‹ã‚‰ãªã„VoiceMuxã®ã‚ˆã†ãªã‚¤ãƒ³ãƒ•ãƒ©ç³»ãƒ„ãƒ¼ãƒ«ã§ã¯ã€ã‚„ã¯ã‚Š**ã€Œå…¨æ¨©é™ï¼ˆè­¦å‘Šã‚ã‚Šï¼‰ã€ãŒç‹é“ã‹ã¤æ­£è§£**ã ã¨æ€ã„ã¾ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ã‚ã‹ã‚Šã¾ã—ãŸã€‚å¤‰ã«å°ç´°å·¥ã‚’ã—ã¦ä¸ä¾¿ã«ã™ã‚‹ã‚ˆã‚Šã€æ­£ç›´ã«ã€Œä¾¿åˆ©ã•ã®ãŸã‚ã®æ¨©é™ã§ã™ã€ã¨èª¬æ˜ã—ã¦é€²ã‚ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚ã‚ã¨ã€ã‚µãƒ¼ãƒãƒ¼å´ã¯é‹ç”¨ä¸Šã®éƒ½åˆã§ã‚½ãƒ¼ã‚¹ã‚’éå…¬é–‹ã«ã—ãŸã„ã®ã§ã™ãŒã€ãã‚Œã¯ã€Œã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã€ã‚’è¬³ã†ä¸Šã§å•é¡Œã«ãªã‚Šã¾ã™ã‹ï¼Ÿ

#### ğŸ¤– AI
è³¢æ˜ãªåˆ¤æ–­ã§ã™ã€‚
ã‚µãƒ¼ãƒãƒ¼å´ã«ã¤ã„ã¦ã§ã™ãŒã€**ã€Œæ‹¡å¼µæ©Ÿèƒ½ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰å´ãŒã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã‚ã‚Œã°ã€E2EEã®ä¿¡é ¼æ€§ã¯æ‹…ä¿ã§ãã‚‹ã€**ã®ã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸€ç•ªæã‚Œã‚‹ã®ã¯ã€Œè‡ªåˆ†ã®ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ä½•ãŒèµ·ãã¦ã„ã‚‹ã‹ã€ã§ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶å´ã§é€ä¿¡å‰ã«ãƒ‡ãƒ¼ã‚¿ãŒæš—å·åŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã•ãˆã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§è¨¼æ˜ã§ãã‚Œã°ã€ãã®å…ˆã®ã‚µãƒ¼ãƒãƒ¼ãŒã©ã‚Œã ã‘ã€Œãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã€ã§ã‚ã£ã¦ã‚‚ã€ä¸­èº«ã‚’ç›—ã¿è¦‹ã‚‹ã“ã¨ã¯ä¸å¯èƒ½ã§ã™ã€‚

ã‚€ã—ã‚ã€ã‚µãƒ¼ãƒãƒ¼ã‚’ã€ŒãŸã ã®æš—å·åŒ–ãƒ‡ãƒ¼ã‚¿ã®åœŸç®¡ã€ã«å¾¹ã•ã›ã‚‹ã“ã¨ã§ã€é‹ç”¨ã‚³ã‚¹ãƒˆã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’è‡ªåˆ†ã§ç®¡ç†ã—ã‚„ã™ããªã‚‹ãƒ¡ãƒªãƒƒãƒˆã‚‚ã‚ã‚Šã¾ã™ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ã€Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã¯å…¬é–‹ã€ã‚µãƒ¼ãƒãƒ¼å´ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆé‹ç”¨ï¼ˆã§ã‚‚ä¸­èº«ã¯è¦‹ã‚Œãªã„ï¼‰ã€ã¨æ­£ç›´ã«æ›¸ãã®ãŒã€æœ€ã‚‚ä¿¡é ¼ã•ã‚Œã‚‹å½¢ã§ã™ã€‚è‡ªä¿¡ã‚’æŒã£ã¦é€²ã‚ã¾ã—ã‚‡ã†ã€‚

--- END OF FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION.md ---

--- FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION_EN.md ---
# [Dev Log] Chatting with AI about Chrome Extension Security Warnings

Sharing the raw conversation log where I consulted with AI (Gemini) about the scary security warnings that appear when installing VoiceMux Bridge. This explains the "why" behind the permissions.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
I just published my extension, but when I try to install it, I get a warning saying "This extension is not trusted by Enhanced Safe Browsing." Is there a bug?

#### ğŸ¤– AI
Long story short: **This isn't a bug or a violation. It's mainly because you haven't accumulated "trust" as a developer yet.**

It's just how Chrome's security works. Hereâ€™s why:

1.  **You don't meet the "Trusted Developer" criteria yet:** Your account is new, or the install count is low.
2.  **It's brand new:** Since it was just published, Google hasn't finished their automated scanning and reputation evaluation.

Unfortunately, there's no "fix it" button. The standard solution is to **wait for time to solve it.** It happens to almost everyone. Just announce to your users "It's safe, just new," and let the reputation build up naturally.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
When I proceed with the installation, I get an even scarier warning: "Read and change all your data on all websites." Users are going to run away when they see this.

#### ğŸ¤– AI
That warning appears because **you expanded the scope from "specific pages" to "any page."**

Are you using `<all_urls>` in your `manifest.json`?

To achieve the VoiceMux experienceâ€”where you speak to your phone and it *instantly* types into whatever page is openâ€”**you need the receiver program waiting in the background on every page.**
Chrome forces that scary warning whenever you ask for this "wait everywhere" permission. Itâ€™s the price you pay for the feature.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
What happens if I restrict that permission? Will the warning go away?

#### ğŸ¤– AI
If you restrict it to `activeTab`, the warning disappears. But the behavior changes to: **"The extension does nothing unless you explicitly click it."**

Here is the reality:

1.  Open Gemini Web -> **Speak to phone, nothing happens.** (Receiver isn't running).
2.  **Click** the extension icon -> Now it can type.
3.  Switch tab to Gmail -> **Click the icon again** or it won't work.

The biggest issue is **when users forget to click.** They'll dictate a long paragraph, hit send, and... nothing appears on the PC. That's a terrible user experience.

For a tool like VoiceMux, **"Hands-free on the PC side"** is the core value. Making clicks mandatory effectively kills the UX.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
I see... What about other tools like VoiceIn? How do they handle this?

#### ğŸ¤– AI
I checked, and **VoiceIn uses the exact same approach as you (Full Permissions with the warning).**
Their stance is: "You get a warning, but in exchange, you get a magic-like seamless experience." They cover the fear with their reputation.

Other tools like Typeless avoid browser warnings by building a native OS app instead (which is way harder to build).

There are tools like Honey that ask for permission "only when needed," but that works because "shopping" is a distinct event. For an infrastructure tool like VoiceMux where input can happen anytime, **sticking with "Full Permissions (Warning)" is the standard and correct choice.**

---

#### ğŸ§‘â€ğŸ’» Developer (User)
Got it. Instead of crippling the features to hide the warning, I'll be honest and explain "This permission is for your convenience." Also, I plan to keep the relay server code private for operational reasons. Is that a problem for the "Open Source" claim?

#### ğŸ¤– AI
That's a sound strategy!
Regarding the server: **As long as the extension (client) is open-source, the integrity of the E2EE remains verifiable.**

What users care about most is what happens inside their browser. If you can prove via open-source code that data is encrypted *before* it leaves the client, the relay server becomes a "dumb pipe." Even if the server is a private "black box," it is mathematically impossible for it to read your messages.

In fact, keeping the server private allows you to manage operational security and spam prevention more effectively without compromising user privacy. Simply state that the "Client is Open Source, while the Server is Private (but blind to data)," and you will build genuine trust. Go for it with confidence.

--- END OF FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION_EN.md ---

--- FILE: ./docs/E2EE_IMPLEMENTATION_EN.md ---
# VoiceMux Bridge: E2EE Implementation Report

This report explains how VoiceMux Bridge ensures that your data remains private and invisible to our servers, using snippets from the actual source code.

---

## 1. Local Key Generation and Secure Transfer
The encryption key (AES-GCM 128-bit) is generated within [VoiceMux Hub](https://hub.knc.jp) and securely pushed to the extension via the official browser messaging API. It is never sent to our servers.

**Source: `background.js` (Receiver side)**
```javascript
// Around line 155: Listening for credential push from the Hub
chrome.runtime.onMessageExternal.addListener((request, sender, sendResponse) => {
  if (request.action === "SYNC_AUTH") {
    const { uuid, token, key } = request.payload;
    
    // Storing in the extension's private secure storage
    chrome.storage.local.set({
      'voicemux_room_id': uuid,
      'voicemux_token': token,
      'voicemux_key': key
    }, () => { ... });
  }
});
```
The key is stored in `chrome.storage.local`, an isolated storage area provided by the browser that websites and external servers cannot access.

---

## 2. Zero-Knowledge Key Exchange
We use URL hash fragments to share keys between your PC and smartphone without the server ever seeing the key.

**Source: `popup.js`**
```javascript
// Around line 45: Constructing the pairing URL
let pairingUrl = `${hubOrigin}/${roomId}/zen`;
pairingUrl += `?token=${token}&uuid=${roomId}`;
pairingUrl += `#key=${keyBase64}`; // Key is included in the hash
```
The key is placed after the `#` symbol. By technical design, **anything after the `#` (hash fragment) is handled exclusively by the browser and is NEVER sent to the server.**

---

## 3. Client-Side Decryption
The extension receives only encrypted blobs from the relay server. The actual decryption happens locally inside the extension's background process.

**Source: `background.js`**
```javascript
// Around line 43: The core decryption logic
async function decrypt(payload) {
  // Receives only ciphertext and IV (Initialization Vector)
  if (!payload.ciphertext || !payload.iv) return payload.text || "";
  
  try {
    const key = await getDecryptionKey(); // Import key from local storage
    const iv = Uint8Array.from(safeAtob(payload.iv), c => c.charCodeAt(0));
    const ciphertext = Uint8Array.from(safeAtob(payload.ciphertext), c => c.charCodeAt(0));

    // AES-GCM decryption using the Web Crypto API
    const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ciphertext);
    
    // Returns the plaintext only to the active browser tab
    return new TextDecoder().decode(decrypted);
  } catch (e) {
    // If the key is missing or incorrect, decryption is mathematically impossible
    return "[Decryption Error]";
  }
}
```
The relay server only sees the `ciphertext` string, which acts as noise. It has no mathematical means to read your data.

---

## 4. Conclusion
Based on the implementation above:
1. **Exclusive Access:** Only you possess the encryption keys on your devices.
2. **Secure Transport:** Keys never touch the network or the server.
3. **Transparent Logic:** Since the extension is open-source, anyone can verify that we do not leak data or bypass encryption.

---

## 5. How to Verify the Identity of the Code
"How do I know the code running in my browser is the same as this GitHub code?" You can verify this yourself with these steps:

### A. Inspect the installed files on your disk
Chrome stores the source code of installed extensions on your local machine.

- **Windows**: `%LOCALAPPDATA%\Google\Chrome\User Data\Default\Extensions\omdfoongpifbbhapnpbocfoijkglegpd`
- **Mac**: `~/Library/Application Support/Google/Chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`
- **Linux**: `~/.config/google-chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`

You can open the JS files (`background.js`, `content.js`, etc.) in these folders and compare them with the GitHub repository. VoiceMux Bridge does not minify or obfuscate its code, making comparison easy.

### B. Inspect the Running Background Code
1. Open `chrome://extensions` in your browser.
2. Click the **"Service Worker"** link for VoiceMux Bridge.
3. Developer Tools will open, allowing you to read the `background.js` source code currently in execution.

VoiceMux Bridge proves its integrity through total transparency.

---
*Last Updated: 2026-02-21 (v2.1.0)*

--- END OF FILE: ./docs/E2EE_IMPLEMENTATION_EN.md ---

--- FILE: ./docs/E2EE_IMPLEMENTATION_JA.md ---
# VoiceMux Bridge: E2EEå®Ÿè£…æŠ€è¡“ãƒ¬ãƒãƒ¼ãƒˆ

VoiceMux Bridge ãŒã©ã®ã‚ˆã†ã«ã—ã¦ãƒ‡ãƒ¼ã‚¿ã®ç§˜å¯†ã‚’ä¿æŒã—ã€ã‚µãƒ¼ãƒãƒ¼ã«å†…å®¹ã‚’è¦‹ã›ãªã„ä»•çµ„ã¿ã«ãªã£ã¦ã„ã‚‹ã‹ã‚’ã€å®Ÿéš›ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’æŠœç²‹ã—ã¦è§£èª¬ã—ã¾ã™ã€‚

---

## 1. ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®æš—å·éµç”Ÿæˆã¨ã‚»ã‚­ãƒ¥ã‚¢ãªè»¢é€
æš—å·éµï¼ˆAES-GCM 128bitï¼‰ã¯ [VoiceMux Hub](https://hub.knc.jp) ã§ç”Ÿæˆã•ã‚Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã®æ­£è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚° API ã‚’é€šã˜ã¦æ‹¡å¼µæ©Ÿèƒ½ã¸å®‰å…¨ã«ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã¸é€ä¿¡ã•ã‚Œã‚‹ã“ã¨ã¯æ±ºã—ã¦ã‚ã‚Šã¾ã›ã‚“ã€‚

**è¨¼æ‹ ã‚³ãƒ¼ãƒ‰: `background.js` (å—ä¿¡å´)**
```javascript
// 155è¡Œç›®ä»˜è¿‘: Hub ã‹ã‚‰ã®è³‡æ ¼æƒ…å ±ãƒ—ãƒƒã‚·ãƒ¥ã‚’å¾…æ©Ÿ
chrome.runtime.onMessageExternal.addListener((request, sender, sendResponse) => {
  if (request.action === "SYNC_AUTH") {
    const { uuid, token, key } = request.payload;
    
    // æ‹¡å¼µæ©Ÿèƒ½å°‚ç”¨ã®å®‰å…¨ãªé ˜åŸŸã«ä¿å­˜
    chrome.storage.local.set({
      'voicemux_room_id': uuid,
      'voicemux_token': token,
      'voicemux_key': key
    }, () => { ... });
  }
});
```
ã“ã®éµã¯ `chrome.storage.local` ã¨ã„ã†ã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒæä¾›ã™ã‚‹ã€Œæ‹¡å¼µæ©Ÿèƒ½å°‚ç”¨ã®éš”é›¢ã•ã‚ŒãŸå®‰å…¨ãªé ˜åŸŸã€ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

---

## 2. ã‚µãƒ¼ãƒãƒ¼ã‚’çµŒç”±ã—ãªã„éµå…±æœ‰ï¼ˆZero-Knowledgeï¼‰
ã‚¹ãƒãƒ›ã¨ã®ãƒšã‚¢ãƒªãƒ³ã‚°æ™‚ã€URLã®ãƒãƒƒã‚·ãƒ¥ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆ`#`ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€ã‚µãƒ¼ãƒãƒ¼ã«éµã‚’çŸ¥ã‚‰ã›ãšã«ãƒ‡ãƒã‚¤ã‚¹é–“ã§å…±æœ‰ã—ã¾ã™ã€‚

**è¨¼æ‹ ã‚³ãƒ¼ãƒ‰: `popup.js`**
```javascript
// 45è¡Œç›®ä»˜è¿‘: ãƒšã‚¢ãƒªãƒ³ã‚°ç”¨URLã®æ§‹ç¯‰
let pairingUrl = `${hubOrigin}/${roomId}/zen`;
pairingUrl += `?token=${token}&uuid=${roomId}`;
pairingUrl += `#key=${keyBase64}`; // éµã‚’ãƒãƒƒã‚·ãƒ¥ã«å«ã‚ã‚‹
```
URLã® `#` ä»¥é™ã®éƒ¨åˆ†ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ä»•æ§˜ã«ã‚ˆã‚Š **ã€Œã‚µãƒ¼ãƒãƒ¼ã«ã¯é€ä¿¡ã•ã‚Œãªã„ã€** ã¨ã„ã†ç‰¹æ€§ãŒã‚ã‚Šã¾ã™ã€‚éµã®æƒ…å ±ã¯ã‚¹ãƒãƒ›ã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ã ã‘ã§å‡¦ç†ã•ã‚Œã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ã‚µãƒ¼ãƒãƒ¼ï¼ˆä¸­ç¶™å™¨ï¼‰ã«ã¯ä¸€åˆ‡å±Šãã¾ã›ã‚“ã€‚

---

## 3. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ã®å¾©å·
æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã€Œæš—å·åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®å¡Šã€ã®ã¿ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’å¹³æ–‡ã«æˆ»ã™ï¼ˆå¾©å·ã™ã‚‹ï¼‰å‡¦ç†ã¯ã€æ‹¡å¼µæ©Ÿèƒ½ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹å†…ã§è¡Œã‚ã‚Œã¾ã™ã€‚

**è¨¼æ‹ ã‚³ãƒ¼ãƒ‰: `background.js`**
```javascript
// 43è¡Œç›®ä»˜è¿‘: å¾©å·å‡¦ç†ã®æ ¸å¿ƒ
async function decrypt(payload) {
  // payload.ciphertextï¼ˆæš—å·æ–‡ï¼‰ã¨ payload.ivï¼ˆåˆæœŸåŒ–ãƒ™ã‚¯ãƒˆãƒ«ï¼‰ã®ã¿ã‚’å—ã‘å–ã‚‹
  if (!payload.ciphertext || !payload.iv) return payload.text || "";
  
  try {
    const key = await getDecryptionKey(); // ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰éµã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
    const iv = Uint8Array.from(safeAtob(payload.iv), c => c.charCodeAt(0));
    const ciphertext = Uint8Array.from(safeAtob(payload.ciphertext), c => c.charCodeAt(0));

    // Web Crypto API ã«ã‚ˆã‚‹ AES-GCM å¾©å·
    const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ciphertext);
    
    // å¾©å·ã•ã‚ŒãŸå¹³æ–‡ã®ã¿ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã¸é€ä¿¡
    return new TextDecoder().decode(decrypted);
  } catch (e) {
    // éµãŒæ­£ã—ããªã„å ´åˆã€ä¸­èº«ã‚’èª­ã¿å–ã‚‹ã“ã¨ã¯æš—å·å­¦çš„ã«ä¸å¯èƒ½
    return "[Decryption Error]";
  }
}
```
ã‚µãƒ¼ãƒãƒ¼ã¯æ„å‘³ã‚’æŒãŸãªã„æš—å·æ–‡ï¼ˆ`ciphertext`ï¼‰ã‚’è»¢é€ã—ã¦ã„ã‚‹ã ã‘ã§ã€ãã®å†…å®¹ã‚’èª­ã¿å–ã‚‹æ•°å­¦çš„ãªæ‰‹æ®µã‚’æŒã¡ã¾ã›ã‚“ã€‚

---

## 4. çµè«–
ä»¥ä¸Šã®å®Ÿè£…ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®å®‰å…¨æ€§ãŒæŠ€è¡“çš„ã«æ‹…ä¿ã•ã‚Œã¦ã„ã¾ã™ã€‚

1.  **éµã®ç‹¬å **: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒã‚¤ã‚¹é–“ï¼ˆPCã¨ã‚¹ãƒãƒ›ï¼‰ä»¥å¤–ã«éµã¯å­˜åœ¨ã—ã¾ã›ã‚“ã€‚
2.  **å®‰å…¨ãªé€šä¿¡**: éµæœ¬ä½“ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆï¼‰ã‚’æµã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
3.  **é€æ˜æ€§ã®æ‹…ä¿**: æ‹¡å¼µæ©Ÿèƒ½ãŒã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã‚ã‚‹ãŸã‚ã€ä¸Šè¨˜ã®å®Ÿè£…ã«å˜˜ãŒãªã„ã“ã¨ã‚’èª°ã§ã‚‚æ¤œè¨¼å¯èƒ½ã§ã™ã€‚

---

## 5. ã‚¹ãƒˆã‚¢ç‰ˆã¨GitHubã®ã‚³ãƒ¼ãƒ‰ãŒåŒä¸€ã‹ç¢ºèªã™ã‚‹æ–¹æ³•
ã€ŒGitHubã®ã‚³ãƒ¼ãƒ‰ã¯ç¶ºéº—ã ãŒã€ã‚¹ãƒˆã‚¢ã§é…å¸ƒã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯ä¸­èº«ãŒé•ã†ã®ã§ã¯ãªã„ã‹ï¼Ÿã€ã¨ã„ã†ç–‘å•ã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ãŒè§£æ¶ˆã§ãã¾ã™ã€‚

### A. ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚ŒãŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã™ã‚‹
Chromeã‚¦ã‚§ãƒ–ã‚¹ãƒˆã‚¢ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸæ‹¡å¼µæ©Ÿèƒ½ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã€ã‚ãªãŸã®PCã®ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

- **Windows**: `%LOCALAPPDATA%\Google\Chrome\User Data\Default\Extensions\omdfoongpifbbhapnpbocfoijkglegpd`
- **Mac**: `~/Library/Application Support/Google/Chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`
- **Linux**: `~/.config/google-chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`

ã“ã®ãƒ•ã‚©ãƒ«ãƒ€å†…ã® JS ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`background.js`, `content.js` ç­‰ï¼‰ã‚’é–‹ãã€GitHub ä¸Šã®ã‚³ãƒ¼ãƒ‰ã¨æ¯”è¼ƒã—ã¦ã¿ã¦ãã ã•ã„ã€‚VoiceMux Bridge ã¯ã‚³ãƒ¼ãƒ‰ã®é›£èª­åŒ–ï¼ˆèª­ã¿ã¥ã‚‰ãã™ã‚‹å‡¦ç†ï¼‰ã‚’è¡Œã£ã¦ã„ãªã„ãŸã‚ã€ãã®ã¾ã¾æ¯”è¼ƒãŒå¯èƒ½ã§ã™ã€‚

### B. å®Ÿè¡Œä¸­ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã‚‹
1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ `chrome://extensions` ã‚’é–‹ãã¾ã™ã€‚
2. VoiceMux Bridge ã® **ã€Œã‚µãƒ¼ãƒ“ã‚¹ ãƒ¯ãƒ¼ã‚«ãƒ¼ã€** ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
3. ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ãŒé–‹ãã€ç¾åœ¨å‹•ä½œã—ã¦ã„ã‚‹ `background.js` ã®ã‚½ãƒ¼ã‚¹ã‚’ç›´æ¥ç¢ºèªã§ãã¾ã™ã€‚

VoiceMux Bridge ã¯ã€æŠ€è¡“çš„ãªèª å®Ÿã•ã‚’é€æ˜æ€§ã«ã‚ˆã£ã¦è¨¼æ˜ã—ã¾ã™ã€‚

---
*æœ€çµ‚æ›´æ–°: 2026-02-21 (v2.1.0)*

--- END OF FILE: ./docs/E2EE_IMPLEMENTATION_JA.md ---

--- FILE: ./docs/USER_GUIDE_EN.md ---
# VoiceMux Bridge User Guide ğŸ›°ï¸

Welcome to VoiceMux Bridge!
This extension allows you to use your smartphone's familiar keyboard to type seamlessly into any input field on your PC (ChatGPT, Gemini, Gmail, Slack, etc.).

No complex setup is required. Let's get started!

---

## 1. Preparation: Sync with the Hub

First, enable the extension.

1.  Open [VoiceMux Hub](https://hub.knc.jp) on your PC.
2.  As soon as the site opens, your secure credentials will be automatically synced to this extension.
3.  Click the **VoiceMux icon (microphone stand mark)** in the top right of your browser.
4.  If you see "Ready to Pair!" and a QR code, you're all set!

> ğŸ’¡ **Tip**: "Pin" the icon to your toolbar for instant access to the QR code.

---

## 2. Connect: Pair with Your Smartphone

1.  Scan the displayed **QR code** with your smartphone's camera.
2.  Once the dedicated input page opens on your phone, pairing is complete.

Your smartphone and PC are now connected via a private channel protected by strong End-to-End Encryption (E2EE).

---

## 3. Usage: Talk to Your Phone

The best part of VoiceMux is using **"Gboard" or "iPhone Voice Dictation"** directly on your PC.

1.  On your PC, click into any text input field (ChatGPT, Gmail, etc.) where you want to type.
2.  Tap the input area on your phone to bring up the keyboard.
3.  Press the **"Microphone button"** on your keyboard and speak to your phone.
4.  When you stop speaking... your words will appear directly at your PC's cursor position!

---

## 4. Advance: Grow Your Dictionary

VoiceMux Hub helps you fix common misrecognitions of technical terms or names.

*   **Error Correction**: Fixing text in the Hub editor teaches the AI to be smarter next time.
*   **Prompt Generation**: Click **"ğŸª„ Fix Errors & Generate Prompts"** at the bottom of the extension to open the Hub and optimize your input for AI assistants.

---

## 5. Privacy & Security

VoiceMux prioritizes your privacy.
*   **Private Data**: Your text is encrypted directly between your phone and PC. Not even our servers can read it.
*   **Offline Cache**: Once synced, you don't need to open the Hub site anymore. Just click the extension icon to start pairing instantly using cached credentials.

---

## 6. Troubleshooting

*   **No QR Code**: Try refreshing [VoiceMux Hub](https://hub.knc.jp) and then click the extension icon again.
*   **Text Not Appearing**: Make sure you've clicked inside a text field on your PC and that the cursor is active.

---

We hope VoiceMux makes your daily work and creative sessions smoother and more enjoyable!
Feel free to return to this guide whenever you need help.

--- END OF FILE: ./docs/USER_GUIDE_EN.md ---

--- FILE: ./docs/USER_GUIDE_JA.md ---
# VoiceMux Bridge ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ‰ ğŸ›°ï¸

VoiceMux Bridgeï¼ˆãƒœã‚¤ã‚¹ãƒ ã‚¯ã‚¹ãƒ»ãƒ–ãƒªãƒƒã‚¸ï¼‰ã¸ã‚ˆã†ã“ãï¼
ã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ã‚¹ãƒãƒ›ã®ã€Œä½¿ã„æ…£ã‚ŒãŸã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã€ã‚’ä½¿ã£ã¦ã€ãƒ‘ã‚½ã‚³ãƒ³ã®ã‚ã‚‰ã‚†ã‚‹å…¥åŠ›æ¬„ï¼ˆGemini, ChatGPT, Gmail, Slackãªã©ï¼‰ã¸ã‚¹ãƒ©ã‚¹ãƒ©ã¨æ–‡å­—ã‚’å…¥åŠ›ã™ã‚‹ãŸã‚ã®æ¶ã‘æ©‹ã§ã™ã€‚

é›£ã—ã„è¨­å®šã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®ã‚¬ã‚¤ãƒ‰ã¨ä¸€ç·’ã«ã€æœ€åˆã®ä¸€æ­©ã‚’è¸ã¿å‡ºã—ã¾ã—ã‚‡ã†ã€‚

---

## 1. æº–å‚™ï¼šWebã‚µã‚¤ãƒˆã¨ã¤ãªã’ã‚ˆã†ï¼ˆåŒæœŸï¼‰

ã¾ãšã€æ‹¡å¼µæ©Ÿèƒ½ã‚’ä½¿ãˆã‚‹çŠ¶æ…‹ã«ã—ã¾ã™ã€‚

1.  ãƒ‘ã‚½ã‚³ãƒ³ã§ [VoiceMux Hub](https://hub.knc.jp) ã‚’é–‹ãã¾ã™ã€‚
2.  ã‚µã‚¤ãƒˆãŒé–‹ãã¨åŒæ™‚ã«ã€å®‰å…¨ãªèªè¨¼æƒ…å ±ãŒã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¸è‡ªå‹•çš„ã«é€ã‚‰ã‚Œã¾ã™ã€‚
3.  ãƒ–ãƒ©ã‚¦ã‚¶å³ä¸Šã® **VoiceMuxã‚¢ã‚¤ã‚³ãƒ³ï¼ˆãƒã‚¤ã‚¯ã‚¹ã‚¿ãƒ³ãƒ‰ã®ãƒãƒ¼ã‚¯ï¼‰** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
4.  ã€Œãƒšã‚¢ãƒªãƒ³ã‚°ã®æº–å‚™å®Œäº†ã€ã¨è¡¨ç¤ºã•ã‚Œã€QRã‚³ãƒ¼ãƒ‰ãŒå‡ºã¦ã„ã‚Œã°æº–å‚™OKã§ã™ï¼

> ğŸ’¡ **ãƒ’ãƒ³ãƒˆ**: ã‚¢ã‚¤ã‚³ãƒ³ã‚’ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã«ã€Œãƒ”ãƒ³ç•™ã‚ã€ã—ã¦ãŠãã¨ã€ã„ã¤ã§ã‚‚ã™ãã«QRã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã§ãã¦ä¾¿åˆ©ã§ã™ã€‚

---

## 2. ã¤ãªã’ã‚ˆã†ï¼šã‚¹ãƒãƒ›ã¨ãƒšã‚¢ãƒªãƒ³ã‚°

1.  è¡¨ç¤ºã•ã‚ŒãŸ **QRã‚³ãƒ¼ãƒ‰** ã‚’ã‚¹ãƒãƒ›ã®ã‚«ãƒ¡ãƒ©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã¾ã™ã€‚
2.  ã‚¹ãƒãƒ›ã§å°‚ç”¨ã®å…¥åŠ›ç”»é¢ãŒé–‹ã„ãŸã‚‰ã€é€£æºå®Œäº†ã§ã™ã€‚

ã‚ãªãŸã®ã‚¹ãƒãƒ›ã¨ãƒ‘ã‚½ã‚³ãƒ³ã¯ã€å¼·åŠ›ãªæš—å·ï¼ˆE2EEï¼‰ã§å®ˆã‚‰ã‚ŒãŸå°‚ç”¨ã®é€šã‚Šé“ã§ã¤ãªãŒã‚Šã¾ã—ãŸã€‚

---

## 3. ã¤ã‹ã£ã¦ã¿ã‚ˆã†ï¼šã„ã¤ã‚‚ã®ã‚¹ãƒãƒ›ã§è©±ã—ã‹ã‘ã‚‹

VoiceMuxã®æœ€å¤§ã®ç‰¹å¾´ã¯ã€ã‚¹ãƒãƒ›ã§ã„ã¤ã‚‚ä½¿ã£ã¦ã„ã‚‹ **ã€ŒGboardã€ã‚„ã€ŒiPhoneã®éŸ³å£°å…¥åŠ›ã€** ã‚’ãã®ã¾ã¾ãƒ‘ã‚½ã‚³ãƒ³ã§ä½¿ãˆã‚‹ã“ã¨ã§ã™ã€‚

1.  ãƒ‘ã‚½ã‚³ãƒ³ã§ã€æ–‡å­—ã‚’å…¥åŠ›ã—ãŸã„ã‚µã‚¤ãƒˆï¼ˆChatGPT, Gmailãªã©ï¼‰ã®å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚«ãƒ¼ã‚½ãƒ«ã‚’åˆã‚ã›ã¾ã™ã€‚
2.  ã‚¹ãƒãƒ›ã®ç”»é¢ã«ã‚ã‚‹å…¥åŠ›ã‚¨ãƒªã‚¢ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’å‡ºã—ã¾ã™ã€‚
3.  ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã«ã‚ã‚‹ **ã€Œãƒã‚¤ã‚¯ã®ãƒœã‚¿ãƒ³ã€** ã‚’æŠ¼ã—ã¦ã€ã‚¹ãƒãƒ›ã«å‘ã‹ã£ã¦è©±ã—ã‹ã‘ã¦ã¿ã¦ãã ã•ã„ã€‚
4.  è©±ã—çµ‚ã‚ã‚‹ã¨â€¦â€¦ã‚ãªãŸã®è¨€è‘‰ãŒã€ãƒ‘ã‚½ã‚³ãƒ³ã®å…¥åŠ›æ¬„ã«ç›´æ¥å…¥åŠ›ã•ã‚Œã¾ã™ï¼

---

## 4. ã‚‚ã£ã¨ä¾¿åˆ©ã«ï¼šè¾æ›¸ã‚’è‚²ã¦ã‚‹

éŸ³å£°å…¥åŠ›ã§ã‚ˆãã‚ã‚‹ã€Œå°‚é–€ç”¨èªã®èª¤å¤‰æ›ã€ã¯ã€[VoiceMux Hub](https://hub.knc.jp) ã§ä¿®æ­£ã§ãã¾ã™ã€‚

*   **èª¤èªè­˜ã®ä¿®æ­£**: Hub ã®ã‚¨ãƒ‡ã‚£ã‚¿ã§æ–‡å­—ã‚’ç›´ã™ã¨ã€AIãŒæ¬¡å›ã‹ã‚‰ã®å¤‰æ›ã‚’è³¢ãã—ã¦ãã‚Œã¾ã™ã€‚
*   **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ**: æ‹¡å¼µæ©Ÿèƒ½ã®ä¸‹éƒ¨ã«ã‚ã‚‹ **ã€ŒğŸª„ èª¤èªè­˜ã®ä¿®æ­£ãƒ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã€** ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€Hub ãŒé–‹ãã€å…¥åŠ›ã—ãŸå†…å®¹ã‚’ã•ã‚‰ã«AIå‘ã‘ã«æœ€é©åŒ–ã§ãã¾ã™ã€‚

---

## 5. å®‰å¿ƒãƒ»å®‰å…¨ã®ãŸã‚ã«

VoiceMuxã¯ã€ã‚ãªãŸã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’ä¸€ç•ªå¤§åˆ‡ã«ã—ã¦ã„ã¾ã™ã€‚
*   **ã‚ãªãŸã®æ–‡å­—ã¯ã€èª°ã«ã‚‚è¦‹ã‚‰ã‚Œã¾ã›ã‚“**: ã‚¹ãƒãƒ›ã¨ãƒ‘ã‚½ã‚³ãƒ³ã®é–“ã§ç›´æ¥æš—å·åŒ–ã•ã‚Œã‚‹ãŸã‚ã€é€”ä¸­ã®ã‚µãƒ¼ãƒãƒ¼ã§ã™ã‚‰ä¸­èº«ã‚’èª­ã‚€ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
*   **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½**: ä¸€åº¦é€£æºã™ã‚Œã°ã€æ¬¡å›ã‹ã‚‰ã¯ Hub ã‚µã‚¤ãƒˆã‚’é–‹ã‹ãªãã¦ã‚‚ã€æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’æŠ¼ã™ã ã‘ã§å³åº§ã«ä½¿ã„å§‹ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

---

## 6. å›°ã£ãŸã¨ãã¯ï¼Ÿ

*   **QRã‚³ãƒ¼ãƒ‰ãŒå‡ºãªã„**: [VoiceMux Hub](https://hub.knc.jp) ã‚’ä¸€åº¦ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆå†èª­ã¿è¾¼ã¿ï¼‰ã—ã¦ã‹ã‚‰ã€ã‚‚ã†ä¸€åº¦ã‚¢ã‚¤ã‚³ãƒ³ã‚’æŠ¼ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
*   **æ–‡å­—ãŒå…¥åŠ›ã•ã‚Œãªã„**: ãƒ‘ã‚½ã‚³ãƒ³ã®å…¥åŠ›æ¬„ã‚’ä¸€åº¦ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ã‚«ãƒ¼ã‚½ãƒ«ãŒãƒã‚«ãƒã‚«ã—ã¦ã„ã‚‹çŠ¶æ…‹ã«ã—ã¦ãã ã•ã„ã€‚

---

æ¯æ—¥ã®ãŠä»•äº‹ã‚„å‰µä½œæ´»å‹•ãŒã€ã‚¹ãƒãƒ›ã®åŠ›ã§ã‚‚ã£ã¨æ¥½ã—ãã€ã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚Šã¾ã™ã‚ˆã†ã«ï¼
ã‚‚ã—ä½¿ã„æ–¹ãŒã‚ã‹ã‚‰ãªããªã£ãŸã‚‰ã€ã„ã¤ã§ã‚‚ã“ã®ã‚¬ã‚¤ãƒ‰ã«æˆ»ã£ã¦ãã¦ãã ã•ã„ã­ã€‚

--- END OF FILE: ./docs/USER_GUIDE_JA.md ---

--- FILE: ./docs/WHY_PERMISSIONS_EN.md ---
# Transparency Report: Why VoiceMux Bridge Requests "Access to All Sites"

**VoiceMux Bridge** is designed to provide a seamless bridge between your smartphone's voice recognition and your desktop browser. This document explains our technical decisions regarding Chrome Extension permissions and our commitment to user privacy.

---

## 1. Why does Chrome say this extension is "Not Trusted"?

### The Issue
When installing from the Chrome Web Store, you might see this message:

> **Warning:** This extension is not trusted by Enhanced Safe Browsing.

### The Reason
This is not due to a bug or malware. It is a standard automated security check by Google based on:

- **Developer Longevity:** The developer account is relatively new.
- **User Base:** The extension was recently published and has a growing but still small number of users.

**Our Commitment:**
VoiceMux Bridge is fully open-source. We provide the source code on GitHub for public auditing to ensure complete transparency while Google's automated trust score accumulates.

---

## 2. Why "Read and Change All Your Data on All Websites"?

### The Reason: Ensuring a "Frictionless" UX
The core value of VoiceMux is the **"Magic Experience"**â€”speak into your phone, and text appears on your PC instantly without you having to touch your mouse.

To achieve this, the extension must be able to:

1. **Standby:** Listen for incoming encrypted data regardless of which tab (ChatGPT, Gemini, Notion, etc.) you are currently using.
2. **Auto-Injection:** Detect the active input field as soon as you switch tabs and inject the text without manual intervention.

If we restricted permissions to "activeTab" (only when clicked), **you would have to click the extension icon every single time you switch a tab.** This would destroy the hands-free utility that makes VoiceMux valuable.

---

## 3. Privacy and Security by Design

We understand that "All Site Access" is a powerful permission. We balance this responsibility with the following transparency measures:

- **Open Source Client:** The source code for the Chrome Extension is fully public on GitHub. This allows anyone to verify that data is encrypted *before* it leaves your browser and that we are not touching sensitive data like passwords.
- **End-to-End Encryption (E2EE):** While our relay server operates in a private environment, it only handles encrypted blobs. Since the encryption happens in the open-source client, the server remains a "black box" that cannot see or log your actual text.
- **Zero-Knowledge Key Exchange:** Your encryption keys are shared with your phone via URL hash fragments (`#key=...`). By technical design, these fragments are never sent to any server, ensuring your keys never touch the network.
- **No Tracking:** We do not collect browsing history or analytics. Your encryption keys and Room IDs stay stored locally on your devices.

---

## 4. Industry Standards

Most essential productivity tools, such as **1Password, Grammarly, and DeepL**, require the same level of permission. Because these tools must be ready to assist you the moment you start typing, constant presence is a technical necessity.

---

## Conclusion

We chose this permission model to deliver the **fastest, most seamless input experience possible.** While the system warning looks intimidating, we stand behind our transparent, E2EE-secured architecture to earn your trust.

---
*Last Updated: 2026-02-17*

--- END OF FILE: ./docs/WHY_PERMISSIONS_EN.md ---

--- FILE: ./docs/WHY_PERMISSIONS_JA.md ---
# Chromeæ‹¡å¼µæ©Ÿèƒ½ã®ã€Œå¼·åŠ›ãªæ¨©é™ã€ã¨UXã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã«ã¤ã„ã¦

**VoiceMux Bridge** ã¯ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®éŸ³å£°å…¥åŠ›ã‚’PCã®ã‚ã‚‰ã‚†ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã¸ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«è»¢é€ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ã€Œã™ã¹ã¦ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆä¸Šã®å…¨ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å–ã‚Šã¨å¤‰æ›´ã€ã¨ã„ã†è­¦å‘Šã®æ„å›³ã¨ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¸ã®é…æ…®ã«ã¤ã„ã¦é–‹ç™ºãƒãƒ¼ãƒ ã®è¦‹è§£ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚

---

## 1. ãªãœã€Œä¿¡é ¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€ã¨ã„ã†è­¦å‘ŠãŒå‡ºã‚‹ã®ã‹ï¼Ÿ

### èƒŒæ™¯
Chrome ã‚¦ã‚§ãƒ–ã‚¹ãƒˆã‚¢ã‹ã‚‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

> **è­¦å‘Š:** ã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ã‚»ãƒ¼ãƒ• ãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ä¿è­·å¼·åŒ–æ©Ÿèƒ½ã§ä¿¡é ¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

### ç†ç”±
ã“ã‚Œã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æ¬ é™¥ã§ã¯ãªãã€Google Chrome ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è©•ä¾¡ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™ã€‚ä¸»ã«ä»¥ä¸‹ã®æ¡ä»¶ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

- **é–‹ç™ºè€…å®Ÿç¸¾ã®è“„ç©æœŸé–“:** ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ç™»éŒ²ã‹ã‚‰ã®æœŸé–“ãŒçŸ­ã„ã€‚
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°:** å…¬é–‹ç›´å¾Œã§åˆ©ç”¨è€…ãŒé™å®šçš„ã§ã‚ã‚‹ã€‚

**VoiceMux ã®å¯¾å¿œ:**
ç§ãŸã¡ã¯ã™ã¹ã¦ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ GitHub ã§å…¬é–‹ã—ã¦ãŠã‚Šã€èª°ã§ã‚‚å®‰å…¨æ€§ã‚’ç›£æŸ»ã§ãã‚‹çŠ¶æ…‹ã«ã—ã¦ã„ã¾ã™ã€‚åˆ©ç”¨è€…ãŒå¢—ãˆã‚‹ã«ã¤ã‚Œã¦ã€ã“ã®è­¦å‘Šã¯è‡ªå‹•çš„ã«è¡¨ç¤ºã•ã‚Œãªããªã‚Šã¾ã™ã€‚

---

## 2. ãªãœã€Œå…¨ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã€ãŒå¿…è¦ãªã®ã‹ï¼Ÿ

### ç†ç”±ï¼šã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªã€Œãƒãƒ³ã‚ºãƒ•ãƒªãƒ¼ä½“é¨“ã€ã®å®Ÿç¾
VoiceMux Bridge ã®æ ¸å¿ƒã¯ã€**ã€ŒPCå´ã«è§¦ã‚Œã‚‹ã“ã¨ãªãã€ã‚¹ãƒãƒ›ã«è©±ã—ã‹ã‘ã‚‹ã ã‘ã§æ–‡å­—ãŒå…¥åŠ›ã•ã‚Œã‚‹ã€**ã¨ã„ã†ä½“é¨“ã§ã™ã€‚

ã“ã®ã€Œé­”æ³•ã®ã‚ˆã†ãªä½“é¨“ã€ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€æ‹¡å¼µæ©Ÿèƒ½ãŒä»¥ä¸‹ã®å‹•ä½œã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

1. **å¾…æ©Ÿ:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã©ã®ã‚¿ãƒ–ï¼ˆGemini, ChatGPT, Gmailç­‰ï¼‰ã‚’é–‹ã„ã¦ã‚‚ã€éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Œã‚‹çŠ¶æ…‹ã«ã™ã‚‹ã€‚
2. **è‡ªå‹•æ¤œçŸ¥:** ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆãŸéš›ã€æ–°ã—ã„ãƒšãƒ¼ã‚¸ä¸Šã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å³åº§ã«ç‰¹å®šã—ã¦æ–‡å­—ã‚’æµã—è¾¼ã‚€ã€‚

ã‚‚ã—æ¨©é™ã‚’ã€Œã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã ã‘ã€ã«åˆ¶é™ã—ãŸå ´åˆã€**ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã³ã«æ¯å›æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¨±å¯ã‚’ä¸ãˆã‚‹**æ“ä½œãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã§ã¯éŸ³å£°å…¥åŠ›ã®åˆ©ä¾¿æ€§ãŒæãªã‚ã‚Œã€ãƒ„ãƒ¼ãƒ«ã®å­˜åœ¨æ„ç¾©ãŒå¤±ã‚ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚

---

## 3. ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¨å®‰å…¨æ€§ã«ã¤ã„ã¦

ç§ãŸã¡ã¯ã€å¼·åŠ›ãªæ¨©é™ã‚’è¦æ±‚ã™ã‚‹è²¬ä»»ã¨ã—ã¦ã€ä»¥ä¸‹ã®è¨­è¨ˆã¨æƒ…å ±å…¬é–‹ã‚’å¾¹åº•ã—ã¦ã„ã¾ã™ã€‚

- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹åŒ–:** æ‹¡å¼µæ©Ÿèƒ½ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã™ã¹ã¦ GitHub ã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã€Œãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰é€ä¿¡ã•ã‚Œã‚‹å‰ã«ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãæš—å·åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ã€ã€Œå…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆä»¥å¤–ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã„ãªã„ã‹ã€ã‚’èª°ã§ã‚‚ç›£æŸ»å¯èƒ½ã§ã™ã€‚
- **ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰æš—å·åŒ– (E2EE):** éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚„ãƒ†ã‚­ã‚¹ãƒˆã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã¨ã‚¹ãƒãƒ›ã®é–“ã§ç›´æ¥æš—å·åŒ–ã•ã‚Œã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼å´ã¯ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰éå…¬é–‹ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆç’°å¢ƒã§é‹ç”¨ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§æš—å·åŒ–ãŒå®Œçµã—ã¦ã„ã‚‹ãŸã‚ã€ã‚µãƒ¼ãƒãƒ¼ï¼ˆå½“ã‚µã‚¤ãƒˆï¼‰ã§ã•ãˆä¸­èº«ã‚’èª­ã¿å–ã‚‹ã“ã¨ã¯ç‰©ç†çš„ã«ä¸å¯èƒ½ã§ã™ã€‚
- **ã‚µãƒ¼ãƒãƒ¼ã«éµã‚’æ¸¡ã•ãªã„ä»•çµ„ã¿:** ã‚¹ãƒãƒ›ã¨ã®ãƒšã‚¢ãƒªãƒ³ã‚°ã«ä½¿ç”¨ã™ã‚‹æš—å·éµã¯ã€URLã®ãƒãƒƒã‚·ãƒ¥ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆ`#` ä»¥é™ã®éƒ¨åˆ†ï¼‰ã¨ã—ã¦å…±æœ‰ã•ã‚Œã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ä»•æ§˜ä¸Šã€ã“ã®éƒ¨åˆ†ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œãªã„ãŸã‚ã€éµã®æƒ…å ±ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æµã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
- **æœ€å°é™ã®ãƒ‡ãƒ¼ã‚¿åé›†:** æ‹¡å¼µæ©Ÿèƒ½ã¯è¨­å®šï¼ˆRoom ID / Keyï¼‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã™ã‚‹ã®ã¿ã§ã€é–²è¦§å±¥æ­´ã‚„å€‹äººæƒ…å ±ã‚’å¤–éƒ¨ã¸é€ä¿¡ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

---

## 4. ä»–ã®ãƒ„ãƒ¼ãƒ«ã¨ã®æ¯”è¼ƒ

å¤šãã®ã‚¤ãƒ³ãƒ•ãƒ©ç³»ãƒ„ãƒ¼ãƒ«ï¼ˆ1Password, Grammarly, DeepLç­‰ï¼‰ã‚‚ã€åŒæ§˜ã®ç†ç”±ã§ã€Œå…¨ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã€ã‚’è¦æ±‚ã—ã¾ã™ã€‚ã€Œã„ã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã‚’å¿…è¦ã¨ã™ã‚‹ã‹äºˆæ¸¬ã§ããªã„ã€ãƒ„ãƒ¼ãƒ«ã«ã¨ã£ã¦ã€ã“ã®æ¨©é™ã¯åˆ©ä¾¿æ€§ã¨å®‰å…¨æ€§ã‚’ä¸¡ç«‹ã™ã‚‹ãŸã‚ã®æ¨™æº–çš„ãªé¸æŠã§ã™ã€‚

---

## çµè«–

VoiceMux Bridge ã¯ã€**ã€Œç©¶æ¥µã®å…¥åŠ›ä½“é¨“ã€ã‚’æä¾›ã™ã‚‹ãŸã‚ã«ç¾åœ¨ã®æ¨©é™è¨­å®šã‚’é¸æŠã—ã¾ã—ãŸã€‚** è­¦å‘Šã¯å¼·åŠ›ã«è¦‹ãˆã¾ã™ãŒã€ç§ãŸã¡ã¯é€æ˜æ€§ã¨æŠ€è¡“ï¼ˆE2EEï¼‰ã«ã‚ˆã£ã¦ãã®ä¿¡é ¼ã«å¿œãˆã¾ã™ã€‚

---
*æœ€çµ‚æ›´æ–°: 2026-02-17*

--- END OF FILE: ./docs/WHY_PERMISSIONS_JA.md ---

--- FILE: ./docs/community-adapters.md ---
# VoiceMux Community Adapters Catalog ğŸ“‚

Copy the JSON snippets below and paste them into the **Custom Site Adapters** field in your VoiceMux Extension Options.

---

### ğŸ“§ Outlook (Web)
Supports both personal (outlook.com) and business (Office 365).
```json
{
  "id": "outlook",
  "name": "Outlook",
  "host": "outlook",
  "inputSelector": "div[role='textbox'][aria-label*='ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸'], div[role='textbox'][aria-label*='Message']",
  "submitSelector": null
}
```

### ğŸ“§ Yahoo! Mail (Japan)
```json
{
  "id": "yahoo-mail-jp",
  "name": "Yahoo! Mail JP",
  "host": "mail.yahoo.co.jp",
  "inputSelector": "div[role='textbox']",
  "submitSelector": null
}
```

### ğŸ’¬ Slack (Web)
```json
{
  "id": "slack",
  "name": "Slack",
  "host": "slack.com",
  "inputSelector": ".ql-editor",
  "submitSelector": "button[data-testid='composer_send_button']"
}
```

### ğŸ“ Notion
```json
{
  "id": "notion",
  "name": "Notion",
  "host": "notion.so",
  "inputSelector": "div[contenteditable='true']",
  "submitSelector": null
}
```

---

### ğŸ’¡ How to contribute
If you've created a working adapter for a new site, please open a Pull Request or Issue to add it to this list!

--- END OF FILE: ./docs/community-adapters.md ---

--- FILE: ./PRIVACY.md ---
# Privacy Policy for VoiceMux Bridge

Last updated: 2026-02-21

## 1. Data Collection
VoiceMux Bridge does **not** collect, store, or transmit any personal data, keystrokes, or browsing history to our servers.

## 2. End-to-End Encryption (E2EE)
All data transmitted from your mobile device to this extension is encrypted using Client-Side AES-GCM (128-bit).
- **Decryption Keys**: These keys are generated within VoiceMux Hub and securely pushed to the extension via the browser's internal messaging API. They are stored in `chrome.storage.local`.
- **Zero-Knowledge**: Keys are shared with your mobile device via URL hash fragments (`#key=...`). These fragments are handled exclusively by the browser and are never sent to any server by design.

## 3. Permissions
The extension requires the following permissions to function:
- **activeTab**: Used only to inject text into the input field of the website you are currently using, and only upon your explicit request via the paired mobile device.
- **storage**: Used to save your local configuration, including your unique Room ID, encryption key, and any Custom Site Adapters you define.

## 4. Third-Party Services
VoiceMux Bridge acts as a bridge between your mobile device and the AI services you choose to use (e.g., Gemini, ChatGPT). We do not control and are not responsible for the privacy practices of those third-party services.

## 5. Contact
If you have any questions about this Privacy Policy, please open an issue on our [GitHub repository](https://github.com/Kaneta/voicemux-bridge).

--- END OF FILE: ./PRIVACY.md ---

--- FILE: ./background.js ---
// VoiceMux Bridge: Background Service Worker (Clean Push-Sync Mode)
// Configuration
const IS_DEV = false; // Set to true for local backend testing
const BASE_WS_URL = IS_DEV ? "ws://localhost:4000/socket/websocket" : "wss://v.knc.jp/socket/websocket";
const HUB_URL = IS_DEV ? "http://localhost:5173" : "https://hub.knc.jp";

/**
 * decodes Base64 strings safely, supporting both Standard and URL-safe formats.
 */
function safeAtob(base64) {
  if (!base64) return "";
  let standardBase64 = base64.replace(/\s/g, '').replace(/-/g, '+').replace(/_/g, '/');
  while (standardBase64.length % 4 !== 0) {
    standardBase64 += '=';
  }
  try {
    return atob(standardBase64);
  } catch (e) {
    console.error("[Base64] atob failed:", e);
    return "";
  }
}

let socket = null;
let heartbeatInterval = null;
let retryTimer = null;
let retryDelay = 1000;
const MAX_RETRY_DELAY = 60000;

// â˜… Crypto Helpers
async function getDecryptionKey() {
  const data = await chrome.storage.local.get('voicemux_key');
  if (!data.voicemux_key) return null;
  const rawKey = Uint8Array.from(safeAtob(data.voicemux_key), c => c.charCodeAt(0));
  return await crypto.subtle.importKey("raw", rawKey, "AES-GCM", true, ["decrypt"]);
}

async function decrypt(payload) {
  if (!payload.ciphertext || !payload.iv) return payload.text || "";
  try {
    const data = await chrome.storage.local.get('voicemux_key');
    if (!data.voicemux_key) {
      console.warn("[E2EE] Decryption skipped: No key in storage.");
      return payload.text || "";
    }

    const rawKey = Uint8Array.from(safeAtob(data.voicemux_key), c => c.charCodeAt(0));
    const key = await crypto.subtle.importKey("raw", rawKey, "AES-GCM", true, ["decrypt"]);
    
    const iv = Uint8Array.from(safeAtob(payload.iv), c => c.charCodeAt(0));
    const ciphertext = Uint8Array.from(safeAtob(payload.ciphertext), c => c.charCodeAt(0));
    
    const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ciphertext);
    const result = new TextDecoder().decode(decrypted);
    
    if (!result && ciphertext.length > 0) {
      console.warn("[E2EE] Decrypted to empty string. Possible key mismatch.");
    }
    return result;
  } catch (e) {
    console.error("[E2EE] Decryption failed. Error:", e.name, "| Key Length:", safeAtob((await chrome.storage.local.get('voicemux_key')).voicemux_key).length);
    return "[Decryption Error]";
  }
}

let currentRoomId = null;

/** Initializes WebSocket connection to the relay server using KNC ID token. */
async function connect() {
  if (socket && (socket.readyState === WebSocket.CONNECTING || socket.readyState === WebSocket.OPEN)) {
    return;
  }

  // DESIGN INTENT: Passive connection.
  // Wait for credentials to be pushed from Hub via SYNC_AUTH message.
  const data = await chrome.storage.local.get(['voicemux_token', 'voicemux_room_id']);
  
  if (!data.voicemux_token || !data.voicemux_room_id) {
    console.log("VoiceMux: Waiting for credentials from Hub...");
    return;
  }

  const roomId = data.voicemux_room_id;
  const token = data.voicemux_token;
  currentRoomId = roomId;

  try {
    const topic = `room:${roomId}`; 
    console.log(`VoiceMux: Connecting... | Room: ${roomId}`);
    
    const wsUrl = `${BASE_WS_URL}?vsn=2.0.0&token=${token}`;
    socket = new WebSocket(wsUrl);

    socket.onopen = () => {
      if (!socket || socket.readyState !== WebSocket.OPEN) return;
      
      console.log("VoiceMux: Connected (Authenticated)");
      retryDelay = 1000;
      socket.send(JSON.stringify(["1", "1", topic, "phx_join", {}]));

      // DESIGN INTENT: Proactive presence. 
      // Notify other devices (Mobile) that the Extension is here.
      socket.send(JSON.stringify([null, "2", topic, "device_online", { sender_tab_id: "extension" }]));
      
      if (heartbeatInterval) clearInterval(heartbeatInterval);
      heartbeatInterval = setInterval(() => {
        if (socket && socket.readyState === WebSocket.OPEN) {
          socket.send(JSON.stringify([null, "heartbeat", "phoenix", "heartbeat", {}]));
        }
      }, 30000);
    };

    socket.onmessage = async (event) => {
      const data = JSON.parse(event.data);
      const msgTopic = data[2];
      const eventName = data[3];
      const payload = data[4];

      if (msgTopic === `room:${currentRoomId}`) {
        if (eventName === "update_text" || eventName === "confirm_send") {
          // ... existing logic ...
        } else if (eventName === "device_online") {
          // DESIGN INTENT: Bidirectional Ping-back.
          if (payload.sender_tab_id !== "extension") {
            console.log("VoiceMux: Remote device detected. Replying with Ping-back.");
            chrome.storage.local.set({ 'voicemux_paired': true });
            
            // Reply so the mobile device knows we are here too
            socket.send(JSON.stringify([null, "3", msgTopic, "device_online", { sender_tab_id: "extension" }]));
          }
        } else if (eventName === "remote_command") {
          // DESIGN INTENT: Remote Control.
          // Phone sends commands like CLEAR, SUBMIT, INSERT, NEWLINE.
          console.log("VoiceMux: Remote command received:", payload.action);
          
          let textToForward = payload.text;
          // If encrypted, decrypt it. In Bolt protocol, text might be encrypted.
          if (payload.ciphertext && payload.iv) {
              decrypt(payload).then(decrypted => {
                  chrome.tabs.query({active: true, lastFocusedWindow: true}, (tabs) => {
                      if (tabs[0]) {
                         chrome.tabs.sendMessage(tabs[0].id, {
                          action: payload.action,
                          text: decrypted
                        }).catch(() => {});
                      }
                  });
              });
          } else {
              chrome.tabs.query({active: true, lastFocusedWindow: true}, (tabs) => {
                if (tabs[0]) {
                   chrome.tabs.sendMessage(tabs[0].id, {
                    action: payload.action,
                    text: textToForward
                  }).catch(() => {});
                }
              });
          }
        }
      }
    };

    socket.onclose = () => {
      cleanup();
      scheduleReconnect();
    };

    socket.onerror = (err) => {
      socket.close();
    };
  } catch (error) {
    console.error("VoiceMux: Connection failed:", error);
    scheduleReconnect();
  }
}

function scheduleReconnect() {
  if (retryTimer) clearTimeout(retryTimer);
  retryTimer = setTimeout(connect, retryDelay);
  retryDelay = Math.min(retryDelay * 2, MAX_RETRY_DELAY);
}

function cleanup() {
  if (heartbeatInterval) clearInterval(heartbeatInterval);
  heartbeatInterval = null;
}

function safeCheckConnection() {
  if (!socket || socket.readyState !== WebSocket.OPEN) {
    connect();
  }
}

chrome.alarms.onAlarm.addListener((alarm) => {
  if (alarm.name === "keepAlive") {
    safeCheckConnection();
  }
});
chrome.alarms.create("keepAlive", { periodInMinutes: 1 });

let syncTimeout = null;

// â˜… External Message Listener (Clean Sync architecture)
// DESIGN INTENT: Receive credentials directly from Hub's JS environment.
chrome.runtime.onMessageExternal.addListener((request, sender, sendResponse) => {
  if (request.action === "SYNC_AUTH") {
    const { uuid, token, key } = request.payload;
    
    // DESIGN INTENT: Debounce rapid sync calls from Hub to prevent WebSocket thrashing.
    if (syncTimeout) clearTimeout(syncTimeout);
    syncTimeout = setTimeout(() => {
      console.log(`[Auth] Sync received from Hub. UUID: ${uuid.substring(0, 8)}...`);
      chrome.storage.local.set({
        'voicemux_room_id': uuid,
        'voicemux_token': token,
        'voicemux_key': key,
        'voicemux_hub_url': sender.url // Automatically trust the hub URL
      }, () => {
        // Force a clean reconnection with the new credentials
        if (socket) {
          socket.onclose = null; // Prevent reconnection loop during intentional close
          socket.onerror = null;
          socket.close();
          socket = null;
        }
        connect();
      });
    }, 500); // 500ms debounce

    if (sendResponse) sendResponse({ success: true });
    return true; 
  }
});

// Internal check connection (e.g. from popup)
chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  if (request.action === "check_connection") {
    safeCheckConnection();
  }
});

// Start initial connection attempt
console.log(`VoiceMux Bridge v${chrome.runtime.getManifest().version} Background Service Worker Started`);
connect();

--- END OF FILE: ./background.js ---

--- FILE: ./collect_context.sh ---
#!/bin/bash
echo "Generating full_context.txt for VoiceMux Bridge..."
# Find relevant files and concatenate them with headers
# Exclude node_modules, .git, and common binary extensions
find . -maxdepth 2 -not -path '*/.*' -not -path './node_modules*' -not -name "*.png" -not -name "*.zip" -not -name "*.svg" -not -name "full_context.txt" -not -name "STORE_DESCRIPTION_*.txt" -not -name "DRAFT_*" -not -name "MEMO_*" -type f | while read file; do
    echo "--- FILE: $file ---" >> full_context.txt
    cat "$file" >> full_context.txt
    echo -e "
--- END OF FILE: $file ---
" >> full_context.txt
done
echo "Done! Context collected in full_context.txt"

--- END OF FILE: ./collect_context.sh ---

--- FILE: ./gen_map.sh ---
#!/bin/bash

# Configuration: Project-specific extensions
EXTENSIONS="js,jsx,ts,tsx,kt,ex,exs,svelte,astro,html,css,dart,go"
COMMENT_LIMIT=3

echo "# Codebase Map (Enhanced with Intent)"
echo "This map provides a structural overview with documentation comments. For implementation details, use MCP."
echo ""

# Get relevant files from git, excluding minified and build artifacts
FILES=$(git ls-files | grep -E "\.(${EXTENSIONS//,/|})$" | grep -vE "\.min\.js$|drizzle/|static/")

if [ -z "$FILES" ]; then
    # Fallback to find, explicitly excluding common noise
    FILES=$(find . -maxdepth 4 -type f \
        -not -path "*/node_modules/*" \
        -not -path "*/.*" \
        -not -path "*/drizzle/*" \
        -not -path "*/static/*" \
        | grep -E "\.(${EXTENSIONS//,/|})$" | grep -v "\.min\.js$")
fi

if [ -z "$FILES" ]; then
    echo "No files found with extensions: $EXTENSIONS"
    exit 0
fi

# Run ctags and process output
echo "$FILES" | xargs ctags --output-format=json --fields=+n+S --sort=no 2>/dev/null | jq -r -s '
    sort_by(.path) | .[] | 
    "\(.path)\t\(.name)\t\(.kind)\t\(.line)\t\(.signature // "")"
' | while IFS=$'\t' read -r PATH_VAL NAME KIND LINE_NUM SIG; do
    # Group by file
    if [ "$CURRENT_PATH" != "$PATH_VAL" ]; then
        echo -e "\n### FILE: $PATH_VAL"
        CURRENT_PATH=$PATH_VAL
    fi

    # Extract comments directly before the definition
    if [ -f "$PATH_VAL" ]; then
        COMMENTS=$(head -n $((LINE_NUM - 1)) "$PATH_VAL" 2>/dev/null | tail -n $COMMENT_LIMIT | grep -E "^\s*(//|/\*|\*|#|@doc|--)" | sed 's/^[[:space:]]*//' | tr '\n' ' ' | sed 's/ $//')
        
        if [ -n "$COMMENTS" ]; then
            echo "  [$KIND] $NAME$SIG (Line: $LINE_NUM) // $COMMENTS"
        else
            echo "  [$KIND] $NAME$SIG (Line: $LINE_NUM)"
        fi
    fi
done

# Add Svelte files (they are often missed by ctags)
echo "$FILES" | grep "\.svelte$" | while read -r SVELTE_FILE; do
    # Simple check to see if we already listed it
    echo -e "\n### FILE: $SVELTE_FILE (Svelte Component)"
done | sort -u

--- END OF FILE: ./gen_map.sh ---

--- FILE: ./gen_diff_context.sh ---
#!/bin/bash
# gen_diff_context.sh - å·®åˆ†é›†ä¸­å‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆå™¨

# 1. å¯¾è±¡ã¨ãªã‚‹å·®åˆ†ç¯„å›²ã®æ±ºå®š (git diff ãŒç©ºã®å ´åˆã€ç›´è¿‘ã®ã‚³ãƒŸãƒƒãƒˆã‚’å¯¾è±¡ã«ã™ã‚‹)
if [ -z "$(git diff)" ]; then
    echo "Notice: No staged or unstaged changes. Checking the last commit instead."
    TARGET="HEAD~1..HEAD"
else
    TARGET="HEAD"
fi

# 2. å¤‰æ›´ã•ã‚ŒãŸã‚·ãƒ³ãƒœãƒ«ï¼ˆé–¢æ•°ãƒ»ã‚¯ãƒ©ã‚¹ç­‰ï¼‰ã®æŠ½å‡º
echo "## [STEP 1] Detecting changed symbols via git diff ($TARGET)..."
CHANGED_SYMBOLS=$(git diff -U0 $TARGET | grep -E "^\+.*(def|function|class|interface|type)" | sed -E 's/.*\b(def|function|class|interface|type)\s+([a-zA-Z0-9_!/?]+).*/\2/' | sort -u)

if [ -z "$CHANGED_SYMBOLS" ]; then
    echo "No major symbol changes detected in diff."
    exit 0
fi

echo "Found: $CHANGED_SYMBOLS"

# 2. å½±éŸ¿ç¯„å›²ï¼ˆå‘¼ã³å‡ºã—å…ƒï¼‰ã®ç°¡æ˜“æ¢ç´¢
echo -e "\n## [STEP 2] Searching for impacted areas (Usage in other files)..."
for SYMBOL in $CHANGED_SYMBOLS; do
    echo "### Symbol: $SYMBOL"
    # å¤‰æ›´ã•ã‚ŒãŸã‚·ãƒ³ãƒœãƒ«ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ç®‡æ‰€ã‚’é«˜é€Ÿæ¤œç´¢ï¼ˆè‡ªåˆ†è‡ªèº«ã¯é™¤ãï¼‰
    grep -rwn . -e "$SYMBOL" --exclude-dir={.git,node_modules,.svelte-kit,vendor} | grep -v "$(git diff --name-only $TARGET)" | head -n 10
done

# 3. æ—¢å­˜ã® gen_map.sh ã¨é€£æºã—ã¦ã€Œåœ°å›³ã€ã‚’çµã‚Šè¾¼ã‚€
echo -e "\n## [STEP 3] Relevant Codebase Map (Filtered by Diff)"
# å¤‰æ›´ãŒã‚ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«å‘¨è¾ºã® ctags æƒ…å ±ã ã‘ã‚’åšã‚ã«æŠ½å‡º
./gen_map.sh | grep -A 5 -B 5 -E "($(echo $CHANGED_SYMBOLS | tr ' ' '|'))"
--- END OF FILE: ./gen_diff_context.sh ---

--- FILE: ./manifest.json ---
{
  "manifest_version": 3,
  "name": "__MSG_name__",
  "version": "2.2.6",
  "description": "__MSG_description__",
  "default_locale": "en",
  "permissions": [
    "activeTab",
    "storage",
    "alarms"
  ],
  "host_permissions": [
    "http://localhost:4000/*",
    "https://v.knc.jp/*",
    "https://hub.knc.jp/*"
  ],
  "action": {
    "default_popup": "popup.html",
    "default_icon": {
      "128": "icon128.png"
    }
  },
  "externally_connectable": {
    "matches": [
      "https://hub.knc.jp/*",
      "http://localhost/*"
    ]
  },
  "options_page": "options.html",
  "background": {
    "service_worker": "background.js"
  },
  "content_scripts": [
    {
      "matches": [
        "<all_urls>"
      ],
      "exclude_matches": [
        "https://v.knc.jp/*",
        "https://t.knc.jp/*"
      ],
      "js": [
        "content.js"
      ]
    }
  ],
  "icons": {
    "128": "icon128.png"
  },
  "web_accessible_resources": [
    {
      "resources": ["adapters.json"],
      "matches": ["<all_urls>"]
    }
  ]
}

--- END OF FILE: ./manifest.json ---

--- FILE: ./content.js ---
// VoiceMux Bridge Content Script v2.1.0 (Clean Architecture)
if (window.VOICEMUX_INITIALIZED) {
  console.log("VoiceMux: Already initialized in this tab.");
} else {
  window.VOICEMUX_INITIALIZED = true;
  console.group("VoiceMux Bridge v2.2.6");
  console.log("Status: Content Script Loaded");
  console.groupEnd();

  /**
   * decodes Base64 strings safely.
   */
  function safeAtob(base64) {
    if (!base64) return "";
    let standardBase64 = base64.replace(/\s/g, '').replace(/-/g, '+').replace(/_/g, '/');
    while (standardBase64.length % 4 !== 0) {
      standardBase64 += '=';
    }
    try {
      return atob(standardBase64);
    } catch (e) {
      console.error("[Base64] atob failed:", e);
      return "";
    }
  }

  let ADAPTERS_CACHE = [];
  let loadPromise = null;

  // â˜… Initialize Adapters
  async function loadAdapters() {
    if (loadPromise) return loadPromise;
    loadPromise = (async () => {
      try {
        const builtInUrl = chrome.runtime.getURL('adapters.json');
        const builtInRes = await fetch(builtInUrl);
        const builtInAdapters = await builtInRes.json();
        const storage = await chrome.storage.local.get('custom_adapters');
        const customAdapters = storage.custom_adapters || [];
        const normalizedCustom = customAdapters.map(a => ({
          name: a.name || "Custom",
          host: a.host,
          inputSelector: a.inputSelector ?? (Array.isArray(a.selectors) ? a.selectors.join(',') : a.selectors),
          submitSelector: a.submitSelector ?? (Array.isArray(a.sendBtns) ? a.sendBtns.join(',') : a.sendBtns)
        }));
        ADAPTERS_CACHE = [...normalizedCustom, ...builtInAdapters];
      } catch (e) {
        console.error("VoiceMux: Failed to load adapters", e);
      } finally {
        loadPromise = null;
      }
    })();
    return loadPromise;
  }

  chrome.storage.onChanged.addListener((changes, area) => {
    if (area === 'local' && changes.custom_adapters) {
      loadAdapters();
    }
  });
  loadAdapters();

  // â˜… Target Selection
  async function getTargetAndAdapter() {
    const url = window.location.href;
    if (ADAPTERS_CACHE.length === 0) await loadAdapters();
    const adapter = ADAPTERS_CACHE.find(a => a.host && url.includes(a.host));
    const active = document.activeElement;
    if (active && 
        (active.isContentEditable || 
         active.tagName === 'TEXTAREA' || 
         (active.tagName === 'INPUT' && !['checkbox', 'radio', 'button', 'submit'].includes(active.type)))) {
      return { target: active, adapter: adapter || { name: 'active-element' } };
    }
    if (adapter) {
      const el = document.querySelector(adapter.inputSelector);
      if (el) return { target: el, adapter: adapter };
    }
    const firstInput = document.querySelector('textarea, div[contenteditable="true"]');
    if (firstInput) {
        return { target: firstInput, adapter: { name: 'last-resort' } };
    }
    return { target: null, adapter: null };
  }

  let lastUserInteraction = 0;
  const INPUT_LOCK_MS = 2000;
  const SUBMIT_DELAY_MS = 150;

  // Listen for local interaction to prevent remote fighting
  document.addEventListener('keydown', () => lastUserInteraction = Date.now(), true);
  document.addEventListener('mousedown', () => lastUserInteraction = Date.now(), true);

  /** 
   * Hybrid Text Injection: v1.4 Stability + v2.2.2 Mirroring
   */
  function forceInject(element, text) {
    if (!element) return;
    
    const now = Date.now();
    if (now - lastUserInteraction < INPUT_LOCK_MS) {
      console.log("VoiceMux: Local interaction detected. Skipping remote update.");
      return;
    }

    // 1. Robust comparison (Check multiple text properties to avoid redundant churn)
    const val = (element.tagName === 'TEXTAREA' || element.tagName === 'INPUT' ? element.value : (element.innerText || element.textContent)) || "";
    if (val.trim() === text.trim()) return;

    console.log(`VoiceMux: Mirroring into ${element.tagName}. New Length: ${text.length}`);
    element.focus();

    try {
      if (element.tagName === 'TEXTAREA' || element.tagName === 'INPUT') {
        // --- v1.4 PROTOTYPE SETTER HACK ---
        const proto = element.tagName === 'INPUT' ? window.HTMLInputElement.prototype : window.HTMLTextAreaElement.prototype;
        const nativeSetter = Object.getOwnPropertyDescriptor(proto, "value")?.set;
        
        if (nativeSetter) {
          nativeSetter.call(element, text);
        } else {
          element.value = text;
        }
      } else if (element.isContentEditable) {
        // --- v2.2.4 ATOMIC MIRRORING ---
        // DESIGN INTENT: Aggressive Clear + Insert.
        // Modern editors often hijack 'selectAll' or 'paste'. 
        // By selecting and DELETING before insertion, we force the editor
        // to treat it as a fresh start, preventing duplication.
        
        const selection = window.getSelection();
        if (selection) {
          // Double-strength selection
          document.execCommand('selectAll', false, null);
          const range = document.createRange();
          range.selectNodeContents(element);
          selection.removeAllRanges();
          selection.addRange(range);
        }

        // Atomic transaction: Clear -> Insert
        document.execCommand('delete', false, null);
        const success = document.execCommand('insertText', false, text);
        
        if (!success) {
          element.innerText = text;
        }
      }
    } catch (e) {
      console.error("VoiceMux: Critical Injection Failure:", e);
      if (element.tagName === 'TEXTAREA') element.value = text;
      else element.innerText = text;
    }

    // 3. Mandatory State Sync (Explicitly mark as replacement)
    element.dispatchEvent(new InputEvent('input', { 
      bubbles: true, 
      inputType: 'insertReplacementText',
      data: text 
    }));
    element.dispatchEvent(new Event('change', { bubbles: true }));
    
    moveCursorToEnd(element);
  }

  function moveCursorToEnd(element) {
    if (element.tagName === 'TEXTAREA' || element.tagName === 'INPUT') {
      element.selectionStart = element.selectionEnd = element.value.length;
    } else if (element.isContentEditable) {
      try {
        const range = document.createRange();
        range.selectNodeContents(element);
        range.collapse(false);
        const sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
      } catch (e) {}
    }
  }

  /**
   * Aggressive Submission Logic: Wakes up the UI before clicking
   */
  async function performSubmit(target, adapter) {
    console.log("VoiceMux: Preparing for submission...");
    
    // 1. Final focus ritual to ensure button states refresh
    target.focus();
    target.dispatchEvent(new Event('input', { bubbles: true }));

    setTimeout(() => {
      if (adapter && adapter.submitSelector === null) return;
      
      let btn = null;
      if (adapter && adapter.submitSelector) {
        btn = document.querySelector(adapter.submitSelector);
      }

      if (btn && !btn.disabled) {
        console.log("VoiceMux: Clicking submission button.");
        btn.click();
      } else {
        console.log("VoiceMux: Submitting via Enter key.");
        triggerEnter(target);
      }
    }, SUBMIT_DELAY_MS);
  }

  function triggerEnter(target) {
      const opts = { key: 'Enter', code: 'Enter', keyCode: 13, which: 13, bubbles: true, cancelable: true, composed: true, view: window };
      target.dispatchEvent(new KeyboardEvent('keydown', opts));
      target.dispatchEvent(new KeyboardEvent('keypress', opts));
      target.dispatchEvent(new KeyboardEvent('keyup', opts));
  }

  // â˜… Message Listener (Plaintext from Background)
  chrome.runtime.onMessage.addListener(async (request, sender, sendResponse) => {
    const isHub = window.location.hostname.includes("hub.knc.jp") || 
                  (window.location.hostname === "localhost" && window.location.port === "5173");
    if (isHub) return;

    console.group("VoiceMux: Remote Command");
    try {
      const { target, adapter } = await getTargetAndAdapter();
      const plaintext = request.plaintext;
      
      let finalTarget = target;
      if (!finalTarget) {
        const active = document.activeElement;
        if (active && (active.tagName === 'TEXTAREA' || active.tagName === 'INPUT' || active.isContentEditable)) {
          finalTarget = active;
        }
      }

      if (!finalTarget) {
        console.warn("VoiceMux: No target for injection.");
        console.groupEnd();
        return;
      }

      if (request.action === "update_text") {
        forceInject(finalTarget, plaintext);
      } else if (request.action === "INSERT") {
        console.log("VoiceMux: Handling INSERT command.");
        const textToInsert = request.text || plaintext || "";
        if (textToInsert) {
          finalTarget.focus();
          document.execCommand('insertText', false, textToInsert);
          finalTarget.dispatchEvent(new InputEvent('input', { bubbles: true, inputType: 'insertText', data: textToInsert }));
          finalTarget.dispatchEvent(new Event('change', { bubbles: true }));
          moveCursorToEnd(finalTarget);
        }
      } else if (request.action === "NEWLINE") {
        console.log("VoiceMux: Handling NEWLINE command.");
        finalTarget.focus();
        document.execCommand('insertText', false, '\n');
        finalTarget.dispatchEvent(new InputEvent('input', { bubbles: true, inputType: 'insertText', data: '\n' }));
        finalTarget.dispatchEvent(new Event('change', { bubbles: true }));
        moveCursorToEnd(finalTarget);
      } else if (request.action === "SUBMIT" || request.action === "confirm_send") {
        // DESIGN INTENT: SUBMIT is now decoupled from text injection.
        // It only wakes up the UI and clicks the button.
        console.log("VoiceMux: Handling SUBMIT command.");
        await performSubmit(finalTarget, adapter);
      } else if (request.action === "CLEAR") {
        console.log("VoiceMux: Clearing target element.");
        if (finalTarget.tagName === 'TEXTAREA' || finalTarget.tagName === 'INPUT') {
          // Native setter hack for clearing
          const proto = finalTarget.tagName === 'INPUT' ? window.HTMLInputElement.prototype : window.HTMLTextAreaElement.prototype;
          const nativeSetter = Object.getOwnPropertyDescriptor(proto, "value")?.set;
          if (nativeSetter) nativeSetter.call(finalTarget, "");
          else finalTarget.value = "";
        } else {
          // ContentEditable clear
          finalTarget.focus();
          document.execCommand('selectAll', false, null);
          document.execCommand('delete', false, null);
        }
        finalTarget.dispatchEvent(new Event('input', { bubbles: true }));
      }
    } catch (err) {
      console.error("VoiceMux: Handler Error:", err);
    } finally {
      console.groupEnd();
    }
  });

  function safeCheckConnection() {
    if (chrome.runtime?.id) {
      chrome.runtime.sendMessage({ action: "check_connection" }).catch(() => {});
    }
  }

  document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "visible") {
      safeCheckConnection();
    }
  });
}

--- END OF FILE: ./content.js ---

--- FILE: ./options.html ---
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VoiceMux Settings</title>
  <style>
    :root {
      /* M3 Light Palette (Violet baseline) */
      --md-sys-color-primary: #6750A4;
      --md-sys-color-on-primary: #FFFFFF;
      --md-sys-color-primary-container: #EADDFF;
      --md-sys-color-on-primary-container: #21005D;
      --md-sys-color-secondary: #625B71;
      --md-sys-color-on-secondary: #FFFFFF;
      --md-sys-color-surface: #FEF7FF;
      --md-sys-color-on-surface: #1D1B20;
      --md-sys-color-surface-variant: #E7E0EB;
      --md-sys-color-on-surface-variant: #49454F;
      --md-sys-color-outline: #79747E;
      --md-sys-color-success: #10b981;

      /* Elevation */
      --md-sys-elevation-1: 0px 1px 3px 1px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
      --md-sys-elevation-3: 0px 1px 3px 0px rgba(0, 0, 0, 0.3), 0px 4px 8px 3px rgba(0, 0, 0, 0.15);
    }

    body {
      font-family: 'Roboto', system-ui, -apple-system, sans-serif;
      background-color: var(--md-sys-color-surface);
      color: var(--md-sys-color-on-surface);
      max-width: 680px;
      margin: 40px auto;
      padding: 24px;
      -webkit-font-smoothing: antialiased;
    }

    .card {
      background: var(--md-sys-color-surface);
      padding: 32px;
      border-radius: 28px;
      border: 1px solid var(--md-sys-color-surface-variant);
      box-shadow: var(--md-sys-elevation-1);
    }

    h1 { 
      font-size: 28px; 
      font-weight: 400; 
      margin: 0 0 12px 0; 
      color: var(--md-sys-color-on-surface);
    }

    p { 
      color: var(--md-sys-color-on-surface-variant); 
      font-size: 14px; 
      line-height: 1.6;
      margin-bottom: 32px; 
    }

    p a {
      color: var(--md-sys-color-primary);
      text-decoration: none;
      font-weight: 500;
    }

    textarea {
      width: 100%;
      height: 360px;
      font-family: 'Roboto Mono', ui-monospace, monospace;
      font-size: 13px;
      padding: 20px;
      border: 1px solid var(--md-sys-color-outline);
      border-radius: 12px;
      background-color: var(--md-sys-color-surface-variant);
      color: var(--md-sys-color-on-surface-variant);
      resize: vertical;
      box-sizing: border-box;
      outline: none;
      transition: border-color 0.2s;
    }

    textarea:focus {
      border-color: var(--md-sys-color-primary);
      border-width: 2px;
    }

    .btn-save {
      background-color: var(--md-sys-color-primary);
      color: var(--md-sys-color-on-primary);
      border: none;
      padding: 12px 24px;
      height: 40px;
      border-radius: 20px;
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      margin-top: 24px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: var(--md-sys-elevation-1);
    }

    .btn-save:hover { 
      box-shadow: var(--md-sys-elevation-2);
      opacity: 0.9;
    }

    .btn-save:active {
      transform: scale(0.98);
    }

    .status {
      margin-top: 16px;
      font-size: 14px;
      font-weight: 500;
      color: var(--md-sys-color-success);
      display: none;
      animation: fadeIn 0.3s ease;
    }

    code { 
      background: var(--md-sys-color-primary-container); 
      color: var(--md-sys-color-on-primary-container);
      padding: 2px 6px; 
      border-radius: 4px; 
      font-size: 12px;
    }

    .example-box {
      margin-top: 40px; 
      font-size: 12px; 
      color: var(--md-sys-color-on-surface-variant);
      background: var(--md-sys-color-surface-variant);
      padding: 16px;
      border-radius: 12px;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body data-i18n-title="options_title">
  <div class="card">
    <h1 data-i18n="options_header">Custom Site Adapters</h1>
    <p data-i18n="options_description">Define custom CSS selectors for your favorite sites. You can find pre-made configurations in our <a href="https://github.com/Kaneta/voicemux-bridge/blob/main/docs/community-adapters.md" target="_blank">Community Adapters Catalog</a>.</p>
    
    <textarea id="custom-adapters" spellcheck="false" placeholder='[
  {
    "name": "Custom App",
    "host": "example.com",
    "inputSelector": ".my-input",
    "submitSelector": ".my-send-button"
  }
]'></textarea>

    <button id="save" class="btn-save" data-i18n="btn_save_config">Save Configuration</button>
    <div id="status" class="status" data-i18n="status_saved">Settings saved successfully</div>

    <div class="example-box">
      <strong data-i18n="example_structure">Example Structure:</strong><br>
      <code>[{"name": "Slack", "host": "slack.com", "inputSelector": ".ql-editor", "submitSelector": "button.c-button-unstyled"}]</code>
    </div>
  </div>
  <script src="options.js"></script>
</body>
</html>

--- END OF FILE: ./options.html ---

--- FILE: ./options.js ---
// VoiceMux Options JS
const textarea = document.getElementById('custom-adapters');
const saveBtn = document.getElementById('save');
const status = document.getElementById('status');

// Load saved settings
document.addEventListener('DOMContentLoaded', async () => {
  localize();
  const data = await chrome.storage.local.get('custom_adapters');
  if (data.custom_adapters) {
    textarea.value = JSON.stringify(data.custom_adapters, null, 2);
  }
});

// Save settings
saveBtn.addEventListener('click', async () => {
  const rawValue = textarea.value.trim();
  let parsedValue = [];

  if (rawValue) {
    try {
      parsedValue = JSON.parse(rawValue);
      if (!Array.isArray(parsedValue)) throw new Error("Must be an array");
    } catch (e) {
      alert(chrome.i18n.getMessage("invalid_json_format", [e.message]));
      return;
    }
  }

  await chrome.storage.local.set({ 'custom_adapters': parsedValue });
  
  // Show status
  status.style.display = 'block';
  setTimeout(() => {
    status.style.display = 'none';
  }, 2000);
});

function localize() {
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    const message = chrome.i18n.getMessage(key);
    if (message) {
      if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
        element.placeholder = message;
      } else {
        element.innerHTML = message;
      }
    }
  });

  document.querySelectorAll('[data-i18n-title]').forEach(element => {
    const key = element.getAttribute('data-i18n-title');
    const message = chrome.i18n.getMessage(key);
    if (message) {
      document.title = message;
    }
  });
}

--- END OF FILE: ./options.js ---

--- FILE: ./popup.html ---
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    :root {
      /* M3 Light Palette (Violet baseline) */
      --md-sys-color-primary: #6750A4;
      --md-sys-color-on-primary: #FFFFFF;
      --md-sys-color-primary-container: #EADDFF;
      --md-sys-color-on-primary-container: #21005D;
      --md-sys-color-secondary-container: #E8DEF8;
      --md-sys-color-on-secondary-container: #1D192B;
      --md-sys-color-surface: #FEF7FF;
      --md-sys-color-on-surface: #1D1B20;
      --md-sys-color-surface-variant: #E7E0EB;
      --md-sys-color-on-surface-variant: #49454F;
      --md-sys-color-outline: #79747E;
      --md-sys-color-success: #10b981;
      --md-sys-color-warning: #f59e0b;

      /* Elevation */
      --md-sys-elevation-1: 0px 1px 3px 1px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
      --md-sys-elevation-2: 0px 2px 6px 2px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
    }

    body {
      width: 320px;
      font-family: 'Roboto', system-ui, -apple-system, sans-serif;
      margin: 0;
      padding: 20px 24px;
      background-color: var(--md-sys-color-surface);
      color: var(--md-sys-color-on-surface);
      -webkit-font-smoothing: antialiased;
      overflow: hidden;
    }

    .header {
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    h1 {
      font-size: 18px;
      font-weight: 700;
      margin: 0;
      color: var(--md-sys-color-primary);
      letter-spacing: -0.02em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .app-version {
      font-size: 10px;
      font-weight: 400;
      opacity: 0.6;
      background: var(--md-sys-color-surface-variant);
      padding: 2px 6px;
      border-radius: 4px;
    }

    .maintenance-notice {
      background: var(--md-sys-color-warning);
      color: white;
      padding: 4px 8px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 700;
      margin-bottom: 12px;
      width: 100%;
    }

    .maintenance-notice a {
      color: white;
      text-decoration: underline;
    }

    .status-indicator-group {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: var(--md-sys-color-warning);
      box-shadow: 0 0 0 2px var(--md-sys-color-surface);
    }

    .status-dot.online {
      background-color: var(--md-sys-color-success);
      box-shadow: 0 0 8px var(--md-sys-color-success);
    }

    /* Views */
    #unlinked-view, #linked-view {
      display: none;
      flex-direction: column;
      align-items: center;
      text-align: center;
      animation: fadeIn 0.3s ease-out;
    }

    /* Common Button Style (MD3 Tonal Capsule) */
    .btn-tonal {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 24px;
      background-color: var(--md-sys-color-secondary-container);
      color: var(--md-sys-color-on-secondary-container);
      border: none;
      border-radius: 9999px;
      font-size: 14px;
      font-weight: 700;
      text-decoration: none;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }

    .btn-tonal:hover {
      filter: brightness(0.95);
      box-shadow: var(--md-sys-elevation-1);
    }

    .btn-tonal:active {
      transform: scale(0.98);
    }

    /* Footer Links */
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-top: 16px;
      margin-bottom: 4px;
    }

    .f-link {
      font-size: 11px;
      color: var(--md-sys-color-primary);
      text-decoration: none;
      opacity: 0.7;
      font-weight: 600;
    }
    .f-link:hover { opacity: 1; text-decoration: underline; }

    /* Unlinked View Specific */
    .sync-wait-container {
      position: relative;
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
    }

    .pulse {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background-color: var(--md-sys-color-primary);
      opacity: 0.2;
      animation: pulse 2s infinite cubic-bezier(0.4, 0, 0.6, 1);
    }

    .waiting-text-main {
      font-size: 1.1rem;
      font-weight: 800;
      margin: 0 0 12px 0;
      color: var(--md-sys-color-on-surface);
      line-height: 1.3;
    }

    .waiting-text-sub {
      font-size: 13px;
      color: var(--md-sys-color-on-surface-variant);
      margin-bottom: 24px;
      line-height: 1.5;
      padding: 0 8px;
    }

    /* Linked View Specific */
    .ready-msg {
      font-size: 1.15rem;
      font-weight: 900;
      color: var(--md-sys-color-primary);
      margin: 0 0 8px 0;
      line-height: 1.2;
    }

    .sync-instruction {
      font-size: 13px;
      color: var(--md-sys-color-on-surface-variant);
      margin-bottom: 24px;
      line-height: 1.4;
      padding: 0 12px;
      white-space: nowrap;
    }

    #qrcode-link {
      display: block;
      margin-bottom: 12px;
      text-decoration: none;
      transition: transform 0.2s;
    }

    #qrcode-link:hover { transform: scale(1.02); }

    #qrcode {
      background: white;
      padding: 12px;
      border-radius: 20px;
      box-shadow: var(--md-sys-elevation-2);
      border: 1px solid var(--md-sys-color-surface-variant);
      /* High contrast for scannability */
      image-rendering: pixelated;
    }

    #qrcode img, #qrcode svg {
      display: block;
      width: 100%;
      height: auto;
    }

    .room-info {
      font-family: var(--font-mono, monospace);
      font-size: 18px;
      font-weight: 800;
      color: var(--md-sys-color-primary);
      background: var(--md-sys-color-secondary-container);
      padding: 4px 12px;
      border-radius: 8px;
      margin-bottom: 12px;
      letter-spacing: 2px;
    }

    /* Subtle Copy Button */
    .btn-copy-link {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 8px 24px;
      background: transparent;
      color: var(--md-sys-color-primary);
      border: 1px solid var(--md-sys-color-outline);
      border-radius: 100px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 24px;
      transition: all 0.2s;
    }

    .btn-copy-link:hover { background-color: rgba(103, 80, 164, 0.05); }
    .btn-copy-link.success { border-color: var(--md-sys-color-success); color: var(--md-sys-color-success); }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 0.4; }
      100% { transform: scale(1.6); opacity: 0; }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>
      <span data-i18n="name">VoiceMux Bridge</span>
      <span id="version-display" class="app-version">v...</span>
    </h1>
    <div class="status-indicator-group">
      <div id="status-indicator" class="status-dot"></div>
    </div>
  </div>

  <!-- View 1: Unlinked -->
  <div id="unlinked-view">
    <div class="sync-wait-container">
      <div class="pulse"></div>
      <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--md-sys-color-primary); z-index: 1;">
        <path d="M21 2v6h-6"></path><path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path><path d="M3 22v-6h6"></path><path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
      </svg>
    </div>
    <h2 class="waiting-text-main" data-i18n="waiting_hub_main">First, let's link with the Hub</h2>
    <p class="waiting-text-sub" data-i18n="waiting_hub_sub">Once you open the VoiceMux Hub site, the pairing QR code will appear here automatically.</p>
    <button id="btn-open-hub" class="btn-tonal" data-i18n="btn_open_hub">ğŸš€ Open Hub to Link</button>
  </div>

  <!-- View 2: Linked (Ready) -->
  <div id="linked-view">
    <div id="maintenance-notice" class="maintenance-notice" style="display: none;">
      <a id="maintenance-link" href="#" target="_blank">ğŸš§ Maintenance (Details)</a>
    </div>

    <h2 class="ready-msg" data-i18n="ready_to_sync">Ready to Pair!</h2>
    <p class="sync-instruction" data-i18n="sync_instruction">Scan with your phone to start input.</p>

    <a id="qrcode-link" href="#" target="_blank">
      <div id="qrcode"></div>
    </a>
    <div id="room-id" class="room-info" data-i18n="room_loading">Room: Loading...</div>

    <button id="copy-btn" class="btn-copy-link">
      <span id="copy-text" data-i18n="btn_copy_link">Copy Link</span>
    </button>

    <a href="https://hub.knc.jp" id="hub-link" target="_blank" class="btn-tonal" data-i18n="btn_manage_librarian">
      ğŸª„ Fix Errors & Generate Prompts
    </a>
  </div>

  <div class="footer-links">
    <a href="https://github.com/Kaneta/voicemux-bridge/issues" target="_blank" class="f-link" data-i18n="link_support">Support</a>
    <a href="https://knc.jp/ja/docs/voicemux-bridge/" id="guide-link" target="_blank" class="f-link" data-i18n="link_guide">Guide</a>
    <a href="https://github.com/Kaneta/voicemux-bridge/blob/main/PRIVACY.md" target="_blank" class="f-link" data-i18n="link_privacy">Privacy</a>
  </div>

  <script src="qrcode.min.js"></script>
  <script src="popup.js"></script>
</body>
</html>

--- END OF FILE: ./popup.html ---

--- FILE: ./popup.js ---
// VoiceMux Popup JS (v2.1.1 Finalized UI)
document.addEventListener('DOMContentLoaded', async () => {
  // Localization
  localize();

  // Version Display
  const versionDisplay = document.getElementById("version-display");
  if (versionDisplay) {
    versionDisplay.innerText = `v${chrome.runtime.getManifest().version}`;
  }

    const unlinkedView = document.getElementById("unlinked-view");
    const linkedView = document.getElementById("linked-view");
  
    // System Status Check (Non-blocking)
    try {
      const statusRes = await fetch("https://v.knc.jp/api/status");
      if (statusRes.ok) {
        const status = await statusRes.json();
        if (status.is_maintenance) {
          const notice = document.getElementById("maintenance-notice");
          const link = document.getElementById("maintenance-link");
          if (notice && link) {
            notice.style.display = "block";
            link.href = status.info_url;
          }
        }
      }
    } catch (e) {
      console.warn("VoiceMux: Failed to fetch system status.");
    }
  
    const qrcodeContainer = document.getElementById("qrcode");
  const qrcodeLink = document.getElementById("qrcode-link");
  const roomIdDisplay = document.getElementById("room-id");
  const btnOpenHub = document.getElementById("btn-open-hub");
  const statusIndicator = document.getElementById("status-indicator");
  const hubLink = document.getElementById("hub-link");

  // 1. Retrieve credentials from storage
  async function updateUI() {
    const data = await chrome.storage.local.get(['voicemux_room_id', 'voicemux_token', 'voicemux_key', 'voicemux_hub_url', 'voicemux_paired']);
    const roomId = data.voicemux_room_id;
    const token = data.voicemux_token;
    const keyBase64 = data.voicemux_key;
    const isPaired = data.voicemux_paired;
    
    let hubOrigin = 'https://hub.knc.jp';
    try {
      const rawHubUrl = data.voicemux_hub_url || 'https://hub.knc.jp';
      hubOrigin = new URL(rawHubUrl).origin;
    } catch (e) {}

    if (roomId && token && keyBase64) {
      // --- LINKED STATE (READY) ---
      linkedView.style.display = "flex";
      unlinkedView.style.display = "none";
      statusIndicator?.classList.add("online");

      // Check for active pairing success
      if (isPaired) {
        linkedView.innerHTML = `
          <div class="success-animation">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
          </div>
          <h2 class="ready-msg" style="color: #10b981;">Paired Successfully!</h2>
          <p class="sync-instruction">Your phone is now connected as a mic.</p>
          <button id="btn-close-popup" class="btn-tonal" style="width: 100%; margin-top: 12px; background-color: #10b981; color: white;">
            Done (Close)
          </button>
        `;
        const closeBtn = document.getElementById("btn-close-popup");
        if (closeBtn) closeBtn.onclick = () => window.close();
        return;
      }

      // Update Hub Link (Optional)
      if (hubLink) hubLink.href = `${hubOrigin}/welcome`;

      // Construct Pairing URL
      let pairingUrl = `${hubOrigin}/${roomId}`;
      pairingUrl += `?mode=zen&token=${token}`;
      pairingUrl += `#key=${keyBase64}`;
      
      const displayRoomId = roomId.substring(0, 4).toUpperCase();
      if (roomIdDisplay) roomIdDisplay.innerText = displayRoomId;
      if (qrcodeLink) qrcodeLink.href = pairingUrl;

      // Handle Copy Button
      const copyBtn = document.getElementById("copy-btn");
      const copyText = document.getElementById("copy-text");
      if (copyBtn) {
        copyBtn.onclick = async () => {
          try {
            await navigator.clipboard.writeText(pairingUrl);
            if (copyText) copyText.innerText = chrome.i18n.getMessage("btn_copy_success");
            copyBtn.classList.add("success");
            setTimeout(() => {
              if (copyText) copyText.innerText = chrome.i18n.getMessage("btn_copy_link");
              copyBtn.classList.remove("success");
            }, 2000);
          } catch (err) {}
        };
      }

      // Generate QR Code
      if (qrcodeContainer && qrcodeContainer.innerHTML === "") {
        new QRCode(qrcodeContainer, {
          text: pairingUrl,
          width: 160,
          height: 160,
          colorDark: "#000000",
          colorLight: "#ffffff",
          correctLevel: QRCode.CorrectLevel.M
        });
      }

    } else {
      // --- UNLINKED STATE ---
      unlinkedView.style.display = "flex";
      linkedView.style.display = "none";
      statusIndicator?.classList.remove("online");

      if (btnOpenHub) {
        btnOpenHub.onclick = () => {
          chrome.tabs.create({ url: hubOrigin });
        };
      }

      // Signal background to check connection
      chrome.runtime.sendMessage({ action: "check_connection" });
    }
  }

  // Initial update
  updateUI();
  
  // DESIGN INTENT: Reset pairing flag when opening to allow future re-pairs
  chrome.storage.local.set({ 'voicemux_paired': false });

  // Listen for storage changes
  chrome.storage.onChanged.addListener((changes, namespace) => {
    if (namespace === 'local' && (changes.voicemux_room_id || changes.voicemux_token || changes.voicemux_paired)) {
      updateUI();
    }
  });
});

function localize() {
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    const message = chrome.i18n.getMessage(key);
    if (message) {
      if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
        element.placeholder = message;
      } else {
        element.innerHTML = message;
      }
    }
  });

  // Localize specialized links
  const guideLink = document.getElementById('guide-link');
  if (guideLink) {
    guideLink.href = chrome.i18n.getMessage('url_guide');
  }
}

--- END OF FILE: ./popup.js ---

--- FILE: ./qrcode.min.js ---
var QRCode;!function(){function a(a){this.mode=c.MODE_8BIT_BYTE,this.data=a,this.parsedData=[];for(var b=[],d=0,e=this.data.length;e>d;d++){var f=this.data.charCodeAt(d);f>65536?(b[0]=240|(1835008&f)>>>18,b[1]=128|(258048&f)>>>12,b[2]=128|(4032&f)>>>6,b[3]=128|63&f):f>2048?(b[0]=224|(61440&f)>>>12,b[1]=128|(4032&f)>>>6,b[2]=128|63&f):f>128?(b[0]=192|(1984&f)>>>6,b[1]=128|63&f):b[0]=f,this.parsedData=this.parsedData.concat(b)}this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function b(a,b){this.typeNumber=a,this.errorCorrectLevel=b,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function i(a,b){if(void 0==a.length)throw new Error(a.length+"/"+b);for(var c=0;c<a.length&&0==a[c];)c++;this.num=new Array(a.length-c+b);for(var d=0;d<a.length-c;d++)this.num[d]=a[d+c]}function j(a,b){this.totalCount=a,this.dataCount=b}function k(){this.buffer=[],this.length=0}function m(){return"undefined"!=typeof CanvasRenderingContext2D}function n(){var a=!1,b=navigator.userAgent;return/android/i.test(b)&&(a=!0,aMat=b.toString().match(/android ([0-9]\.[0-9])/i),aMat&&aMat[1]&&(a=parseFloat(aMat[1]))),a}function r(a,b){for(var c=1,e=s(a),f=0,g=l.length;g>=f;f++){var h=0;switch(b){case d.L:h=l[f][0];break;case d.M:h=l[f][1];break;case d.Q:h=l[f][2];break;case d.H:h=l[f][3]}if(h>=e)break;c++}if(c>l.length)throw new Error("Too long data");return c}function s(a){var b=encodeURI(a).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return b.length+(b.length!=a?3:0)}a.prototype={getLength:function(){return this.parsedData.length},write:function(a){for(var b=0,c=this.parsedData.length;c>b;b++)a.put(this.parsedData[b],8)}},b.prototype={addData:function(b){var c=new a(b);this.dataList.push(c),this.dataCache=null},isDark:function(a,b){if(0>a||this.moduleCount<=a||0>b||this.moduleCount<=b)throw new Error(a+","+b);return this.modules[a][b]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(a,c){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var d=0;d<this.moduleCount;d++){this.modules[d]=new Array(this.moduleCount);for(var e=0;e<this.moduleCount;e++)this.modules[d][e]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(a,c),this.typeNumber>=7&&this.setupTypeNumber(a),null==this.dataCache&&(this.dataCache=b.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,c)},setupPositionProbePattern:function(a,b){for(var c=-1;7>=c;c++)if(!(-1>=a+c||this.moduleCount<=a+c))for(var d=-1;7>=d;d++)-1>=b+d||this.moduleCount<=b+d||(this.modules[a+c][b+d]=c>=0&&6>=c&&(0==d||6==d)||d>=0&&6>=d&&(0==c||6==c)||c>=2&&4>=c&&d>=2&&4>=d?!0:!1)},getBestMaskPattern:function(){for(var a=0,b=0,c=0;8>c;c++){this.makeImpl(!0,c);var d=f.getLostPoint(this);(0==c||a>d)&&(a=d,b=c)}return b},createMovieClip:function(a,b,c){var d=a.createEmptyMovieClip(b,c),e=1;this.make();for(var f=0;f<this.modules.length;f++)for(var g=f*e,h=0;h<this.modules[f].length;h++){var i=h*e,j=this.modules[f][h];j&&(d.beginFill(0,100),d.moveTo(i,g),d.lineTo(i+e,g),d.lineTo(i+e,g+e),d.lineTo(i,g+e),d.endFill())}return d},setupTimingPattern:function(){for(var a=8;a<this.moduleCount-8;a++)null==this.modules[a][6]&&(this.modules[a][6]=0==a%2);for(var b=8;b<this.moduleCount-8;b++)null==this.modules[6][b]&&(this.modules[6][b]=0==b%2)},setupPositionAdjustPattern:function(){for(var a=f.getPatternPosition(this.typeNumber),b=0;b<a.length;b++)for(var c=0;c<a.length;c++){var d=a[b],e=a[c];if(null==this.modules[d][e])for(var g=-2;2>=g;g++)for(var h=-2;2>=h;h++)this.modules[d+g][e+h]=-2==g||2==g||-2==h||2==h||0==g&&0==h?!0:!1}},setupTypeNumber:function(a){for(var b=f.getBCHTypeNumber(this.typeNumber),c=0;18>c;c++){var d=!a&&1==(1&b>>c);this.modules[Math.floor(c/3)][c%3+this.moduleCount-8-3]=d}for(var c=0;18>c;c++){var d=!a&&1==(1&b>>c);this.modules[c%3+this.moduleCount-8-3][Math.floor(c/3)]=d}},setupTypeInfo:function(a,b){for(var c=this.errorCorrectLevel<<3|b,d=f.getBCHTypeInfo(c),e=0;15>e;e++){var g=!a&&1==(1&d>>e);6>e?this.modules[e][8]=g:8>e?this.modules[e+1][8]=g:this.modules[this.moduleCount-15+e][8]=g}for(var e=0;15>e;e++){var g=!a&&1==(1&d>>e);8>e?this.modules[8][this.moduleCount-e-1]=g:9>e?this.modules[8][15-e-1+1]=g:this.modules[8][15-e-1]=g}this.modules[this.moduleCount-8][8]=!a},mapData:function(a,b){for(var c=-1,d=this.moduleCount-1,e=7,g=0,h=this.moduleCount-1;h>0;h-=2)for(6==h&&h--;;){for(var i=0;2>i;i++)if(null==this.modules[d][h-i]){var j=!1;g<a.length&&(j=1==(1&a[g]>>>e));var k=f.getMask(b,d,h-i);k&&(j=!j),this.modules[d][h-i]=j,e--,-1==e&&(g++,e=7)}if(d+=c,0>d||this.moduleCount<=d){d-=c,c=-c;break}}}},b.PAD0=236,b.PAD1=17,b.createData=function(a,c,d){for(var e=j.getRSBlocks(a,c),g=new k,h=0;h<d.length;h++){var i=d[h];g.put(i.mode,4),g.put(i.getLength(),f.getLengthInBits(i.mode,a)),i.write(g)}for(var l=0,h=0;h<e.length;h++)l+=e[h].dataCount;if(g.getLengthInBits()>8*l)throw new Error("code length overflow. ("+g.getLengthInBits()+">"+8*l+")");for(g.getLengthInBits()+4<=8*l&&g.put(0,4);0!=g.getLengthInBits()%8;)g.putBit(!1);for(;;){if(g.getLengthInBits()>=8*l)break;if(g.put(b.PAD0,8),g.getLengthInBits()>=8*l)break;g.put(b.PAD1,8)}return b.createBytes(g,e)},b.createBytes=function(a,b){for(var c=0,d=0,e=0,g=new Array(b.length),h=new Array(b.length),j=0;j<b.length;j++){var k=b[j].dataCount,l=b[j].totalCount-k;d=Math.max(d,k),e=Math.max(e,l),g[j]=new Array(k);for(var m=0;m<g[j].length;m++)g[j][m]=255&a.buffer[m+c];c+=k;var n=f.getErrorCorrectPolynomial(l),o=new i(g[j],n.getLength()-1),p=o.mod(n);h[j]=new Array(n.getLength()-1);for(var m=0;m<h[j].length;m++){var q=m+p.getLength()-h[j].length;h[j][m]=q>=0?p.get(q):0}}for(var r=0,m=0;m<b.length;m++)r+=b[m].totalCount;for(var s=new Array(r),t=0,m=0;d>m;m++)for(var j=0;j<b.length;j++)m<g[j].length&&(s[t++]=g[j][m]);for(var m=0;e>m;m++)for(var j=0;j<b.length;j++)m<h[j].length&&(s[t++]=h[j][m]);return s};for(var c={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},d={L:1,M:0,Q:3,H:2},e={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},f={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(a){for(var b=a<<10;f.getBCHDigit(b)-f.getBCHDigit(f.G15)>=0;)b^=f.G15<<f.getBCHDigit(b)-f.getBCHDigit(f.G15);return(a<<10|b)^f.G15_MASK},getBCHTypeNumber:function(a){for(var b=a<<12;f.getBCHDigit(b)-f.getBCHDigit(f.G18)>=0;)b^=f.G18<<f.getBCHDigit(b)-f.getBCHDigit(f.G18);return a<<12|b},getBCHDigit:function(a){for(var b=0;0!=a;)b++,a>>>=1;return b},getPatternPosition:function(a){return f.PATTERN_POSITION_TABLE[a-1]},getMask:function(a,b,c){switch(a){case e.PATTERN000:return 0==(b+c)%2;case e.PATTERN001:return 0==b%2;case e.PATTERN010:return 0==c%3;case e.PATTERN011:return 0==(b+c)%3;case e.PATTERN100:return 0==(Math.floor(b/2)+Math.floor(c/3))%2;case e.PATTERN101:return 0==b*c%2+b*c%3;case e.PATTERN110:return 0==(b*c%2+b*c%3)%2;case e.PATTERN111:return 0==(b*c%3+(b+c)%2)%2;default:throw new Error("bad maskPattern:"+a)}},getErrorCorrectPolynomial:function(a){for(var b=new i([1],0),c=0;a>c;c++)b=b.multiply(new i([1,g.gexp(c)],0));return b},getLengthInBits:function(a,b){if(b>=1&&10>b)switch(a){case c.MODE_NUMBER:return 10;case c.MODE_ALPHA_NUM:return 9;case c.MODE_8BIT_BYTE:return 8;case c.MODE_KANJI:return 8;default:throw new Error("mode:"+a)}else if(27>b)switch(a){case c.MODE_NUMBER:return 12;case c.MODE_ALPHA_NUM:return 11;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 10;default:throw new Error("mode:"+a)}else{if(!(41>b))throw new Error("type:"+b);switch(a){case c.MODE_NUMBER:return 14;case c.MODE_ALPHA_NUM:return 13;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 12;default:throw new Error("mode:"+a)}}},getLostPoint:function(a){for(var b=a.getModuleCount(),c=0,d=0;b>d;d++)for(var e=0;b>e;e++){for(var f=0,g=a.isDark(d,e),h=-1;1>=h;h++)if(!(0>d+h||d+h>=b))for(var i=-1;1>=i;i++)0>e+i||e+i>=b||(0!=h||0!=i)&&g==a.isDark(d+h,e+i)&&f++;f>5&&(c+=3+f-5)}for(var d=0;b-1>d;d++)for(var e=0;b-1>e;e++){var j=0;a.isDark(d,e)&&j++,a.isDark(d+1,e)&&j++,a.isDark(d,e+1)&&j++,a.isDark(d+1,e+1)&&j++,(0==j||4==j)&&(c+=3)}for(var d=0;b>d;d++)for(var e=0;b-6>e;e++)a.isDark(d,e)&&!a.isDark(d,e+1)&&a.isDark(d,e+2)&&a.isDark(d,e+3)&&a.isDark(d,e+4)&&!a.isDark(d,e+5)&&a.isDark(d,e+6)&&(c+=40);for(var e=0;b>e;e++)for(var d=0;b-6>d;d++)a.isDark(d,e)&&!a.isDark(d+1,e)&&a.isDark(d+2,e)&&a.isDark(d+3,e)&&a.isDark(d+4,e)&&!a.isDark(d+5,e)&&a.isDark(d+6,e)&&(c+=40);for(var k=0,e=0;b>e;e++)for(var d=0;b>d;d++)a.isDark(d,e)&&k++;var l=Math.abs(100*k/b/b-50)/5;return c+=10*l}},g={glog:function(a){if(1>a)throw new Error("glog("+a+")");return g.LOG_TABLE[a]},gexp:function(a){for(;0>a;)a+=255;for(;a>=256;)a-=255;return g.EXP_TABLE[a]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},h=0;8>h;h++)g.EXP_TABLE[h]=1<<h;for(var h=8;256>h;h++)g.EXP_TABLE[h]=g.EXP_TABLE[h-4]^g.EXP_TABLE[h-5]^g.EXP_TABLE[h-6]^g.EXP_TABLE[h-8];for(var h=0;255>h;h++)g.LOG_TABLE[g.EXP_TABLE[h]]=h;i.prototype={get:function(a){return this.num[a]},getLength:function(){return this.num.length},multiply:function(a){for(var b=new Array(this.getLength()+a.getLength()-1),c=0;c<this.getLength();c++)for(var d=0;d<a.getLength();d++)b[c+d]^=g.gexp(g.glog(this.get(c))+g.glog(a.get(d)));return new i(b,0)},mod:function(a){if(this.getLength()-a.getLength()<0)return this;for(var b=g.glog(this.get(0))-g.glog(a.get(0)),c=new Array(this.getLength()),d=0;d<this.getLength();d++)c[d]=this.get(d);for(var d=0;d<a.getLength();d++)c[d]^=g.gexp(g.glog(a.get(d))+b);return new i(c,0).mod(a)}},j.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],j.getRSBlocks=function(a,b){var c=j.getRsBlockTable(a,b);if(void 0==c)throw new Error("bad rs block @ typeNumber:"+a+"/errorCorrectLevel:"+b);for(var d=c.length/3,e=[],f=0;d>f;f++)for(var g=c[3*f+0],h=c[3*f+1],i=c[3*f+2],k=0;g>k;k++)e.push(new j(h,i));return e},j.getRsBlockTable=function(a,b){switch(b){case d.L:return j.RS_BLOCK_TABLE[4*(a-1)+0];case d.M:return j.RS_BLOCK_TABLE[4*(a-1)+1];case d.Q:return j.RS_BLOCK_TABLE[4*(a-1)+2];case d.H:return j.RS_BLOCK_TABLE[4*(a-1)+3];default:return void 0}},k.prototype={get:function(a){var b=Math.floor(a/8);return 1==(1&this.buffer[b]>>>7-a%8)},put:function(a,b){for(var c=0;b>c;c++)this.putBit(1==(1&a>>>b-c-1))},getLengthInBits:function(){return this.length},putBit:function(a){var b=Math.floor(this.length/8);this.buffer.length<=b&&this.buffer.push(0),a&&(this.buffer[b]|=128>>>this.length%8),this.length++}};var l=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],o=function(){var a=function(a,b){this._el=a,this._htOption=b};return a.prototype.draw=function(a){function g(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a);for(var d in b)b.hasOwnProperty(d)&&c.setAttribute(d,b[d]);return c}var b=this._htOption,c=this._el,d=a.getModuleCount();Math.floor(b.width/d),Math.floor(b.height/d),this.clear();var h=g("svg",{viewBox:"0 0 "+String(d)+" "+String(d),width:"100%",height:"100%",fill:b.colorLight});h.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),c.appendChild(h),h.appendChild(g("rect",{fill:b.colorDark,width:"1",height:"1",id:"template"}));for(var i=0;d>i;i++)for(var j=0;d>j;j++)if(a.isDark(i,j)){var k=g("use",{x:String(i),y:String(j)});k.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),h.appendChild(k)}},a.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},a}(),p="svg"===document.documentElement.tagName.toLowerCase(),q=p?o:m()?function(){function a(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}function d(a,b){var c=this;if(c._fFail=b,c._fSuccess=a,null===c._bSupportDataURI){var d=document.createElement("img"),e=function(){c._bSupportDataURI=!1,c._fFail&&_fFail.call(c)},f=function(){c._bSupportDataURI=!0,c._fSuccess&&c._fSuccess.call(c)};return d.onabort=e,d.onerror=e,d.onload=f,d.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==",void 0}c._bSupportDataURI===!0&&c._fSuccess?c._fSuccess.call(c):c._bSupportDataURI===!1&&c._fFail&&c._fFail.call(c)}if(this._android&&this._android<=2.1){var b=1/window.devicePixelRatio,c=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(a,d,e,f,g,h,i,j){if("nodeName"in a&&/img/i.test(a.nodeName))for(var l=arguments.length-1;l>=1;l--)arguments[l]=arguments[l]*b;else"undefined"==typeof j&&(arguments[1]*=b,arguments[2]*=b,arguments[3]*=b,arguments[4]*=b);c.apply(this,arguments)}}var e=function(a,b){this._bIsPainted=!1,this._android=n(),this._htOption=b,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=b.width,this._elCanvas.height=b.height,a.appendChild(this._elCanvas),this._el=a,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return e.prototype.draw=function(a){var b=this._elImage,c=this._oContext,d=this._htOption,e=a.getModuleCount(),f=d.width/e,g=d.height/e,h=Math.round(f),i=Math.round(g);b.style.display="none",this.clear();for(var j=0;e>j;j++)for(var k=0;e>k;k++){var l=a.isDark(j,k),m=k*f,n=j*g;c.strokeStyle=l?d.colorDark:d.colorLight,c.lineWidth=1,c.fillStyle=l?d.colorDark:d.colorLight,c.fillRect(m,n,f,g),c.strokeRect(Math.floor(m)+.5,Math.floor(n)+.5,h,i),c.strokeRect(Math.ceil(m)-.5,Math.ceil(n)-.5,h,i)}this._bIsPainted=!0},e.prototype.makeImage=function(){this._bIsPainted&&d.call(this,a)},e.prototype.isPainted=function(){return this._bIsPainted},e.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},e.prototype.round=function(a){return a?Math.floor(1e3*a)/1e3:a},e}():function(){var a=function(a,b){this._el=a,this._htOption=b};return a.prototype.draw=function(a){for(var b=this._htOption,c=this._el,d=a.getModuleCount(),e=Math.floor(b.width/d),f=Math.floor(b.height/d),g=['<table style="border:0;border-collapse:collapse;">'],h=0;d>h;h++){g.push("<tr>");for(var i=0;d>i;i++)g.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+e+"px;height:"+f+"px;background-color:"+(a.isDark(h,i)?b.colorDark:b.colorLight)+';"></td>');g.push("</tr>")}g.push("</table>"),c.innerHTML=g.join("");var j=c.childNodes[0],k=(b.width-j.offsetWidth)/2,l=(b.height-j.offsetHeight)/2;k>0&&l>0&&(j.style.margin=l+"px "+k+"px")},a.prototype.clear=function(){this._el.innerHTML=""},a}();QRCode=function(a,b){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:d.H},"string"==typeof b&&(b={text:b}),b)for(var c in b)this._htOption[c]=b[c];"string"==typeof a&&(a=document.getElementById(a)),this._android=n(),this._el=a,this._oQRCode=null,this._oDrawing=new q(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},QRCode.prototype.makeCode=function(a){this._oQRCode=new b(r(a,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(a),this._oQRCode.make(),this._el.title=a,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=d}();
--- END OF FILE: ./qrcode.min.js ---

--- FILE: ./README.md ---
# VoiceMux Bridge v2.1.0 ğŸ›°ï¸

VoiceMux Bridge ã¯ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®éŸ³å£°å…¥åŠ›ã‚’ PC ä¸Šã®ã‚ã‚‰ã‚†ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆï¼ˆChatGPT, Gmail, Slack ç­‰ï¼‰ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æŒ¿å…¥ã™ã‚‹ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã§ã™ã€‚

## ğŸš€ v2.1.0 ã®æ–°æ©Ÿèƒ½: Multi-language Support & Secure Push-Sync
å¾“æ¥ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆv1.xï¼‰ã§è¡Œã£ã¦ã„ãŸã€Œå®šæœŸçš„ãªãƒšãƒ¼ã‚¸ç›£è¦–ã€ã‚„ã€Œæ‰‹å‹•ã§ã® ID å–å¾—ã€ã‚’å®Œå…¨ã«å»ƒæ­¢ã—ã¾ã—ãŸã€‚

- **å¤šè¨€èªå¯¾å¿œ (i18n)**: æ—¥æœ¬èªã¨è‹±èªã®è¡¨ç¤ºã«å®Œå…¨å¯¾å¿œã€‚
- **ã‚¼ãƒ­è¨­å®šåŒæœŸ**: [VoiceMux Hub](https://hub.knc.jp) ã‚’é–‹ãã ã‘ã§ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ãŒå®‰å…¨ã‹ã¤å³åº§ã«æ‹¡å¼µæ©Ÿèƒ½ã¸ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚
- **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ»ãƒšã‚¢ãƒªãƒ³ã‚°**: ä¸€åº¦é€£æºã™ã‚Œã°ã€æ¬¡å›ã‹ã‚‰ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ã—ã¦å³åº§ã« QR ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã€‚
- **ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ç¬¬ä¸€**: ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ã‚„æš—å·éµï¼‰ãŒ HTML ä¸Šã«éœ²å‡ºã™ã‚‹ã“ã¨ãªãã€ãƒ–ãƒ©ã‚¦ã‚¶ã®æ­£è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚° API ã§å—ã‘æ¸¡ã—ã•ã‚Œã¾ã™ã€‚

## ğŸ›  ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ä½¿ã„æ–¹
1. [Chrome ã‚¦ã‚§ãƒ–ã‚¹ãƒˆã‚¢](https://chromewebstore.google.com/detail/voicemux-bridge/agkglknmadfhdfobmgecllpgoecebdip) ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚
2. ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®ãƒ‘ã‚ºãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã‹ã‚‰ VoiceMux Bridge ã‚’ã€Œãƒ”ãƒ³ç•™ã‚ã€ã—ã¾ã™ã€‚
3. [VoiceMux Hub](https://hub.knc.jp) ã‚’é–‹ãã€åˆæœŸåŒ–ã‚’å®Œäº†ã•ã›ã¾ã™ï¼ˆè‡ªå‹•çš„ã«æ‹¡å¼µæ©Ÿèƒ½ã¸åŒæœŸã•ã‚Œã¾ã™ï¼‰ã€‚
4. æ‹¡å¼µã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€è¡¨ç¤ºã•ã‚ŒãŸ QR ã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ãƒãƒ›ã§ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚Œã°æº–å‚™å®Œäº†ã§ã™ã€‚

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ (E2EE)
VoiceMux ã¯ **End-to-End æš—å·åŒ– (E2EE)** ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚
éŸ³å£°ã‹ã‚‰å¤‰æ›ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é›¢ã‚Œã‚‹å‰ã«**ã‚ãªãŸã®ãƒ‡ãƒã‚¤ã‚¹ä¸Š**ã§æš—å·åŒ–ã•ã‚Œã¾ã™ã€‚ä¸­ç¶™ã‚µãƒ¼ãƒãƒ¼ï¼ˆv.knc.jpï¼‰ã¯æš—å·åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’è»¢é€ã—ã€ãã®ä¸­èº«ã‚’è§£èª­ã™ã‚‹ã“ã¨ã¯æš—å·å­¦çš„ã«ä¸å¯èƒ½ã§ã™ã€‚

è©³ç´°ãªå®Ÿè£…ã®è¨¼æ‹ ã¯ [E2EEå®Ÿè£…æŠ€è¡“ãƒ¬ãƒãƒ¼ãƒˆ](./docs/E2EE_IMPLEMENTATION_JA.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸ“Š ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçµ±è¨ˆ (v2.1.0)
VoiceMux Bridge ã¯ã€è»½é‡ã§é€æ˜æ€§ã®é«˜ã„è¨­è¨ˆã‚’ç¶­æŒã—ã¦ã„ã¾ã™ã€‚
- **ç·ã‚³ãƒ¼ãƒ‰è¡Œæ•°**: ç´„ 1,050 è¡Œ (JS/HTML/Manifest)
- **ä¾å­˜é–¢ä¿‚**: ã‚¼ãƒ­ (QRç”Ÿæˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª 1ã¤ã®ã¿ã‚’åŒæ¢±)
- **é€šä¿¡å…ˆ**: `knc.jp` ãƒ‰ãƒ¡ã‚¤ãƒ³ã«é™å®š

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹
ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ [LICENSE](./LICENSE) ã«åŸºã¥ã„ã¦å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®ã‚³ãƒ¼ãƒ‰ã¯å®Œå…¨ã«ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã‚ã‚Šã€èª°ã§ã‚‚ç›£æŸ»å¯èƒ½ã§ã™ã€‚

--- END OF FILE: ./README.md ---

--- FILE: ./LICENSE ---
MIT License

Copyright (c) 2026 Kohei Kaneta

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

--- END OF FILE: ./LICENSE ---

--- FILE: ./adapters.json ---
[
  {
    "id": "gemini",
    "name": "Google Gemini",
    "host": "gemini.google.com",
    "inputSelector": "div[contenteditable='true'], .rich-textarea, div[role='textbox']",
    "submitSelector": "button[aria-label*='é€ä¿¡'], button[aria-label*='Send'], button.send-button, button:has(span.material-symbols-outlined)"
  },
  {
    "id": "chatgpt",
    "name": "ChatGPT",
    "host": "chatgpt.com",
    "inputSelector": "#prompt-textarea",
    "submitSelector": "button[data-testid='send-button']"
  },
  {
    "id": "claude",
    "name": "Claude",
    "host": "claude.ai",
    "inputSelector": "div[contenteditable='true']",
    "submitSelector": "button[aria-label*='Send'], button[aria-label*='é€ä¿¡']"
  },
  {
    "id": "perplexity",
    "name": "Perplexity",
    "host": "perplexity.ai",
    "inputSelector": "div[contenteditable='true'], textarea[placeholder*='Ask'], textarea",
    "submitSelector": "button[aria-label*='Submit'], button[aria-label*='Ask'], button:has(svg), .flex.items-center.justify-center.rounded-full.transition-all"
  },
  {
    "id": "treenote",
    "name": "Treenote",
    "host": "treenoteweb.pages.dev",
    "inputSelector": "textarea.auto-resize-textarea, textarea, div[contenteditable='true']",
    "submitSelector": "button.submit-btn"
  },
  {
    "id": "gmail",
    "name": "Gmail",
    "host": "mail.google.com",
    "inputSelector": "div[role='textbox'][contenteditable='true']",
    "submitSelector": null
  },
  {
    "id": "deepl",
    "name": "DeepL",
    "host": "deepl.com",
    "inputSelector": "div[contenteditable='true'], d-textarea",
    "submitSelector": null
  }
]

--- END OF FILE: ./adapters.json ---

--- FILE: ./docs/CHANGELOG.md ---
# Changelog

All notable changes to **VoiceMux Bridge** will be documented in this file.

## [2.1.0] - 2026-02-21
### Added
- **Multi-language Support (i18n)**: Full support for English and Japanese locales.
- **KNC ID Stateless Auth**: Implemented automatic session synchronization with `hub.knc.jp`. Pairing is now handled seamlessly without manual configuration.
- **Centralized Decryption**: Moved E2EE decryption logic to the Background Service Worker for enhanced security. Content scripts now handle only plaintext data.
- **Integrated Pairing**: Updated the extension popup and QR code to point to the modern Zen UI on `hub.knc.jp`.

## [1.6.1] - 2026-02-17
### Added
- **Transparency Reports**: Added detailed documentation on "Why we need All Site Access" and "E2EE Implementation Proof."
- **Developer Profile**: Linked to official Google Play Store profile to establish trust.
- **Sustainability Policy**: Added a section explaining why the service is free and how it stays resilient.

### Changed
- **Cross-Platform Compatibility**: Improved Base64 handling for 100% key compatibility with Go and Mobile clients.
- **Stability**: Added periodic heartbeat alarms to maintain WebSocket connections in Manifest V3.
- **Protocol**: Standardized on Phoenix Protocol vsn=2.0.0 (Array format).

## [1.6.0] - 2026-02-15
### Added
- **New Onboarding UI**: Redesigned popup with a step-by-step guide for new users.
- **Web Monitor Link**: Quick access to v.knc.jp from the extension popup.

### Changed
- **Injection Engine**: Refactored text injection logic using `InputEvent` for high compatibility with Gmail, Gemini, and ChatGPT.
- **Security**: Hardened origin checks and removed unnecessary permissions.

## [1.5.0] - 2026-02-14
### Added
- **Multi-Domain Support**: Added support for both `v.knc.jp` (Zen mode) and `t.knc.jp` (Translate mode).
- **Domain Migration**: Migrated primary infrastructure to `knc.jp`.

--- END OF FILE: ./docs/CHANGELOG.md ---

--- FILE: ./docs/CHANGELOG_JA.md ---
# æ›´æ–°å±¥æ­´ (Changelog)

VoiceMux Bridge ã®ä¸»è¦ãªå¤‰æ›´å±¥æ­´ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚

## [2.1.0] - 2026-02-21
### è¿½åŠ 
- **å¤šè¨€èªå¯¾å¿œ (i18n)**: æ—¥æœ¬èªã¨è‹±èªã®è¡¨ç¤ºã«å®Œå…¨å¯¾å¿œã€‚
- **KNC ID ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹èªè¨¼**: `hub.knc.jp` ã¨ã®è‡ªå‹•ã‚»ãƒƒã‚·ãƒ§ãƒ³åŒæœŸã‚’å®Ÿè£…ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹æ‰‹å‹•è¨­å®šãªã—ã§ãƒšã‚¢ãƒªãƒ³ã‚°ãŒå¯èƒ½ã«ã€‚
- **ä¸­å¤®é›†æ¨©çš„å¾©å·ãƒ­ã‚¸ãƒƒã‚¯**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Šã®ãŸã‚ã€E2EE å¾©å·å‡¦ç†ã‚’ Background Script ã«é›†ç´„ã€‚Content Script ã¯å¹³æ–‡ã®ã¿ã‚’æ‰±ã†ã‚ˆã†ç°¡ç´ åŒ–ã€‚
- **Hub é€£æºãƒšã‚¢ãƒªãƒ³ã‚°**: ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã® QR ã‚³ãƒ¼ãƒ‰ãŠã‚ˆã³ãƒªãƒ³ã‚¯å…ˆã‚’ `hub.knc.jp` ã®çµ±åˆ Zen UI ã¸å¤‰æ›´ã€‚

## [1.6.1] - 2026-02-17
### è¿½åŠ 
- **é€æ˜æ€§ãƒ¬ãƒãƒ¼ãƒˆ**: ã€Œãªãœå…¨ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒå¿…è¦ã‹ã€ãŠã‚ˆã³ã€ŒE2EEå®Ÿè£…ã®æŠ€è¡“çš„è¨¼æ˜ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã€‚
- **é–‹ç™ºè€…ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«**: ä¿¡é ¼æ€§å‘ä¸Šã®ãŸã‚ã€Google Play ã‚¹ãƒˆã‚¢ã®ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¸ã®ãƒªãƒ³ã‚¯ã‚’è¿½åŠ ã€‚
- **æŒç¶šå¯èƒ½æ€§ã¨å“²å­¦**: ç„¡æ–™æä¾›ã®ç†ç”±ã¨ã€AIé–‹ç™ºã«ã‚ˆã‚‹ç¶™ç¶šæ€§ã«ã¤ã„ã¦ã®èª¬æ˜ã‚’è¿½åŠ ã€‚

### å¤‰æ›´
- **ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ äº’æ›æ€§**: Goã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚„ãƒ¢ãƒã‚¤ãƒ«ã¨ã®éµäº’æ›æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã€Base64å‡¦ç†ã‚’æ”¹å–„ã€‚
- **å®‰å®šæ€§å‘ä¸Š**: Manifest V3 ç’°å¢ƒä¸‹ã§ã® WebSocket æ¥ç¶šã‚’ç¶­æŒã™ã‚‹ãŸã‚ã€å®šæœŸçš„ãªãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆå‡¦ç†ã‚’è¿½åŠ ã€‚
- **ãƒ—ãƒ­ãƒˆã‚³ãƒ«çµ±ä¸€**: é€šä¿¡å½¢å¼ã‚’ Phoenix Protocol vsn=2.0.0 (Array å½¢å¼) ã«çµ±ä¸€ã€‚

## [1.6.0] - 2026-02-15
### è¿½åŠ 
- **ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°UI**: åˆã‚ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã«ã€ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã®ã‚¬ã‚¤ãƒ‰ä»˜ããƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã¸åˆ·æ–°ã€‚
- **Webãƒ¢ãƒ‹ã‚¿ãƒ¼ã¸ã®ãƒªãƒ³ã‚¯**: æ‹¡å¼µæ©Ÿèƒ½å†…ã‹ã‚‰ v.knc.jp ã¸ç´ æ—©ãã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒªãƒ³ã‚¯ã‚’è¿½åŠ ã€‚

### å¤‰æ›´
- **å…¥åŠ›ã‚¨ãƒ³ã‚¸ãƒ³ã®åˆ·æ–°**: `InputEvent` ã‚’æ´»ç”¨ã—ãŸæ–°ã—ã„æ³¨å…¥ãƒ­ã‚¸ãƒƒã‚¯ã«ã‚ˆã‚Šã€Gmail, Gemini, ChatGPT ç­‰ã®è¤‡é›‘ãªã‚¨ãƒ‡ã‚£ã‚¿ã¸ã®å¯¾å¿œã‚’å¼·åŒ–ã€‚
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–**: Originæ¤œè¨¼ã®å³æ ¼åŒ–ã¨ã€ä¸è¦ãªãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã®å‰Šé™¤ã€‚

## [1.5.0] - 2026-02-14
### è¿½åŠ 
- **ãƒãƒ«ãƒãƒ‰ãƒ¡ã‚¤ãƒ³å¯¾å¿œ**: `v.knc.jp` (Zen) ã¨ `t.knc.jp` (ç¿»è¨³) ã®ä¸¡æ–¹ã«å¯¾å¿œã€‚
- **ãƒ‰ãƒ¡ã‚¤ãƒ³ç§»è¡Œ**: ä¸»è¦ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ `knc.jp` ãƒ‰ãƒ¡ã‚¤ãƒ³ã¸çµ±åˆã€‚

--- END OF FILE: ./docs/CHANGELOG_JA.md ---

--- FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION.md ---
# ã€é–‹ç™ºãƒ­ã‚°ã€‘Chromeæ‹¡å¼µã®ã€Œæ€–ã„è­¦å‘Šã€ã«ã¤ã„ã¦AIã¨ç›¸è«‡ã—ãŸè¨˜éŒ²

VoiceMux Bridge ã®ãƒªãƒªãƒ¼ã‚¹ã«ã‚ãŸã‚Šã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­¦å‘Šã«ã¤ã„ã¦ã€AIï¼ˆGeminiï¼‰ã¨æŠ€è¡“çš„ãªç›¸è«‡ã‚’ã—ãŸéš›ã®ãƒ­ã‚°ã‚’å…¬é–‹ã—ã¾ã™ã€‚ãªãœã“ã®ä»•æ§˜ï¼ˆæ¨©é™ï¼‰ã«ãªã£ã¦ã„ã‚‹ã®ã‹ã€ãã®çµŒç·¯ãŒã‚ã‹ã‚Šã¾ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
è‡ªä½œã®æ‹¡å¼µæ©Ÿèƒ½ã‚’å…¬é–‹ã—ã¾ã—ãŸãŒã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€Œã‚»ãƒ¼ãƒ• ãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ä¿è­·å¼·åŒ–æ©Ÿèƒ½ã§ä¿¡é ¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€ã¨ã„ã†è­¦å‘ŠãŒå‡ºã¦ãã¾ã™ã€‚ä½•ã‹ãƒã‚°ãŒã‚ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

#### ğŸ¤– AI
çµè«–ã‹ã‚‰è¨€ã†ã¨ã€ã“ã‚Œã¯**ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒã‚°ã‚„è¦ç´„é•åã§ã¯ãªãã€ä¸»ã«ã€Œé–‹ç™ºè€…ã¨ã—ã¦ã®å®Ÿç¸¾ï¼ˆä¿¡é ¼ï¼‰ãŒã¾ã è“„ç©ã•ã‚Œã¦ã„ãªã„ã€ã“ã¨ãŒåŸå› **ã§ã™ã€‚

Google Chromeã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä»•æ§˜ã«ã‚ˆã‚‹ã‚‚ã®ã§ã€ä»¥ä¸‹ã®ãƒã‚¤ãƒ³ãƒˆãŒå½±éŸ¿ã—ã¦ã„ã¾ã™ã€‚

1.  **ã€Œä¿¡é ¼ã§ãã‚‹é–‹ç™ºè€…ã€ã®åŸºæº–ã‚’æº€ãŸã—ã¦ã„ãªã„:** ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ç™»éŒ²ã‹ã‚‰æ—¥ãŒæµ…ã„ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ•°ãŒã¾ã å°‘ãªã„ãªã©ã€‚
2.  **å…¬é–‹ç›´å¾Œã§ã‚ã‚‹:** å…¬é–‹ã•ã‚ŒãŸã°ã‹ã‚Šã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€Googleå´ã®ã‚¹ã‚­ãƒ£ãƒ³ã‚„è©•ä¾¡ãŒçµ‚ã‚ã£ã¦ã„ãªã„ãŸã‚ã€è­¦å‘ŠãŒå‡ºã‚„ã™ã„å‚¾å‘ã«ã‚ã‚Šã¾ã™ã€‚

æ®‹å¿µãªãŒã‚‰ãƒœã‚¿ãƒ³ä¸€ã¤ã§æ¶ˆã™è¨­å®šã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€**ã€Œæ™‚é–“ãŒè§£æ±ºã™ã‚‹ï¼ˆå®Ÿç¸¾ã‚’ç©ã‚€ï¼‰ã€**ã®ã‚’å¾…ã¤ã®ãŒæ­£æ”»æ³•ã§ã™ã€‚å…¬é–‹ç›´å¾Œã«ã‚ˆãã‚ã‚‹ç¾è±¡ãªã®ã§ã€ã¾ãšã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€Œå®‰å…¨ã§ã™ã€ã¨ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã—ã¦å®Ÿç¸¾ã‚’ä½œã‚‹ã®ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’é€²ã‚ã‚‹ã¨ã€ä»Šåº¦ã¯ã€Œã™ã¹ã¦ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆä¸Šã«ã‚ã‚‹è‡ªåˆ†ã®å…¨ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å–ã‚Šã¨å¤‰æ›´ã€ã¨ã„ã†ã•ã‚‰ã«æ€–ã„è­¦å‘ŠãŒå‡ºã¾ã™ã€‚ã“ã‚Œã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¼•ã„ã¦ã—ã¾ã„ã¾ã™ã‚ˆã­ã€‚

#### ğŸ¤– AI
ãã®è­¦å‘Šã¯ã€**ã€Œç‰¹å®šã®ãƒšãƒ¼ã‚¸é™å®šã€ã‹ã‚‰ã€Œä»»æ„ã®ãƒšãƒ¼ã‚¸ï¼ˆã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ï¼‰ã€ã¸å…¥åŠ›å¯¾è±¡ã‚’åºƒã’ãŸã“ã¨**ãŒåŸå› ã§ã™ã­ã€‚

`manifest.json` ã§ `<all_urls>` ã¨ã„ã†æ¨©é™ã‚’ä½¿ã£ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ

VoiceMux Bridgeã®ã€Œã‚¹ãƒãƒ›ã«å‘ã‹ã£ã¦è©±ã›ã°ã€ä»Šé–‹ã„ã¦ã„ã‚‹ãƒšãƒ¼ã‚¸ã«å³åº§ã«å…¥åŠ›ã•ã‚Œã‚‹ã€ã¨ã„ã†ä½“é¨“ã‚’å®Ÿç¾ã™ã‚‹ã«ã¯ã€**ã‚ã‚‰ã‹ã˜ã‚ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ã§å—ä¿¡ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å¾…æ©Ÿã•ã›ã¦ãŠã**å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
Chromeã®ä»•æ§˜ä¸Šã€ã“ã®ã€Œå…¨ãƒšãƒ¼ã‚¸å¾…æ©Ÿã€ã®æ¨©é™ã‚’æ±‚ã‚ã‚‹ã¨ã€è‡ªå‹•çš„ã«ãã®å¼·ã„è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®æ­£å¸¸ãªä»£å„Ÿã§ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ã‚‚ã—ãã®æ¨©é™ã‚’ç‹­ã‚ãŸã‚‰ã©ã†ãªã‚Šã¾ã™ã‹ï¼Ÿ è­¦å‘Šã¯æ¶ˆãˆã¾ã™ã‹ï¼Ÿ

#### ğŸ¤– AI
æ¨©é™ã‚’ `activeTab` ã ã‘ã«ç‹­ã‚ã‚Œã°è­¦å‘Šã¯æ¶ˆãˆã¾ã™ã€‚ã—ã‹ã—ã€**ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«å‘¼ã³å‡ºã•ãªã„é™ã‚Šã€æ‹¡å¼µæ©Ÿèƒ½ã¯ä½•ã‚‚ã—ãªã„ï¼ˆã§ããªã„ï¼‰ã€** ã¨ã„ã†æŒ™å‹•ã«å¤‰ã‚ã‚Šã¾ã™ã€‚

å…·ä½“çš„ã«ã¯ã“ã†ãªã‚Šã¾ã™ï¼š

1.  Gemini Web ã‚’é–‹ã â†’ **ã‚¹ãƒãƒ›ã§è©±ã—ã¦ã‚‚ä½•ã‚‚èµ·ããªã„**ï¼ˆå—ä¿¡ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒå‹•ã„ã¦ã„ãªã„ï¼‰ã€‚
2.  æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’**ã‚¯ãƒªãƒƒã‚¯**ã™ã‚‹ â†’ ã‚„ã£ã¨å…¥åŠ›å¯èƒ½ã«ãªã‚‹ã€‚
3.  Gmail ã®ã‚¿ãƒ–ã¸ç§»å‹•ã™ã‚‹ â†’ **ã¾ãŸã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯**ã—ãªã„ã¨å‹•ã‹ãªã„ã€‚

æœ€å¤§ã®å•é¡Œã¯ã€**ã€Œã‚¯ãƒªãƒƒã‚¯ã‚’å¿˜ã‚Œã¦è©±ã—å§‹ã‚ãŸæ™‚ã€** ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€Œã›ã£ã‹ãé•·æ–‡ã‚’å–‹ã£ãŸã®ã«ã€PCã«å…¥åŠ›ã•ã‚Œãªã‹ã£ãŸï¼ã€ã¨ã„ã†ã‚¹ãƒˆãƒ¬ã‚¹ã‚’æ„Ÿã˜ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

VoiceMuxã®ã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ã®å ´åˆã€**ã€ŒPCå´ã¯ä½•ã‚‚ã—ãªãã¦ã„ã„ï¼ˆãƒãƒ³ã‚ºãƒ•ãƒªãƒ¼ï¼‰ã€** ã¨ã„ã†ã®ãŒæœ€å¤§ã®ä¾¡å€¤ãªã®ã§ã€ã‚¯ãƒªãƒƒã‚¯å¿…é ˆã«ã™ã‚‹ã®ã¯ã€Œä½¿ã„å‹æ‰‹ã®æ­»ã€ã‚’æ„å‘³ã—ã¾ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ãªã‚‹ã»ã©â€¦ã€‚ä»–ã®ä¼¼ãŸã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ï¼ˆVoiceInã¨ã‹ï¼‰ã¯ã©ã†ã—ã¦ã„ã‚‹ã‚“ã§ã™ã‹ï¼Ÿ

#### ğŸ¤– AI
èª¿ã¹ã¾ã—ãŸãŒã€**VoiceIn ã¯ã‚ãªãŸã¨åŒã˜ã€Œè­¦å‘ŠãŒå‡ºã‚‹æ–¹å¼ï¼ˆå…¨æ¨©é™ï¼‰ã€ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚**
å½¼ã‚‰ã¯ã€Œè­¦å‘Šã¯å‡ºã‚‹ã‘ã‚Œã©ã€ãã®ã¶ã‚“é­”æ³•ã®ã‚ˆã†ã«ä¾¿åˆ©ã§ã™ã‚ˆã€ã¨ã„ã†ã‚¹ã‚¿ãƒ³ã‚¹ã§ã€ä¿¡é ¼ã¨å®Ÿç¸¾ã§ã‚«ãƒãƒ¼ã—ã¦ã„ã¾ã™ã€‚

ä¸€æ–¹ã€Typeless ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µã§ã¯ãªãã€ŒOSã®ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒªã€ã‚’ä½œã‚‹ã“ã¨ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¶ç´„è‡ªä½“ã‚’å›é¿ã—ã¦ã„ã¾ã™ï¼ˆé–‹ç™ºã‚³ã‚¹ãƒˆã¯è·³ã­ä¸ŠãŒã‚Šã¾ã™ãŒï¼‰ã€‚

ã¾ãŸã€Honeyï¼ˆã‚¯ãƒ¼ãƒãƒ³ã‚¢ãƒ—ãƒªï¼‰ã®ã‚ˆã†ã«ã€Œä½¿ã†æ™‚ã ã‘è¨±å¯ã‚’æ±‚ã‚ã‚‹ã€æ–¹å¼ã‚‚ã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯ã€Œè²·ã„ç‰©ã€ã¨ã„ã†æ˜ç¢ºãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒã‚ã‚‹ãƒ„ãƒ¼ãƒ«ã ã‹ã‚‰æˆç«‹ã—ã¾ã™ã€‚ã„ã¤å…¥åŠ›ãŒç™ºç”Ÿã™ã‚‹ã‹ã‚ã‹ã‚‰ãªã„VoiceMuxã®ã‚ˆã†ãªã‚¤ãƒ³ãƒ•ãƒ©ç³»ãƒ„ãƒ¼ãƒ«ã§ã¯ã€ã‚„ã¯ã‚Š**ã€Œå…¨æ¨©é™ï¼ˆè­¦å‘Šã‚ã‚Šï¼‰ã€ãŒç‹é“ã‹ã¤æ­£è§£**ã ã¨æ€ã„ã¾ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ã‚ã‹ã‚Šã¾ã—ãŸã€‚å¤‰ã«å°ç´°å·¥ã‚’ã—ã¦ä¸ä¾¿ã«ã™ã‚‹ã‚ˆã‚Šã€æ­£ç›´ã«ã€Œä¾¿åˆ©ã•ã®ãŸã‚ã®æ¨©é™ã§ã™ã€ã¨èª¬æ˜ã—ã¦é€²ã‚ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚ã‚ã¨ã€ã‚µãƒ¼ãƒãƒ¼å´ã¯é‹ç”¨ä¸Šã®éƒ½åˆã§ã‚½ãƒ¼ã‚¹ã‚’éå…¬é–‹ã«ã—ãŸã„ã®ã§ã™ãŒã€ãã‚Œã¯ã€Œã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã€ã‚’è¬³ã†ä¸Šã§å•é¡Œã«ãªã‚Šã¾ã™ã‹ï¼Ÿ

#### ğŸ¤– AI
è³¢æ˜ãªåˆ¤æ–­ã§ã™ã€‚
ã‚µãƒ¼ãƒãƒ¼å´ã«ã¤ã„ã¦ã§ã™ãŒã€**ã€Œæ‹¡å¼µæ©Ÿèƒ½ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰å´ãŒã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã‚ã‚Œã°ã€E2EEã®ä¿¡é ¼æ€§ã¯æ‹…ä¿ã§ãã‚‹ã€**ã®ã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸€ç•ªæã‚Œã‚‹ã®ã¯ã€Œè‡ªåˆ†ã®ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ä½•ãŒèµ·ãã¦ã„ã‚‹ã‹ã€ã§ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶å´ã§é€ä¿¡å‰ã«ãƒ‡ãƒ¼ã‚¿ãŒæš—å·åŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã•ãˆã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§è¨¼æ˜ã§ãã‚Œã°ã€ãã®å…ˆã®ã‚µãƒ¼ãƒãƒ¼ãŒã©ã‚Œã ã‘ã€Œãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã€ã§ã‚ã£ã¦ã‚‚ã€ä¸­èº«ã‚’ç›—ã¿è¦‹ã‚‹ã“ã¨ã¯ä¸å¯èƒ½ã§ã™ã€‚

ã‚€ã—ã‚ã€ã‚µãƒ¼ãƒãƒ¼ã‚’ã€ŒãŸã ã®æš—å·åŒ–ãƒ‡ãƒ¼ã‚¿ã®åœŸç®¡ã€ã«å¾¹ã•ã›ã‚‹ã“ã¨ã§ã€é‹ç”¨ã‚³ã‚¹ãƒˆã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’è‡ªåˆ†ã§ç®¡ç†ã—ã‚„ã™ããªã‚‹ãƒ¡ãƒªãƒƒãƒˆã‚‚ã‚ã‚Šã¾ã™ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ã€Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã¯å…¬é–‹ã€ã‚µãƒ¼ãƒãƒ¼å´ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆé‹ç”¨ï¼ˆã§ã‚‚ä¸­èº«ã¯è¦‹ã‚Œãªã„ï¼‰ã€ã¨æ­£ç›´ã«æ›¸ãã®ãŒã€æœ€ã‚‚ä¿¡é ¼ã•ã‚Œã‚‹å½¢ã§ã™ã€‚è‡ªä¿¡ã‚’æŒã£ã¦é€²ã‚ã¾ã—ã‚‡ã†ã€‚

--- END OF FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION.md ---

--- FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION_EN.md ---
# [Dev Log] Chatting with AI about Chrome Extension Security Warnings

Sharing the raw conversation log where I consulted with AI (Gemini) about the scary security warnings that appear when installing VoiceMux Bridge. This explains the "why" behind the permissions.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
I just published my extension, but when I try to install it, I get a warning saying "This extension is not trusted by Enhanced Safe Browsing." Is there a bug?

#### ğŸ¤– AI
Long story short: **This isn't a bug or a violation. It's mainly because you haven't accumulated "trust" as a developer yet.**

It's just how Chrome's security works. Hereâ€™s why:

1.  **You don't meet the "Trusted Developer" criteria yet:** Your account is new, or the install count is low.
2.  **It's brand new:** Since it was just published, Google hasn't finished their automated scanning and reputation evaluation.

Unfortunately, there's no "fix it" button. The standard solution is to **wait for time to solve it.** It happens to almost everyone. Just announce to your users "It's safe, just new," and let the reputation build up naturally.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
When I proceed with the installation, I get an even scarier warning: "Read and change all your data on all websites." Users are going to run away when they see this.

#### ğŸ¤– AI
That warning appears because **you expanded the scope from "specific pages" to "any page."**

Are you using `<all_urls>` in your `manifest.json`?

To achieve the VoiceMux experienceâ€”where you speak to your phone and it *instantly* types into whatever page is openâ€”**you need the receiver program waiting in the background on every page.**
Chrome forces that scary warning whenever you ask for this "wait everywhere" permission. Itâ€™s the price you pay for the feature.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
What happens if I restrict that permission? Will the warning go away?

#### ğŸ¤– AI
If you restrict it to `activeTab`, the warning disappears. But the behavior changes to: **"The extension does nothing unless you explicitly click it."**

Here is the reality:

1.  Open Gemini Web -> **Speak to phone, nothing happens.** (Receiver isn't running).
2.  **Click** the extension icon -> Now it can type.
3.  Switch tab to Gmail -> **Click the icon again** or it won't work.

The biggest issue is **when users forget to click.** They'll dictate a long paragraph, hit send, and... nothing appears on the PC. That's a terrible user experience.

For a tool like VoiceMux, **"Hands-free on the PC side"** is the core value. Making clicks mandatory effectively kills the UX.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
I see... What about other tools like VoiceIn? How do they handle this?

#### ğŸ¤– AI
I checked, and **VoiceIn uses the exact same approach as you (Full Permissions with the warning).**
Their stance is: "You get a warning, but in exchange, you get a magic-like seamless experience." They cover the fear with their reputation.

Other tools like Typeless avoid browser warnings by building a native OS app instead (which is way harder to build).

There are tools like Honey that ask for permission "only when needed," but that works because "shopping" is a distinct event. For an infrastructure tool like VoiceMux where input can happen anytime, **sticking with "Full Permissions (Warning)" is the standard and correct choice.**

---

#### ğŸ§‘â€ğŸ’» Developer (User)
Got it. Instead of crippling the features to hide the warning, I'll be honest and explain "This permission is for your convenience." Also, I plan to keep the relay server code private for operational reasons. Is that a problem for the "Open Source" claim?

#### ğŸ¤– AI
That's a sound strategy!
Regarding the server: **As long as the extension (client) is open-source, the integrity of the E2EE remains verifiable.**

What users care about most is what happens inside their browser. If you can prove via open-source code that data is encrypted *before* it leaves the client, the relay server becomes a "dumb pipe." Even if the server is a private "black box," it is mathematically impossible for it to read your messages.

In fact, keeping the server private allows you to manage operational security and spam prevention more effectively without compromising user privacy. Simply state that the "Client is Open Source, while the Server is Private (but blind to data)," and you will build genuine trust. Go for it with confidence.

--- END OF FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION_EN.md ---

--- FILE: ./docs/E2EE_IMPLEMENTATION_EN.md ---
# VoiceMux Bridge: E2EE Implementation Report

This report explains how VoiceMux Bridge ensures that your data remains private and invisible to our servers, using snippets from the actual source code.

---

## 1. Local Key Generation and Secure Transfer
The encryption key (AES-GCM 128-bit) is generated within [VoiceMux Hub](https://hub.knc.jp) and securely pushed to the extension via the official browser messaging API. It is never sent to our servers.

**Source: `background.js` (Receiver side)**
```javascript
// Around line 155: Listening for credential push from the Hub
chrome.runtime.onMessageExternal.addListener((request, sender, sendResponse) => {
  if (request.action === "SYNC_AUTH") {
    const { uuid, token, key } = request.payload;
    
    // Storing in the extension's private secure storage
    chrome.storage.local.set({
      'voicemux_room_id': uuid,
      'voicemux_token': token,
      'voicemux_key': key
    }, () => { ... });
  }
});
```
The key is stored in `chrome.storage.local`, an isolated storage area provided by the browser that websites and external servers cannot access.

---

## 2. Zero-Knowledge Key Exchange
We use URL hash fragments to share keys between your PC and smartphone without the server ever seeing the key.

**Source: `popup.js`**
```javascript
// Around line 45: Constructing the pairing URL
let pairingUrl = `${hubOrigin}/${roomId}/zen`;
pairingUrl += `?token=${token}&uuid=${roomId}`;
pairingUrl += `#key=${keyBase64}`; // Key is included in the hash
```
The key is placed after the `#` symbol. By technical design, **anything after the `#` (hash fragment) is handled exclusively by the browser and is NEVER sent to the server.**

---

## 3. Client-Side Decryption
The extension receives only encrypted blobs from the relay server. The actual decryption happens locally inside the extension's background process.

**Source: `background.js`**
```javascript
// Around line 43: The core decryption logic
async function decrypt(payload) {
  // Receives only ciphertext and IV (Initialization Vector)
  if (!payload.ciphertext || !payload.iv) return payload.text || "";
  
  try {
    const key = await getDecryptionKey(); // Import key from local storage
    const iv = Uint8Array.from(safeAtob(payload.iv), c => c.charCodeAt(0));
    const ciphertext = Uint8Array.from(safeAtob(payload.ciphertext), c => c.charCodeAt(0));

    // AES-GCM decryption using the Web Crypto API
    const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ciphertext);
    
    // Returns the plaintext only to the active browser tab
    return new TextDecoder().decode(decrypted);
  } catch (e) {
    // If the key is missing or incorrect, decryption is mathematically impossible
    return "[Decryption Error]";
  }
}
```
The relay server only sees the `ciphertext` string, which acts as noise. It has no mathematical means to read your data.

---

## 4. Conclusion
Based on the implementation above:
1. **Exclusive Access:** Only you possess the encryption keys on your devices.
2. **Secure Transport:** Keys never touch the network or the server.
3. **Transparent Logic:** Since the extension is open-source, anyone can verify that we do not leak data or bypass encryption.

---

## 5. How to Verify the Identity of the Code
"How do I know the code running in my browser is the same as this GitHub code?" You can verify this yourself with these steps:

### A. Inspect the installed files on your disk
Chrome stores the source code of installed extensions on your local machine.

- **Windows**: `%LOCALAPPDATA%\Google\Chrome\User Data\Default\Extensions\omdfoongpifbbhapnpbocfoijkglegpd`
- **Mac**: `~/Library/Application Support/Google/Chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`
- **Linux**: `~/.config/google-chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`

You can open the JS files (`background.js`, `content.js`, etc.) in these folders and compare them with the GitHub repository. VoiceMux Bridge does not minify or obfuscate its code, making comparison easy.

### B. Inspect the Running Background Code
1. Open `chrome://extensions` in your browser.
2. Click the **"Service Worker"** link for VoiceMux Bridge.
3. Developer Tools will open, allowing you to read the `background.js` source code currently in execution.

VoiceMux Bridge proves its integrity through total transparency.

---
*Last Updated: 2026-02-21 (v2.1.0)*

--- END OF FILE: ./docs/E2EE_IMPLEMENTATION_EN.md ---

--- FILE: ./docs/E2EE_IMPLEMENTATION_JA.md ---
# VoiceMux Bridge: E2EEå®Ÿè£…æŠ€è¡“ãƒ¬ãƒãƒ¼ãƒˆ

VoiceMux Bridge ãŒã©ã®ã‚ˆã†ã«ã—ã¦ãƒ‡ãƒ¼ã‚¿ã®ç§˜å¯†ã‚’ä¿æŒã—ã€ã‚µãƒ¼ãƒãƒ¼ã«å†…å®¹ã‚’è¦‹ã›ãªã„ä»•çµ„ã¿ã«ãªã£ã¦ã„ã‚‹ã‹ã‚’ã€å®Ÿéš›ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’æŠœç²‹ã—ã¦è§£èª¬ã—ã¾ã™ã€‚

---

## 1. ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®æš—å·éµç”Ÿæˆã¨ã‚»ã‚­ãƒ¥ã‚¢ãªè»¢é€
æš—å·éµï¼ˆAES-GCM 128bitï¼‰ã¯ [VoiceMux Hub](https://hub.knc.jp) ã§ç”Ÿæˆã•ã‚Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã®æ­£è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚° API ã‚’é€šã˜ã¦æ‹¡å¼µæ©Ÿèƒ½ã¸å®‰å…¨ã«ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã¸é€ä¿¡ã•ã‚Œã‚‹ã“ã¨ã¯æ±ºã—ã¦ã‚ã‚Šã¾ã›ã‚“ã€‚

**è¨¼æ‹ ã‚³ãƒ¼ãƒ‰: `background.js` (å—ä¿¡å´)**
```javascript
// 155è¡Œç›®ä»˜è¿‘: Hub ã‹ã‚‰ã®è³‡æ ¼æƒ…å ±ãƒ—ãƒƒã‚·ãƒ¥ã‚’å¾…æ©Ÿ
chrome.runtime.onMessageExternal.addListener((request, sender, sendResponse) => {
  if (request.action === "SYNC_AUTH") {
    const { uuid, token, key } = request.payload;
    
    // æ‹¡å¼µæ©Ÿèƒ½å°‚ç”¨ã®å®‰å…¨ãªé ˜åŸŸã«ä¿å­˜
    chrome.storage.local.set({
      'voicemux_room_id': uuid,
      'voicemux_token': token,
      'voicemux_key': key
    }, () => { ... });
  }
});
```
ã“ã®éµã¯ `chrome.storage.local` ã¨ã„ã†ã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒæä¾›ã™ã‚‹ã€Œæ‹¡å¼µæ©Ÿèƒ½å°‚ç”¨ã®éš”é›¢ã•ã‚ŒãŸå®‰å…¨ãªé ˜åŸŸã€ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

---

## 2. ã‚µãƒ¼ãƒãƒ¼ã‚’çµŒç”±ã—ãªã„éµå…±æœ‰ï¼ˆZero-Knowledgeï¼‰
ã‚¹ãƒãƒ›ã¨ã®ãƒšã‚¢ãƒªãƒ³ã‚°æ™‚ã€URLã®ãƒãƒƒã‚·ãƒ¥ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆ`#`ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€ã‚µãƒ¼ãƒãƒ¼ã«éµã‚’çŸ¥ã‚‰ã›ãšã«ãƒ‡ãƒã‚¤ã‚¹é–“ã§å…±æœ‰ã—ã¾ã™ã€‚

**è¨¼æ‹ ã‚³ãƒ¼ãƒ‰: `popup.js`**
```javascript
// 45è¡Œç›®ä»˜è¿‘: ãƒšã‚¢ãƒªãƒ³ã‚°ç”¨URLã®æ§‹ç¯‰
let pairingUrl = `${hubOrigin}/${roomId}/zen`;
pairingUrl += `?token=${token}&uuid=${roomId}`;
pairingUrl += `#key=${keyBase64}`; // éµã‚’ãƒãƒƒã‚·ãƒ¥ã«å«ã‚ã‚‹
```
URLã® `#` ä»¥é™ã®éƒ¨åˆ†ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ä»•æ§˜ã«ã‚ˆã‚Š **ã€Œã‚µãƒ¼ãƒãƒ¼ã«ã¯é€ä¿¡ã•ã‚Œãªã„ã€** ã¨ã„ã†ç‰¹æ€§ãŒã‚ã‚Šã¾ã™ã€‚éµã®æƒ…å ±ã¯ã‚¹ãƒãƒ›ã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ã ã‘ã§å‡¦ç†ã•ã‚Œã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ã‚µãƒ¼ãƒãƒ¼ï¼ˆä¸­ç¶™å™¨ï¼‰ã«ã¯ä¸€åˆ‡å±Šãã¾ã›ã‚“ã€‚

---

## 3. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ã®å¾©å·
æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã€Œæš—å·åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®å¡Šã€ã®ã¿ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’å¹³æ–‡ã«æˆ»ã™ï¼ˆå¾©å·ã™ã‚‹ï¼‰å‡¦ç†ã¯ã€æ‹¡å¼µæ©Ÿèƒ½ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹å†…ã§è¡Œã‚ã‚Œã¾ã™ã€‚

**è¨¼æ‹ ã‚³ãƒ¼ãƒ‰: `background.js`**
```javascript
// 43è¡Œç›®ä»˜è¿‘: å¾©å·å‡¦ç†ã®æ ¸å¿ƒ
async function decrypt(payload) {
  // payload.ciphertextï¼ˆæš—å·æ–‡ï¼‰ã¨ payload.ivï¼ˆåˆæœŸåŒ–ãƒ™ã‚¯ãƒˆãƒ«ï¼‰ã®ã¿ã‚’å—ã‘å–ã‚‹
  if (!payload.ciphertext || !payload.iv) return payload.text || "";
  
  try {
    const key = await getDecryptionKey(); // ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰éµã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
    const iv = Uint8Array.from(safeAtob(payload.iv), c => c.charCodeAt(0));
    const ciphertext = Uint8Array.from(safeAtob(payload.ciphertext), c => c.charCodeAt(0));

    // Web Crypto API ã«ã‚ˆã‚‹ AES-GCM å¾©å·
    const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ciphertext);
    
    // å¾©å·ã•ã‚ŒãŸå¹³æ–‡ã®ã¿ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã¸é€ä¿¡
    return new TextDecoder().decode(decrypted);
  } catch (e) {
    // éµãŒæ­£ã—ããªã„å ´åˆã€ä¸­èº«ã‚’èª­ã¿å–ã‚‹ã“ã¨ã¯æš—å·å­¦çš„ã«ä¸å¯èƒ½
    return "[Decryption Error]";
  }
}
```
ã‚µãƒ¼ãƒãƒ¼ã¯æ„å‘³ã‚’æŒãŸãªã„æš—å·æ–‡ï¼ˆ`ciphertext`ï¼‰ã‚’è»¢é€ã—ã¦ã„ã‚‹ã ã‘ã§ã€ãã®å†…å®¹ã‚’èª­ã¿å–ã‚‹æ•°å­¦çš„ãªæ‰‹æ®µã‚’æŒã¡ã¾ã›ã‚“ã€‚

---

## 4. çµè«–
ä»¥ä¸Šã®å®Ÿè£…ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®å®‰å…¨æ€§ãŒæŠ€è¡“çš„ã«æ‹…ä¿ã•ã‚Œã¦ã„ã¾ã™ã€‚

1.  **éµã®ç‹¬å **: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒã‚¤ã‚¹é–“ï¼ˆPCã¨ã‚¹ãƒãƒ›ï¼‰ä»¥å¤–ã«éµã¯å­˜åœ¨ã—ã¾ã›ã‚“ã€‚
2.  **å®‰å…¨ãªé€šä¿¡**: éµæœ¬ä½“ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆï¼‰ã‚’æµã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
3.  **é€æ˜æ€§ã®æ‹…ä¿**: æ‹¡å¼µæ©Ÿèƒ½ãŒã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã‚ã‚‹ãŸã‚ã€ä¸Šè¨˜ã®å®Ÿè£…ã«å˜˜ãŒãªã„ã“ã¨ã‚’èª°ã§ã‚‚æ¤œè¨¼å¯èƒ½ã§ã™ã€‚

---

## 5. ã‚¹ãƒˆã‚¢ç‰ˆã¨GitHubã®ã‚³ãƒ¼ãƒ‰ãŒåŒä¸€ã‹ç¢ºèªã™ã‚‹æ–¹æ³•
ã€ŒGitHubã®ã‚³ãƒ¼ãƒ‰ã¯ç¶ºéº—ã ãŒã€ã‚¹ãƒˆã‚¢ã§é…å¸ƒã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯ä¸­èº«ãŒé•ã†ã®ã§ã¯ãªã„ã‹ï¼Ÿã€ã¨ã„ã†ç–‘å•ã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ãŒè§£æ¶ˆã§ãã¾ã™ã€‚

### A. ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚ŒãŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã™ã‚‹
Chromeã‚¦ã‚§ãƒ–ã‚¹ãƒˆã‚¢ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸæ‹¡å¼µæ©Ÿèƒ½ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã€ã‚ãªãŸã®PCã®ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

- **Windows**: `%LOCALAPPDATA%\Google\Chrome\User Data\Default\Extensions\omdfoongpifbbhapnpbocfoijkglegpd`
- **Mac**: `~/Library/Application Support/Google/Chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`
- **Linux**: `~/.config/google-chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`

ã“ã®ãƒ•ã‚©ãƒ«ãƒ€å†…ã® JS ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`background.js`, `content.js` ç­‰ï¼‰ã‚’é–‹ãã€GitHub ä¸Šã®ã‚³ãƒ¼ãƒ‰ã¨æ¯”è¼ƒã—ã¦ã¿ã¦ãã ã•ã„ã€‚VoiceMux Bridge ã¯ã‚³ãƒ¼ãƒ‰ã®é›£èª­åŒ–ï¼ˆèª­ã¿ã¥ã‚‰ãã™ã‚‹å‡¦ç†ï¼‰ã‚’è¡Œã£ã¦ã„ãªã„ãŸã‚ã€ãã®ã¾ã¾æ¯”è¼ƒãŒå¯èƒ½ã§ã™ã€‚

### B. å®Ÿè¡Œä¸­ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã‚‹
1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ `chrome://extensions` ã‚’é–‹ãã¾ã™ã€‚
2. VoiceMux Bridge ã® **ã€Œã‚µãƒ¼ãƒ“ã‚¹ ãƒ¯ãƒ¼ã‚«ãƒ¼ã€** ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
3. ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ãŒé–‹ãã€ç¾åœ¨å‹•ä½œã—ã¦ã„ã‚‹ `background.js` ã®ã‚½ãƒ¼ã‚¹ã‚’ç›´æ¥ç¢ºèªã§ãã¾ã™ã€‚

VoiceMux Bridge ã¯ã€æŠ€è¡“çš„ãªèª å®Ÿã•ã‚’é€æ˜æ€§ã«ã‚ˆã£ã¦è¨¼æ˜ã—ã¾ã™ã€‚

---
*æœ€çµ‚æ›´æ–°: 2026-02-21 (v2.1.0)*

--- END OF FILE: ./docs/E2EE_IMPLEMENTATION_JA.md ---

--- FILE: ./docs/USER_GUIDE_EN.md ---
# VoiceMux Bridge User Guide ğŸ›°ï¸

Welcome to VoiceMux Bridge!
This extension allows you to use your smartphone's familiar keyboard to type seamlessly into any input field on your PC (ChatGPT, Gemini, Gmail, Slack, etc.).

No complex setup is required. Let's get started!

---

## 1. Preparation: Sync with the Hub

First, enable the extension.

1.  Open [VoiceMux Hub](https://hub.knc.jp) on your PC.
2.  As soon as the site opens, your secure credentials will be automatically synced to this extension.
3.  Click the **VoiceMux icon (microphone stand mark)** in the top right of your browser.
4.  If you see "Ready to Pair!" and a QR code, you're all set!

> ğŸ’¡ **Tip**: "Pin" the icon to your toolbar for instant access to the QR code.

---

## 2. Connect: Pair with Your Smartphone

1.  Scan the displayed **QR code** with your smartphone's camera.
2.  Once the dedicated input page opens on your phone, pairing is complete.

Your smartphone and PC are now connected via a private channel protected by strong End-to-End Encryption (E2EE).

---

## 3. Usage: Talk to Your Phone

The best part of VoiceMux is using **"Gboard" or "iPhone Voice Dictation"** directly on your PC.

1.  On your PC, click into any text input field (ChatGPT, Gmail, etc.) where you want to type.
2.  Tap the input area on your phone to bring up the keyboard.
3.  Press the **"Microphone button"** on your keyboard and speak to your phone.
4.  When you stop speaking... your words will appear directly at your PC's cursor position!

---

## 4. Advance: Grow Your Dictionary

VoiceMux Hub helps you fix common misrecognitions of technical terms or names.

*   **Error Correction**: Fixing text in the Hub editor teaches the AI to be smarter next time.
*   **Prompt Generation**: Click **"ğŸª„ Fix Errors & Generate Prompts"** at the bottom of the extension to open the Hub and optimize your input for AI assistants.

---

## 5. Privacy & Security

VoiceMux prioritizes your privacy.
*   **Private Data**: Your text is encrypted directly between your phone and PC. Not even our servers can read it.
*   **Offline Cache**: Once synced, you don't need to open the Hub site anymore. Just click the extension icon to start pairing instantly using cached credentials.

---

## 6. Troubleshooting

*   **No QR Code**: Try refreshing [VoiceMux Hub](https://hub.knc.jp) and then click the extension icon again.
*   **Text Not Appearing**: Make sure you've clicked inside a text field on your PC and that the cursor is active.

---

We hope VoiceMux makes your daily work and creative sessions smoother and more enjoyable!
Feel free to return to this guide whenever you need help.

--- END OF FILE: ./docs/USER_GUIDE_EN.md ---

--- FILE: ./docs/USER_GUIDE_JA.md ---
# VoiceMux Bridge ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ‰ ğŸ›°ï¸

VoiceMux Bridgeï¼ˆãƒœã‚¤ã‚¹ãƒ ã‚¯ã‚¹ãƒ»ãƒ–ãƒªãƒƒã‚¸ï¼‰ã¸ã‚ˆã†ã“ãï¼
ã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ã‚¹ãƒãƒ›ã®ã€Œä½¿ã„æ…£ã‚ŒãŸã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã€ã‚’ä½¿ã£ã¦ã€ãƒ‘ã‚½ã‚³ãƒ³ã®ã‚ã‚‰ã‚†ã‚‹å…¥åŠ›æ¬„ï¼ˆGemini, ChatGPT, Gmail, Slackãªã©ï¼‰ã¸ã‚¹ãƒ©ã‚¹ãƒ©ã¨æ–‡å­—ã‚’å…¥åŠ›ã™ã‚‹ãŸã‚ã®æ¶ã‘æ©‹ã§ã™ã€‚

é›£ã—ã„è¨­å®šã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®ã‚¬ã‚¤ãƒ‰ã¨ä¸€ç·’ã«ã€æœ€åˆã®ä¸€æ­©ã‚’è¸ã¿å‡ºã—ã¾ã—ã‚‡ã†ã€‚

---

## 1. æº–å‚™ï¼šWebã‚µã‚¤ãƒˆã¨ã¤ãªã’ã‚ˆã†ï¼ˆåŒæœŸï¼‰

ã¾ãšã€æ‹¡å¼µæ©Ÿèƒ½ã‚’ä½¿ãˆã‚‹çŠ¶æ…‹ã«ã—ã¾ã™ã€‚

1.  ãƒ‘ã‚½ã‚³ãƒ³ã§ [VoiceMux Hub](https://hub.knc.jp) ã‚’é–‹ãã¾ã™ã€‚
2.  ã‚µã‚¤ãƒˆãŒé–‹ãã¨åŒæ™‚ã«ã€å®‰å…¨ãªèªè¨¼æƒ…å ±ãŒã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¸è‡ªå‹•çš„ã«é€ã‚‰ã‚Œã¾ã™ã€‚
3.  ãƒ–ãƒ©ã‚¦ã‚¶å³ä¸Šã® **VoiceMuxã‚¢ã‚¤ã‚³ãƒ³ï¼ˆãƒã‚¤ã‚¯ã‚¹ã‚¿ãƒ³ãƒ‰ã®ãƒãƒ¼ã‚¯ï¼‰** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
4.  ã€Œãƒšã‚¢ãƒªãƒ³ã‚°ã®æº–å‚™å®Œäº†ã€ã¨è¡¨ç¤ºã•ã‚Œã€QRã‚³ãƒ¼ãƒ‰ãŒå‡ºã¦ã„ã‚Œã°æº–å‚™OKã§ã™ï¼

> ğŸ’¡ **ãƒ’ãƒ³ãƒˆ**: ã‚¢ã‚¤ã‚³ãƒ³ã‚’ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã«ã€Œãƒ”ãƒ³ç•™ã‚ã€ã—ã¦ãŠãã¨ã€ã„ã¤ã§ã‚‚ã™ãã«QRã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã§ãã¦ä¾¿åˆ©ã§ã™ã€‚

---

## 2. ã¤ãªã’ã‚ˆã†ï¼šã‚¹ãƒãƒ›ã¨ãƒšã‚¢ãƒªãƒ³ã‚°

1.  è¡¨ç¤ºã•ã‚ŒãŸ **QRã‚³ãƒ¼ãƒ‰** ã‚’ã‚¹ãƒãƒ›ã®ã‚«ãƒ¡ãƒ©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã¾ã™ã€‚
2.  ã‚¹ãƒãƒ›ã§å°‚ç”¨ã®å…¥åŠ›ç”»é¢ãŒé–‹ã„ãŸã‚‰ã€é€£æºå®Œäº†ã§ã™ã€‚

ã‚ãªãŸã®ã‚¹ãƒãƒ›ã¨ãƒ‘ã‚½ã‚³ãƒ³ã¯ã€å¼·åŠ›ãªæš—å·ï¼ˆE2EEï¼‰ã§å®ˆã‚‰ã‚ŒãŸå°‚ç”¨ã®é€šã‚Šé“ã§ã¤ãªãŒã‚Šã¾ã—ãŸã€‚

---

## 3. ã¤ã‹ã£ã¦ã¿ã‚ˆã†ï¼šã„ã¤ã‚‚ã®ã‚¹ãƒãƒ›ã§è©±ã—ã‹ã‘ã‚‹

VoiceMuxã®æœ€å¤§ã®ç‰¹å¾´ã¯ã€ã‚¹ãƒãƒ›ã§ã„ã¤ã‚‚ä½¿ã£ã¦ã„ã‚‹ **ã€ŒGboardã€ã‚„ã€ŒiPhoneã®éŸ³å£°å…¥åŠ›ã€** ã‚’ãã®ã¾ã¾ãƒ‘ã‚½ã‚³ãƒ³ã§ä½¿ãˆã‚‹ã“ã¨ã§ã™ã€‚

1.  ãƒ‘ã‚½ã‚³ãƒ³ã§ã€æ–‡å­—ã‚’å…¥åŠ›ã—ãŸã„ã‚µã‚¤ãƒˆï¼ˆChatGPT, Gmailãªã©ï¼‰ã®å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚«ãƒ¼ã‚½ãƒ«ã‚’åˆã‚ã›ã¾ã™ã€‚
2.  ã‚¹ãƒãƒ›ã®ç”»é¢ã«ã‚ã‚‹å…¥åŠ›ã‚¨ãƒªã‚¢ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’å‡ºã—ã¾ã™ã€‚
3.  ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã«ã‚ã‚‹ **ã€Œãƒã‚¤ã‚¯ã®ãƒœã‚¿ãƒ³ã€** ã‚’æŠ¼ã—ã¦ã€ã‚¹ãƒãƒ›ã«å‘ã‹ã£ã¦è©±ã—ã‹ã‘ã¦ã¿ã¦ãã ã•ã„ã€‚
4.  è©±ã—çµ‚ã‚ã‚‹ã¨â€¦â€¦ã‚ãªãŸã®è¨€è‘‰ãŒã€ãƒ‘ã‚½ã‚³ãƒ³ã®å…¥åŠ›æ¬„ã«ç›´æ¥å…¥åŠ›ã•ã‚Œã¾ã™ï¼

---

## 4. ã‚‚ã£ã¨ä¾¿åˆ©ã«ï¼šè¾æ›¸ã‚’è‚²ã¦ã‚‹

éŸ³å£°å…¥åŠ›ã§ã‚ˆãã‚ã‚‹ã€Œå°‚é–€ç”¨èªã®èª¤å¤‰æ›ã€ã¯ã€[VoiceMux Hub](https://hub.knc.jp) ã§ä¿®æ­£ã§ãã¾ã™ã€‚

*   **èª¤èªè­˜ã®ä¿®æ­£**: Hub ã®ã‚¨ãƒ‡ã‚£ã‚¿ã§æ–‡å­—ã‚’ç›´ã™ã¨ã€AIãŒæ¬¡å›ã‹ã‚‰ã®å¤‰æ›ã‚’è³¢ãã—ã¦ãã‚Œã¾ã™ã€‚
*   **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ**: æ‹¡å¼µæ©Ÿèƒ½ã®ä¸‹éƒ¨ã«ã‚ã‚‹ **ã€ŒğŸª„ èª¤èªè­˜ã®ä¿®æ­£ãƒ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã€** ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€Hub ãŒé–‹ãã€å…¥åŠ›ã—ãŸå†…å®¹ã‚’ã•ã‚‰ã«AIå‘ã‘ã«æœ€é©åŒ–ã§ãã¾ã™ã€‚

---

## 5. å®‰å¿ƒãƒ»å®‰å…¨ã®ãŸã‚ã«

VoiceMuxã¯ã€ã‚ãªãŸã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’ä¸€ç•ªå¤§åˆ‡ã«ã—ã¦ã„ã¾ã™ã€‚
*   **ã‚ãªãŸã®æ–‡å­—ã¯ã€èª°ã«ã‚‚è¦‹ã‚‰ã‚Œã¾ã›ã‚“**: ã‚¹ãƒãƒ›ã¨ãƒ‘ã‚½ã‚³ãƒ³ã®é–“ã§ç›´æ¥æš—å·åŒ–ã•ã‚Œã‚‹ãŸã‚ã€é€”ä¸­ã®ã‚µãƒ¼ãƒãƒ¼ã§ã™ã‚‰ä¸­èº«ã‚’èª­ã‚€ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
*   **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½**: ä¸€åº¦é€£æºã™ã‚Œã°ã€æ¬¡å›ã‹ã‚‰ã¯ Hub ã‚µã‚¤ãƒˆã‚’é–‹ã‹ãªãã¦ã‚‚ã€æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’æŠ¼ã™ã ã‘ã§å³åº§ã«ä½¿ã„å§‹ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

---

## 6. å›°ã£ãŸã¨ãã¯ï¼Ÿ

*   **QRã‚³ãƒ¼ãƒ‰ãŒå‡ºãªã„**: [VoiceMux Hub](https://hub.knc.jp) ã‚’ä¸€åº¦ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆå†èª­ã¿è¾¼ã¿ï¼‰ã—ã¦ã‹ã‚‰ã€ã‚‚ã†ä¸€åº¦ã‚¢ã‚¤ã‚³ãƒ³ã‚’æŠ¼ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
*   **æ–‡å­—ãŒå…¥åŠ›ã•ã‚Œãªã„**: ãƒ‘ã‚½ã‚³ãƒ³ã®å…¥åŠ›æ¬„ã‚’ä¸€åº¦ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ã‚«ãƒ¼ã‚½ãƒ«ãŒãƒã‚«ãƒã‚«ã—ã¦ã„ã‚‹çŠ¶æ…‹ã«ã—ã¦ãã ã•ã„ã€‚

---

æ¯æ—¥ã®ãŠä»•äº‹ã‚„å‰µä½œæ´»å‹•ãŒã€ã‚¹ãƒãƒ›ã®åŠ›ã§ã‚‚ã£ã¨æ¥½ã—ãã€ã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚Šã¾ã™ã‚ˆã†ã«ï¼
ã‚‚ã—ä½¿ã„æ–¹ãŒã‚ã‹ã‚‰ãªããªã£ãŸã‚‰ã€ã„ã¤ã§ã‚‚ã“ã®ã‚¬ã‚¤ãƒ‰ã«æˆ»ã£ã¦ãã¦ãã ã•ã„ã­ã€‚

--- END OF FILE: ./docs/USER_GUIDE_JA.md ---

--- FILE: ./docs/WHY_PERMISSIONS_EN.md ---
# Transparency Report: Why VoiceMux Bridge Requests "Access to All Sites"

**VoiceMux Bridge** is designed to provide a seamless bridge between your smartphone's voice recognition and your desktop browser. This document explains our technical decisions regarding Chrome Extension permissions and our commitment to user privacy.

---

## 1. Why does Chrome say this extension is "Not Trusted"?

### The Issue
When installing from the Chrome Web Store, you might see this message:

> **Warning:** This extension is not trusted by Enhanced Safe Browsing.

### The Reason
This is not due to a bug or malware. It is a standard automated security check by Google based on:

- **Developer Longevity:** The developer account is relatively new.
- **User Base:** The extension was recently published and has a growing but still small number of users.

**Our Commitment:**
VoiceMux Bridge is fully open-source. We provide the source code on GitHub for public auditing to ensure complete transparency while Google's automated trust score accumulates.

---

## 2. Why "Read and Change All Your Data on All Websites"?

### The Reason: Ensuring a "Frictionless" UX
The core value of VoiceMux is the **"Magic Experience"**â€”speak into your phone, and text appears on your PC instantly without you having to touch your mouse.

To achieve this, the extension must be able to:

1. **Standby:** Listen for incoming encrypted data regardless of which tab (ChatGPT, Gemini, Notion, etc.) you are currently using.
2. **Auto-Injection:** Detect the active input field as soon as you switch tabs and inject the text without manual intervention.

If we restricted permissions to "activeTab" (only when clicked), **you would have to click the extension icon every single time you switch a tab.** This would destroy the hands-free utility that makes VoiceMux valuable.

---

## 3. Privacy and Security by Design

We understand that "All Site Access" is a powerful permission. We balance this responsibility with the following transparency measures:

- **Open Source Client:** The source code for the Chrome Extension is fully public on GitHub. This allows anyone to verify that data is encrypted *before* it leaves your browser and that we are not touching sensitive data like passwords.
- **End-to-End Encryption (E2EE):** While our relay server operates in a private environment, it only handles encrypted blobs. Since the encryption happens in the open-source client, the server remains a "black box" that cannot see or log your actual text.
- **Zero-Knowledge Key Exchange:** Your encryption keys are shared with your phone via URL hash fragments (`#key=...`). By technical design, these fragments are never sent to any server, ensuring your keys never touch the network.
- **No Tracking:** We do not collect browsing history or analytics. Your encryption keys and Room IDs stay stored locally on your devices.

---

## 4. Industry Standards

Most essential productivity tools, such as **1Password, Grammarly, and DeepL**, require the same level of permission. Because these tools must be ready to assist you the moment you start typing, constant presence is a technical necessity.

---

## Conclusion

We chose this permission model to deliver the **fastest, most seamless input experience possible.** While the system warning looks intimidating, we stand behind our transparent, E2EE-secured architecture to earn your trust.

---
*Last Updated: 2026-02-17*

--- END OF FILE: ./docs/WHY_PERMISSIONS_EN.md ---

--- FILE: ./docs/WHY_PERMISSIONS_JA.md ---
# Chromeæ‹¡å¼µæ©Ÿèƒ½ã®ã€Œå¼·åŠ›ãªæ¨©é™ã€ã¨UXã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã«ã¤ã„ã¦

**VoiceMux Bridge** ã¯ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®éŸ³å£°å…¥åŠ›ã‚’PCã®ã‚ã‚‰ã‚†ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã¸ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«è»¢é€ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ã€Œã™ã¹ã¦ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆä¸Šã®å…¨ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å–ã‚Šã¨å¤‰æ›´ã€ã¨ã„ã†è­¦å‘Šã®æ„å›³ã¨ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¸ã®é…æ…®ã«ã¤ã„ã¦é–‹ç™ºãƒãƒ¼ãƒ ã®è¦‹è§£ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚

---

## 1. ãªãœã€Œä¿¡é ¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€ã¨ã„ã†è­¦å‘ŠãŒå‡ºã‚‹ã®ã‹ï¼Ÿ

### èƒŒæ™¯
Chrome ã‚¦ã‚§ãƒ–ã‚¹ãƒˆã‚¢ã‹ã‚‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

> **è­¦å‘Š:** ã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ã‚»ãƒ¼ãƒ• ãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ä¿è­·å¼·åŒ–æ©Ÿèƒ½ã§ä¿¡é ¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

### ç†ç”±
ã“ã‚Œã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æ¬ é™¥ã§ã¯ãªãã€Google Chrome ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è©•ä¾¡ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™ã€‚ä¸»ã«ä»¥ä¸‹ã®æ¡ä»¶ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

- **é–‹ç™ºè€…å®Ÿç¸¾ã®è“„ç©æœŸé–“:** ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ç™»éŒ²ã‹ã‚‰ã®æœŸé–“ãŒçŸ­ã„ã€‚
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°:** å…¬é–‹ç›´å¾Œã§åˆ©ç”¨è€…ãŒé™å®šçš„ã§ã‚ã‚‹ã€‚

**VoiceMux ã®å¯¾å¿œ:**
ç§ãŸã¡ã¯ã™ã¹ã¦ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ GitHub ã§å…¬é–‹ã—ã¦ãŠã‚Šã€èª°ã§ã‚‚å®‰å…¨æ€§ã‚’ç›£æŸ»ã§ãã‚‹çŠ¶æ…‹ã«ã—ã¦ã„ã¾ã™ã€‚åˆ©ç”¨è€…ãŒå¢—ãˆã‚‹ã«ã¤ã‚Œã¦ã€ã“ã®è­¦å‘Šã¯è‡ªå‹•çš„ã«è¡¨ç¤ºã•ã‚Œãªããªã‚Šã¾ã™ã€‚

---

## 2. ãªãœã€Œå…¨ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã€ãŒå¿…è¦ãªã®ã‹ï¼Ÿ

### ç†ç”±ï¼šã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªã€Œãƒãƒ³ã‚ºãƒ•ãƒªãƒ¼ä½“é¨“ã€ã®å®Ÿç¾
VoiceMux Bridge ã®æ ¸å¿ƒã¯ã€**ã€ŒPCå´ã«è§¦ã‚Œã‚‹ã“ã¨ãªãã€ã‚¹ãƒãƒ›ã«è©±ã—ã‹ã‘ã‚‹ã ã‘ã§æ–‡å­—ãŒå…¥åŠ›ã•ã‚Œã‚‹ã€**ã¨ã„ã†ä½“é¨“ã§ã™ã€‚

ã“ã®ã€Œé­”æ³•ã®ã‚ˆã†ãªä½“é¨“ã€ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€æ‹¡å¼µæ©Ÿèƒ½ãŒä»¥ä¸‹ã®å‹•ä½œã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

1. **å¾…æ©Ÿ:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã©ã®ã‚¿ãƒ–ï¼ˆGemini, ChatGPT, Gmailç­‰ï¼‰ã‚’é–‹ã„ã¦ã‚‚ã€éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Œã‚‹çŠ¶æ…‹ã«ã™ã‚‹ã€‚
2. **è‡ªå‹•æ¤œçŸ¥:** ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆãŸéš›ã€æ–°ã—ã„ãƒšãƒ¼ã‚¸ä¸Šã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å³åº§ã«ç‰¹å®šã—ã¦æ–‡å­—ã‚’æµã—è¾¼ã‚€ã€‚

ã‚‚ã—æ¨©é™ã‚’ã€Œã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã ã‘ã€ã«åˆ¶é™ã—ãŸå ´åˆã€**ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã³ã«æ¯å›æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¨±å¯ã‚’ä¸ãˆã‚‹**æ“ä½œãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã§ã¯éŸ³å£°å…¥åŠ›ã®åˆ©ä¾¿æ€§ãŒæãªã‚ã‚Œã€ãƒ„ãƒ¼ãƒ«ã®å­˜åœ¨æ„ç¾©ãŒå¤±ã‚ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚

---

## 3. ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¨å®‰å…¨æ€§ã«ã¤ã„ã¦

ç§ãŸã¡ã¯ã€å¼·åŠ›ãªæ¨©é™ã‚’è¦æ±‚ã™ã‚‹è²¬ä»»ã¨ã—ã¦ã€ä»¥ä¸‹ã®è¨­è¨ˆã¨æƒ…å ±å…¬é–‹ã‚’å¾¹åº•ã—ã¦ã„ã¾ã™ã€‚

- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹åŒ–:** æ‹¡å¼µæ©Ÿèƒ½ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã™ã¹ã¦ GitHub ã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã€Œãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰é€ä¿¡ã•ã‚Œã‚‹å‰ã«ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãæš—å·åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ã€ã€Œå…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆä»¥å¤–ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã„ãªã„ã‹ã€ã‚’èª°ã§ã‚‚ç›£æŸ»å¯èƒ½ã§ã™ã€‚
- **ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰æš—å·åŒ– (E2EE):** éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚„ãƒ†ã‚­ã‚¹ãƒˆã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã¨ã‚¹ãƒãƒ›ã®é–“ã§ç›´æ¥æš—å·åŒ–ã•ã‚Œã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼å´ã¯ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰éå…¬é–‹ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆç’°å¢ƒã§é‹ç”¨ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§æš—å·åŒ–ãŒå®Œçµã—ã¦ã„ã‚‹ãŸã‚ã€ã‚µãƒ¼ãƒãƒ¼ï¼ˆå½“ã‚µã‚¤ãƒˆï¼‰ã§ã•ãˆä¸­èº«ã‚’èª­ã¿å–ã‚‹ã“ã¨ã¯ç‰©ç†çš„ã«ä¸å¯èƒ½ã§ã™ã€‚
- **ã‚µãƒ¼ãƒãƒ¼ã«éµã‚’æ¸¡ã•ãªã„ä»•çµ„ã¿:** ã‚¹ãƒãƒ›ã¨ã®ãƒšã‚¢ãƒªãƒ³ã‚°ã«ä½¿ç”¨ã™ã‚‹æš—å·éµã¯ã€URLã®ãƒãƒƒã‚·ãƒ¥ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆ`#` ä»¥é™ã®éƒ¨åˆ†ï¼‰ã¨ã—ã¦å…±æœ‰ã•ã‚Œã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ä»•æ§˜ä¸Šã€ã“ã®éƒ¨åˆ†ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œãªã„ãŸã‚ã€éµã®æƒ…å ±ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æµã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
- **æœ€å°é™ã®ãƒ‡ãƒ¼ã‚¿åé›†:** æ‹¡å¼µæ©Ÿèƒ½ã¯è¨­å®šï¼ˆRoom ID / Keyï¼‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã™ã‚‹ã®ã¿ã§ã€é–²è¦§å±¥æ­´ã‚„å€‹äººæƒ…å ±ã‚’å¤–éƒ¨ã¸é€ä¿¡ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

---

## 4. ä»–ã®ãƒ„ãƒ¼ãƒ«ã¨ã®æ¯”è¼ƒ

å¤šãã®ã‚¤ãƒ³ãƒ•ãƒ©ç³»ãƒ„ãƒ¼ãƒ«ï¼ˆ1Password, Grammarly, DeepLç­‰ï¼‰ã‚‚ã€åŒæ§˜ã®ç†ç”±ã§ã€Œå…¨ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã€ã‚’è¦æ±‚ã—ã¾ã™ã€‚ã€Œã„ã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã‚’å¿…è¦ã¨ã™ã‚‹ã‹äºˆæ¸¬ã§ããªã„ã€ãƒ„ãƒ¼ãƒ«ã«ã¨ã£ã¦ã€ã“ã®æ¨©é™ã¯åˆ©ä¾¿æ€§ã¨å®‰å…¨æ€§ã‚’ä¸¡ç«‹ã™ã‚‹ãŸã‚ã®æ¨™æº–çš„ãªé¸æŠã§ã™ã€‚

---

## çµè«–

VoiceMux Bridge ã¯ã€**ã€Œç©¶æ¥µã®å…¥åŠ›ä½“é¨“ã€ã‚’æä¾›ã™ã‚‹ãŸã‚ã«ç¾åœ¨ã®æ¨©é™è¨­å®šã‚’é¸æŠã—ã¾ã—ãŸã€‚** è­¦å‘Šã¯å¼·åŠ›ã«è¦‹ãˆã¾ã™ãŒã€ç§ãŸã¡ã¯é€æ˜æ€§ã¨æŠ€è¡“ï¼ˆE2EEï¼‰ã«ã‚ˆã£ã¦ãã®ä¿¡é ¼ã«å¿œãˆã¾ã™ã€‚

---
*æœ€çµ‚æ›´æ–°: 2026-02-17*

--- END OF FILE: ./docs/WHY_PERMISSIONS_JA.md ---

--- FILE: ./docs/community-adapters.md ---
# VoiceMux Community Adapters Catalog ğŸ“‚

Copy the JSON snippets below and paste them into the **Custom Site Adapters** field in your VoiceMux Extension Options.

---

### ğŸ“§ Outlook (Web)
Supports both personal (outlook.com) and business (Office 365).
```json
{
  "id": "outlook",
  "name": "Outlook",
  "host": "outlook",
  "inputSelector": "div[role='textbox'][aria-label*='ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸'], div[role='textbox'][aria-label*='Message']",
  "submitSelector": null
}
```

### ğŸ“§ Yahoo! Mail (Japan)
```json
{
  "id": "yahoo-mail-jp",
  "name": "Yahoo! Mail JP",
  "host": "mail.yahoo.co.jp",
  "inputSelector": "div[role='textbox']",
  "submitSelector": null
}
```

### ğŸ’¬ Slack (Web)
```json
{
  "id": "slack",
  "name": "Slack",
  "host": "slack.com",
  "inputSelector": ".ql-editor",
  "submitSelector": "button[data-testid='composer_send_button']"
}
```

### ğŸ“ Notion
```json
{
  "id": "notion",
  "name": "Notion",
  "host": "notion.so",
  "inputSelector": "div[contenteditable='true']",
  "submitSelector": null
}
```

---

### ğŸ’¡ How to contribute
If you've created a working adapter for a new site, please open a Pull Request or Issue to add it to this list!

--- END OF FILE: ./docs/community-adapters.md ---

--- FILE: ./PRIVACY.md ---
# Privacy Policy for VoiceMux Bridge

Last updated: 2026-02-21

## 1. Data Collection
VoiceMux Bridge does **not** collect, store, or transmit any personal data, keystrokes, or browsing history to our servers.

## 2. End-to-End Encryption (E2EE)
All data transmitted from your mobile device to this extension is encrypted using Client-Side AES-GCM (128-bit).
- **Decryption Keys**: These keys are generated within VoiceMux Hub and securely pushed to the extension via the browser's internal messaging API. They are stored in `chrome.storage.local`.
- **Zero-Knowledge**: Keys are shared with your mobile device via URL hash fragments (`#key=...`). These fragments are handled exclusively by the browser and are never sent to any server by design.

## 3. Permissions
The extension requires the following permissions to function:
- **activeTab**: Used only to inject text into the input field of the website you are currently using, and only upon your explicit request via the paired mobile device.
- **storage**: Used to save your local configuration, including your unique Room ID, encryption key, and any Custom Site Adapters you define.

## 4. Third-Party Services
VoiceMux Bridge acts as a bridge between your mobile device and the AI services you choose to use (e.g., Gemini, ChatGPT). We do not control and are not responsible for the privacy practices of those third-party services.

## 5. Contact
If you have any questions about this Privacy Policy, please open an issue on our [GitHub repository](https://github.com/Kaneta/voicemux-bridge).

--- END OF FILE: ./PRIVACY.md ---

--- FILE: ./background.js ---
/**
 * VoiceMux Bridge: Extension Service Worker (WebSocket Relay)
 * Version: 2.2.17
 */

const BASE_WS_URL = "wss://v.knc.jp/socket/websocket";
const MAX_RETRY_DELAY = 30000;

let socket = null;
let heartbeatInterval = null;
let retryTimer = null;
let retryDelay = 1000;
let currentRoomId = null;
let isJoined = false; 
const JOIN_REF = "1"; 

/** @intent Synchronous Base64 conversion to prevent Promise leakage. */
function safeAtob(str) {
  if (!str) return "";
  try {
    return atob(str.replace(/-/g, "+").replace(/_/g, "/"));
  } catch (e) {
    return "";
  }
}

/** @intent Robust AES-GCM decryption. */
async function decrypt(payload) {
  try {
    const data = await chrome.storage.local.get('voicemux_key');
    if (!data.voicemux_key) return "[No Key]";
    const localHint = data.voicemux_key.substring(0, 4);
    if (payload.key_hint && payload.key_hint !== localHint) return "[Key Mismatch]";

    const rawKey = safeAtob(data.voicemux_key);
    const key = await crypto.subtle.importKey("raw", Uint8Array.from(rawKey, c => c.charCodeAt(0)), { name: "AES-GCM" }, false, ["decrypt"]);
    const iv = Uint8Array.from(safeAtob(payload.iv), c => c.charCodeAt(0));
    const ciphertext = Uint8Array.from(safeAtob(payload.ciphertext), c => c.charCodeAt(0));
    const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ciphertext);
    return new TextDecoder().decode(decrypted);
  } catch (e) {
    return "[Decryption Error]";
  }
}

async function connect() {
  if (socket && (socket.readyState === WebSocket.CONNECTING || socket.readyState === WebSocket.OPEN)) return;
  const data = await chrome.storage.local.get(['voicemux_token', 'voicemux_room_id']);
  if (!data.voicemux_token || !data.voicemux_room_id) return;

  currentRoomId = data.voicemux_room_id;
  const topic = `room:${currentRoomId}`; 
  socket = new WebSocket(`${BASE_WS_URL}?vsn=2.0.0&token=${data.voicemux_token}`);

  socket.onopen = () => {
    console.log("VoiceMux: Socket established. Joining room...");
    isJoined = false;
    socket.send(JSON.stringify([JOIN_REF, JOIN_REF, topic, "phx_join", {}]));
    if (heartbeatInterval) clearInterval(heartbeatInterval);
    heartbeatInterval = setInterval(() => { if (socket?.readyState === WebSocket.OPEN) socket.send(JSON.stringify([null, "heartbeat", "phoenix", "heartbeat", {}])); }, 30000);
  };

  socket.onmessage = async (event) => {
    const [joinRef, ref, msgTopic, eventName, payload] = JSON.parse(event.data);
    if (msgTopic !== topic) return;

    // DESIGN INTENT: Remote logging mirror for PC console debugging.
    chrome.tabs.query({active: true, lastFocusedWindow: true}, (tabs) => {
      if (tabs[0]) chrome.tabs.sendMessage(tabs[0].id, { action: "LOG", log_level: "info", message: `ğŸ“¡ [${eventName}] | Sender: ${payload?.sender_tab_id || 'system'}` }).catch(() => {});
    });

    if (eventName === "phx_reply" && payload?.status === "ok") {
      console.log("VoiceMux: Channel Joined Successfully.");
      isJoined = true;
      socket.send(JSON.stringify([JOIN_REF, "2", topic, "device_online", { sender_tab_id: "extension" }]));
    } else if (eventName === "update_text" || eventName === "confirm_send") {
      const plaintext = await decrypt(payload);
      chrome.tabs.query({active: true, lastFocusedWindow: true}, (tabs) => { if (tabs[0]) chrome.tabs.sendMessage(tabs[0].id, { action: eventName, plaintext }).catch(() => {}); });
    } else if (eventName === "device_online" && payload.sender_tab_id !== "extension") {
      if (isJoined) {
        // DESIGN INTENT: Bidirectional handshake. Reply to mobile that PC is online.
        socket.send(JSON.stringify([JOIN_REF, "3", topic, "device_online", { sender_tab_id: "extension" }]));
      }
    } else if (eventName === "remote_command") {
      // DESIGN INTENT: Execute remote action (INSERT, NEWLINE, SUBMIT, CLEAR, LOG)
      const text = (payload.ciphertext && payload.iv) ? await decrypt(payload) : payload.text;
      chrome.tabs.query({active: true, lastFocusedWindow: true}, (tabs) => { if (tabs[0]) chrome.tabs.sendMessage(tabs[0].id, { ...payload, text }).catch(() => {}); });
    }
  };
  socket.onclose = () => { isJoined = false; scheduleReconnect(); };
  socket.onerror = () => socket.close();
}

function scheduleReconnect() { if (retryTimer) clearTimeout(retryTimer); retryTimer = setTimeout(connect, retryDelay); retryDelay = Math.min(retryDelay * 2, MAX_RETRY_DELAY); }

chrome.runtime.onMessage.addListener((request) => {
  if (request.action === "SYNC_AUTH") {
    chrome.storage.local.set({ 'voicemux_token': request.token, 'voicemux_room_id': request.roomId, 'voicemux_key': request.key }, () => { if (socket) socket.close(); connect(); });
  }
});

connect();

--- END OF FILE: ./background.js ---

--- FILE: ./collect_context.sh ---
#!/bin/bash
echo "Generating full_context.txt for VoiceMux Bridge..."
# Find relevant files and concatenate them with headers
# Exclude node_modules, .git, and common binary extensions
find . -maxdepth 2 -not -path '*/.*' -not -path './node_modules*' -not -name "*.png" -not -name "*.zip" -not -name "*.svg" -not -name "full_context.txt" -not -name "STORE_DESCRIPTION_*.txt" -not -name "DRAFT_*" -not -name "MEMO_*" -type f | while read file; do
    echo "--- FILE: $file ---" >> full_context.txt
    cat "$file" >> full_context.txt
    echo -e "
--- END OF FILE: $file ---
" >> full_context.txt
done
echo "Done! Context collected in full_context.txt"

--- END OF FILE: ./collect_context.sh ---

--- FILE: ./gen_map.sh ---
#!/bin/bash

# Configuration: Project-specific extensions
EXTENSIONS="js,jsx,ts,tsx,kt,ex,exs,svelte,astro,html,css,dart,go"
COMMENT_LIMIT=3

echo "# Codebase Map (Enhanced with Intent)"
echo "This map provides a structural overview with documentation comments. For implementation details, use MCP."
echo ""

# Get relevant files from git, excluding minified and build artifacts
FILES=$(git ls-files | grep -E "\.(${EXTENSIONS//,/|})$" | grep -vE "\.min\.js$|drizzle/|static/")

if [ -z "$FILES" ]; then
    # Fallback to find, explicitly excluding common noise
    FILES=$(find . -maxdepth 4 -type f \
        -not -path "*/node_modules/*" \
        -not -path "*/.*" \
        -not -path "*/drizzle/*" \
        -not -path "*/static/*" \
        | grep -E "\.(${EXTENSIONS//,/|})$" | grep -v "\.min\.js$")
fi

if [ -z "$FILES" ]; then
    echo "No files found with extensions: $EXTENSIONS"
    exit 0
fi

# Run ctags and process output
echo "$FILES" | xargs ctags --output-format=json --fields=+n+S --sort=no 2>/dev/null | jq -r -s '
    sort_by(.path) | .[] | 
    "\(.path)\t\(.name)\t\(.kind)\t\(.line)\t\(.signature // "")"
' | while IFS=$'\t' read -r PATH_VAL NAME KIND LINE_NUM SIG; do
    # Group by file
    if [ "$CURRENT_PATH" != "$PATH_VAL" ]; then
        echo -e "\n### FILE: $PATH_VAL"
        CURRENT_PATH=$PATH_VAL
    fi

    # Extract comments directly before the definition
    if [ -f "$PATH_VAL" ]; then
        COMMENTS=$(head -n $((LINE_NUM - 1)) "$PATH_VAL" 2>/dev/null | tail -n $COMMENT_LIMIT | grep -E "^\s*(//|/\*|\*|#|@doc|--)" | sed 's/^[[:space:]]*//' | tr '\n' ' ' | sed 's/ $//')
        
        if [ -n "$COMMENTS" ]; then
            echo "  [$KIND] $NAME$SIG (Line: $LINE_NUM) // $COMMENTS"
        else
            echo "  [$KIND] $NAME$SIG (Line: $LINE_NUM)"
        fi
    fi
done

# Add Svelte files (they are often missed by ctags)
echo "$FILES" | grep "\.svelte$" | while read -r SVELTE_FILE; do
    # Simple check to see if we already listed it
    echo -e "\n### FILE: $SVELTE_FILE (Svelte Component)"
done | sort -u

--- END OF FILE: ./gen_map.sh ---

--- FILE: ./gen_diff_context.sh ---
#!/bin/bash
# gen_diff_context.sh - å·®åˆ†é›†ä¸­å‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆå™¨

# 1. å¯¾è±¡ã¨ãªã‚‹å·®åˆ†ç¯„å›²ã®æ±ºå®š (git diff ãŒç©ºã®å ´åˆã€ç›´è¿‘ã®ã‚³ãƒŸãƒƒãƒˆã‚’å¯¾è±¡ã«ã™ã‚‹)
if [ -z "$(git diff)" ]; then
    echo "Notice: No staged or unstaged changes. Checking the last commit instead."
    TARGET="HEAD~1..HEAD"
else
    TARGET="HEAD"
fi

# 2. å¤‰æ›´ã•ã‚ŒãŸã‚·ãƒ³ãƒœãƒ«ï¼ˆé–¢æ•°ãƒ»ã‚¯ãƒ©ã‚¹ç­‰ï¼‰ã®æŠ½å‡º
echo "## [STEP 1] Detecting changed symbols via git diff ($TARGET)..."
CHANGED_SYMBOLS=$(git diff -U0 $TARGET | grep -E "^\+.*(def|function|class|interface|type)" | sed -E 's/.*\b(def|function|class|interface|type)\s+([a-zA-Z0-9_!/?]+).*/\2/' | sort -u)

if [ -z "$CHANGED_SYMBOLS" ]; then
    echo "No major symbol changes detected in diff."
    exit 0
fi

echo "Found: $CHANGED_SYMBOLS"

# 2. å½±éŸ¿ç¯„å›²ï¼ˆå‘¼ã³å‡ºã—å…ƒï¼‰ã®ç°¡æ˜“æ¢ç´¢
echo -e "\n## [STEP 2] Searching for impacted areas (Usage in other files)..."
for SYMBOL in $CHANGED_SYMBOLS; do
    echo "### Symbol: $SYMBOL"
    # å¤‰æ›´ã•ã‚ŒãŸã‚·ãƒ³ãƒœãƒ«ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ç®‡æ‰€ã‚’é«˜é€Ÿæ¤œç´¢ï¼ˆè‡ªåˆ†è‡ªèº«ã¯é™¤ãï¼‰
    grep -rwn . -e "$SYMBOL" --exclude-dir={.git,node_modules,.svelte-kit,vendor} | grep -v "$(git diff --name-only $TARGET)" | head -n 10
done

# 3. æ—¢å­˜ã® gen_map.sh ã¨é€£æºã—ã¦ã€Œåœ°å›³ã€ã‚’çµã‚Šè¾¼ã‚€
echo -e "\n## [STEP 3] Relevant Codebase Map (Filtered by Diff)"
# å¤‰æ›´ãŒã‚ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«å‘¨è¾ºã® ctags æƒ…å ±ã ã‘ã‚’åšã‚ã«æŠ½å‡º
./gen_map.sh | grep -A 5 -B 5 -E "($(echo $CHANGED_SYMBOLS | tr ' ' '|'))"
--- END OF FILE: ./gen_diff_context.sh ---

--- FILE: ./manifest.json ---
{
  "manifest_version": 3,
  "name": "__MSG_name__",
  "version": "2.2.17",
  "description": "__MSG_description__",
  "default_locale": "en",
  "permissions": [
    "activeTab",
    "storage",
    "alarms"
  ],
  "host_permissions": [
    "http://localhost:4000/*",
    "https://v.knc.jp/*",
    "https://hub.knc.jp/*"
  ],
  "action": {
    "default_popup": "popup.html",
    "default_icon": {
      "128": "icon128.png"
    }
  },
  "externally_connectable": {
    "matches": [
      "https://hub.knc.jp/*",
      "http://localhost/*"
    ]
  },
  "options_page": "options.html",
  "background": {
    "service_worker": "background.js"
  },
  "content_scripts": [
    {
      "matches": [
        "<all_urls>"
      ],
      "exclude_matches": [
        "https://v.knc.jp/*",
        "https://t.knc.jp/*"
      ],
      "js": [
        "content.js"
      ]
    }
  ],
  "icons": {
    "128": "icon128.png"
  },
  "web_accessible_resources": [
    {
      "resources": ["adapters.json"],
      "matches": ["<all_urls>"]
    }
  ]
}

--- END OF FILE: ./manifest.json ---

--- FILE: ./content.js ---
// VoiceMux Bridge Content Script v2.1.0 (Clean Architecture)
if (window.VOICEMUX_INITIALIZED) {
  console.log("VoiceMux: Already initialized in this tab.");
} else {
  window.VOICEMUX_INITIALIZED = true;
  console.group("VoiceMux Bridge v2.2.17");
  console.log("Status: Content Script Loaded");
  console.groupEnd();

  /**
   * decodes Base64 strings safely.
   */
  function safeAtob(base64) {
    if (!base64) return "";
    let standardBase64 = base64.replace(/\s/g, '').replace(/-/g, '+').replace(/_/g, '/');
    while (standardBase64.length % 4 !== 0) {
      standardBase64 += '=';
    }
    try {
      return atob(standardBase64);
    } catch (e) {
      console.error("[Base64] atob failed:", e);
      return "";
    }
  }

  let ADAPTERS_CACHE = [];
  let loadPromise = null;

  // â˜… Initialize Adapters
  async function loadAdapters() {
    if (loadPromise) return loadPromise;
    loadPromise = (async () => {
      try {
        const builtInUrl = chrome.runtime.getURL('adapters.json');
        const builtInRes = await fetch(builtInUrl);
        const builtInAdapters = await builtInRes.json();
        const storage = await chrome.storage.local.get('custom_adapters');
        const customAdapters = storage.custom_adapters || [];
        const normalizedCustom = customAdapters.map(a => ({
          name: a.name || "Custom",
          host: a.host,
          inputSelector: a.inputSelector ?? (Array.isArray(a.selectors) ? a.selectors.join(',') : a.selectors),
          submitSelector: a.submitSelector ?? (Array.isArray(a.sendBtns) ? a.sendBtns.join(',') : a.sendBtns)
        }));
        ADAPTERS_CACHE = [...normalizedCustom, ...builtInAdapters];
      } catch (e) {
        console.error("VoiceMux: Failed to load adapters", e);
      } finally {
        loadPromise = null;
      }
    })();
    return loadPromise;
  }

  chrome.storage.onChanged.addListener((changes, area) => {
    if (area === 'local' && changes.custom_adapters) {
      loadAdapters();
    }
  });
  loadAdapters();

  // â˜… Target Selection
  async function getTargetAndAdapter() {
    const url = window.location.href;
    if (ADAPTERS_CACHE.length === 0) await loadAdapters();
    const adapter = ADAPTERS_CACHE.find(a => a.host && url.includes(a.host));
    const active = document.activeElement;
    if (active && 
        (active.isContentEditable || 
         active.tagName === 'TEXTAREA' || 
         (active.tagName === 'INPUT' && !['checkbox', 'radio', 'button', 'submit'].includes(active.type)))) {
      return { target: active, adapter: adapter || { name: 'active-element' } };
    }
    if (adapter) {
      const el = document.querySelector(adapter.inputSelector);
      if (el) return { target: el, adapter: adapter };
    }
    const firstInput = document.querySelector('textarea, div[contenteditable="true"]');
    if (firstInput) {
        return { target: firstInput, adapter: { name: 'last-resort' } };
    }
    return { target: null, adapter: null };
  }

  let lastUserInteraction = 0;
  const INPUT_LOCK_MS = 2000;
  const SUBMIT_DELAY_MS = 150;

  // Listen for local interaction to prevent remote fighting
  document.addEventListener('keydown', () => lastUserInteraction = Date.now(), true);
  document.addEventListener('mousedown', () => lastUserInteraction = Date.now(), true);

  /** 
   * Hybrid Text Injection: v1.4 Stability + v2.2.2 Mirroring
   */
  function forceInject(element, text) {
    if (!element) return;
    
    const now = Date.now();
    if (now - lastUserInteraction < INPUT_LOCK_MS) {
      console.log("VoiceMux: Local interaction detected. Skipping remote update.");
      return;
    }

    // 1. Robust comparison (Check multiple text properties to avoid redundant churn)
    const val = (element.tagName === 'TEXTAREA' || element.tagName === 'INPUT' ? element.value : (element.innerText || element.textContent)) || "";
    if (val.trim() === text.trim()) return;

    console.log(`VoiceMux: Mirroring into ${element.tagName}. New Length: ${text.length}`);
    element.focus();

    try {
      if (element.tagName === 'TEXTAREA' || element.tagName === 'INPUT') {
        // --- v1.4 PROTOTYPE SETTER HACK ---
        const proto = element.tagName === 'INPUT' ? window.HTMLInputElement.prototype : window.HTMLTextAreaElement.prototype;
        const nativeSetter = Object.getOwnPropertyDescriptor(proto, "value")?.set;
        
        if (nativeSetter) {
          nativeSetter.call(element, text);
        } else {
          element.value = text;
        }
      } else if (element.isContentEditable) {
        // --- v2.2.4 ATOMIC MIRRORING ---
        // DESIGN INTENT: Aggressive Clear + Insert.
        // Modern editors often hijack 'selectAll' or 'paste'. 
        // By selecting and DELETING before insertion, we force the editor
        // to treat it as a fresh start, preventing duplication.
        
        const selection = window.getSelection();
        if (selection) {
          // Double-strength selection
          document.execCommand('selectAll', false, null);
          const range = document.createRange();
          range.selectNodeContents(element);
          selection.removeAllRanges();
          selection.addRange(range);
        }

        // Atomic transaction: Clear -> Insert
        document.execCommand('delete', false, null);
        const success = document.execCommand('insertText', false, text);
        
        if (!success) {
          element.innerText = text;
        }
      }
    } catch (e) {
      console.error("VoiceMux: Critical Injection Failure:", e);
      if (element.tagName === 'TEXTAREA') element.value = text;
      else element.innerText = text;
    }

    // 3. Mandatory State Sync (Explicitly mark as replacement)
    element.dispatchEvent(new InputEvent('input', { 
      bubbles: true, 
      inputType: 'insertReplacementText',
      data: text 
    }));
    element.dispatchEvent(new Event('change', { bubbles: true }));
    
    moveCursorToEnd(element);
  }

  function moveCursorToEnd(element) {
    if (element.tagName === 'TEXTAREA' || element.tagName === 'INPUT') {
      element.selectionStart = element.selectionEnd = element.value.length;
    } else if (element.isContentEditable) {
      try {
        const range = document.createRange();
        range.selectNodeContents(element);
        range.collapse(false);
        const sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
      } catch (e) {}
    }
  }

  /**
   * Aggressive Submission Logic: Wakes up the UI before clicking
   */
  async function performSubmit(target, adapter) {
    console.log("VoiceMux: Preparing for submission...");
    
    // 1. Final focus ritual to ensure button states refresh
    target.focus();
    target.dispatchEvent(new Event('input', { bubbles: true }));

    setTimeout(() => {
      if (adapter && adapter.submitSelector === null) return;
      
      let btn = null;
      if (adapter && adapter.submitSelector) {
        btn = document.querySelector(adapter.submitSelector);
      }

      if (btn && !btn.disabled) {
        console.log("VoiceMux: Clicking submission button.");
        btn.click();
      } else {
        console.log("VoiceMux: Submitting via Enter key.");
        triggerEnter(target);
      }
    }, SUBMIT_DELAY_MS);
  }

  function triggerEnter(target) {
      const opts = { key: 'Enter', code: 'Enter', keyCode: 13, which: 13, bubbles: true, cancelable: true, composed: true, view: window };
      target.dispatchEvent(new KeyboardEvent('keydown', opts));
      target.dispatchEvent(new KeyboardEvent('keypress', opts));
      target.dispatchEvent(new KeyboardEvent('keyup', opts));
  }

  // â˜… Message Listener (Plaintext from Background)
  chrome.runtime.onMessage.addListener(async (request, sender, sendResponse) => {
    const isHub = window.location.hostname.includes("hub.knc.jp") || 
                  (window.location.hostname === "localhost" && window.location.port === "5173");
    if (isHub) return;

    console.group("VoiceMux: Remote Command");
    try {
      const { target, adapter } = await getTargetAndAdapter();
      const plaintext = request.plaintext;
      
      let finalTarget = target;
      if (!finalTarget) {
        const active = document.activeElement;
        if (active && (active.tagName === 'TEXTAREA' || active.tagName === 'INPUT' || active.isContentEditable)) {
          finalTarget = active;
        }
      }

      if (!finalTarget) {
        console.warn("VoiceMux: No target for injection.");
        console.groupEnd();
        return;
      }

      if (request.action === "update_text") {
        forceInject(finalTarget, plaintext);
      } else if (request.action === "INSERT") {
        console.log("VoiceMux: Handling INSERT command.");
        const textToInsert = request.text || plaintext || "";
        if (textToInsert) {
          finalTarget.focus();
          document.execCommand('insertText', false, textToInsert);
          finalTarget.dispatchEvent(new InputEvent('input', { bubbles: true, inputType: 'insertText', data: textToInsert }));
          finalTarget.dispatchEvent(new Event('change', { bubbles: true }));
          moveCursorToEnd(finalTarget);
        }
      } else if (request.action === "NEWLINE") {
        console.log("VoiceMux: Handling NEWLINE command.");
        finalTarget.focus();
        document.execCommand('insertText', false, '\n');
        finalTarget.dispatchEvent(new InputEvent('input', { bubbles: true, inputType: 'insertText', data: '\n' }));
        finalTarget.dispatchEvent(new Event('change', { bubbles: true }));
        moveCursorToEnd(finalTarget);
      } else if (request.action === "SUBMIT" || request.action === "confirm_send") {
        // DESIGN INTENT: SUBMIT is now decoupled from text injection.
        // It only wakes up the UI and clicks the button.
        console.log("VoiceMux: Handling SUBMIT command.");
        await performSubmit(finalTarget, adapter);
      } else if (request.action === "CLEAR") {
        console.log("VoiceMux: Clearing target element.");
        if (finalTarget.tagName === 'TEXTAREA' || finalTarget.tagName === 'INPUT') {
          // Native setter hack for clearing
          const proto = finalTarget.tagName === 'INPUT' ? window.HTMLInputElement.prototype : window.HTMLTextAreaElement.prototype;
          const nativeSetter = Object.getOwnPropertyDescriptor(proto, "value")?.set;
          if (nativeSetter) nativeSetter.call(finalTarget, "");
          else finalTarget.value = "";
        } else {
          // ContentEditable clear
          finalTarget.focus();
          document.execCommand('selectAll', false, null);
          document.execCommand('delete', false, null);
        }
        finalTarget.dispatchEvent(new Event('input', { bubbles: true }));
      } else if (request.action === "LOG") {
        const style = "background: #6750A4; color: white; padding: 2px 4px; border-radius: 2px;";
        if (request.log_level === 'error') console.error("%cREMOTE", style, request.message);
        else if (request.log_level === 'warn') console.warn("%cREMOTE", style, request.message);
        else console.log("%cREMOTE", style, request.message);
      }
    } catch (err) {
      console.error("VoiceMux: Handler Error:", err);
    } finally {
      console.groupEnd();
    }
  });

  function safeCheckConnection() {
    if (chrome.runtime?.id) {
      chrome.runtime.sendMessage({ action: "check_connection" }).catch(() => {});
    }
  }

  document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "visible") {
      safeCheckConnection();
    }
  });
}

--- END OF FILE: ./content.js ---

--- FILE: ./options.html ---
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VoiceMux Settings</title>
  <style>
    :root {
      /* M3 Light Palette (Violet baseline) */
      --md-sys-color-primary: #6750A4;
      --md-sys-color-on-primary: #FFFFFF;
      --md-sys-color-primary-container: #EADDFF;
      --md-sys-color-on-primary-container: #21005D;
      --md-sys-color-secondary: #625B71;
      --md-sys-color-on-secondary: #FFFFFF;
      --md-sys-color-surface: #FEF7FF;
      --md-sys-color-on-surface: #1D1B20;
      --md-sys-color-surface-variant: #E7E0EB;
      --md-sys-color-on-surface-variant: #49454F;
      --md-sys-color-outline: #79747E;
      --md-sys-color-success: #10b981;

      /* Elevation */
      --md-sys-elevation-1: 0px 1px 3px 1px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
      --md-sys-elevation-3: 0px 1px 3px 0px rgba(0, 0, 0, 0.3), 0px 4px 8px 3px rgba(0, 0, 0, 0.15);
    }

    body {
      font-family: 'Roboto', system-ui, -apple-system, sans-serif;
      background-color: var(--md-sys-color-surface);
      color: var(--md-sys-color-on-surface);
      max-width: 680px;
      margin: 40px auto;
      padding: 24px;
      -webkit-font-smoothing: antialiased;
    }

    .card {
      background: var(--md-sys-color-surface);
      padding: 32px;
      border-radius: 28px;
      border: 1px solid var(--md-sys-color-surface-variant);
      box-shadow: var(--md-sys-elevation-1);
    }

    h1 { 
      font-size: 28px; 
      font-weight: 400; 
      margin: 0 0 12px 0; 
      color: var(--md-sys-color-on-surface);
    }

    p { 
      color: var(--md-sys-color-on-surface-variant); 
      font-size: 14px; 
      line-height: 1.6;
      margin-bottom: 32px; 
    }

    p a {
      color: var(--md-sys-color-primary);
      text-decoration: none;
      font-weight: 500;
    }

    textarea {
      width: 100%;
      height: 360px;
      font-family: 'Roboto Mono', ui-monospace, monospace;
      font-size: 13px;
      padding: 20px;
      border: 1px solid var(--md-sys-color-outline);
      border-radius: 12px;
      background-color: var(--md-sys-color-surface-variant);
      color: var(--md-sys-color-on-surface-variant);
      resize: vertical;
      box-sizing: border-box;
      outline: none;
      transition: border-color 0.2s;
    }

    textarea:focus {
      border-color: var(--md-sys-color-primary);
      border-width: 2px;
    }

    .btn-save {
      background-color: var(--md-sys-color-primary);
      color: var(--md-sys-color-on-primary);
      border: none;
      padding: 12px 24px;
      height: 40px;
      border-radius: 20px;
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      margin-top: 24px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: var(--md-sys-elevation-1);
    }

    .btn-save:hover { 
      box-shadow: var(--md-sys-elevation-2);
      opacity: 0.9;
    }

    .btn-save:active {
      transform: scale(0.98);
    }

    .status {
      margin-top: 16px;
      font-size: 14px;
      font-weight: 500;
      color: var(--md-sys-color-success);
      display: none;
      animation: fadeIn 0.3s ease;
    }

    code { 
      background: var(--md-sys-color-primary-container); 
      color: var(--md-sys-color-on-primary-container);
      padding: 2px 6px; 
      border-radius: 4px; 
      font-size: 12px;
    }

    .example-box {
      margin-top: 40px; 
      font-size: 12px; 
      color: var(--md-sys-color-on-surface-variant);
      background: var(--md-sys-color-surface-variant);
      padding: 16px;
      border-radius: 12px;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body data-i18n-title="options_title">
  <div class="card">
    <h1 data-i18n="options_header">Custom Site Adapters</h1>
    <p data-i18n="options_description">Define custom CSS selectors for your favorite sites. You can find pre-made configurations in our <a href="https://github.com/Kaneta/voicemux-bridge/blob/main/docs/community-adapters.md" target="_blank">Community Adapters Catalog</a>.</p>
    
    <textarea id="custom-adapters" spellcheck="false" placeholder='[
  {
    "name": "Custom App",
    "host": "example.com",
    "inputSelector": ".my-input",
    "submitSelector": ".my-send-button"
  }
]'></textarea>

    <button id="save" class="btn-save" data-i18n="btn_save_config">Save Configuration</button>
    <div id="status" class="status" data-i18n="status_saved">Settings saved successfully</div>

    <div class="example-box">
      <strong data-i18n="example_structure">Example Structure:</strong><br>
      <code>[{"name": "Slack", "host": "slack.com", "inputSelector": ".ql-editor", "submitSelector": "button.c-button-unstyled"}]</code>
    </div>
  </div>
  <script src="options.js"></script>
</body>
</html>

--- END OF FILE: ./options.html ---

--- FILE: ./options.js ---
// VoiceMux Options JS
const textarea = document.getElementById('custom-adapters');
const saveBtn = document.getElementById('save');
const status = document.getElementById('status');

// Load saved settings
document.addEventListener('DOMContentLoaded', async () => {
  localize();
  const data = await chrome.storage.local.get('custom_adapters');
  if (data.custom_adapters) {
    textarea.value = JSON.stringify(data.custom_adapters, null, 2);
  }
});

// Save settings
saveBtn.addEventListener('click', async () => {
  const rawValue = textarea.value.trim();
  let parsedValue = [];

  if (rawValue) {
    try {
      parsedValue = JSON.parse(rawValue);
      if (!Array.isArray(parsedValue)) throw new Error("Must be an array");
    } catch (e) {
      alert(chrome.i18n.getMessage("invalid_json_format", [e.message]));
      return;
    }
  }

  await chrome.storage.local.set({ 'custom_adapters': parsedValue });
  
  // Show status
  status.style.display = 'block';
  setTimeout(() => {
    status.style.display = 'none';
  }, 2000);
});

function localize() {
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    const message = chrome.i18n.getMessage(key);
    if (message) {
      if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
        element.placeholder = message;
      } else {
        element.innerHTML = message;
      }
    }
  });

  document.querySelectorAll('[data-i18n-title]').forEach(element => {
    const key = element.getAttribute('data-i18n-title');
    const message = chrome.i18n.getMessage(key);
    if (message) {
      document.title = message;
    }
  });
}

--- END OF FILE: ./options.js ---

--- FILE: ./popup.html ---
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    :root {
      /* M3 Light Palette (Violet baseline) */
      --md-sys-color-primary: #6750A4;
      --md-sys-color-on-primary: #FFFFFF;
      --md-sys-color-primary-container: #EADDFF;
      --md-sys-color-on-primary-container: #21005D;
      --md-sys-color-secondary-container: #E8DEF8;
      --md-sys-color-on-secondary-container: #1D192B;
      --md-sys-color-surface: #FEF7FF;
      --md-sys-color-on-surface: #1D1B20;
      --md-sys-color-surface-variant: #E7E0EB;
      --md-sys-color-on-surface-variant: #49454F;
      --md-sys-color-outline: #79747E;
      --md-sys-color-success: #10b981;
      --md-sys-color-warning: #f59e0b;

      /* Elevation */
      --md-sys-elevation-1: 0px 1px 3px 1px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
      --md-sys-elevation-2: 0px 2px 6px 2px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
    }

    body {
      width: 320px;
      font-family: 'Roboto', system-ui, -apple-system, sans-serif;
      margin: 0;
      padding: 20px 24px;
      background-color: var(--md-sys-color-surface);
      color: var(--md-sys-color-on-surface);
      -webkit-font-smoothing: antialiased;
      overflow: hidden;
    }

    .header {
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    h1 {
      font-size: 18px;
      font-weight: 700;
      margin: 0;
      color: var(--md-sys-color-primary);
      letter-spacing: -0.02em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .app-version {
      font-size: 10px;
      font-weight: 400;
      opacity: 0.6;
      background: var(--md-sys-color-surface-variant);
      padding: 2px 6px;
      border-radius: 4px;
    }

    .maintenance-notice {
      background: var(--md-sys-color-warning);
      color: white;
      padding: 4px 8px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 700;
      margin-bottom: 12px;
      width: 100%;
    }

    .maintenance-notice a {
      color: white;
      text-decoration: underline;
    }

    .status-indicator-group {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: var(--md-sys-color-warning);
      box-shadow: 0 0 0 2px var(--md-sys-color-surface);
    }

    .status-dot.online {
      background-color: var(--md-sys-color-success);
      box-shadow: 0 0 8px var(--md-sys-color-success);
    }

    /* Views */
    #unlinked-view, #linked-view {
      display: none;
      flex-direction: column;
      align-items: center;
      text-align: center;
      animation: fadeIn 0.3s ease-out;
    }

    /* Common Button Style (MD3 Tonal Capsule) */
    .btn-tonal {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 24px;
      background-color: var(--md-sys-color-secondary-container);
      color: var(--md-sys-color-on-secondary-container);
      border: none;
      border-radius: 9999px;
      font-size: 14px;
      font-weight: 700;
      text-decoration: none;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }

    .btn-tonal:hover {
      filter: brightness(0.95);
      box-shadow: var(--md-sys-elevation-1);
    }

    .btn-tonal:active {
      transform: scale(0.98);
    }

    /* Footer Links */
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-top: 16px;
      margin-bottom: 4px;
    }

    .f-link {
      font-size: 11px;
      color: var(--md-sys-color-primary);
      text-decoration: none;
      opacity: 0.7;
      font-weight: 600;
    }
    .f-link:hover { opacity: 1; text-decoration: underline; }

    /* Unlinked View Specific */
    .sync-wait-container {
      position: relative;
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
    }

    .pulse {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background-color: var(--md-sys-color-primary);
      opacity: 0.2;
      animation: pulse 2s infinite cubic-bezier(0.4, 0, 0.6, 1);
    }

    .waiting-text-main {
      font-size: 1.1rem;
      font-weight: 800;
      margin: 0 0 12px 0;
      color: var(--md-sys-color-on-surface);
      line-height: 1.3;
    }

    .waiting-text-sub {
      font-size: 13px;
      color: var(--md-sys-color-on-surface-variant);
      margin-bottom: 24px;
      line-height: 1.5;
      padding: 0 8px;
    }

    /* Linked View Specific */
    .ready-msg {
      font-size: 1.15rem;
      font-weight: 900;
      color: var(--md-sys-color-primary);
      margin: 0 0 8px 0;
      line-height: 1.2;
    }

    .sync-instruction {
      font-size: 13px;
      color: var(--md-sys-color-on-surface-variant);
      margin-bottom: 24px;
      line-height: 1.4;
      padding: 0 12px;
      white-space: nowrap;
    }

    #qrcode-link {
      display: block;
      margin-bottom: 12px;
      text-decoration: none;
      transition: transform 0.2s;
    }

    #qrcode-link:hover { transform: scale(1.02); }

    #qrcode {
      background: white;
      padding: 12px;
      border-radius: 20px;
      box-shadow: var(--md-sys-elevation-2);
      border: 1px solid var(--md-sys-color-surface-variant);
      /* High contrast for scannability */
      image-rendering: pixelated;
    }

    #qrcode img, #qrcode svg {
      display: block;
      width: 100%;
      height: auto;
    }

    .room-info {
      font-family: var(--font-mono, monospace);
      font-size: 18px;
      font-weight: 800;
      color: var(--md-sys-color-primary);
      background: var(--md-sys-color-secondary-container);
      padding: 4px 12px;
      border-radius: 8px;
      margin-bottom: 12px;
      letter-spacing: 2px;
    }

    /* Subtle Copy Button */
    .btn-copy-link {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 8px 24px;
      background: transparent;
      color: var(--md-sys-color-primary);
      border: 1px solid var(--md-sys-color-outline);
      border-radius: 100px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 24px;
      transition: all 0.2s;
    }

    .btn-copy-link:hover { background-color: rgba(103, 80, 164, 0.05); }
    .btn-copy-link.success { border-color: var(--md-sys-color-success); color: var(--md-sys-color-success); }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 0.4; }
      100% { transform: scale(1.6); opacity: 0; }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>
      <span data-i18n="name">VoiceMux Bridge</span>
      <span id="version-display" class="app-version">v...</span>
    </h1>
    <div class="status-indicator-group">
      <div id="status-indicator" class="status-dot"></div>
    </div>
  </div>

  <!-- View 1: Unlinked -->
  <div id="unlinked-view">
    <div class="sync-wait-container">
      <div class="pulse"></div>
      <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--md-sys-color-primary); z-index: 1;">
        <path d="M21 2v6h-6"></path><path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path><path d="M3 22v-6h6"></path><path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
      </svg>
    </div>
    <h2 class="waiting-text-main" data-i18n="waiting_hub_main">First, let's link with the Hub</h2>
    <p class="waiting-text-sub" data-i18n="waiting_hub_sub">Once you open the VoiceMux Hub site, the pairing QR code will appear here automatically.</p>
    <button id="btn-open-hub" class="btn-tonal" data-i18n="btn_open_hub">ğŸš€ Open Hub to Link</button>
  </div>

  <!-- View 2: Linked (Ready) -->
  <div id="linked-view">
    <div id="maintenance-notice" class="maintenance-notice" style="display: none;">
      <a id="maintenance-link" href="#" target="_blank">ğŸš§ Maintenance (Details)</a>
    </div>

    <h2 class="ready-msg" data-i18n="ready_to_sync">Ready to Pair!</h2>
    <p class="sync-instruction" data-i18n="sync_instruction">Scan with your phone to start input.</p>

    <a id="qrcode-link" href="#" target="_blank">
      <div id="qrcode"></div>
    </a>
    <div id="room-id" class="room-info" data-i18n="room_loading">Room: Loading...</div>

    <button id="copy-btn" class="btn-copy-link">
      <span id="copy-text" data-i18n="btn_copy_link">Copy Link</span>
    </button>

    <a href="https://hub.knc.jp" id="hub-link" target="_blank" class="btn-tonal" data-i18n="btn_manage_librarian">
      ğŸª„ Fix Errors & Generate Prompts
    </a>
  </div>

  <div class="footer-links">
    <a href="https://github.com/Kaneta/voicemux-bridge/issues" target="_blank" class="f-link" data-i18n="link_support">Support</a>
    <a href="https://knc.jp/ja/docs/voicemux-bridge/" id="guide-link" target="_blank" class="f-link" data-i18n="link_guide">Guide</a>
    <a href="https://github.com/Kaneta/voicemux-bridge/blob/main/PRIVACY.md" target="_blank" class="f-link" data-i18n="link_privacy">Privacy</a>
  </div>

  <script src="qrcode.min.js"></script>
  <script src="popup.js"></script>
</body>
</html>

--- END OF FILE: ./popup.html ---

--- FILE: ./popup.js ---
// VoiceMux Popup JS (v2.1.1 Finalized UI)
document.addEventListener('DOMContentLoaded', async () => {
  // Localization
  localize();

  // Version Display
  const versionDisplay = document.getElementById("version-display");
  if (versionDisplay) {
    versionDisplay.innerText = `v${chrome.runtime.getManifest().version}`;
  }

    const unlinkedView = document.getElementById("unlinked-view");
    const linkedView = document.getElementById("linked-view");
  
    // System Status Check (Non-blocking)
    try {
      const statusRes = await fetch("https://v.knc.jp/api/status");
      if (statusRes.ok) {
        const status = await statusRes.json();
        if (status.is_maintenance) {
          const notice = document.getElementById("maintenance-notice");
          const link = document.getElementById("maintenance-link");
          if (notice && link) {
            notice.style.display = "block";
            link.href = status.info_url;
          }
        }
      }
    } catch (e) {
      console.warn("VoiceMux: Failed to fetch system status.");
    }
  
    const qrcodeContainer = document.getElementById("qrcode");
  const qrcodeLink = document.getElementById("qrcode-link");
  const roomIdDisplay = document.getElementById("room-id");
  const btnOpenHub = document.getElementById("btn-open-hub");
  const statusIndicator = document.getElementById("status-indicator");
  const hubLink = document.getElementById("hub-link");

  // 1. Retrieve credentials from storage
  async function updateUI() {
    const data = await chrome.storage.local.get(['voicemux_room_id', 'voicemux_token', 'voicemux_key', 'voicemux_hub_url', 'voicemux_paired']);
    const roomId = data.voicemux_room_id;
    const token = data.voicemux_token;
    const keyBase64 = data.voicemux_key;
    const isPaired = data.voicemux_paired;
    
    let hubOrigin = 'https://hub.knc.jp';
    try {
      const rawHubUrl = data.voicemux_hub_url || 'https://hub.knc.jp';
      hubOrigin = new URL(rawHubUrl).origin;
    } catch (e) {}

    if (roomId && token && keyBase64) {
      // --- LINKED STATE (READY) ---
      linkedView.style.display = "flex";
      unlinkedView.style.display = "none";
      statusIndicator?.classList.add("online");

      // Check for active pairing success
      if (isPaired) {
        linkedView.innerHTML = `
          <div class="success-animation">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
          </div>
          <h2 class="ready-msg" style="color: #10b981;">Paired Successfully!</h2>
          <p class="sync-instruction">Your phone is now connected as a mic.</p>
          <button id="btn-close-popup" class="btn-tonal" style="width: 100%; margin-top: 12px; background-color: #10b981; color: white;">
            Done (Close)
          </button>
        `;
        const closeBtn = document.getElementById("btn-close-popup");
        if (closeBtn) closeBtn.onclick = () => window.close();
        return;
      }

      // Update Hub Link (Optional)
      if (hubLink) hubLink.href = `${hubOrigin}/welcome`;

      // Construct Pairing URL
      let pairingUrl = `${hubOrigin}/${roomId}`;
      pairingUrl += `?mode=zen&token=${token}`;
      pairingUrl += `#key=${keyBase64}`;
      
      const displayRoomId = roomId.substring(0, 4).toUpperCase();
      if (roomIdDisplay) roomIdDisplay.innerText = displayRoomId;
      if (qrcodeLink) qrcodeLink.href = pairingUrl;

      // Handle Copy Button
      const copyBtn = document.getElementById("copy-btn");
      const copyText = document.getElementById("copy-text");
      if (copyBtn) {
        copyBtn.onclick = async () => {
          try {
            await navigator.clipboard.writeText(pairingUrl);
            if (copyText) copyText.innerText = chrome.i18n.getMessage("btn_copy_success");
            copyBtn.classList.add("success");
            setTimeout(() => {
              if (copyText) copyText.innerText = chrome.i18n.getMessage("btn_copy_link");
              copyBtn.classList.remove("success");
            }, 2000);
          } catch (err) {}
        };
      }

      // Generate QR Code
      if (qrcodeContainer && qrcodeContainer.innerHTML === "") {
        new QRCode(qrcodeContainer, {
          text: pairingUrl,
          width: 160,
          height: 160,
          colorDark: "#000000",
          colorLight: "#ffffff",
          correctLevel: QRCode.CorrectLevel.M
        });
      }

    } else {
      // --- UNLINKED STATE ---
      unlinkedView.style.display = "flex";
      linkedView.style.display = "none";
      statusIndicator?.classList.remove("online");

      if (btnOpenHub) {
        btnOpenHub.onclick = () => {
          chrome.tabs.create({ url: hubOrigin });
        };
      }

      // Signal background to check connection
      chrome.runtime.sendMessage({ action: "check_connection" });
    }
  }

  // Initial update
  updateUI();
  
  // DESIGN INTENT: Reset pairing flag when opening to allow future re-pairs
  chrome.storage.local.set({ 'voicemux_paired': false });

  // Listen for storage changes
  chrome.storage.onChanged.addListener((changes, namespace) => {
    if (namespace === 'local' && (changes.voicemux_room_id || changes.voicemux_token || changes.voicemux_paired)) {
      updateUI();
    }
  });
});

function localize() {
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    const message = chrome.i18n.getMessage(key);
    if (message) {
      if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
        element.placeholder = message;
      } else {
        element.innerHTML = message;
      }
    }
  });

  // Localize specialized links
  const guideLink = document.getElementById('guide-link');
  if (guideLink) {
    guideLink.href = chrome.i18n.getMessage('url_guide');
  }
}

--- END OF FILE: ./popup.js ---

--- FILE: ./qrcode.min.js ---
var QRCode;!function(){function a(a){this.mode=c.MODE_8BIT_BYTE,this.data=a,this.parsedData=[];for(var b=[],d=0,e=this.data.length;e>d;d++){var f=this.data.charCodeAt(d);f>65536?(b[0]=240|(1835008&f)>>>18,b[1]=128|(258048&f)>>>12,b[2]=128|(4032&f)>>>6,b[3]=128|63&f):f>2048?(b[0]=224|(61440&f)>>>12,b[1]=128|(4032&f)>>>6,b[2]=128|63&f):f>128?(b[0]=192|(1984&f)>>>6,b[1]=128|63&f):b[0]=f,this.parsedData=this.parsedData.concat(b)}this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function b(a,b){this.typeNumber=a,this.errorCorrectLevel=b,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function i(a,b){if(void 0==a.length)throw new Error(a.length+"/"+b);for(var c=0;c<a.length&&0==a[c];)c++;this.num=new Array(a.length-c+b);for(var d=0;d<a.length-c;d++)this.num[d]=a[d+c]}function j(a,b){this.totalCount=a,this.dataCount=b}function k(){this.buffer=[],this.length=0}function m(){return"undefined"!=typeof CanvasRenderingContext2D}function n(){var a=!1,b=navigator.userAgent;return/android/i.test(b)&&(a=!0,aMat=b.toString().match(/android ([0-9]\.[0-9])/i),aMat&&aMat[1]&&(a=parseFloat(aMat[1]))),a}function r(a,b){for(var c=1,e=s(a),f=0,g=l.length;g>=f;f++){var h=0;switch(b){case d.L:h=l[f][0];break;case d.M:h=l[f][1];break;case d.Q:h=l[f][2];break;case d.H:h=l[f][3]}if(h>=e)break;c++}if(c>l.length)throw new Error("Too long data");return c}function s(a){var b=encodeURI(a).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return b.length+(b.length!=a?3:0)}a.prototype={getLength:function(){return this.parsedData.length},write:function(a){for(var b=0,c=this.parsedData.length;c>b;b++)a.put(this.parsedData[b],8)}},b.prototype={addData:function(b){var c=new a(b);this.dataList.push(c),this.dataCache=null},isDark:function(a,b){if(0>a||this.moduleCount<=a||0>b||this.moduleCount<=b)throw new Error(a+","+b);return this.modules[a][b]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(a,c){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var d=0;d<this.moduleCount;d++){this.modules[d]=new Array(this.moduleCount);for(var e=0;e<this.moduleCount;e++)this.modules[d][e]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(a,c),this.typeNumber>=7&&this.setupTypeNumber(a),null==this.dataCache&&(this.dataCache=b.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,c)},setupPositionProbePattern:function(a,b){for(var c=-1;7>=c;c++)if(!(-1>=a+c||this.moduleCount<=a+c))for(var d=-1;7>=d;d++)-1>=b+d||this.moduleCount<=b+d||(this.modules[a+c][b+d]=c>=0&&6>=c&&(0==d||6==d)||d>=0&&6>=d&&(0==c||6==c)||c>=2&&4>=c&&d>=2&&4>=d?!0:!1)},getBestMaskPattern:function(){for(var a=0,b=0,c=0;8>c;c++){this.makeImpl(!0,c);var d=f.getLostPoint(this);(0==c||a>d)&&(a=d,b=c)}return b},createMovieClip:function(a,b,c){var d=a.createEmptyMovieClip(b,c),e=1;this.make();for(var f=0;f<this.modules.length;f++)for(var g=f*e,h=0;h<this.modules[f].length;h++){var i=h*e,j=this.modules[f][h];j&&(d.beginFill(0,100),d.moveTo(i,g),d.lineTo(i+e,g),d.lineTo(i+e,g+e),d.lineTo(i,g+e),d.endFill())}return d},setupTimingPattern:function(){for(var a=8;a<this.moduleCount-8;a++)null==this.modules[a][6]&&(this.modules[a][6]=0==a%2);for(var b=8;b<this.moduleCount-8;b++)null==this.modules[6][b]&&(this.modules[6][b]=0==b%2)},setupPositionAdjustPattern:function(){for(var a=f.getPatternPosition(this.typeNumber),b=0;b<a.length;b++)for(var c=0;c<a.length;c++){var d=a[b],e=a[c];if(null==this.modules[d][e])for(var g=-2;2>=g;g++)for(var h=-2;2>=h;h++)this.modules[d+g][e+h]=-2==g||2==g||-2==h||2==h||0==g&&0==h?!0:!1}},setupTypeNumber:function(a){for(var b=f.getBCHTypeNumber(this.typeNumber),c=0;18>c;c++){var d=!a&&1==(1&b>>c);this.modules[Math.floor(c/3)][c%3+this.moduleCount-8-3]=d}for(var c=0;18>c;c++){var d=!a&&1==(1&b>>c);this.modules[c%3+this.moduleCount-8-3][Math.floor(c/3)]=d}},setupTypeInfo:function(a,b){for(var c=this.errorCorrectLevel<<3|b,d=f.getBCHTypeInfo(c),e=0;15>e;e++){var g=!a&&1==(1&d>>e);6>e?this.modules[e][8]=g:8>e?this.modules[e+1][8]=g:this.modules[this.moduleCount-15+e][8]=g}for(var e=0;15>e;e++){var g=!a&&1==(1&d>>e);8>e?this.modules[8][this.moduleCount-e-1]=g:9>e?this.modules[8][15-e-1+1]=g:this.modules[8][15-e-1]=g}this.modules[this.moduleCount-8][8]=!a},mapData:function(a,b){for(var c=-1,d=this.moduleCount-1,e=7,g=0,h=this.moduleCount-1;h>0;h-=2)for(6==h&&h--;;){for(var i=0;2>i;i++)if(null==this.modules[d][h-i]){var j=!1;g<a.length&&(j=1==(1&a[g]>>>e));var k=f.getMask(b,d,h-i);k&&(j=!j),this.modules[d][h-i]=j,e--,-1==e&&(g++,e=7)}if(d+=c,0>d||this.moduleCount<=d){d-=c,c=-c;break}}}},b.PAD0=236,b.PAD1=17,b.createData=function(a,c,d){for(var e=j.getRSBlocks(a,c),g=new k,h=0;h<d.length;h++){var i=d[h];g.put(i.mode,4),g.put(i.getLength(),f.getLengthInBits(i.mode,a)),i.write(g)}for(var l=0,h=0;h<e.length;h++)l+=e[h].dataCount;if(g.getLengthInBits()>8*l)throw new Error("code length overflow. ("+g.getLengthInBits()+">"+8*l+")");for(g.getLengthInBits()+4<=8*l&&g.put(0,4);0!=g.getLengthInBits()%8;)g.putBit(!1);for(;;){if(g.getLengthInBits()>=8*l)break;if(g.put(b.PAD0,8),g.getLengthInBits()>=8*l)break;g.put(b.PAD1,8)}return b.createBytes(g,e)},b.createBytes=function(a,b){for(var c=0,d=0,e=0,g=new Array(b.length),h=new Array(b.length),j=0;j<b.length;j++){var k=b[j].dataCount,l=b[j].totalCount-k;d=Math.max(d,k),e=Math.max(e,l),g[j]=new Array(k);for(var m=0;m<g[j].length;m++)g[j][m]=255&a.buffer[m+c];c+=k;var n=f.getErrorCorrectPolynomial(l),o=new i(g[j],n.getLength()-1),p=o.mod(n);h[j]=new Array(n.getLength()-1);for(var m=0;m<h[j].length;m++){var q=m+p.getLength()-h[j].length;h[j][m]=q>=0?p.get(q):0}}for(var r=0,m=0;m<b.length;m++)r+=b[m].totalCount;for(var s=new Array(r),t=0,m=0;d>m;m++)for(var j=0;j<b.length;j++)m<g[j].length&&(s[t++]=g[j][m]);for(var m=0;e>m;m++)for(var j=0;j<b.length;j++)m<h[j].length&&(s[t++]=h[j][m]);return s};for(var c={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},d={L:1,M:0,Q:3,H:2},e={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},f={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(a){for(var b=a<<10;f.getBCHDigit(b)-f.getBCHDigit(f.G15)>=0;)b^=f.G15<<f.getBCHDigit(b)-f.getBCHDigit(f.G15);return(a<<10|b)^f.G15_MASK},getBCHTypeNumber:function(a){for(var b=a<<12;f.getBCHDigit(b)-f.getBCHDigit(f.G18)>=0;)b^=f.G18<<f.getBCHDigit(b)-f.getBCHDigit(f.G18);return a<<12|b},getBCHDigit:function(a){for(var b=0;0!=a;)b++,a>>>=1;return b},getPatternPosition:function(a){return f.PATTERN_POSITION_TABLE[a-1]},getMask:function(a,b,c){switch(a){case e.PATTERN000:return 0==(b+c)%2;case e.PATTERN001:return 0==b%2;case e.PATTERN010:return 0==c%3;case e.PATTERN011:return 0==(b+c)%3;case e.PATTERN100:return 0==(Math.floor(b/2)+Math.floor(c/3))%2;case e.PATTERN101:return 0==b*c%2+b*c%3;case e.PATTERN110:return 0==(b*c%2+b*c%3)%2;case e.PATTERN111:return 0==(b*c%3+(b+c)%2)%2;default:throw new Error("bad maskPattern:"+a)}},getErrorCorrectPolynomial:function(a){for(var b=new i([1],0),c=0;a>c;c++)b=b.multiply(new i([1,g.gexp(c)],0));return b},getLengthInBits:function(a,b){if(b>=1&&10>b)switch(a){case c.MODE_NUMBER:return 10;case c.MODE_ALPHA_NUM:return 9;case c.MODE_8BIT_BYTE:return 8;case c.MODE_KANJI:return 8;default:throw new Error("mode:"+a)}else if(27>b)switch(a){case c.MODE_NUMBER:return 12;case c.MODE_ALPHA_NUM:return 11;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 10;default:throw new Error("mode:"+a)}else{if(!(41>b))throw new Error("type:"+b);switch(a){case c.MODE_NUMBER:return 14;case c.MODE_ALPHA_NUM:return 13;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 12;default:throw new Error("mode:"+a)}}},getLostPoint:function(a){for(var b=a.getModuleCount(),c=0,d=0;b>d;d++)for(var e=0;b>e;e++){for(var f=0,g=a.isDark(d,e),h=-1;1>=h;h++)if(!(0>d+h||d+h>=b))for(var i=-1;1>=i;i++)0>e+i||e+i>=b||(0!=h||0!=i)&&g==a.isDark(d+h,e+i)&&f++;f>5&&(c+=3+f-5)}for(var d=0;b-1>d;d++)for(var e=0;b-1>e;e++){var j=0;a.isDark(d,e)&&j++,a.isDark(d+1,e)&&j++,a.isDark(d,e+1)&&j++,a.isDark(d+1,e+1)&&j++,(0==j||4==j)&&(c+=3)}for(var d=0;b>d;d++)for(var e=0;b-6>e;e++)a.isDark(d,e)&&!a.isDark(d,e+1)&&a.isDark(d,e+2)&&a.isDark(d,e+3)&&a.isDark(d,e+4)&&!a.isDark(d,e+5)&&a.isDark(d,e+6)&&(c+=40);for(var e=0;b>e;e++)for(var d=0;b-6>d;d++)a.isDark(d,e)&&!a.isDark(d+1,e)&&a.isDark(d+2,e)&&a.isDark(d+3,e)&&a.isDark(d+4,e)&&!a.isDark(d+5,e)&&a.isDark(d+6,e)&&(c+=40);for(var k=0,e=0;b>e;e++)for(var d=0;b>d;d++)a.isDark(d,e)&&k++;var l=Math.abs(100*k/b/b-50)/5;return c+=10*l}},g={glog:function(a){if(1>a)throw new Error("glog("+a+")");return g.LOG_TABLE[a]},gexp:function(a){for(;0>a;)a+=255;for(;a>=256;)a-=255;return g.EXP_TABLE[a]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},h=0;8>h;h++)g.EXP_TABLE[h]=1<<h;for(var h=8;256>h;h++)g.EXP_TABLE[h]=g.EXP_TABLE[h-4]^g.EXP_TABLE[h-5]^g.EXP_TABLE[h-6]^g.EXP_TABLE[h-8];for(var h=0;255>h;h++)g.LOG_TABLE[g.EXP_TABLE[h]]=h;i.prototype={get:function(a){return this.num[a]},getLength:function(){return this.num.length},multiply:function(a){for(var b=new Array(this.getLength()+a.getLength()-1),c=0;c<this.getLength();c++)for(var d=0;d<a.getLength();d++)b[c+d]^=g.gexp(g.glog(this.get(c))+g.glog(a.get(d)));return new i(b,0)},mod:function(a){if(this.getLength()-a.getLength()<0)return this;for(var b=g.glog(this.get(0))-g.glog(a.get(0)),c=new Array(this.getLength()),d=0;d<this.getLength();d++)c[d]=this.get(d);for(var d=0;d<a.getLength();d++)c[d]^=g.gexp(g.glog(a.get(d))+b);return new i(c,0).mod(a)}},j.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],j.getRSBlocks=function(a,b){var c=j.getRsBlockTable(a,b);if(void 0==c)throw new Error("bad rs block @ typeNumber:"+a+"/errorCorrectLevel:"+b);for(var d=c.length/3,e=[],f=0;d>f;f++)for(var g=c[3*f+0],h=c[3*f+1],i=c[3*f+2],k=0;g>k;k++)e.push(new j(h,i));return e},j.getRsBlockTable=function(a,b){switch(b){case d.L:return j.RS_BLOCK_TABLE[4*(a-1)+0];case d.M:return j.RS_BLOCK_TABLE[4*(a-1)+1];case d.Q:return j.RS_BLOCK_TABLE[4*(a-1)+2];case d.H:return j.RS_BLOCK_TABLE[4*(a-1)+3];default:return void 0}},k.prototype={get:function(a){var b=Math.floor(a/8);return 1==(1&this.buffer[b]>>>7-a%8)},put:function(a,b){for(var c=0;b>c;c++)this.putBit(1==(1&a>>>b-c-1))},getLengthInBits:function(){return this.length},putBit:function(a){var b=Math.floor(this.length/8);this.buffer.length<=b&&this.buffer.push(0),a&&(this.buffer[b]|=128>>>this.length%8),this.length++}};var l=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],o=function(){var a=function(a,b){this._el=a,this._htOption=b};return a.prototype.draw=function(a){function g(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a);for(var d in b)b.hasOwnProperty(d)&&c.setAttribute(d,b[d]);return c}var b=this._htOption,c=this._el,d=a.getModuleCount();Math.floor(b.width/d),Math.floor(b.height/d),this.clear();var h=g("svg",{viewBox:"0 0 "+String(d)+" "+String(d),width:"100%",height:"100%",fill:b.colorLight});h.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),c.appendChild(h),h.appendChild(g("rect",{fill:b.colorDark,width:"1",height:"1",id:"template"}));for(var i=0;d>i;i++)for(var j=0;d>j;j++)if(a.isDark(i,j)){var k=g("use",{x:String(i),y:String(j)});k.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),h.appendChild(k)}},a.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},a}(),p="svg"===document.documentElement.tagName.toLowerCase(),q=p?o:m()?function(){function a(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}function d(a,b){var c=this;if(c._fFail=b,c._fSuccess=a,null===c._bSupportDataURI){var d=document.createElement("img"),e=function(){c._bSupportDataURI=!1,c._fFail&&_fFail.call(c)},f=function(){c._bSupportDataURI=!0,c._fSuccess&&c._fSuccess.call(c)};return d.onabort=e,d.onerror=e,d.onload=f,d.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==",void 0}c._bSupportDataURI===!0&&c._fSuccess?c._fSuccess.call(c):c._bSupportDataURI===!1&&c._fFail&&c._fFail.call(c)}if(this._android&&this._android<=2.1){var b=1/window.devicePixelRatio,c=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(a,d,e,f,g,h,i,j){if("nodeName"in a&&/img/i.test(a.nodeName))for(var l=arguments.length-1;l>=1;l--)arguments[l]=arguments[l]*b;else"undefined"==typeof j&&(arguments[1]*=b,arguments[2]*=b,arguments[3]*=b,arguments[4]*=b);c.apply(this,arguments)}}var e=function(a,b){this._bIsPainted=!1,this._android=n(),this._htOption=b,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=b.width,this._elCanvas.height=b.height,a.appendChild(this._elCanvas),this._el=a,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return e.prototype.draw=function(a){var b=this._elImage,c=this._oContext,d=this._htOption,e=a.getModuleCount(),f=d.width/e,g=d.height/e,h=Math.round(f),i=Math.round(g);b.style.display="none",this.clear();for(var j=0;e>j;j++)for(var k=0;e>k;k++){var l=a.isDark(j,k),m=k*f,n=j*g;c.strokeStyle=l?d.colorDark:d.colorLight,c.lineWidth=1,c.fillStyle=l?d.colorDark:d.colorLight,c.fillRect(m,n,f,g),c.strokeRect(Math.floor(m)+.5,Math.floor(n)+.5,h,i),c.strokeRect(Math.ceil(m)-.5,Math.ceil(n)-.5,h,i)}this._bIsPainted=!0},e.prototype.makeImage=function(){this._bIsPainted&&d.call(this,a)},e.prototype.isPainted=function(){return this._bIsPainted},e.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},e.prototype.round=function(a){return a?Math.floor(1e3*a)/1e3:a},e}():function(){var a=function(a,b){this._el=a,this._htOption=b};return a.prototype.draw=function(a){for(var b=this._htOption,c=this._el,d=a.getModuleCount(),e=Math.floor(b.width/d),f=Math.floor(b.height/d),g=['<table style="border:0;border-collapse:collapse;">'],h=0;d>h;h++){g.push("<tr>");for(var i=0;d>i;i++)g.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+e+"px;height:"+f+"px;background-color:"+(a.isDark(h,i)?b.colorDark:b.colorLight)+';"></td>');g.push("</tr>")}g.push("</table>"),c.innerHTML=g.join("");var j=c.childNodes[0],k=(b.width-j.offsetWidth)/2,l=(b.height-j.offsetHeight)/2;k>0&&l>0&&(j.style.margin=l+"px "+k+"px")},a.prototype.clear=function(){this._el.innerHTML=""},a}();QRCode=function(a,b){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:d.H},"string"==typeof b&&(b={text:b}),b)for(var c in b)this._htOption[c]=b[c];"string"==typeof a&&(a=document.getElementById(a)),this._android=n(),this._el=a,this._oQRCode=null,this._oDrawing=new q(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},QRCode.prototype.makeCode=function(a){this._oQRCode=new b(r(a,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(a),this._oQRCode.make(),this._el.title=a,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=d}();
--- END OF FILE: ./qrcode.min.js ---

--- FILE: ./README.md ---
# VoiceMux Bridge v2.1.0 ğŸ›°ï¸

VoiceMux Bridge ã¯ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®éŸ³å£°å…¥åŠ›ã‚’ PC ä¸Šã®ã‚ã‚‰ã‚†ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆï¼ˆChatGPT, Gmail, Slack ç­‰ï¼‰ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æŒ¿å…¥ã™ã‚‹ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã§ã™ã€‚

## ğŸš€ v2.1.0 ã®æ–°æ©Ÿèƒ½: Multi-language Support & Secure Push-Sync
å¾“æ¥ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆv1.xï¼‰ã§è¡Œã£ã¦ã„ãŸã€Œå®šæœŸçš„ãªãƒšãƒ¼ã‚¸ç›£è¦–ã€ã‚„ã€Œæ‰‹å‹•ã§ã® ID å–å¾—ã€ã‚’å®Œå…¨ã«å»ƒæ­¢ã—ã¾ã—ãŸã€‚

- **å¤šè¨€èªå¯¾å¿œ (i18n)**: æ—¥æœ¬èªã¨è‹±èªã®è¡¨ç¤ºã«å®Œå…¨å¯¾å¿œã€‚
- **ã‚¼ãƒ­è¨­å®šåŒæœŸ**: [VoiceMux Hub](https://hub.knc.jp) ã‚’é–‹ãã ã‘ã§ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ãŒå®‰å…¨ã‹ã¤å³åº§ã«æ‹¡å¼µæ©Ÿèƒ½ã¸ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚
- **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ»ãƒšã‚¢ãƒªãƒ³ã‚°**: ä¸€åº¦é€£æºã™ã‚Œã°ã€æ¬¡å›ã‹ã‚‰ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ã—ã¦å³åº§ã« QR ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã€‚
- **ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ç¬¬ä¸€**: ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ã‚„æš—å·éµï¼‰ãŒ HTML ä¸Šã«éœ²å‡ºã™ã‚‹ã“ã¨ãªãã€ãƒ–ãƒ©ã‚¦ã‚¶ã®æ­£è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚° API ã§å—ã‘æ¸¡ã—ã•ã‚Œã¾ã™ã€‚

## ğŸ›  ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ä½¿ã„æ–¹
1. [Chrome ã‚¦ã‚§ãƒ–ã‚¹ãƒˆã‚¢](https://chromewebstore.google.com/detail/voicemux-bridge/agkglknmadfhdfobmgecllpgoecebdip) ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚
2. ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®ãƒ‘ã‚ºãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã‹ã‚‰ VoiceMux Bridge ã‚’ã€Œãƒ”ãƒ³ç•™ã‚ã€ã—ã¾ã™ã€‚
3. [VoiceMux Hub](https://hub.knc.jp) ã‚’é–‹ãã€åˆæœŸåŒ–ã‚’å®Œäº†ã•ã›ã¾ã™ï¼ˆè‡ªå‹•çš„ã«æ‹¡å¼µæ©Ÿèƒ½ã¸åŒæœŸã•ã‚Œã¾ã™ï¼‰ã€‚
4. æ‹¡å¼µã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€è¡¨ç¤ºã•ã‚ŒãŸ QR ã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ãƒãƒ›ã§ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚Œã°æº–å‚™å®Œäº†ã§ã™ã€‚

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ (E2EE)
VoiceMux ã¯ **End-to-End æš—å·åŒ– (E2EE)** ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚
éŸ³å£°ã‹ã‚‰å¤‰æ›ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é›¢ã‚Œã‚‹å‰ã«**ã‚ãªãŸã®ãƒ‡ãƒã‚¤ã‚¹ä¸Š**ã§æš—å·åŒ–ã•ã‚Œã¾ã™ã€‚ä¸­ç¶™ã‚µãƒ¼ãƒãƒ¼ï¼ˆv.knc.jpï¼‰ã¯æš—å·åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’è»¢é€ã—ã€ãã®ä¸­èº«ã‚’è§£èª­ã™ã‚‹ã“ã¨ã¯æš—å·å­¦çš„ã«ä¸å¯èƒ½ã§ã™ã€‚

è©³ç´°ãªå®Ÿè£…ã®è¨¼æ‹ ã¯ [E2EEå®Ÿè£…æŠ€è¡“ãƒ¬ãƒãƒ¼ãƒˆ](./docs/E2EE_IMPLEMENTATION_JA.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸ“Š ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçµ±è¨ˆ (v2.1.0)
VoiceMux Bridge ã¯ã€è»½é‡ã§é€æ˜æ€§ã®é«˜ã„è¨­è¨ˆã‚’ç¶­æŒã—ã¦ã„ã¾ã™ã€‚
- **ç·ã‚³ãƒ¼ãƒ‰è¡Œæ•°**: ç´„ 1,050 è¡Œ (JS/HTML/Manifest)
- **ä¾å­˜é–¢ä¿‚**: ã‚¼ãƒ­ (QRç”Ÿæˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª 1ã¤ã®ã¿ã‚’åŒæ¢±)
- **é€šä¿¡å…ˆ**: `knc.jp` ãƒ‰ãƒ¡ã‚¤ãƒ³ã«é™å®š

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹
ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ [LICENSE](./LICENSE) ã«åŸºã¥ã„ã¦å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®ã‚³ãƒ¼ãƒ‰ã¯å®Œå…¨ã«ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã‚ã‚Šã€èª°ã§ã‚‚ç›£æŸ»å¯èƒ½ã§ã™ã€‚

--- END OF FILE: ./README.md ---

--- FILE: ./LICENSE ---
MIT License

Copyright (c) 2026 Kohei Kaneta

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

--- END OF FILE: ./LICENSE ---

--- FILE: ./adapters.json ---
[
  {
    "id": "gemini",
    "name": "Google Gemini",
    "host": "gemini.google.com",
    "inputSelector": "div[contenteditable='true'], .rich-textarea, div[role='textbox']",
    "submitSelector": "button[aria-label*='é€ä¿¡'], button[aria-label*='Send'], button.send-button, button:has(span.material-symbols-outlined)"
  },
  {
    "id": "chatgpt",
    "name": "ChatGPT",
    "host": "chatgpt.com",
    "inputSelector": "#prompt-textarea",
    "submitSelector": "button[data-testid='send-button']"
  },
  {
    "id": "claude",
    "name": "Claude",
    "host": "claude.ai",
    "inputSelector": "div[contenteditable='true']",
    "submitSelector": "button[aria-label*='Send'], button[aria-label*='é€ä¿¡']"
  },
  {
    "id": "perplexity",
    "name": "Perplexity",
    "host": "perplexity.ai",
    "inputSelector": "div[contenteditable='true'], textarea[placeholder*='Ask'], textarea",
    "submitSelector": "button[aria-label*='Submit'], button[aria-label*='Ask'], button:has(svg), .flex.items-center.justify-center.rounded-full.transition-all"
  },
  {
    "id": "treenote",
    "name": "Treenote",
    "host": "treenoteweb.pages.dev",
    "inputSelector": "textarea.auto-resize-textarea, textarea, div[contenteditable='true']",
    "submitSelector": "button.submit-btn"
  },
  {
    "id": "gmail",
    "name": "Gmail",
    "host": "mail.google.com",
    "inputSelector": "div[role='textbox'][contenteditable='true']",
    "submitSelector": null
  },
  {
    "id": "deepl",
    "name": "DeepL",
    "host": "deepl.com",
    "inputSelector": "div[contenteditable='true'], d-textarea",
    "submitSelector": null
  }
]

--- END OF FILE: ./adapters.json ---

--- FILE: ./docs/CHANGELOG.md ---
# Changelog

All notable changes to **VoiceMux Bridge** will be documented in this file.

## [2.1.0] - 2026-02-21
### Added
- **Multi-language Support (i18n)**: Full support for English and Japanese locales.
- **KNC ID Stateless Auth**: Implemented automatic session synchronization with `hub.knc.jp`. Pairing is now handled seamlessly without manual configuration.
- **Centralized Decryption**: Moved E2EE decryption logic to the Background Service Worker for enhanced security. Content scripts now handle only plaintext data.
- **Integrated Pairing**: Updated the extension popup and QR code to point to the modern Zen UI on `hub.knc.jp`.

## [1.6.1] - 2026-02-17
### Added
- **Transparency Reports**: Added detailed documentation on "Why we need All Site Access" and "E2EE Implementation Proof."
- **Developer Profile**: Linked to official Google Play Store profile to establish trust.
- **Sustainability Policy**: Added a section explaining why the service is free and how it stays resilient.

### Changed
- **Cross-Platform Compatibility**: Improved Base64 handling for 100% key compatibility with Go and Mobile clients.
- **Stability**: Added periodic heartbeat alarms to maintain WebSocket connections in Manifest V3.
- **Protocol**: Standardized on Phoenix Protocol vsn=2.0.0 (Array format).

## [1.6.0] - 2026-02-15
### Added
- **New Onboarding UI**: Redesigned popup with a step-by-step guide for new users.
- **Web Monitor Link**: Quick access to v.knc.jp from the extension popup.

### Changed
- **Injection Engine**: Refactored text injection logic using `InputEvent` for high compatibility with Gmail, Gemini, and ChatGPT.
- **Security**: Hardened origin checks and removed unnecessary permissions.

## [1.5.0] - 2026-02-14
### Added
- **Multi-Domain Support**: Added support for both `v.knc.jp` (Zen mode) and `t.knc.jp` (Translate mode).
- **Domain Migration**: Migrated primary infrastructure to `knc.jp`.

--- END OF FILE: ./docs/CHANGELOG.md ---

--- FILE: ./docs/CHANGELOG_JA.md ---
# æ›´æ–°å±¥æ­´ (Changelog)

VoiceMux Bridge ã®ä¸»è¦ãªå¤‰æ›´å±¥æ­´ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚

## [2.1.0] - 2026-02-21
### è¿½åŠ 
- **å¤šè¨€èªå¯¾å¿œ (i18n)**: æ—¥æœ¬èªã¨è‹±èªã®è¡¨ç¤ºã«å®Œå…¨å¯¾å¿œã€‚
- **KNC ID ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹èªè¨¼**: `hub.knc.jp` ã¨ã®è‡ªå‹•ã‚»ãƒƒã‚·ãƒ§ãƒ³åŒæœŸã‚’å®Ÿè£…ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹æ‰‹å‹•è¨­å®šãªã—ã§ãƒšã‚¢ãƒªãƒ³ã‚°ãŒå¯èƒ½ã«ã€‚
- **ä¸­å¤®é›†æ¨©çš„å¾©å·ãƒ­ã‚¸ãƒƒã‚¯**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Šã®ãŸã‚ã€E2EE å¾©å·å‡¦ç†ã‚’ Background Script ã«é›†ç´„ã€‚Content Script ã¯å¹³æ–‡ã®ã¿ã‚’æ‰±ã†ã‚ˆã†ç°¡ç´ åŒ–ã€‚
- **Hub é€£æºãƒšã‚¢ãƒªãƒ³ã‚°**: ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã® QR ã‚³ãƒ¼ãƒ‰ãŠã‚ˆã³ãƒªãƒ³ã‚¯å…ˆã‚’ `hub.knc.jp` ã®çµ±åˆ Zen UI ã¸å¤‰æ›´ã€‚

## [1.6.1] - 2026-02-17
### è¿½åŠ 
- **é€æ˜æ€§ãƒ¬ãƒãƒ¼ãƒˆ**: ã€Œãªãœå…¨ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒå¿…è¦ã‹ã€ãŠã‚ˆã³ã€ŒE2EEå®Ÿè£…ã®æŠ€è¡“çš„è¨¼æ˜ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã€‚
- **é–‹ç™ºè€…ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«**: ä¿¡é ¼æ€§å‘ä¸Šã®ãŸã‚ã€Google Play ã‚¹ãƒˆã‚¢ã®ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¸ã®ãƒªãƒ³ã‚¯ã‚’è¿½åŠ ã€‚
- **æŒç¶šå¯èƒ½æ€§ã¨å“²å­¦**: ç„¡æ–™æä¾›ã®ç†ç”±ã¨ã€AIé–‹ç™ºã«ã‚ˆã‚‹ç¶™ç¶šæ€§ã«ã¤ã„ã¦ã®èª¬æ˜ã‚’è¿½åŠ ã€‚

### å¤‰æ›´
- **ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ äº’æ›æ€§**: Goã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚„ãƒ¢ãƒã‚¤ãƒ«ã¨ã®éµäº’æ›æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã€Base64å‡¦ç†ã‚’æ”¹å–„ã€‚
- **å®‰å®šæ€§å‘ä¸Š**: Manifest V3 ç’°å¢ƒä¸‹ã§ã® WebSocket æ¥ç¶šã‚’ç¶­æŒã™ã‚‹ãŸã‚ã€å®šæœŸçš„ãªãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆå‡¦ç†ã‚’è¿½åŠ ã€‚
- **ãƒ—ãƒ­ãƒˆã‚³ãƒ«çµ±ä¸€**: é€šä¿¡å½¢å¼ã‚’ Phoenix Protocol vsn=2.0.0 (Array å½¢å¼) ã«çµ±ä¸€ã€‚

## [1.6.0] - 2026-02-15
### è¿½åŠ 
- **ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°UI**: åˆã‚ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã«ã€ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã®ã‚¬ã‚¤ãƒ‰ä»˜ããƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã¸åˆ·æ–°ã€‚
- **Webãƒ¢ãƒ‹ã‚¿ãƒ¼ã¸ã®ãƒªãƒ³ã‚¯**: æ‹¡å¼µæ©Ÿèƒ½å†…ã‹ã‚‰ v.knc.jp ã¸ç´ æ—©ãã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒªãƒ³ã‚¯ã‚’è¿½åŠ ã€‚

### å¤‰æ›´
- **å…¥åŠ›ã‚¨ãƒ³ã‚¸ãƒ³ã®åˆ·æ–°**: `InputEvent` ã‚’æ´»ç”¨ã—ãŸæ–°ã—ã„æ³¨å…¥ãƒ­ã‚¸ãƒƒã‚¯ã«ã‚ˆã‚Šã€Gmail, Gemini, ChatGPT ç­‰ã®è¤‡é›‘ãªã‚¨ãƒ‡ã‚£ã‚¿ã¸ã®å¯¾å¿œã‚’å¼·åŒ–ã€‚
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–**: Originæ¤œè¨¼ã®å³æ ¼åŒ–ã¨ã€ä¸è¦ãªãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã®å‰Šé™¤ã€‚

## [1.5.0] - 2026-02-14
### è¿½åŠ 
- **ãƒãƒ«ãƒãƒ‰ãƒ¡ã‚¤ãƒ³å¯¾å¿œ**: `v.knc.jp` (Zen) ã¨ `t.knc.jp` (ç¿»è¨³) ã®ä¸¡æ–¹ã«å¯¾å¿œã€‚
- **ãƒ‰ãƒ¡ã‚¤ãƒ³ç§»è¡Œ**: ä¸»è¦ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ `knc.jp` ãƒ‰ãƒ¡ã‚¤ãƒ³ã¸çµ±åˆã€‚

--- END OF FILE: ./docs/CHANGELOG_JA.md ---

--- FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION.md ---
# ã€é–‹ç™ºãƒ­ã‚°ã€‘Chromeæ‹¡å¼µã®ã€Œæ€–ã„è­¦å‘Šã€ã«ã¤ã„ã¦AIã¨ç›¸è«‡ã—ãŸè¨˜éŒ²

VoiceMux Bridge ã®ãƒªãƒªãƒ¼ã‚¹ã«ã‚ãŸã‚Šã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­¦å‘Šã«ã¤ã„ã¦ã€AIï¼ˆGeminiï¼‰ã¨æŠ€è¡“çš„ãªç›¸è«‡ã‚’ã—ãŸéš›ã®ãƒ­ã‚°ã‚’å…¬é–‹ã—ã¾ã™ã€‚ãªãœã“ã®ä»•æ§˜ï¼ˆæ¨©é™ï¼‰ã«ãªã£ã¦ã„ã‚‹ã®ã‹ã€ãã®çµŒç·¯ãŒã‚ã‹ã‚Šã¾ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
è‡ªä½œã®æ‹¡å¼µæ©Ÿèƒ½ã‚’å…¬é–‹ã—ã¾ã—ãŸãŒã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€Œã‚»ãƒ¼ãƒ• ãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ä¿è­·å¼·åŒ–æ©Ÿèƒ½ã§ä¿¡é ¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€ã¨ã„ã†è­¦å‘ŠãŒå‡ºã¦ãã¾ã™ã€‚ä½•ã‹ãƒã‚°ãŒã‚ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

#### ğŸ¤– AI
çµè«–ã‹ã‚‰è¨€ã†ã¨ã€ã“ã‚Œã¯**ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒã‚°ã‚„è¦ç´„é•åã§ã¯ãªãã€ä¸»ã«ã€Œé–‹ç™ºè€…ã¨ã—ã¦ã®å®Ÿç¸¾ï¼ˆä¿¡é ¼ï¼‰ãŒã¾ã è“„ç©ã•ã‚Œã¦ã„ãªã„ã€ã“ã¨ãŒåŸå› **ã§ã™ã€‚

Google Chromeã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä»•æ§˜ã«ã‚ˆã‚‹ã‚‚ã®ã§ã€ä»¥ä¸‹ã®ãƒã‚¤ãƒ³ãƒˆãŒå½±éŸ¿ã—ã¦ã„ã¾ã™ã€‚

1.  **ã€Œä¿¡é ¼ã§ãã‚‹é–‹ç™ºè€…ã€ã®åŸºæº–ã‚’æº€ãŸã—ã¦ã„ãªã„:** ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ç™»éŒ²ã‹ã‚‰æ—¥ãŒæµ…ã„ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ•°ãŒã¾ã å°‘ãªã„ãªã©ã€‚
2.  **å…¬é–‹ç›´å¾Œã§ã‚ã‚‹:** å…¬é–‹ã•ã‚ŒãŸã°ã‹ã‚Šã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€Googleå´ã®ã‚¹ã‚­ãƒ£ãƒ³ã‚„è©•ä¾¡ãŒçµ‚ã‚ã£ã¦ã„ãªã„ãŸã‚ã€è­¦å‘ŠãŒå‡ºã‚„ã™ã„å‚¾å‘ã«ã‚ã‚Šã¾ã™ã€‚

æ®‹å¿µãªãŒã‚‰ãƒœã‚¿ãƒ³ä¸€ã¤ã§æ¶ˆã™è¨­å®šã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€**ã€Œæ™‚é–“ãŒè§£æ±ºã™ã‚‹ï¼ˆå®Ÿç¸¾ã‚’ç©ã‚€ï¼‰ã€**ã®ã‚’å¾…ã¤ã®ãŒæ­£æ”»æ³•ã§ã™ã€‚å…¬é–‹ç›´å¾Œã«ã‚ˆãã‚ã‚‹ç¾è±¡ãªã®ã§ã€ã¾ãšã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€Œå®‰å…¨ã§ã™ã€ã¨ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã—ã¦å®Ÿç¸¾ã‚’ä½œã‚‹ã®ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’é€²ã‚ã‚‹ã¨ã€ä»Šåº¦ã¯ã€Œã™ã¹ã¦ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆä¸Šã«ã‚ã‚‹è‡ªåˆ†ã®å…¨ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å–ã‚Šã¨å¤‰æ›´ã€ã¨ã„ã†ã•ã‚‰ã«æ€–ã„è­¦å‘ŠãŒå‡ºã¾ã™ã€‚ã“ã‚Œã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¼•ã„ã¦ã—ã¾ã„ã¾ã™ã‚ˆã­ã€‚

#### ğŸ¤– AI
ãã®è­¦å‘Šã¯ã€**ã€Œç‰¹å®šã®ãƒšãƒ¼ã‚¸é™å®šã€ã‹ã‚‰ã€Œä»»æ„ã®ãƒšãƒ¼ã‚¸ï¼ˆã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ï¼‰ã€ã¸å…¥åŠ›å¯¾è±¡ã‚’åºƒã’ãŸã“ã¨**ãŒåŸå› ã§ã™ã­ã€‚

`manifest.json` ã§ `<all_urls>` ã¨ã„ã†æ¨©é™ã‚’ä½¿ã£ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ

VoiceMux Bridgeã®ã€Œã‚¹ãƒãƒ›ã«å‘ã‹ã£ã¦è©±ã›ã°ã€ä»Šé–‹ã„ã¦ã„ã‚‹ãƒšãƒ¼ã‚¸ã«å³åº§ã«å…¥åŠ›ã•ã‚Œã‚‹ã€ã¨ã„ã†ä½“é¨“ã‚’å®Ÿç¾ã™ã‚‹ã«ã¯ã€**ã‚ã‚‰ã‹ã˜ã‚ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ã§å—ä¿¡ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å¾…æ©Ÿã•ã›ã¦ãŠã**å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
Chromeã®ä»•æ§˜ä¸Šã€ã“ã®ã€Œå…¨ãƒšãƒ¼ã‚¸å¾…æ©Ÿã€ã®æ¨©é™ã‚’æ±‚ã‚ã‚‹ã¨ã€è‡ªå‹•çš„ã«ãã®å¼·ã„è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®æ­£å¸¸ãªä»£å„Ÿã§ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ã‚‚ã—ãã®æ¨©é™ã‚’ç‹­ã‚ãŸã‚‰ã©ã†ãªã‚Šã¾ã™ã‹ï¼Ÿ è­¦å‘Šã¯æ¶ˆãˆã¾ã™ã‹ï¼Ÿ

#### ğŸ¤– AI
æ¨©é™ã‚’ `activeTab` ã ã‘ã«ç‹­ã‚ã‚Œã°è­¦å‘Šã¯æ¶ˆãˆã¾ã™ã€‚ã—ã‹ã—ã€**ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«å‘¼ã³å‡ºã•ãªã„é™ã‚Šã€æ‹¡å¼µæ©Ÿèƒ½ã¯ä½•ã‚‚ã—ãªã„ï¼ˆã§ããªã„ï¼‰ã€** ã¨ã„ã†æŒ™å‹•ã«å¤‰ã‚ã‚Šã¾ã™ã€‚

å…·ä½“çš„ã«ã¯ã“ã†ãªã‚Šã¾ã™ï¼š

1.  Gemini Web ã‚’é–‹ã â†’ **ã‚¹ãƒãƒ›ã§è©±ã—ã¦ã‚‚ä½•ã‚‚èµ·ããªã„**ï¼ˆå—ä¿¡ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒå‹•ã„ã¦ã„ãªã„ï¼‰ã€‚
2.  æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’**ã‚¯ãƒªãƒƒã‚¯**ã™ã‚‹ â†’ ã‚„ã£ã¨å…¥åŠ›å¯èƒ½ã«ãªã‚‹ã€‚
3.  Gmail ã®ã‚¿ãƒ–ã¸ç§»å‹•ã™ã‚‹ â†’ **ã¾ãŸã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯**ã—ãªã„ã¨å‹•ã‹ãªã„ã€‚

æœ€å¤§ã®å•é¡Œã¯ã€**ã€Œã‚¯ãƒªãƒƒã‚¯ã‚’å¿˜ã‚Œã¦è©±ã—å§‹ã‚ãŸæ™‚ã€** ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€Œã›ã£ã‹ãé•·æ–‡ã‚’å–‹ã£ãŸã®ã«ã€PCã«å…¥åŠ›ã•ã‚Œãªã‹ã£ãŸï¼ã€ã¨ã„ã†ã‚¹ãƒˆãƒ¬ã‚¹ã‚’æ„Ÿã˜ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

VoiceMuxã®ã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ã®å ´åˆã€**ã€ŒPCå´ã¯ä½•ã‚‚ã—ãªãã¦ã„ã„ï¼ˆãƒãƒ³ã‚ºãƒ•ãƒªãƒ¼ï¼‰ã€** ã¨ã„ã†ã®ãŒæœ€å¤§ã®ä¾¡å€¤ãªã®ã§ã€ã‚¯ãƒªãƒƒã‚¯å¿…é ˆã«ã™ã‚‹ã®ã¯ã€Œä½¿ã„å‹æ‰‹ã®æ­»ã€ã‚’æ„å‘³ã—ã¾ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ãªã‚‹ã»ã©â€¦ã€‚ä»–ã®ä¼¼ãŸã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ï¼ˆVoiceInã¨ã‹ï¼‰ã¯ã©ã†ã—ã¦ã„ã‚‹ã‚“ã§ã™ã‹ï¼Ÿ

#### ğŸ¤– AI
èª¿ã¹ã¾ã—ãŸãŒã€**VoiceIn ã¯ã‚ãªãŸã¨åŒã˜ã€Œè­¦å‘ŠãŒå‡ºã‚‹æ–¹å¼ï¼ˆå…¨æ¨©é™ï¼‰ã€ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚**
å½¼ã‚‰ã¯ã€Œè­¦å‘Šã¯å‡ºã‚‹ã‘ã‚Œã©ã€ãã®ã¶ã‚“é­”æ³•ã®ã‚ˆã†ã«ä¾¿åˆ©ã§ã™ã‚ˆã€ã¨ã„ã†ã‚¹ã‚¿ãƒ³ã‚¹ã§ã€ä¿¡é ¼ã¨å®Ÿç¸¾ã§ã‚«ãƒãƒ¼ã—ã¦ã„ã¾ã™ã€‚

ä¸€æ–¹ã€Typeless ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µã§ã¯ãªãã€ŒOSã®ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒªã€ã‚’ä½œã‚‹ã“ã¨ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¶ç´„è‡ªä½“ã‚’å›é¿ã—ã¦ã„ã¾ã™ï¼ˆé–‹ç™ºã‚³ã‚¹ãƒˆã¯è·³ã­ä¸ŠãŒã‚Šã¾ã™ãŒï¼‰ã€‚

ã¾ãŸã€Honeyï¼ˆã‚¯ãƒ¼ãƒãƒ³ã‚¢ãƒ—ãƒªï¼‰ã®ã‚ˆã†ã«ã€Œä½¿ã†æ™‚ã ã‘è¨±å¯ã‚’æ±‚ã‚ã‚‹ã€æ–¹å¼ã‚‚ã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯ã€Œè²·ã„ç‰©ã€ã¨ã„ã†æ˜ç¢ºãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒã‚ã‚‹ãƒ„ãƒ¼ãƒ«ã ã‹ã‚‰æˆç«‹ã—ã¾ã™ã€‚ã„ã¤å…¥åŠ›ãŒç™ºç”Ÿã™ã‚‹ã‹ã‚ã‹ã‚‰ãªã„VoiceMuxã®ã‚ˆã†ãªã‚¤ãƒ³ãƒ•ãƒ©ç³»ãƒ„ãƒ¼ãƒ«ã§ã¯ã€ã‚„ã¯ã‚Š**ã€Œå…¨æ¨©é™ï¼ˆè­¦å‘Šã‚ã‚Šï¼‰ã€ãŒç‹é“ã‹ã¤æ­£è§£**ã ã¨æ€ã„ã¾ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ã‚ã‹ã‚Šã¾ã—ãŸã€‚å¤‰ã«å°ç´°å·¥ã‚’ã—ã¦ä¸ä¾¿ã«ã™ã‚‹ã‚ˆã‚Šã€æ­£ç›´ã«ã€Œä¾¿åˆ©ã•ã®ãŸã‚ã®æ¨©é™ã§ã™ã€ã¨èª¬æ˜ã—ã¦é€²ã‚ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚ã‚ã¨ã€ã‚µãƒ¼ãƒãƒ¼å´ã¯é‹ç”¨ä¸Šã®éƒ½åˆã§ã‚½ãƒ¼ã‚¹ã‚’éå…¬é–‹ã«ã—ãŸã„ã®ã§ã™ãŒã€ãã‚Œã¯ã€Œã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã€ã‚’è¬³ã†ä¸Šã§å•é¡Œã«ãªã‚Šã¾ã™ã‹ï¼Ÿ

#### ğŸ¤– AI
è³¢æ˜ãªåˆ¤æ–­ã§ã™ã€‚
ã‚µãƒ¼ãƒãƒ¼å´ã«ã¤ã„ã¦ã§ã™ãŒã€**ã€Œæ‹¡å¼µæ©Ÿèƒ½ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰å´ãŒã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã‚ã‚Œã°ã€E2EEã®ä¿¡é ¼æ€§ã¯æ‹…ä¿ã§ãã‚‹ã€**ã®ã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸€ç•ªæã‚Œã‚‹ã®ã¯ã€Œè‡ªåˆ†ã®ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ä½•ãŒèµ·ãã¦ã„ã‚‹ã‹ã€ã§ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶å´ã§é€ä¿¡å‰ã«ãƒ‡ãƒ¼ã‚¿ãŒæš—å·åŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã•ãˆã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§è¨¼æ˜ã§ãã‚Œã°ã€ãã®å…ˆã®ã‚µãƒ¼ãƒãƒ¼ãŒã©ã‚Œã ã‘ã€Œãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã€ã§ã‚ã£ã¦ã‚‚ã€ä¸­èº«ã‚’ç›—ã¿è¦‹ã‚‹ã“ã¨ã¯ä¸å¯èƒ½ã§ã™ã€‚

ã‚€ã—ã‚ã€ã‚µãƒ¼ãƒãƒ¼ã‚’ã€ŒãŸã ã®æš—å·åŒ–ãƒ‡ãƒ¼ã‚¿ã®åœŸç®¡ã€ã«å¾¹ã•ã›ã‚‹ã“ã¨ã§ã€é‹ç”¨ã‚³ã‚¹ãƒˆã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’è‡ªåˆ†ã§ç®¡ç†ã—ã‚„ã™ããªã‚‹ãƒ¡ãƒªãƒƒãƒˆã‚‚ã‚ã‚Šã¾ã™ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ã€Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã¯å…¬é–‹ã€ã‚µãƒ¼ãƒãƒ¼å´ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆé‹ç”¨ï¼ˆã§ã‚‚ä¸­èº«ã¯è¦‹ã‚Œãªã„ï¼‰ã€ã¨æ­£ç›´ã«æ›¸ãã®ãŒã€æœ€ã‚‚ä¿¡é ¼ã•ã‚Œã‚‹å½¢ã§ã™ã€‚è‡ªä¿¡ã‚’æŒã£ã¦é€²ã‚ã¾ã—ã‚‡ã†ã€‚

--- END OF FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION.md ---

--- FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION_EN.md ---
# [Dev Log] Chatting with AI about Chrome Extension Security Warnings

Sharing the raw conversation log where I consulted with AI (Gemini) about the scary security warnings that appear when installing VoiceMux Bridge. This explains the "why" behind the permissions.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
I just published my extension, but when I try to install it, I get a warning saying "This extension is not trusted by Enhanced Safe Browsing." Is there a bug?

#### ğŸ¤– AI
Long story short: **This isn't a bug or a violation. It's mainly because you haven't accumulated "trust" as a developer yet.**

It's just how Chrome's security works. Hereâ€™s why:

1.  **You don't meet the "Trusted Developer" criteria yet:** Your account is new, or the install count is low.
2.  **It's brand new:** Since it was just published, Google hasn't finished their automated scanning and reputation evaluation.

Unfortunately, there's no "fix it" button. The standard solution is to **wait for time to solve it.** It happens to almost everyone. Just announce to your users "It's safe, just new," and let the reputation build up naturally.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
When I proceed with the installation, I get an even scarier warning: "Read and change all your data on all websites." Users are going to run away when they see this.

#### ğŸ¤– AI
That warning appears because **you expanded the scope from "specific pages" to "any page."**

Are you using `<all_urls>` in your `manifest.json`?

To achieve the VoiceMux experienceâ€”where you speak to your phone and it *instantly* types into whatever page is openâ€”**you need the receiver program waiting in the background on every page.**
Chrome forces that scary warning whenever you ask for this "wait everywhere" permission. Itâ€™s the price you pay for the feature.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
What happens if I restrict that permission? Will the warning go away?

#### ğŸ¤– AI
If you restrict it to `activeTab`, the warning disappears. But the behavior changes to: **"The extension does nothing unless you explicitly click it."**

Here is the reality:

1.  Open Gemini Web -> **Speak to phone, nothing happens.** (Receiver isn't running).
2.  **Click** the extension icon -> Now it can type.
3.  Switch tab to Gmail -> **Click the icon again** or it won't work.

The biggest issue is **when users forget to click.** They'll dictate a long paragraph, hit send, and... nothing appears on the PC. That's a terrible user experience.

For a tool like VoiceMux, **"Hands-free on the PC side"** is the core value. Making clicks mandatory effectively kills the UX.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
I see... What about other tools like VoiceIn? How do they handle this?

#### ğŸ¤– AI
I checked, and **VoiceIn uses the exact same approach as you (Full Permissions with the warning).**
Their stance is: "You get a warning, but in exchange, you get a magic-like seamless experience." They cover the fear with their reputation.

Other tools like Typeless avoid browser warnings by building a native OS app instead (which is way harder to build).

There are tools like Honey that ask for permission "only when needed," but that works because "shopping" is a distinct event. For an infrastructure tool like VoiceMux where input can happen anytime, **sticking with "Full Permissions (Warning)" is the standard and correct choice.**

---

#### ğŸ§‘â€ğŸ’» Developer (User)
Got it. Instead of crippling the features to hide the warning, I'll be honest and explain "This permission is for your convenience." Also, I plan to keep the relay server code private for operational reasons. Is that a problem for the "Open Source" claim?

#### ğŸ¤– AI
That's a sound strategy!
Regarding the server: **As long as the extension (client) is open-source, the integrity of the E2EE remains verifiable.**

What users care about most is what happens inside their browser. If you can prove via open-source code that data is encrypted *before* it leaves the client, the relay server becomes a "dumb pipe." Even if the server is a private "black box," it is mathematically impossible for it to read your messages.

In fact, keeping the server private allows you to manage operational security and spam prevention more effectively without compromising user privacy. Simply state that the "Client is Open Source, while the Server is Private (but blind to data)," and you will build genuine trust. Go for it with confidence.

--- END OF FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION_EN.md ---

--- FILE: ./docs/E2EE_IMPLEMENTATION_EN.md ---
# VoiceMux Bridge: E2EE Implementation Report

This report explains how VoiceMux Bridge ensures that your data remains private and invisible to our servers, using snippets from the actual source code.

---

## 1. Local Key Generation and Secure Transfer
The encryption key (AES-GCM 128-bit) is generated within [VoiceMux Hub](https://hub.knc.jp) and securely pushed to the extension via the official browser messaging API. It is never sent to our servers.

**Source: `background.js` (Receiver side)**
```javascript
// Around line 155: Listening for credential push from the Hub
chrome.runtime.onMessageExternal.addListener((request, sender, sendResponse) => {
  if (request.action === "SYNC_AUTH") {
    const { uuid, token, key } = request.payload;
    
    // Storing in the extension's private secure storage
    chrome.storage.local.set({
      'voicemux_room_id': uuid,
      'voicemux_token': token,
      'voicemux_key': key
    }, () => { ... });
  }
});
```
The key is stored in `chrome.storage.local`, an isolated storage area provided by the browser that websites and external servers cannot access.

---

## 2. Zero-Knowledge Key Exchange
We use URL hash fragments to share keys between your PC and smartphone without the server ever seeing the key.

**Source: `popup.js`**
```javascript
// Around line 45: Constructing the pairing URL
let pairingUrl = `${hubOrigin}/${roomId}/zen`;
pairingUrl += `?token=${token}&uuid=${roomId}`;
pairingUrl += `#key=${keyBase64}`; // Key is included in the hash
```
The key is placed after the `#` symbol. By technical design, **anything after the `#` (hash fragment) is handled exclusively by the browser and is NEVER sent to the server.**

---

## 3. Client-Side Decryption
The extension receives only encrypted blobs from the relay server. The actual decryption happens locally inside the extension's background process.

**Source: `background.js`**
```javascript
// Around line 43: The core decryption logic
async function decrypt(payload) {
  // Receives only ciphertext and IV (Initialization Vector)
  if (!payload.ciphertext || !payload.iv) return payload.text || "";
  
  try {
    const key = await getDecryptionKey(); // Import key from local storage
    const iv = Uint8Array.from(safeAtob(payload.iv), c => c.charCodeAt(0));
    const ciphertext = Uint8Array.from(safeAtob(payload.ciphertext), c => c.charCodeAt(0));

    // AES-GCM decryption using the Web Crypto API
    const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ciphertext);
    
    // Returns the plaintext only to the active browser tab
    return new TextDecoder().decode(decrypted);
  } catch (e) {
    // If the key is missing or incorrect, decryption is mathematically impossible
    return "[Decryption Error]";
  }
}
```
The relay server only sees the `ciphertext` string, which acts as noise. It has no mathematical means to read your data.

---

## 4. Conclusion
Based on the implementation above:
1. **Exclusive Access:** Only you possess the encryption keys on your devices.
2. **Secure Transport:** Keys never touch the network or the server.
3. **Transparent Logic:** Since the extension is open-source, anyone can verify that we do not leak data or bypass encryption.

---

## 5. How to Verify the Identity of the Code
"How do I know the code running in my browser is the same as this GitHub code?" You can verify this yourself with these steps:

### A. Inspect the installed files on your disk
Chrome stores the source code of installed extensions on your local machine.

- **Windows**: `%LOCALAPPDATA%\Google\Chrome\User Data\Default\Extensions\omdfoongpifbbhapnpbocfoijkglegpd`
- **Mac**: `~/Library/Application Support/Google/Chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`
- **Linux**: `~/.config/google-chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`

You can open the JS files (`background.js`, `content.js`, etc.) in these folders and compare them with the GitHub repository. VoiceMux Bridge does not minify or obfuscate its code, making comparison easy.

### B. Inspect the Running Background Code
1. Open `chrome://extensions` in your browser.
2. Click the **"Service Worker"** link for VoiceMux Bridge.
3. Developer Tools will open, allowing you to read the `background.js` source code currently in execution.

VoiceMux Bridge proves its integrity through total transparency.

---
*Last Updated: 2026-02-21 (v2.1.0)*

--- END OF FILE: ./docs/E2EE_IMPLEMENTATION_EN.md ---

--- FILE: ./docs/E2EE_IMPLEMENTATION_JA.md ---
# VoiceMux Bridge: E2EEå®Ÿè£…æŠ€è¡“ãƒ¬ãƒãƒ¼ãƒˆ

VoiceMux Bridge ãŒã©ã®ã‚ˆã†ã«ã—ã¦ãƒ‡ãƒ¼ã‚¿ã®ç§˜å¯†ã‚’ä¿æŒã—ã€ã‚µãƒ¼ãƒãƒ¼ã«å†…å®¹ã‚’è¦‹ã›ãªã„ä»•çµ„ã¿ã«ãªã£ã¦ã„ã‚‹ã‹ã‚’ã€å®Ÿéš›ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’æŠœç²‹ã—ã¦è§£èª¬ã—ã¾ã™ã€‚

---

## 1. ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®æš—å·éµç”Ÿæˆã¨ã‚»ã‚­ãƒ¥ã‚¢ãªè»¢é€
æš—å·éµï¼ˆAES-GCM 128bitï¼‰ã¯ [VoiceMux Hub](https://hub.knc.jp) ã§ç”Ÿæˆã•ã‚Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã®æ­£è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚° API ã‚’é€šã˜ã¦æ‹¡å¼µæ©Ÿèƒ½ã¸å®‰å…¨ã«ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã¸é€ä¿¡ã•ã‚Œã‚‹ã“ã¨ã¯æ±ºã—ã¦ã‚ã‚Šã¾ã›ã‚“ã€‚

**è¨¼æ‹ ã‚³ãƒ¼ãƒ‰: `background.js` (å—ä¿¡å´)**
```javascript
// 155è¡Œç›®ä»˜è¿‘: Hub ã‹ã‚‰ã®è³‡æ ¼æƒ…å ±ãƒ—ãƒƒã‚·ãƒ¥ã‚’å¾…æ©Ÿ
chrome.runtime.onMessageExternal.addListener((request, sender, sendResponse) => {
  if (request.action === "SYNC_AUTH") {
    const { uuid, token, key } = request.payload;
    
    // æ‹¡å¼µæ©Ÿèƒ½å°‚ç”¨ã®å®‰å…¨ãªé ˜åŸŸã«ä¿å­˜
    chrome.storage.local.set({
      'voicemux_room_id': uuid,
      'voicemux_token': token,
      'voicemux_key': key
    }, () => { ... });
  }
});
```
ã“ã®éµã¯ `chrome.storage.local` ã¨ã„ã†ã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒæä¾›ã™ã‚‹ã€Œæ‹¡å¼µæ©Ÿèƒ½å°‚ç”¨ã®éš”é›¢ã•ã‚ŒãŸå®‰å…¨ãªé ˜åŸŸã€ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

---

## 2. ã‚µãƒ¼ãƒãƒ¼ã‚’çµŒç”±ã—ãªã„éµå…±æœ‰ï¼ˆZero-Knowledgeï¼‰
ã‚¹ãƒãƒ›ã¨ã®ãƒšã‚¢ãƒªãƒ³ã‚°æ™‚ã€URLã®ãƒãƒƒã‚·ãƒ¥ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆ`#`ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€ã‚µãƒ¼ãƒãƒ¼ã«éµã‚’çŸ¥ã‚‰ã›ãšã«ãƒ‡ãƒã‚¤ã‚¹é–“ã§å…±æœ‰ã—ã¾ã™ã€‚

**è¨¼æ‹ ã‚³ãƒ¼ãƒ‰: `popup.js`**
```javascript
// 45è¡Œç›®ä»˜è¿‘: ãƒšã‚¢ãƒªãƒ³ã‚°ç”¨URLã®æ§‹ç¯‰
let pairingUrl = `${hubOrigin}/${roomId}/zen`;
pairingUrl += `?token=${token}&uuid=${roomId}`;
pairingUrl += `#key=${keyBase64}`; // éµã‚’ãƒãƒƒã‚·ãƒ¥ã«å«ã‚ã‚‹
```
URLã® `#` ä»¥é™ã®éƒ¨åˆ†ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ä»•æ§˜ã«ã‚ˆã‚Š **ã€Œã‚µãƒ¼ãƒãƒ¼ã«ã¯é€ä¿¡ã•ã‚Œãªã„ã€** ã¨ã„ã†ç‰¹æ€§ãŒã‚ã‚Šã¾ã™ã€‚éµã®æƒ…å ±ã¯ã‚¹ãƒãƒ›ã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ã ã‘ã§å‡¦ç†ã•ã‚Œã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ã‚µãƒ¼ãƒãƒ¼ï¼ˆä¸­ç¶™å™¨ï¼‰ã«ã¯ä¸€åˆ‡å±Šãã¾ã›ã‚“ã€‚

---

## 3. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ã®å¾©å·
æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã€Œæš—å·åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®å¡Šã€ã®ã¿ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’å¹³æ–‡ã«æˆ»ã™ï¼ˆå¾©å·ã™ã‚‹ï¼‰å‡¦ç†ã¯ã€æ‹¡å¼µæ©Ÿèƒ½ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹å†…ã§è¡Œã‚ã‚Œã¾ã™ã€‚

**è¨¼æ‹ ã‚³ãƒ¼ãƒ‰: `background.js`**
```javascript
// 43è¡Œç›®ä»˜è¿‘: å¾©å·å‡¦ç†ã®æ ¸å¿ƒ
async function decrypt(payload) {
  // payload.ciphertextï¼ˆæš—å·æ–‡ï¼‰ã¨ payload.ivï¼ˆåˆæœŸåŒ–ãƒ™ã‚¯ãƒˆãƒ«ï¼‰ã®ã¿ã‚’å—ã‘å–ã‚‹
  if (!payload.ciphertext || !payload.iv) return payload.text || "";
  
  try {
    const key = await getDecryptionKey(); // ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰éµã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
    const iv = Uint8Array.from(safeAtob(payload.iv), c => c.charCodeAt(0));
    const ciphertext = Uint8Array.from(safeAtob(payload.ciphertext), c => c.charCodeAt(0));

    // Web Crypto API ã«ã‚ˆã‚‹ AES-GCM å¾©å·
    const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ciphertext);
    
    // å¾©å·ã•ã‚ŒãŸå¹³æ–‡ã®ã¿ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã¸é€ä¿¡
    return new TextDecoder().decode(decrypted);
  } catch (e) {
    // éµãŒæ­£ã—ããªã„å ´åˆã€ä¸­èº«ã‚’èª­ã¿å–ã‚‹ã“ã¨ã¯æš—å·å­¦çš„ã«ä¸å¯èƒ½
    return "[Decryption Error]";
  }
}
```
ã‚µãƒ¼ãƒãƒ¼ã¯æ„å‘³ã‚’æŒãŸãªã„æš—å·æ–‡ï¼ˆ`ciphertext`ï¼‰ã‚’è»¢é€ã—ã¦ã„ã‚‹ã ã‘ã§ã€ãã®å†…å®¹ã‚’èª­ã¿å–ã‚‹æ•°å­¦çš„ãªæ‰‹æ®µã‚’æŒã¡ã¾ã›ã‚“ã€‚

---

## 4. çµè«–
ä»¥ä¸Šã®å®Ÿè£…ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®å®‰å…¨æ€§ãŒæŠ€è¡“çš„ã«æ‹…ä¿ã•ã‚Œã¦ã„ã¾ã™ã€‚

1.  **éµã®ç‹¬å **: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒã‚¤ã‚¹é–“ï¼ˆPCã¨ã‚¹ãƒãƒ›ï¼‰ä»¥å¤–ã«éµã¯å­˜åœ¨ã—ã¾ã›ã‚“ã€‚
2.  **å®‰å…¨ãªé€šä¿¡**: éµæœ¬ä½“ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆï¼‰ã‚’æµã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
3.  **é€æ˜æ€§ã®æ‹…ä¿**: æ‹¡å¼µæ©Ÿèƒ½ãŒã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã‚ã‚‹ãŸã‚ã€ä¸Šè¨˜ã®å®Ÿè£…ã«å˜˜ãŒãªã„ã“ã¨ã‚’èª°ã§ã‚‚æ¤œè¨¼å¯èƒ½ã§ã™ã€‚

---

## 5. ã‚¹ãƒˆã‚¢ç‰ˆã¨GitHubã®ã‚³ãƒ¼ãƒ‰ãŒåŒä¸€ã‹ç¢ºèªã™ã‚‹æ–¹æ³•
ã€ŒGitHubã®ã‚³ãƒ¼ãƒ‰ã¯ç¶ºéº—ã ãŒã€ã‚¹ãƒˆã‚¢ã§é…å¸ƒã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯ä¸­èº«ãŒé•ã†ã®ã§ã¯ãªã„ã‹ï¼Ÿã€ã¨ã„ã†ç–‘å•ã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ãŒè§£æ¶ˆã§ãã¾ã™ã€‚

### A. ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚ŒãŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã™ã‚‹
Chromeã‚¦ã‚§ãƒ–ã‚¹ãƒˆã‚¢ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸæ‹¡å¼µæ©Ÿèƒ½ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã€ã‚ãªãŸã®PCã®ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

- **Windows**: `%LOCALAPPDATA%\Google\Chrome\User Data\Default\Extensions\omdfoongpifbbhapnpbocfoijkglegpd`
- **Mac**: `~/Library/Application Support/Google/Chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`
- **Linux**: `~/.config/google-chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`

ã“ã®ãƒ•ã‚©ãƒ«ãƒ€å†…ã® JS ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`background.js`, `content.js` ç­‰ï¼‰ã‚’é–‹ãã€GitHub ä¸Šã®ã‚³ãƒ¼ãƒ‰ã¨æ¯”è¼ƒã—ã¦ã¿ã¦ãã ã•ã„ã€‚VoiceMux Bridge ã¯ã‚³ãƒ¼ãƒ‰ã®é›£èª­åŒ–ï¼ˆèª­ã¿ã¥ã‚‰ãã™ã‚‹å‡¦ç†ï¼‰ã‚’è¡Œã£ã¦ã„ãªã„ãŸã‚ã€ãã®ã¾ã¾æ¯”è¼ƒãŒå¯èƒ½ã§ã™ã€‚

### B. å®Ÿè¡Œä¸­ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã‚‹
1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ `chrome://extensions` ã‚’é–‹ãã¾ã™ã€‚
2. VoiceMux Bridge ã® **ã€Œã‚µãƒ¼ãƒ“ã‚¹ ãƒ¯ãƒ¼ã‚«ãƒ¼ã€** ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
3. ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ãŒé–‹ãã€ç¾åœ¨å‹•ä½œã—ã¦ã„ã‚‹ `background.js` ã®ã‚½ãƒ¼ã‚¹ã‚’ç›´æ¥ç¢ºèªã§ãã¾ã™ã€‚

VoiceMux Bridge ã¯ã€æŠ€è¡“çš„ãªèª å®Ÿã•ã‚’é€æ˜æ€§ã«ã‚ˆã£ã¦è¨¼æ˜ã—ã¾ã™ã€‚

---
*æœ€çµ‚æ›´æ–°: 2026-02-21 (v2.1.0)*

--- END OF FILE: ./docs/E2EE_IMPLEMENTATION_JA.md ---

--- FILE: ./docs/USER_GUIDE_EN.md ---
# VoiceMux Bridge User Guide ğŸ›°ï¸

Welcome to VoiceMux Bridge!
This extension allows you to use your smartphone's familiar keyboard to type seamlessly into any input field on your PC (ChatGPT, Gemini, Gmail, Slack, etc.).

No complex setup is required. Let's get started!

---

## 1. Preparation: Sync with the Hub

First, enable the extension.

1.  Open [VoiceMux Hub](https://hub.knc.jp) on your PC.
2.  As soon as the site opens, your secure credentials will be automatically synced to this extension.
3.  Click the **VoiceMux icon (microphone stand mark)** in the top right of your browser.
4.  If you see "Ready to Pair!" and a QR code, you're all set!

> ğŸ’¡ **Tip**: "Pin" the icon to your toolbar for instant access to the QR code.

---

## 2. Connect: Pair with Your Smartphone

1.  Scan the displayed **QR code** with your smartphone's camera.
2.  Once the dedicated input page opens on your phone, pairing is complete.

Your smartphone and PC are now connected via a private channel protected by strong End-to-End Encryption (E2EE).

---

## 3. Usage: Talk to Your Phone

The best part of VoiceMux is using **"Gboard" or "iPhone Voice Dictation"** directly on your PC.

1.  On your PC, click into any text input field (ChatGPT, Gmail, etc.) where you want to type.
2.  Tap the input area on your phone to bring up the keyboard.
3.  Press the **"Microphone button"** on your keyboard and speak to your phone.
4.  When you stop speaking... your words will appear directly at your PC's cursor position!

---

## 4. Advance: Grow Your Dictionary

VoiceMux Hub helps you fix common misrecognitions of technical terms or names.

*   **Error Correction**: Fixing text in the Hub editor teaches the AI to be smarter next time.
*   **Prompt Generation**: Click **"ğŸª„ Fix Errors & Generate Prompts"** at the bottom of the extension to open the Hub and optimize your input for AI assistants.

---

## 5. Privacy & Security

VoiceMux prioritizes your privacy.
*   **Private Data**: Your text is encrypted directly between your phone and PC. Not even our servers can read it.
*   **Offline Cache**: Once synced, you don't need to open the Hub site anymore. Just click the extension icon to start pairing instantly using cached credentials.

---

## 6. Troubleshooting

*   **No QR Code**: Try refreshing [VoiceMux Hub](https://hub.knc.jp) and then click the extension icon again.
*   **Text Not Appearing**: Make sure you've clicked inside a text field on your PC and that the cursor is active.

---

We hope VoiceMux makes your daily work and creative sessions smoother and more enjoyable!
Feel free to return to this guide whenever you need help.

--- END OF FILE: ./docs/USER_GUIDE_EN.md ---

--- FILE: ./docs/USER_GUIDE_JA.md ---
# VoiceMux Bridge ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ‰ ğŸ›°ï¸

VoiceMux Bridgeï¼ˆãƒœã‚¤ã‚¹ãƒ ã‚¯ã‚¹ãƒ»ãƒ–ãƒªãƒƒã‚¸ï¼‰ã¸ã‚ˆã†ã“ãï¼
ã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ã‚¹ãƒãƒ›ã®ã€Œä½¿ã„æ…£ã‚ŒãŸã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã€ã‚’ä½¿ã£ã¦ã€ãƒ‘ã‚½ã‚³ãƒ³ã®ã‚ã‚‰ã‚†ã‚‹å…¥åŠ›æ¬„ï¼ˆGemini, ChatGPT, Gmail, Slackãªã©ï¼‰ã¸ã‚¹ãƒ©ã‚¹ãƒ©ã¨æ–‡å­—ã‚’å…¥åŠ›ã™ã‚‹ãŸã‚ã®æ¶ã‘æ©‹ã§ã™ã€‚

é›£ã—ã„è¨­å®šã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®ã‚¬ã‚¤ãƒ‰ã¨ä¸€ç·’ã«ã€æœ€åˆã®ä¸€æ­©ã‚’è¸ã¿å‡ºã—ã¾ã—ã‚‡ã†ã€‚

---

## 1. æº–å‚™ï¼šWebã‚µã‚¤ãƒˆã¨ã¤ãªã’ã‚ˆã†ï¼ˆåŒæœŸï¼‰

ã¾ãšã€æ‹¡å¼µæ©Ÿèƒ½ã‚’ä½¿ãˆã‚‹çŠ¶æ…‹ã«ã—ã¾ã™ã€‚

1.  ãƒ‘ã‚½ã‚³ãƒ³ã§ [VoiceMux Hub](https://hub.knc.jp) ã‚’é–‹ãã¾ã™ã€‚
2.  ã‚µã‚¤ãƒˆãŒé–‹ãã¨åŒæ™‚ã«ã€å®‰å…¨ãªèªè¨¼æƒ…å ±ãŒã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¸è‡ªå‹•çš„ã«é€ã‚‰ã‚Œã¾ã™ã€‚
3.  ãƒ–ãƒ©ã‚¦ã‚¶å³ä¸Šã® **VoiceMuxã‚¢ã‚¤ã‚³ãƒ³ï¼ˆãƒã‚¤ã‚¯ã‚¹ã‚¿ãƒ³ãƒ‰ã®ãƒãƒ¼ã‚¯ï¼‰** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
4.  ã€Œãƒšã‚¢ãƒªãƒ³ã‚°ã®æº–å‚™å®Œäº†ã€ã¨è¡¨ç¤ºã•ã‚Œã€QRã‚³ãƒ¼ãƒ‰ãŒå‡ºã¦ã„ã‚Œã°æº–å‚™OKã§ã™ï¼

> ğŸ’¡ **ãƒ’ãƒ³ãƒˆ**: ã‚¢ã‚¤ã‚³ãƒ³ã‚’ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã«ã€Œãƒ”ãƒ³ç•™ã‚ã€ã—ã¦ãŠãã¨ã€ã„ã¤ã§ã‚‚ã™ãã«QRã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã§ãã¦ä¾¿åˆ©ã§ã™ã€‚

---

## 2. ã¤ãªã’ã‚ˆã†ï¼šã‚¹ãƒãƒ›ã¨ãƒšã‚¢ãƒªãƒ³ã‚°

1.  è¡¨ç¤ºã•ã‚ŒãŸ **QRã‚³ãƒ¼ãƒ‰** ã‚’ã‚¹ãƒãƒ›ã®ã‚«ãƒ¡ãƒ©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã¾ã™ã€‚
2.  ã‚¹ãƒãƒ›ã§å°‚ç”¨ã®å…¥åŠ›ç”»é¢ãŒé–‹ã„ãŸã‚‰ã€é€£æºå®Œäº†ã§ã™ã€‚

ã‚ãªãŸã®ã‚¹ãƒãƒ›ã¨ãƒ‘ã‚½ã‚³ãƒ³ã¯ã€å¼·åŠ›ãªæš—å·ï¼ˆE2EEï¼‰ã§å®ˆã‚‰ã‚ŒãŸå°‚ç”¨ã®é€šã‚Šé“ã§ã¤ãªãŒã‚Šã¾ã—ãŸã€‚

---

## 3. ã¤ã‹ã£ã¦ã¿ã‚ˆã†ï¼šã„ã¤ã‚‚ã®ã‚¹ãƒãƒ›ã§è©±ã—ã‹ã‘ã‚‹

VoiceMuxã®æœ€å¤§ã®ç‰¹å¾´ã¯ã€ã‚¹ãƒãƒ›ã§ã„ã¤ã‚‚ä½¿ã£ã¦ã„ã‚‹ **ã€ŒGboardã€ã‚„ã€ŒiPhoneã®éŸ³å£°å…¥åŠ›ã€** ã‚’ãã®ã¾ã¾ãƒ‘ã‚½ã‚³ãƒ³ã§ä½¿ãˆã‚‹ã“ã¨ã§ã™ã€‚

1.  ãƒ‘ã‚½ã‚³ãƒ³ã§ã€æ–‡å­—ã‚’å…¥åŠ›ã—ãŸã„ã‚µã‚¤ãƒˆï¼ˆChatGPT, Gmailãªã©ï¼‰ã®å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚«ãƒ¼ã‚½ãƒ«ã‚’åˆã‚ã›ã¾ã™ã€‚
2.  ã‚¹ãƒãƒ›ã®ç”»é¢ã«ã‚ã‚‹å…¥åŠ›ã‚¨ãƒªã‚¢ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’å‡ºã—ã¾ã™ã€‚
3.  ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã«ã‚ã‚‹ **ã€Œãƒã‚¤ã‚¯ã®ãƒœã‚¿ãƒ³ã€** ã‚’æŠ¼ã—ã¦ã€ã‚¹ãƒãƒ›ã«å‘ã‹ã£ã¦è©±ã—ã‹ã‘ã¦ã¿ã¦ãã ã•ã„ã€‚
4.  è©±ã—çµ‚ã‚ã‚‹ã¨â€¦â€¦ã‚ãªãŸã®è¨€è‘‰ãŒã€ãƒ‘ã‚½ã‚³ãƒ³ã®å…¥åŠ›æ¬„ã«ç›´æ¥å…¥åŠ›ã•ã‚Œã¾ã™ï¼

---

## 4. ã‚‚ã£ã¨ä¾¿åˆ©ã«ï¼šè¾æ›¸ã‚’è‚²ã¦ã‚‹

éŸ³å£°å…¥åŠ›ã§ã‚ˆãã‚ã‚‹ã€Œå°‚é–€ç”¨èªã®èª¤å¤‰æ›ã€ã¯ã€[VoiceMux Hub](https://hub.knc.jp) ã§ä¿®æ­£ã§ãã¾ã™ã€‚

*   **èª¤èªè­˜ã®ä¿®æ­£**: Hub ã®ã‚¨ãƒ‡ã‚£ã‚¿ã§æ–‡å­—ã‚’ç›´ã™ã¨ã€AIãŒæ¬¡å›ã‹ã‚‰ã®å¤‰æ›ã‚’è³¢ãã—ã¦ãã‚Œã¾ã™ã€‚
*   **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ**: æ‹¡å¼µæ©Ÿèƒ½ã®ä¸‹éƒ¨ã«ã‚ã‚‹ **ã€ŒğŸª„ èª¤èªè­˜ã®ä¿®æ­£ãƒ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã€** ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€Hub ãŒé–‹ãã€å…¥åŠ›ã—ãŸå†…å®¹ã‚’ã•ã‚‰ã«AIå‘ã‘ã«æœ€é©åŒ–ã§ãã¾ã™ã€‚

---

## 5. å®‰å¿ƒãƒ»å®‰å…¨ã®ãŸã‚ã«

VoiceMuxã¯ã€ã‚ãªãŸã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’ä¸€ç•ªå¤§åˆ‡ã«ã—ã¦ã„ã¾ã™ã€‚
*   **ã‚ãªãŸã®æ–‡å­—ã¯ã€èª°ã«ã‚‚è¦‹ã‚‰ã‚Œã¾ã›ã‚“**: ã‚¹ãƒãƒ›ã¨ãƒ‘ã‚½ã‚³ãƒ³ã®é–“ã§ç›´æ¥æš—å·åŒ–ã•ã‚Œã‚‹ãŸã‚ã€é€”ä¸­ã®ã‚µãƒ¼ãƒãƒ¼ã§ã™ã‚‰ä¸­èº«ã‚’èª­ã‚€ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
*   **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½**: ä¸€åº¦é€£æºã™ã‚Œã°ã€æ¬¡å›ã‹ã‚‰ã¯ Hub ã‚µã‚¤ãƒˆã‚’é–‹ã‹ãªãã¦ã‚‚ã€æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’æŠ¼ã™ã ã‘ã§å³åº§ã«ä½¿ã„å§‹ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

---

## 6. å›°ã£ãŸã¨ãã¯ï¼Ÿ

*   **QRã‚³ãƒ¼ãƒ‰ãŒå‡ºãªã„**: [VoiceMux Hub](https://hub.knc.jp) ã‚’ä¸€åº¦ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆå†èª­ã¿è¾¼ã¿ï¼‰ã—ã¦ã‹ã‚‰ã€ã‚‚ã†ä¸€åº¦ã‚¢ã‚¤ã‚³ãƒ³ã‚’æŠ¼ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
*   **æ–‡å­—ãŒå…¥åŠ›ã•ã‚Œãªã„**: ãƒ‘ã‚½ã‚³ãƒ³ã®å…¥åŠ›æ¬„ã‚’ä¸€åº¦ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ã‚«ãƒ¼ã‚½ãƒ«ãŒãƒã‚«ãƒã‚«ã—ã¦ã„ã‚‹çŠ¶æ…‹ã«ã—ã¦ãã ã•ã„ã€‚

---

æ¯æ—¥ã®ãŠä»•äº‹ã‚„å‰µä½œæ´»å‹•ãŒã€ã‚¹ãƒãƒ›ã®åŠ›ã§ã‚‚ã£ã¨æ¥½ã—ãã€ã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚Šã¾ã™ã‚ˆã†ã«ï¼
ã‚‚ã—ä½¿ã„æ–¹ãŒã‚ã‹ã‚‰ãªããªã£ãŸã‚‰ã€ã„ã¤ã§ã‚‚ã“ã®ã‚¬ã‚¤ãƒ‰ã«æˆ»ã£ã¦ãã¦ãã ã•ã„ã­ã€‚

--- END OF FILE: ./docs/USER_GUIDE_JA.md ---

--- FILE: ./docs/WHY_PERMISSIONS_EN.md ---
# Transparency Report: Why VoiceMux Bridge Requests "Access to All Sites"

**VoiceMux Bridge** is designed to provide a seamless bridge between your smartphone's voice recognition and your desktop browser. This document explains our technical decisions regarding Chrome Extension permissions and our commitment to user privacy.

---

## 1. Why does Chrome say this extension is "Not Trusted"?

### The Issue
When installing from the Chrome Web Store, you might see this message:

> **Warning:** This extension is not trusted by Enhanced Safe Browsing.

### The Reason
This is not due to a bug or malware. It is a standard automated security check by Google based on:

- **Developer Longevity:** The developer account is relatively new.
- **User Base:** The extension was recently published and has a growing but still small number of users.

**Our Commitment:**
VoiceMux Bridge is fully open-source. We provide the source code on GitHub for public auditing to ensure complete transparency while Google's automated trust score accumulates.

---

## 2. Why "Read and Change All Your Data on All Websites"?

### The Reason: Ensuring a "Frictionless" UX
The core value of VoiceMux is the **"Magic Experience"**â€”speak into your phone, and text appears on your PC instantly without you having to touch your mouse.

To achieve this, the extension must be able to:

1. **Standby:** Listen for incoming encrypted data regardless of which tab (ChatGPT, Gemini, Notion, etc.) you are currently using.
2. **Auto-Injection:** Detect the active input field as soon as you switch tabs and inject the text without manual intervention.

If we restricted permissions to "activeTab" (only when clicked), **you would have to click the extension icon every single time you switch a tab.** This would destroy the hands-free utility that makes VoiceMux valuable.

---

## 3. Privacy and Security by Design

We understand that "All Site Access" is a powerful permission. We balance this responsibility with the following transparency measures:

- **Open Source Client:** The source code for the Chrome Extension is fully public on GitHub. This allows anyone to verify that data is encrypted *before* it leaves your browser and that we are not touching sensitive data like passwords.
- **End-to-End Encryption (E2EE):** While our relay server operates in a private environment, it only handles encrypted blobs. Since the encryption happens in the open-source client, the server remains a "black box" that cannot see or log your actual text.
- **Zero-Knowledge Key Exchange:** Your encryption keys are shared with your phone via URL hash fragments (`#key=...`). By technical design, these fragments are never sent to any server, ensuring your keys never touch the network.
- **No Tracking:** We do not collect browsing history or analytics. Your encryption keys and Room IDs stay stored locally on your devices.

---

## 4. Industry Standards

Most essential productivity tools, such as **1Password, Grammarly, and DeepL**, require the same level of permission. Because these tools must be ready to assist you the moment you start typing, constant presence is a technical necessity.

---

## Conclusion

We chose this permission model to deliver the **fastest, most seamless input experience possible.** While the system warning looks intimidating, we stand behind our transparent, E2EE-secured architecture to earn your trust.

---
*Last Updated: 2026-02-17*

--- END OF FILE: ./docs/WHY_PERMISSIONS_EN.md ---

--- FILE: ./docs/WHY_PERMISSIONS_JA.md ---
# Chromeæ‹¡å¼µæ©Ÿèƒ½ã®ã€Œå¼·åŠ›ãªæ¨©é™ã€ã¨UXã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã«ã¤ã„ã¦

**VoiceMux Bridge** ã¯ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®éŸ³å£°å…¥åŠ›ã‚’PCã®ã‚ã‚‰ã‚†ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã¸ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«è»¢é€ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ã€Œã™ã¹ã¦ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆä¸Šã®å…¨ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å–ã‚Šã¨å¤‰æ›´ã€ã¨ã„ã†è­¦å‘Šã®æ„å›³ã¨ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¸ã®é…æ…®ã«ã¤ã„ã¦é–‹ç™ºãƒãƒ¼ãƒ ã®è¦‹è§£ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚

---

## 1. ãªãœã€Œä¿¡é ¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€ã¨ã„ã†è­¦å‘ŠãŒå‡ºã‚‹ã®ã‹ï¼Ÿ

### èƒŒæ™¯
Chrome ã‚¦ã‚§ãƒ–ã‚¹ãƒˆã‚¢ã‹ã‚‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

> **è­¦å‘Š:** ã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ã‚»ãƒ¼ãƒ• ãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ä¿è­·å¼·åŒ–æ©Ÿèƒ½ã§ä¿¡é ¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

### ç†ç”±
ã“ã‚Œã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æ¬ é™¥ã§ã¯ãªãã€Google Chrome ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è©•ä¾¡ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™ã€‚ä¸»ã«ä»¥ä¸‹ã®æ¡ä»¶ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

- **é–‹ç™ºè€…å®Ÿç¸¾ã®è“„ç©æœŸé–“:** ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ç™»éŒ²ã‹ã‚‰ã®æœŸé–“ãŒçŸ­ã„ã€‚
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°:** å…¬é–‹ç›´å¾Œã§åˆ©ç”¨è€…ãŒé™å®šçš„ã§ã‚ã‚‹ã€‚

**VoiceMux ã®å¯¾å¿œ:**
ç§ãŸã¡ã¯ã™ã¹ã¦ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ GitHub ã§å…¬é–‹ã—ã¦ãŠã‚Šã€èª°ã§ã‚‚å®‰å…¨æ€§ã‚’ç›£æŸ»ã§ãã‚‹çŠ¶æ…‹ã«ã—ã¦ã„ã¾ã™ã€‚åˆ©ç”¨è€…ãŒå¢—ãˆã‚‹ã«ã¤ã‚Œã¦ã€ã“ã®è­¦å‘Šã¯è‡ªå‹•çš„ã«è¡¨ç¤ºã•ã‚Œãªããªã‚Šã¾ã™ã€‚

---

## 2. ãªãœã€Œå…¨ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã€ãŒå¿…è¦ãªã®ã‹ï¼Ÿ

### ç†ç”±ï¼šã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªã€Œãƒãƒ³ã‚ºãƒ•ãƒªãƒ¼ä½“é¨“ã€ã®å®Ÿç¾
VoiceMux Bridge ã®æ ¸å¿ƒã¯ã€**ã€ŒPCå´ã«è§¦ã‚Œã‚‹ã“ã¨ãªãã€ã‚¹ãƒãƒ›ã«è©±ã—ã‹ã‘ã‚‹ã ã‘ã§æ–‡å­—ãŒå…¥åŠ›ã•ã‚Œã‚‹ã€**ã¨ã„ã†ä½“é¨“ã§ã™ã€‚

ã“ã®ã€Œé­”æ³•ã®ã‚ˆã†ãªä½“é¨“ã€ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€æ‹¡å¼µæ©Ÿèƒ½ãŒä»¥ä¸‹ã®å‹•ä½œã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

1. **å¾…æ©Ÿ:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã©ã®ã‚¿ãƒ–ï¼ˆGemini, ChatGPT, Gmailç­‰ï¼‰ã‚’é–‹ã„ã¦ã‚‚ã€éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Œã‚‹çŠ¶æ…‹ã«ã™ã‚‹ã€‚
2. **è‡ªå‹•æ¤œçŸ¥:** ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆãŸéš›ã€æ–°ã—ã„ãƒšãƒ¼ã‚¸ä¸Šã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å³åº§ã«ç‰¹å®šã—ã¦æ–‡å­—ã‚’æµã—è¾¼ã‚€ã€‚

ã‚‚ã—æ¨©é™ã‚’ã€Œã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã ã‘ã€ã«åˆ¶é™ã—ãŸå ´åˆã€**ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã³ã«æ¯å›æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¨±å¯ã‚’ä¸ãˆã‚‹**æ“ä½œãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã§ã¯éŸ³å£°å…¥åŠ›ã®åˆ©ä¾¿æ€§ãŒæãªã‚ã‚Œã€ãƒ„ãƒ¼ãƒ«ã®å­˜åœ¨æ„ç¾©ãŒå¤±ã‚ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚

---

## 3. ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¨å®‰å…¨æ€§ã«ã¤ã„ã¦

ç§ãŸã¡ã¯ã€å¼·åŠ›ãªæ¨©é™ã‚’è¦æ±‚ã™ã‚‹è²¬ä»»ã¨ã—ã¦ã€ä»¥ä¸‹ã®è¨­è¨ˆã¨æƒ…å ±å…¬é–‹ã‚’å¾¹åº•ã—ã¦ã„ã¾ã™ã€‚

- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹åŒ–:** æ‹¡å¼µæ©Ÿèƒ½ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã™ã¹ã¦ GitHub ã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã€Œãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰é€ä¿¡ã•ã‚Œã‚‹å‰ã«ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãæš—å·åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ã€ã€Œå…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆä»¥å¤–ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã„ãªã„ã‹ã€ã‚’èª°ã§ã‚‚ç›£æŸ»å¯èƒ½ã§ã™ã€‚
- **ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰æš—å·åŒ– (E2EE):** éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚„ãƒ†ã‚­ã‚¹ãƒˆã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã¨ã‚¹ãƒãƒ›ã®é–“ã§ç›´æ¥æš—å·åŒ–ã•ã‚Œã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼å´ã¯ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰éå…¬é–‹ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆç’°å¢ƒã§é‹ç”¨ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§æš—å·åŒ–ãŒå®Œçµã—ã¦ã„ã‚‹ãŸã‚ã€ã‚µãƒ¼ãƒãƒ¼ï¼ˆå½“ã‚µã‚¤ãƒˆï¼‰ã§ã•ãˆä¸­èº«ã‚’èª­ã¿å–ã‚‹ã“ã¨ã¯ç‰©ç†çš„ã«ä¸å¯èƒ½ã§ã™ã€‚
- **ã‚µãƒ¼ãƒãƒ¼ã«éµã‚’æ¸¡ã•ãªã„ä»•çµ„ã¿:** ã‚¹ãƒãƒ›ã¨ã®ãƒšã‚¢ãƒªãƒ³ã‚°ã«ä½¿ç”¨ã™ã‚‹æš—å·éµã¯ã€URLã®ãƒãƒƒã‚·ãƒ¥ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆ`#` ä»¥é™ã®éƒ¨åˆ†ï¼‰ã¨ã—ã¦å…±æœ‰ã•ã‚Œã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ä»•æ§˜ä¸Šã€ã“ã®éƒ¨åˆ†ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œãªã„ãŸã‚ã€éµã®æƒ…å ±ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æµã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
- **æœ€å°é™ã®ãƒ‡ãƒ¼ã‚¿åé›†:** æ‹¡å¼µæ©Ÿèƒ½ã¯è¨­å®šï¼ˆRoom ID / Keyï¼‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã™ã‚‹ã®ã¿ã§ã€é–²è¦§å±¥æ­´ã‚„å€‹äººæƒ…å ±ã‚’å¤–éƒ¨ã¸é€ä¿¡ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

---

## 4. ä»–ã®ãƒ„ãƒ¼ãƒ«ã¨ã®æ¯”è¼ƒ

å¤šãã®ã‚¤ãƒ³ãƒ•ãƒ©ç³»ãƒ„ãƒ¼ãƒ«ï¼ˆ1Password, Grammarly, DeepLç­‰ï¼‰ã‚‚ã€åŒæ§˜ã®ç†ç”±ã§ã€Œå…¨ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã€ã‚’è¦æ±‚ã—ã¾ã™ã€‚ã€Œã„ã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã‚’å¿…è¦ã¨ã™ã‚‹ã‹äºˆæ¸¬ã§ããªã„ã€ãƒ„ãƒ¼ãƒ«ã«ã¨ã£ã¦ã€ã“ã®æ¨©é™ã¯åˆ©ä¾¿æ€§ã¨å®‰å…¨æ€§ã‚’ä¸¡ç«‹ã™ã‚‹ãŸã‚ã®æ¨™æº–çš„ãªé¸æŠã§ã™ã€‚

---

## çµè«–

VoiceMux Bridge ã¯ã€**ã€Œç©¶æ¥µã®å…¥åŠ›ä½“é¨“ã€ã‚’æä¾›ã™ã‚‹ãŸã‚ã«ç¾åœ¨ã®æ¨©é™è¨­å®šã‚’é¸æŠã—ã¾ã—ãŸã€‚** è­¦å‘Šã¯å¼·åŠ›ã«è¦‹ãˆã¾ã™ãŒã€ç§ãŸã¡ã¯é€æ˜æ€§ã¨æŠ€è¡“ï¼ˆE2EEï¼‰ã«ã‚ˆã£ã¦ãã®ä¿¡é ¼ã«å¿œãˆã¾ã™ã€‚

---
*æœ€çµ‚æ›´æ–°: 2026-02-17*

--- END OF FILE: ./docs/WHY_PERMISSIONS_JA.md ---

--- FILE: ./docs/community-adapters.md ---
# VoiceMux Community Adapters Catalog ğŸ“‚

Copy the JSON snippets below and paste them into the **Custom Site Adapters** field in your VoiceMux Extension Options.

---

### ğŸ“§ Outlook (Web)
Supports both personal (outlook.com) and business (Office 365).
```json
{
  "id": "outlook",
  "name": "Outlook",
  "host": "outlook",
  "inputSelector": "div[role='textbox'][aria-label*='ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸'], div[role='textbox'][aria-label*='Message']",
  "submitSelector": null
}
```

### ğŸ“§ Yahoo! Mail (Japan)
```json
{
  "id": "yahoo-mail-jp",
  "name": "Yahoo! Mail JP",
  "host": "mail.yahoo.co.jp",
  "inputSelector": "div[role='textbox']",
  "submitSelector": null
}
```

### ğŸ’¬ Slack (Web)
```json
{
  "id": "slack",
  "name": "Slack",
  "host": "slack.com",
  "inputSelector": ".ql-editor",
  "submitSelector": "button[data-testid='composer_send_button']"
}
```

### ğŸ“ Notion
```json
{
  "id": "notion",
  "name": "Notion",
  "host": "notion.so",
  "inputSelector": "div[contenteditable='true']",
  "submitSelector": null
}
```

---

### ğŸ’¡ How to contribute
If you've created a working adapter for a new site, please open a Pull Request or Issue to add it to this list!

--- END OF FILE: ./docs/community-adapters.md ---

--- FILE: ./PRIVACY.md ---
# Privacy Policy for VoiceMux Bridge

Last updated: 2026-02-21

## 1. Data Collection
VoiceMux Bridge does **not** collect, store, or transmit any personal data, keystrokes, or browsing history to our servers.

## 2. End-to-End Encryption (E2EE)
All data transmitted from your mobile device to this extension is encrypted using Client-Side AES-GCM (128-bit).
- **Decryption Keys**: These keys are generated within VoiceMux Hub and securely pushed to the extension via the browser's internal messaging API. They are stored in `chrome.storage.local`.
- **Zero-Knowledge**: Keys are shared with your mobile device via URL hash fragments (`#key=...`). These fragments are handled exclusively by the browser and are never sent to any server by design.

## 3. Permissions
The extension requires the following permissions to function:
- **activeTab**: Used only to inject text into the input field of the website you are currently using, and only upon your explicit request via the paired mobile device.
- **storage**: Used to save your local configuration, including your unique Room ID, encryption key, and any Custom Site Adapters you define.

## 4. Third-Party Services
VoiceMux Bridge acts as a bridge between your mobile device and the AI services you choose to use (e.g., Gemini, ChatGPT). We do not control and are not responsible for the privacy practices of those third-party services.

## 5. Contact
If you have any questions about this Privacy Policy, please open an issue on our [GitHub repository](https://github.com/Kaneta/voicemux-bridge).

--- END OF FILE: ./PRIVACY.md ---

--- FILE: ./background.js ---
/**
 * VoiceMux Bridge: Extension Service Worker (WebSocket Relay)
 * Version: 2.2.17
 */

const BASE_WS_URL = "wss://v.knc.jp/socket/websocket";
const MAX_RETRY_DELAY = 30000;

let socket = null;
let heartbeatInterval = null;
let retryTimer = null;
let retryDelay = 1000;
let currentRoomId = null;
let isJoined = false; 
const JOIN_REF = "1"; 

/** @intent Synchronous Base64 conversion to prevent Promise leakage. */
function safeAtob(str) {
  if (!str) return "";
  try {
    return atob(str.replace(/-/g, "+").replace(/_/g, "/"));
  } catch (e) {
    return "";
  }
}

/** @intent Robust AES-GCM decryption. */
async function decrypt(payload) {
  try {
    const data = await chrome.storage.local.get('voicemux_key');
    if (!data.voicemux_key) return "[No Key]";
    const localHint = data.voicemux_key.substring(0, 4);
    if (payload.key_hint && payload.key_hint !== localHint) return "[Key Mismatch]";

    const rawKey = safeAtob(data.voicemux_key);
    const key = await crypto.subtle.importKey("raw", Uint8Array.from(rawKey, c => c.charCodeAt(0)), { name: "AES-GCM" }, false, ["decrypt"]);
    const iv = Uint8Array.from(safeAtob(payload.iv), c => c.charCodeAt(0));
    const ciphertext = Uint8Array.from(safeAtob(payload.ciphertext), c => c.charCodeAt(0));
    const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ciphertext);
    return new TextDecoder().decode(decrypted);
  } catch (e) {
    return "[Decryption Error]";
  }
}

async function connect() {
  if (socket && (socket.readyState === WebSocket.CONNECTING || socket.readyState === WebSocket.OPEN)) return;
  const data = await chrome.storage.local.get(['voicemux_token', 'voicemux_room_id']);
  if (!data.voicemux_token || !data.voicemux_room_id) return;

  currentRoomId = data.voicemux_room_id;
  const topic = `room:${currentRoomId}`; 
  socket = new WebSocket(`${BASE_WS_URL}?vsn=2.0.0&token=${data.voicemux_token}`);

  socket.onopen = () => {
    console.log("VoiceMux: Socket established. Joining room...");
    isJoined = false;
    socket.send(JSON.stringify([JOIN_REF, JOIN_REF, topic, "phx_join", {}]));
    if (heartbeatInterval) clearInterval(heartbeatInterval);
    heartbeatInterval = setInterval(() => { if (socket?.readyState === WebSocket.OPEN) socket.send(JSON.stringify([null, "heartbeat", "phoenix", "heartbeat", {}])); }, 30000);
  };

  socket.onmessage = async (event) => {
    const [joinRef, ref, msgTopic, eventName, payload] = JSON.parse(event.data);
    if (msgTopic !== topic) return;

    // DESIGN INTENT: Remote logging mirror for PC console debugging.
    chrome.tabs.query({active: true, lastFocusedWindow: true}, (tabs) => {
      if (tabs[0]) chrome.tabs.sendMessage(tabs[0].id, { action: "LOG", log_level: "info", message: `ğŸ“¡ [${eventName}] | Sender: ${payload?.sender_tab_id || 'system'}` }).catch(() => {});
    });

    if (eventName === "phx_reply" && payload?.status === "ok") {
      console.log("VoiceMux: Channel Joined Successfully.");
      isJoined = true;
      socket.send(JSON.stringify([JOIN_REF, "2", topic, "device_online", { sender_tab_id: "extension" }]));
    } else if (eventName === "update_text" || eventName === "confirm_send") {
      const plaintext = await decrypt(payload);
      chrome.tabs.query({active: true, lastFocusedWindow: true}, (tabs) => { if (tabs[0]) chrome.tabs.sendMessage(tabs[0].id, { action: eventName, plaintext }).catch(() => {}); });
    } else if (eventName === "device_online" && payload.sender_tab_id !== "extension") {
      if (isJoined) {
        // DESIGN INTENT: Bidirectional handshake. Reply to mobile that PC is online.
        socket.send(JSON.stringify([JOIN_REF, "3", topic, "device_online", { sender_tab_id: "extension" }]));
      }
    } else if (eventName === "remote_command") {
      // DESIGN INTENT: Execute remote action (INSERT, NEWLINE, SUBMIT, CLEAR, LOG)
      const text = (payload.ciphertext && payload.iv) ? await decrypt(payload) : payload.text;
      chrome.tabs.query({active: true, lastFocusedWindow: true}, (tabs) => { if (tabs[0]) chrome.tabs.sendMessage(tabs[0].id, { ...payload, text }).catch(() => {}); });
    }
  };
  socket.onclose = () => { isJoined = false; scheduleReconnect(); };
  socket.onerror = () => socket.close();
}

function scheduleReconnect() { if (retryTimer) clearTimeout(retryTimer); retryTimer = setTimeout(connect, retryDelay); retryDelay = Math.min(retryDelay * 2, MAX_RETRY_DELAY); }

chrome.runtime.onMessage.addListener((request) => {
  if (request.action === "SYNC_AUTH") {
    chrome.storage.local.set({ 'voicemux_token': request.token, 'voicemux_room_id': request.roomId, 'voicemux_key': request.key }, () => { if (socket) socket.close(); connect(); });
  }
});

connect();

--- END OF FILE: ./background.js ---

--- FILE: ./collect_context.sh ---
#!/bin/bash
echo "Generating full_context.txt for VoiceMux Bridge..."
# Find relevant files and concatenate them with headers
# Exclude node_modules, .git, and common binary extensions
find . -maxdepth 2 -not -path '*/.*' -not -path './node_modules*' -not -name "*.png" -not -name "*.zip" -not -name "*.svg" -not -name "full_context.txt" -not -name "STORE_DESCRIPTION_*.txt" -not -name "DRAFT_*" -not -name "MEMO_*" -type f | while read file; do
    echo "--- FILE: $file ---" >> full_context.txt
    cat "$file" >> full_context.txt
    echo -e "
--- END OF FILE: $file ---
" >> full_context.txt
done
echo "Done! Context collected in full_context.txt"

--- END OF FILE: ./collect_context.sh ---

--- FILE: ./gen_map.sh ---
#!/bin/bash

# Configuration: Project-specific extensions
EXTENSIONS="js,jsx,ts,tsx,kt,ex,exs,svelte,astro,html,css,dart,go"
COMMENT_LIMIT=3

echo "# Codebase Map (Enhanced with Intent)"
echo "This map provides a structural overview with documentation comments. For implementation details, use MCP."
echo ""

# Get relevant files from git, excluding minified and build artifacts
FILES=$(git ls-files | grep -E "\.(${EXTENSIONS//,/|})$" | grep -vE "\.min\.js$|drizzle/|static/")

if [ -z "$FILES" ]; then
    # Fallback to find, explicitly excluding common noise
    FILES=$(find . -maxdepth 4 -type f \
        -not -path "*/node_modules/*" \
        -not -path "*/.*" \
        -not -path "*/drizzle/*" \
        -not -path "*/static/*" \
        | grep -E "\.(${EXTENSIONS//,/|})$" | grep -v "\.min\.js$")
fi

if [ -z "$FILES" ]; then
    echo "No files found with extensions: $EXTENSIONS"
    exit 0
fi

# Run ctags and process output
echo "$FILES" | xargs ctags --output-format=json --fields=+n+S --sort=no 2>/dev/null | jq -r -s '
    sort_by(.path) | .[] | 
    "\(.path)\t\(.name)\t\(.kind)\t\(.line)\t\(.signature // "")"
' | while IFS=$'\t' read -r PATH_VAL NAME KIND LINE_NUM SIG; do
    # Group by file
    if [ "$CURRENT_PATH" != "$PATH_VAL" ]; then
        echo -e "\n### FILE: $PATH_VAL"
        CURRENT_PATH=$PATH_VAL
    fi

    # Extract comments directly before the definition
    if [ -f "$PATH_VAL" ]; then
        COMMENTS=$(head -n $((LINE_NUM - 1)) "$PATH_VAL" 2>/dev/null | tail -n $COMMENT_LIMIT | grep -E "^\s*(//|/\*|\*|#|@doc|--)" | sed 's/^[[:space:]]*//' | tr '\n' ' ' | sed 's/ $//')
        
        if [ -n "$COMMENTS" ]; then
            echo "  [$KIND] $NAME$SIG (Line: $LINE_NUM) // $COMMENTS"
        else
            echo "  [$KIND] $NAME$SIG (Line: $LINE_NUM)"
        fi
    fi
done

# Add Svelte files (they are often missed by ctags)
echo "$FILES" | grep "\.svelte$" | while read -r SVELTE_FILE; do
    # Simple check to see if we already listed it
    echo -e "\n### FILE: $SVELTE_FILE (Svelte Component)"
done | sort -u

--- END OF FILE: ./gen_map.sh ---

--- FILE: ./gen_diff_context.sh ---
#!/bin/bash
# gen_diff_context.sh - å·®åˆ†é›†ä¸­å‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆå™¨ (ctags-enhanced)

# Configuration: Project-specific extensions
EXTENSIONS="js,jsx,ts,tsx,kt,ex,exs,svelte,astro,html,css,dart,go"

# 1. å¯¾è±¡ã¨ãªã‚‹ã‚³ãƒŸãƒƒãƒˆç¯„å›²ã®æ±ºå®š
TARGET="HEAD"
if [ -n "$1" ]; then
    TARGET="$1"
elif [ -z "$(git diff --cached)" ] && [ -z "$(git diff)" ]; then
    echo "Notice: No staged or unstaged changes. Checking the last commit instead."
    TARGET="HEAD~1..HEAD"
fi

echo "## [STEP 0] Operational Intent & Environment"
# 1. Current Branch
BRANCH=$(git rev-parse --abbrev-ref HEAD 2>/dev/null || echo "unknown")
echo "- Current Branch: $BRANCH"

# 2. Status / Last Commit
if [ "$TARGET" = "HEAD" ]; then
    echo "- Target: Active Task (Uncommitted Changes)"
else
    LAST_COMMIT=$(git log -1 --pretty=format:"%s" 2>/dev/null)
    echo "- Target: Previous Commit ($LAST_COMMIT)"
fi

# 3. Extract Explicit Intents from diff
INTENTS=$(git diff -U0 $TARGET | awk '/^\+.*(\[Intent:|@intent)/ {
    sub(/^\+/, ""); 
    gsub(/^[ \t]+|[ \t]+$/, ""); 
    print
}')

if [ -n "$INTENTS" ]; then
    echo "- Extracted Intent Annotations:"
    echo "$INTENTS" | sed 's/^/  > /'
fi
echo ""

echo "## [STEP 1] Detecting changed files and lines via git diff ($TARGET)..."

# 2. å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¨è¡Œç•ªå·ã®æŠ½å‡º
# å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: filepath:start_line:end_line
CHANGES=$(git diff -U0 $TARGET | awk '
/^+++ b\// {
    file = substr($0, 7)
}
/^@@ / {
    match($0, /\+([0-9]+)(,[0-9]+)?/, arr)
    start_line = arr[1]
    count = arr[2] ? substr(arr[2], 2) : 1
    
    if (count > 0 && file != "") {
        end_line = start_line + count - 1
        print file ":" start_line ":" end_line
    }
}')

if [ -z "$CHANGES" ]; then
    echo "No relevant lines changed."
    exit 0
fi

# å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¹ãƒˆï¼ˆé‡è¤‡æ’é™¤ã€æ‹¡å¼µå­ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼‰
CHANGED_FILES=$(echo "$CHANGES" | cut -d: -f1 | sort -u | grep -E "\.(${EXTENSIONS//,/|})$")

if [ -z "$CHANGED_FILES" ]; then
    echo "No source code files changed (or files ignored by extension filter)."
    exit 0
fi

echo "Changed files:"
echo "$CHANGED_FILES" | sed 's/^/  - /'

echo -e "\n## [STEP 2] Extracting affected symbols using ctags..."

# ctags ã®ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«
CTAGS_OUT=$(mktemp)

# ctagsã®å®Ÿè¡Œï¼ˆå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ï¼‰
echo "$CHANGED_FILES" | xargs -r ctags --output-format=json --fields=+n --sort=no > "$CTAGS_OUT" 2>/dev/null

# jqã«ã‚ˆã‚‹ã‚·ãƒ³ãƒœãƒ«ã®ç‰¹å®šã¨é›†ç´„
CHANGED_SYMBOLS=$(echo "$CHANGES" | while IFS=: read -r file start end; do
    if ! echo "$CHANGED_FILES" | grep -q "^$file$"; then continue; fi
    
    # å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®ctagsã‹ã‚‰ã€è¡Œç•ªå·ãŒå¤‰æ›´é–‹å§‹è¡Œ(start)ä»¥ä¸‹ã®æœ€å¤§ã®ã‚‚ã®ã‚’å–å¾—
    jq -r --arg file "$file" --argjson start "$start" '
        select(.path == $file and .line <= $start) | .name
    ' "$CTAGS_OUT" | tail -n 1
done | sort -u | grep -v "^$")

rm -f "$CTAGS_OUT"

if [ -z "$CHANGED_SYMBOLS" ]; then
    echo "No major symbol changes detected by ctags."
else
    echo "Affected symbols:"
    echo "$CHANGED_SYMBOLS" | sed 's/^/  - /'

    echo -e "\n## [STEP 3] Searching for impacted areas (Usage in other files)..."
    
    # å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«è‡ªä½“ã¯æ¤œç´¢çµæœã‹ã‚‰é™¤å¤–ã™ã‚‹
    EXCLUDE_PATTERN=$(git diff --name-only $TARGET | grep -v '^$' | tr '\n' '|' | sed 's/|$//')
    
    for SYMBOL in $CHANGED_SYMBOLS; do
        echo "### Symbol: $SYMBOL"
        
        # grep ã®å®Ÿè¡Œ (ãƒ“ãƒ«ãƒ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç­‰ã‚’æ’é™¤ã—ã€å˜èªå¢ƒç•Œã§å®Œå…¨ä¸€è‡´æ¤œç´¢)
        if [ -n "$EXCLUDE_PATTERN" ]; then
            grep -rwn . -e "\b${SYMBOL}\b" \
                --exclude-dir={.git,node_modules,.svelte-kit,vendor,dist,build,out,.wrangler,_build,deps,.venv} \
                | grep -vE "^(${EXCLUDE_PATTERN}):" | head -n 10
        else
            grep -rwn . -e "\b${SYMBOL}\b" \
                --exclude-dir={.git,node_modules,.svelte-kit,vendor,dist,build,out,.wrangler,_build,deps,.venv} \
                | head -n 10
        fi
    done
fi

echo -e "\n## [STEP 4] Relevant Codebase Map (Filtered by Diff)"
if [ -n "$CHANGED_SYMBOLS" ]; then
    # ã‚·ãƒ³ãƒœãƒ«åã§æ—¢å­˜ã®åœ°å›³ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    SYMBOL_PATTERN=$(echo "$CHANGED_SYMBOLS" | tr '\n' '|' | sed 's/|$//')
    ./gen_map.sh | grep -A 5 -B 5 -E "\b(${SYMBOL_PATTERN})\b"
else
    echo "No symbols to map."
fi
--- END OF FILE: ./gen_diff_context.sh ---

--- FILE: ./manifest.json ---
{
  "manifest_version": 3,
  "name": "__MSG_name__",
  "version": "2.2.21",
  "description": "__MSG_description__",
  "default_locale": "en",
  "permissions": [
    "activeTab",
    "storage",
    "alarms"
  ],
  "host_permissions": [
    "http://localhost:4000/*",
    "https://v.knc.jp/*",
    "https://hub.knc.jp/*"
  ],
  "action": {
    "default_popup": "popup.html",
    "default_icon": {
      "128": "icon128.png"
    }
  },
  "externally_connectable": {
    "matches": [
      "https://hub.knc.jp/*",
      "http://localhost/*"
    ]
  },
  "options_page": "options.html",
  "background": {
    "service_worker": "background.js"
  },
  "content_scripts": [
    {
      "matches": [
        "<all_urls>"
      ],
      "exclude_matches": [
        "https://v.knc.jp/*",
        "https://t.knc.jp/*"
      ],
      "js": [
        "content.js"
      ]
    }
  ],
  "icons": {
    "128": "icon128.png"
  },
  "web_accessible_resources": [
    {
      "resources": ["adapters.json"],
      "matches": ["<all_urls>"]
    }
  ]
}

--- END OF FILE: ./manifest.json ---

--- FILE: ./content.js ---
// VoiceMux Bridge Content Script v2.1.0 (Clean Architecture)
if (window.VOICEMUX_INITIALIZED) {
  console.log("VoiceMux: Already initialized in this tab.");
} else {
  window.VOICEMUX_INITIALIZED = true;
  console.group("VoiceMux Bridge v2.2.21");
  console.log("Status: Content Script Loaded");
  console.groupEnd();

  /**
   * decodes Base64 strings safely.
   */
  function safeAtob(base64) {
    if (!base64) return "";
    let standardBase64 = base64.replace(/\s/g, '').replace(/-/g, '+').replace(/_/g, '/');
    while (standardBase64.length % 4 !== 0) {
      standardBase64 += '=';
    }
    try {
      return atob(standardBase64);
    } catch (e) {
      console.error("[Base64] atob failed:", e);
      return "";
    }
  }

  let ADAPTERS_CACHE = [];
  let loadPromise = null;

  // â˜… Initialize Adapters
  async function loadAdapters() {
    if (loadPromise) return loadPromise;
    loadPromise = (async () => {
      try {
        const builtInUrl = chrome.runtime.getURL('adapters.json');
        const builtInRes = await fetch(builtInUrl);
        const builtInAdapters = await builtInRes.json();
        const storage = await chrome.storage.local.get('custom_adapters');
        const customAdapters = storage.custom_adapters || [];
        const normalizedCustom = customAdapters.map(a => ({
          name: a.name || "Custom",
          host: a.host,
          inputSelector: a.inputSelector ?? (Array.isArray(a.selectors) ? a.selectors.join(',') : a.selectors),
          submitSelector: a.submitSelector ?? (Array.isArray(a.sendBtns) ? a.sendBtns.join(',') : a.sendBtns)
        }));
        ADAPTERS_CACHE = [...normalizedCustom, ...builtInAdapters];
      } catch (e) {
        console.error("VoiceMux: Failed to load adapters", e);
      } finally {
        loadPromise = null;
      }
    })();
    return loadPromise;
  }

  chrome.storage.onChanged.addListener((changes, area) => {
    if (area === 'local' && changes.custom_adapters) {
      loadAdapters();
    }
  });
  loadAdapters();

  // â˜… Target Selection
  async function getTargetAndAdapter() {
    const url = window.location.href;
    if (ADAPTERS_CACHE.length === 0) await loadAdapters();
    const adapter = ADAPTERS_CACHE.find(a => a.host && url.includes(a.host));
    const active = document.activeElement;
    if (active && 
        (active.isContentEditable || 
         active.tagName === 'TEXTAREA' || 
         (active.tagName === 'INPUT' && !['checkbox', 'radio', 'button', 'submit'].includes(active.type)))) {
      return { target: active, adapter: adapter || { name: 'active-element' } };
    }
    if (adapter) {
      const el = document.querySelector(adapter.inputSelector);
      if (el) return { target: el, adapter: adapter };
    }
    const firstInput = document.querySelector('textarea, div[contenteditable="true"]');
    if (firstInput) {
        return { target: firstInput, adapter: { name: 'last-resort' } };
    }
    return { target: null, adapter: null };
  }

  let lastUserInteraction = 0;
  let lastInterimLength = 0; // PCå´ã§ä¿æŒã™ã‚‹ã€Œæœ€å¾Œã«æŒ¿å…¥ã—ãŸæœªç¢ºå®šæ–‡å­—ã®é•·ã•ã€
  const INPUT_LOCK_MS = 2000;
  const SUBMIT_DELAY_MS = 150;

  // Listen for local interaction to prevent remote fighting
  document.addEventListener('keydown', () => lastUserInteraction = Date.now(), true);
  document.addEventListener('mousedown', () => lastUserInteraction = Date.now(), true);

  /** 
   * Hybrid Text Injection: v1.4 Stability + v2.2.2 Mirroring
   */
  function forceInject(element, text) {
    if (!element) return;
    
    const now = Date.now();
    if (now - lastUserInteraction < INPUT_LOCK_MS) {
      console.log("VoiceMux: Local interaction detected. Skipping remote update.");
      return;
    }

    // 1. Robust comparison (Check multiple text properties to avoid redundant churn)
    const val = (element.tagName === 'TEXTAREA' || element.tagName === 'INPUT' ? element.value : (element.innerText || element.textContent)) || "";
    if (val.trim() === text.trim()) return;

    console.log(`VoiceMux: Mirroring into ${element.tagName}. New Length: ${text.length}`);
    element.focus();

    try {
      if (element.tagName === 'TEXTAREA' || element.tagName === 'INPUT') {
        // --- v1.4 PROTOTYPE SETTER HACK ---
        const proto = element.tagName === 'INPUT' ? window.HTMLInputElement.prototype : window.HTMLTextAreaElement.prototype;
        const nativeSetter = Object.getOwnPropertyDescriptor(proto, "value")?.set;
        
        if (nativeSetter) {
          nativeSetter.call(element, text);
        } else {
          element.value = text;
        }
      } else if (element.isContentEditable) {
        // --- v2.2.4 ATOMIC MIRRORING ---
        // DESIGN INTENT: Aggressive Clear + Insert.
        // Modern editors often hijack 'selectAll' or 'paste'. 
        // By selecting and DELETING before insertion, we force the editor
        // to treat it as a fresh start, preventing duplication.
        
        const selection = window.getSelection();
        if (selection) {
          // Double-strength selection
          document.execCommand('selectAll', false, null);
          const range = document.createRange();
          range.selectNodeContents(element);
          selection.removeAllRanges();
          selection.addRange(range);
        }

        // Atomic transaction: Clear -> Insert
        document.execCommand('delete', false, null);
        const success = document.execCommand('insertText', false, text);
        
        if (!success) {
          element.innerText = text;
        }
      }
    } catch (e) {
      console.error("VoiceMux: Critical Injection Failure:", e);
      if (element.tagName === 'TEXTAREA') element.value = text;
      else element.innerText = text;
    }

    // 3. Mandatory State Sync (Explicitly mark as replacement)
    element.dispatchEvent(new InputEvent('input', { 
      bubbles: true, 
      inputType: 'insertReplacementText',
      data: text 
    }));
    element.dispatchEvent(new Event('change', { bubbles: true }));
    
    moveCursorToEnd(element);
  }

  function moveCursorToEnd(element) {
    if (element.tagName === 'TEXTAREA' || element.tagName === 'INPUT') {
      element.selectionStart = element.selectionEnd = element.value.length;
    } else if (element.isContentEditable) {
      try {
        const range = document.createRange();
        range.selectNodeContents(element);
        range.collapse(false);
        const sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
      } catch (e) {}
    }
  }

  /**
   * Aggressive Submission Logic: Wakes up the UI before clicking
   */
  async function performSubmit(target, adapter) {
    console.log("VoiceMux: Preparing for submission...");
    
    // 1. Final focus ritual to ensure button states refresh
    target.focus();
    target.dispatchEvent(new Event('input', { bubbles: true }));

    setTimeout(() => {
      if (adapter && adapter.submitSelector === null) return;
      
      let btn = null;
      if (adapter && adapter.submitSelector) {
        btn = document.querySelector(adapter.submitSelector);
      }

      if (btn && !btn.disabled) {
        console.log("VoiceMux: Clicking submission button.");
        btn.click();
      } else {
        console.log("VoiceMux: Submitting via Enter key.");
        triggerEnter(target);
      }
    }, SUBMIT_DELAY_MS);
  }

  function triggerEnter(target) {
      const opts = { key: 'Enter', code: 'Enter', keyCode: 13, which: 13, bubbles: true, cancelable: true, composed: true, view: window };
      target.dispatchEvent(new KeyboardEvent('keydown', opts));
      target.dispatchEvent(new KeyboardEvent('keypress', opts));
      target.dispatchEvent(new KeyboardEvent('keyup', opts));
  }

  // â˜… Message Listener (Plaintext from Background)
  chrome.runtime.onMessage.addListener(async (request, sender, sendResponse) => {
    const isHub = window.location.hostname.includes("hub.knc.jp") || 
                  (window.location.hostname === "localhost" && window.location.port === "5173");
    if (isHub) return;

    console.group("VoiceMux: Remote Command");
    try {
      const { target, adapter } = await getTargetAndAdapter();
      const plaintext = request.plaintext;
      
      let finalTarget = target;
      if (!finalTarget) {
        const active = document.activeElement;
        if (active && (active.tagName === 'TEXTAREA' || active.tagName === 'INPUT' || active.isContentEditable)) {
          finalTarget = active;
        }
      }

      if (!finalTarget) {
        console.warn("VoiceMux: No target for injection.");
        console.groupEnd();
        return;
      }

      if (request.action === "update_text") {
        forceInject(finalTarget, plaintext);
      } else if (request.action === "INTERIM") {
        // DESIGN INTENT: Real-time preview without duplication.
        // Delete the previous interim text before inserting the new one.
        console.log(`VoiceMux: Handling INTERIM command. (Rolling back ${lastInterimLength} chars)`);
        const textToInsert = request.text || plaintext || "";
        finalTarget.focus();

        // 1. å‰å›ã®æœªç¢ºå®šåˆ†ã‚’å‰Šé™¤
        for (let i = 0; i < lastInterimLength; i++) {
          document.execCommand('delete', false, null);
        }

        // 2. æ–°ã—ã„æœªç¢ºå®šãƒ†ã‚­ã‚¹ãƒˆã‚’æŒ¿å…¥ã—ã€é•·ã•ã‚’è¨˜æ†¶
        if (textToInsert) {
          document.execCommand('insertText', false, textToInsert);
          lastInterimLength = textToInsert.length;
        } else {
          lastInterimLength = 0;
        }
      } else if (request.action === "INSERT") {
        console.log("VoiceMux: Handling INSERT command.");
        const textToInsert = request.text || plaintext || "";
        finalTarget.focus();

        // 1. ç¢ºå®šæ™‚ã‚‚ã€ä¸€åº¦æœªç¢ºå®šãƒãƒƒãƒ•ã‚¡ã‚’ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹
        if (lastInterimLength > 0) {
          console.log(`VoiceMux: Rolling back ${lastInterimLength} interim chars before final INSERT.`);
          for (let i = 0; i < lastInterimLength; i++) {
            document.execCommand('delete', false, null);
          }
          lastInterimLength = 0; // ç¢ºå®šã—ãŸã®ã§ãƒãƒƒãƒ•ã‚¡ã‚’ãƒªã‚»ãƒƒãƒˆ
        }

        // 2. ç¢ºå®šãƒ†ã‚­ã‚¹ãƒˆã‚’æŒ¿å…¥
        if (textToInsert) {
          document.execCommand('insertText', false, textToInsert);
          finalTarget.dispatchEvent(new InputEvent('input', { bubbles: true, inputType: 'insertText', data: textToInsert }));
          finalTarget.dispatchEvent(new Event('change', { bubbles: true }));
          moveCursorToEnd(finalTarget);
        }
      } else if (request.action === "NEWLINE") {
        console.log("VoiceMux: Handling NEWLINE command.");
        finalTarget.focus();
        document.execCommand('insertText', false, '\n');
        finalTarget.dispatchEvent(new InputEvent('input', { bubbles: true, inputType: 'insertText', data: '\n' }));
        finalTarget.dispatchEvent(new Event('change', { bubbles: true }));
        moveCursorToEnd(finalTarget);
      } else if (request.action === "SUBMIT" || request.action === "confirm_send") {
        // DESIGN INTENT: SUBMIT is now decoupled from text injection.
        // It only wakes up the UI and clicks the button.
        console.log("VoiceMux: Handling SUBMIT command.");
        await performSubmit(finalTarget, adapter);
      } else if (request.action === "CLEAR") {
        console.log("VoiceMux: Clearing target element.");
        if (finalTarget.tagName === 'TEXTAREA' || finalTarget.tagName === 'INPUT') {
          // Native setter hack for clearing
          const proto = finalTarget.tagName === 'INPUT' ? window.HTMLInputElement.prototype : window.HTMLTextAreaElement.prototype;
          const nativeSetter = Object.getOwnPropertyDescriptor(proto, "value")?.set;
          if (nativeSetter) nativeSetter.call(finalTarget, "");
          else finalTarget.value = "";
        } else {
          // ContentEditable clear
          finalTarget.focus();
          document.execCommand('selectAll', false, null);
          document.execCommand('delete', false, null);
        }
        finalTarget.dispatchEvent(new Event('input', { bubbles: true }));
      } else if (request.action === "LOG") {
        const style = "background: #6750A4; color: white; padding: 2px 4px; border-radius: 2px;";
        if (request.log_level === 'error') console.error("%cREMOTE", style, request.message);
        else if (request.log_level === 'warn') console.warn("%cREMOTE", style, request.message);
        else console.log("%cREMOTE", style, request.message);
      }
    } catch (err) {
      console.error("VoiceMux: Handler Error:", err);
    } finally {
      console.groupEnd();
    }
  });

  function safeCheckConnection() {
    if (chrome.runtime?.id) {
      chrome.runtime.sendMessage({ action: "check_connection" }).catch(() => {});
    }
  }

  document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "visible") {
      safeCheckConnection();
    }
  });
}

--- END OF FILE: ./content.js ---

--- FILE: ./options.html ---
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VoiceMux Settings</title>
  <style>
    :root {
      /* M3 Light Palette (Violet baseline) */
      --md-sys-color-primary: #6750A4;
      --md-sys-color-on-primary: #FFFFFF;
      --md-sys-color-primary-container: #EADDFF;
      --md-sys-color-on-primary-container: #21005D;
      --md-sys-color-secondary: #625B71;
      --md-sys-color-on-secondary: #FFFFFF;
      --md-sys-color-surface: #FEF7FF;
      --md-sys-color-on-surface: #1D1B20;
      --md-sys-color-surface-variant: #E7E0EB;
      --md-sys-color-on-surface-variant: #49454F;
      --md-sys-color-outline: #79747E;
      --md-sys-color-success: #10b981;

      /* Elevation */
      --md-sys-elevation-1: 0px 1px 3px 1px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
      --md-sys-elevation-3: 0px 1px 3px 0px rgba(0, 0, 0, 0.3), 0px 4px 8px 3px rgba(0, 0, 0, 0.15);
    }

    body {
      font-family: 'Roboto', system-ui, -apple-system, sans-serif;
      background-color: var(--md-sys-color-surface);
      color: var(--md-sys-color-on-surface);
      max-width: 680px;
      margin: 40px auto;
      padding: 24px;
      -webkit-font-smoothing: antialiased;
    }

    .card {
      background: var(--md-sys-color-surface);
      padding: 32px;
      border-radius: 28px;
      border: 1px solid var(--md-sys-color-surface-variant);
      box-shadow: var(--md-sys-elevation-1);
    }

    h1 { 
      font-size: 28px; 
      font-weight: 400; 
      margin: 0 0 12px 0; 
      color: var(--md-sys-color-on-surface);
    }

    p { 
      color: var(--md-sys-color-on-surface-variant); 
      font-size: 14px; 
      line-height: 1.6;
      margin-bottom: 32px; 
    }

    p a {
      color: var(--md-sys-color-primary);
      text-decoration: none;
      font-weight: 500;
    }

    textarea {
      width: 100%;
      height: 360px;
      font-family: 'Roboto Mono', ui-monospace, monospace;
      font-size: 13px;
      padding: 20px;
      border: 1px solid var(--md-sys-color-outline);
      border-radius: 12px;
      background-color: var(--md-sys-color-surface-variant);
      color: var(--md-sys-color-on-surface-variant);
      resize: vertical;
      box-sizing: border-box;
      outline: none;
      transition: border-color 0.2s;
    }

    textarea:focus {
      border-color: var(--md-sys-color-primary);
      border-width: 2px;
    }

    .btn-save {
      background-color: var(--md-sys-color-primary);
      color: var(--md-sys-color-on-primary);
      border: none;
      padding: 12px 24px;
      height: 40px;
      border-radius: 20px;
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      margin-top: 24px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: var(--md-sys-elevation-1);
    }

    .btn-save:hover { 
      box-shadow: var(--md-sys-elevation-2);
      opacity: 0.9;
    }

    .btn-save:active {
      transform: scale(0.98);
    }

    .status {
      margin-top: 16px;
      font-size: 14px;
      font-weight: 500;
      color: var(--md-sys-color-success);
      display: none;
      animation: fadeIn 0.3s ease;
    }

    code { 
      background: var(--md-sys-color-primary-container); 
      color: var(--md-sys-color-on-primary-container);
      padding: 2px 6px; 
      border-radius: 4px; 
      font-size: 12px;
    }

    .example-box {
      margin-top: 40px; 
      font-size: 12px; 
      color: var(--md-sys-color-on-surface-variant);
      background: var(--md-sys-color-surface-variant);
      padding: 16px;
      border-radius: 12px;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body data-i18n-title="options_title">
  <div class="card">
    <h1 data-i18n="options_header">Custom Site Adapters</h1>
    <p data-i18n="options_description">Define custom CSS selectors for your favorite sites. You can find pre-made configurations in our <a href="https://github.com/Kaneta/voicemux-bridge/blob/main/docs/community-adapters.md" target="_blank">Community Adapters Catalog</a>.</p>
    
    <textarea id="custom-adapters" spellcheck="false" placeholder='[
  {
    "name": "Custom App",
    "host": "example.com",
    "inputSelector": ".my-input",
    "submitSelector": ".my-send-button"
  }
]'></textarea>

    <button id="save" class="btn-save" data-i18n="btn_save_config">Save Configuration</button>
    <div id="status" class="status" data-i18n="status_saved">Settings saved successfully</div>

    <div class="example-box">
      <strong data-i18n="example_structure">Example Structure:</strong><br>
      <code>[{"name": "Slack", "host": "slack.com", "inputSelector": ".ql-editor", "submitSelector": "button.c-button-unstyled"}]</code>
    </div>
  </div>
  <script src="options.js"></script>
</body>
</html>

--- END OF FILE: ./options.html ---

--- FILE: ./options.js ---
// VoiceMux Options JS
const textarea = document.getElementById("custom-adapters");
const saveBtn = document.getElementById("save");
const status = document.getElementById("status");

// Load saved settings
document.addEventListener("DOMContentLoaded", async () => {
  localize();
  const data = await chrome.storage.local.get("custom_adapters");
  if (data.custom_adapters) {
    textarea.value = JSON.stringify(data.custom_adapters, null, 2);
  }
});

// Save settings
saveBtn.addEventListener("click", async () => {
  const rawValue = textarea.value.trim();
  let parsedValue = [];

  if (rawValue) {
    try {
      parsedValue = JSON.parse(rawValue);
      if (!Array.isArray(parsedValue)) {throw new Error("Must be an array");}
    } catch (e) {
      alert(chrome.i18n.getMessage("invalid_json_format", [e.message]));
      return;
    }
  }

  await chrome.storage.local.set({ "custom_adapters": parsedValue });
  
  // Show status
  status.style.display = "block";
  setTimeout(() => {
    status.style.display = "none";
  }, 2000);
});

function localize() {
  document.querySelectorAll("[data-i18n]").forEach(element => {
    const key = element.getAttribute("data-i18n");
    const message = chrome.i18n.getMessage(key);
    if (message) {
      if (element.tagName === "INPUT" || element.tagName === "TEXTAREA") {
        element.placeholder = message;
      } else {
        element.innerHTML = message;
      }
    }
  });

  document.querySelectorAll("[data-i18n-title]").forEach(element => {
    const key = element.getAttribute("data-i18n-title");
    const message = chrome.i18n.getMessage(key);
    if (message) {
      document.title = message;
    }
  });
}

--- END OF FILE: ./options.js ---

--- FILE: ./popup.html ---
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <!-- [Intent: Status-Centric Dashboard Architecture.
       This popup is a monitoring tool for Hub and Phone connectivity.
       All interactive pairing logic (QR generation) is offloaded to the Hub to:
       1. Simplify Extension security review (minimal UI logic).
       2. Centralize device management in the primary Hub workspace. ] -->
  <style>
    :root {
      /* M3 Light Palette (Violet baseline) */
      --md-sys-color-primary: #6750A4;
      --md-sys-color-on-primary: #FFFFFF;
      --md-sys-color-primary-container: #EADDFF;
      --md-sys-color-on-primary-container: #21005D;
      --md-sys-color-secondary-container: #E8DEF8;
      --md-sys-color-on-secondary-container: #1D192B;
      --md-sys-color-surface: #FEF7FF;
      --md-sys-color-on-surface: #1D1B20;
      --md-sys-color-surface-variant: #E7E0EB;
      --md-sys-color-on-surface-variant: #49454F;
      --md-sys-color-outline: #79747E;
      --md-sys-color-success: #10b981;
      --md-sys-color-warning: #f59e0b;

      /* Elevation */
      --md-sys-elevation-1: 0px 1px 3px 1px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
      --md-sys-elevation-2: 0px 2px 6px 2px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
    }

    body {
      width: 320px;
      font-family: 'Roboto', system-ui, -apple-system, sans-serif;
      margin: 0;
      padding: 20px 24px;
      background-color: var(--md-sys-color-surface);
      color: var(--md-sys-color-on-surface);
      -webkit-font-smoothing: antialiased;
      overflow: hidden;
    }

    .header {
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    h1 {
      font-size: 18px;
      font-weight: 700;
      margin: 0;
      color: var(--md-sys-color-primary);
      letter-spacing: -0.02em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .app-version {
      font-size: 10px;
      font-weight: 400;
      opacity: 0.6;
      background: var(--md-sys-color-surface-variant);
      padding: 2px 6px;
      border-radius: 4px;
    }

    .maintenance-notice {
      background: var(--md-sys-color-warning);
      color: white;
      padding: 4px 8px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 700;
      margin-bottom: 12px;
      width: 100%;
    }

    .maintenance-notice a {
      color: white;
      text-decoration: underline;
    }

    .status-indicator-group {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: var(--md-sys-color-warning);
      box-shadow: 0 0 0 2px var(--md-sys-color-surface);
    }

    .status-dot.online {
      background-color: var(--md-sys-color-success);
      box-shadow: 0 0 8px var(--md-sys-color-success);
    }

    /* Views */
    #unlinked-view, #linked-view {
      display: none;
      flex-direction: column;
      align-items: center;
      text-align: center;
      animation: fadeIn 0.3s ease-out;
    }

    /* Common Button Style (MD3 Tonal Capsule) */
    .btn-tonal {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 24px;
      background-color: var(--md-sys-color-secondary-container);
      color: var(--md-sys-color-on-secondary-container);
      border: none;
      border-radius: 9999px;
      font-size: 14px;
      font-weight: 700;
      text-decoration: none;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }

    .btn-tonal:hover {
      filter: brightness(0.95);
      box-shadow: var(--md-sys-elevation-1);
    }

    .btn-tonal:active {
      transform: scale(0.98);
    }

    /* Footer Links */
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-top: 16px;
      margin-bottom: 4px;
    }

    .f-link {
      font-size: 11px;
      color: var(--md-sys-color-primary);
      text-decoration: none;
      opacity: 0.7;
      font-weight: 600;
    }
    .f-link:hover { opacity: 1; text-decoration: underline; }

    /* Unlinked View Specific */
    .sync-wait-container {
      position: relative;
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
    }

    .pulse {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background-color: var(--md-sys-color-primary);
      opacity: 0.2;
      animation: pulse 2s infinite cubic-bezier(0.4, 0, 0.6, 1);
    }

    .waiting-text-main {
      font-size: 1.1rem;
      font-weight: 800;
      margin: 0 0 12px 0;
      color: var(--md-sys-color-on-surface);
      line-height: 1.3;
    }

    .waiting-text-sub {
      font-size: 13px;
      color: var(--md-sys-color-on-surface-variant);
      margin-bottom: 24px;
      line-height: 1.5;
      padding: 0 8px;
    }

    /* Linked View Specific */
    .ready-msg {
      font-size: 1.15rem;
      font-weight: 900;
      color: var(--md-sys-color-primary);
      margin: 0 0 8px 0;
      line-height: 1.2;
    }

    .sync-instruction {
      font-size: 13px;
      color: var(--md-sys-color-on-surface-variant);
      margin-bottom: 24px;
      line-height: 1.4;
      padding: 0 12px;
      white-space: nowrap;
    }

    #qrcode-link {
      display: block;
      margin-bottom: 12px;
      text-decoration: none;
      transition: transform 0.2s;
    }

    /* Status Monitor Layout */
    .status-monitor {
      width: 100%;
      background: var(--md-sys-color-surface-variant);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      box-sizing: border-box;
    }

    .status-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
    }

    .status-label {
      font-weight: 600;
      opacity: 0.8;
    }

    .status-value {
      font-weight: 800;
      color: var(--md-sys-color-primary);
    }

    .status-value.connected {
      color: var(--md-sys-color-success);
    }

    .btn-connect-phone {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      padding: 24px;
      background: white;
      border-radius: 20px;
      box-shadow: var(--md-sys-elevation-2);
      border: 1px solid var(--md-sys-color-surface-variant);
      color: var(--md-sys-color-primary);
      text-decoration: none;
      margin-bottom: 16px;
    }

    .btn-connect-phone:hover {
      background-color: var(--md-sys-color-primary-container);
    }

    .btn-connect-phone svg {
      color: var(--md-sys-color-primary);
    }

    .btn-connect-phone span {
      font-size: 14px;
      font-weight: 700;
    }

    .room-info {
      font-family: var(--font-mono, monospace);
      font-size: 18px;
      font-weight: 800;
      color: var(--md-sys-color-primary);
      background: var(--md-sys-color-secondary-container);
      padding: 4px 12px;
      border-radius: 8px;
      margin-bottom: 12px;
      letter-spacing: 2px;
    }

    /* Subtle Copy Button */
    .btn-copy-link {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 8px 24px;
      background: transparent;
      color: var(--md-sys-color-primary);
      border: 1px solid var(--md-sys-color-outline);
      border-radius: 100px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 24px;
      transition: all 0.2s;
    }

    .btn-copy-link:hover { background-color: rgba(103, 80, 164, 0.05); }
    .btn-copy-link.success { border-color: var(--md-sys-color-success); color: var(--md-sys-color-success); }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 0.4; }
      100% { transform: scale(1.6); opacity: 0; }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>
      <span data-i18n="name">VoiceMux Bridge</span>
      <span id="version-display" class="app-version">v...</span>
    </h1>
    <div class="status-indicator-group">
      <div id="status-indicator" class="status-dot"></div>
    </div>
  </div>

  <!-- View 1: Unlinked -->
  <div id="unlinked-view">
    <div class="sync-wait-container">
      <div class="pulse"></div>
      <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--md-sys-color-primary); z-index: 1;">
        <path d="M21 2v6h-6"></path><path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path><path d="M3 22v-6h6"></path><path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
      </svg>
    </div>
    <h2 class="waiting-text-main" data-i18n="waiting_hub_main">First, let's link with the Hub</h2>
    <p class="waiting-text-sub" data-i18n="waiting_hub_sub">Once you open the VoiceMux Hub site, the pairing QR code will appear here automatically.</p>
    <button id="btn-open-hub" class="btn-tonal" data-i18n="btn_open_hub">ğŸš€ Open Hub to Link</button>
  </div>

  <!-- View 2: Linked (Ready) -->
  <div id="linked-view">
    <div id="maintenance-notice" class="maintenance-notice" style="display: none;">
      <a id="maintenance-link" href="#" target="_blank">ğŸš§ Maintenance (Details)</a>
    </div>

    <div class="status-monitor">
      <div class="status-item">
        <span class="status-label">ğŸŒ Hub:</span>
        <span id="hub-status-text" class="status-value">Linked</span>
      </div>
      <div class="status-item">
        <span class="status-label">ğŸ“± Phone:</span>
        <span id="phone-status-text" class="status-value">Waiting...</span>
      </div>
    </div>

    <a id="qrcode-link" href="#" target="_blank" class="btn-connect-phone">
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect>
        <line x1="12" y1="18" x2="12.01" y2="18"></line>
      </svg>
      <span data-i18n="btn_show_qr_on_hub">Connect Smartphone</span>
    </a>

    <div id="room-id" class="room-info" data-i18n="room_loading">Room: Loading...</div>

    <button id="copy-btn" class="btn-copy-link">
      <span id="copy-text" data-i18n="btn_copy_link">Copy Link</span>
    </button>

    <a href="https://hub.knc.jp" id="hub-link" target="_blank" class="btn-tonal" data-i18n="btn_manage_librarian">
      ğŸª„ Fix Errors & Generate Prompts
    </a>

    <button id="btn-reset-connection" class="f-link" style="margin-top: 12px; background: none; border: none; cursor: pointer; text-decoration: underline;" data-i18n="btn_reset_connection">
      Reset Connection
    </button>
  </div>

  <div id="global-actions" style="margin-top: 16px; border-top: 1px solid var(--md-sys-color-surface-variant); padding-top: 12px; display: flex; justify-content: center;">
    <button id="btn-global-reset" class="f-link" style="background: none; border: none; cursor: pointer;" data-i18n="btn_reset_connection">
      Reset Connection
    </button>
  </div>

  <div class="footer-links">
    <a href="https://github.com/Kaneta/voicemux-bridge/issues" target="_blank" class="f-link" data-i18n="link_support">Support</a>
    <a href="https://knc.jp/ja/docs/voicemux-bridge/" id="guide-link" target="_blank" class="f-link" data-i18n="link_guide">Guide</a>
    <a href="https://github.com/Kaneta/voicemux-bridge/blob/main/PRIVACY.md" target="_blank" class="f-link" data-i18n="link_privacy">Privacy</a>
  </div>

  <script src="popup.js"></script>
</body>
</html>

--- END OF FILE: ./popup.html ---

--- FILE: ./popup.js ---
// VoiceMux Popup JS (v2.1.1 Finalized UI)
// [Intent: Chrome æ‹¡å¼µæ©Ÿèƒ½ã‚’ã€ŒçŠ¶æ…‹ç›£è¦–ãƒ„ãƒ¼ãƒ«ã€ã¸ã¨ç´”åŒ–ã•ã›ã€UIãƒ­ã‚¸ãƒƒã‚¯ï¼ˆQRç”Ÿæˆ/æˆåŠŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç­‰ï¼‰ã‚’Hubã«é›†ç´„ã™ã‚‹ã“ã¨ã§ã€å¯©æŸ»ã®ä¸ç¢ºå®Ÿæ€§ã¨ä¿å®ˆã‚³ã‚¹ãƒˆã‚’æœ€å°åŒ–ã™ã‚‹ã€‚]
document.addEventListener("DOMContentLoaded", async () => {
  // Localization
  localize();

  // Version Display
  const versionDisplay = document.getElementById("version-display");
  if (versionDisplay) {
    versionDisplay.innerText = `v${chrome.runtime.getManifest().version}`;
  }

    const unlinkedView = document.getElementById("unlinked-view");
    const linkedView = document.getElementById("linked-view");
  
    // System Status Check (Non-blocking)
    try {
      const statusRes = await fetch("https://v.knc.jp/api/status");
      if (statusRes.ok) {
        const status = await statusRes.json();
        if (status.is_maintenance) {
          const notice = document.getElementById("maintenance-notice");
          const link = document.getElementById("maintenance-link");
          if (notice && link) {
            notice.style.display = "block";
            link.href = status.info_url;
          }
        }
      }
    } catch (e) {
      console.warn("VoiceMux: Failed to fetch system status.", e);
    }
  
      const qrcodeLink = document.getElementById("qrcode-link");
    const roomIdDisplay = document.getElementById("room-id");
    const btnOpenHub = document.getElementById("btn-open-hub");
    const statusIndicator = document.getElementById("status-indicator");
    const hubLink = document.getElementById("hub-link");
    const phoneStatusText = document.getElementById("phone-status-text");

    // Global Reset Connection Logic
    const handleReset = async () => {
        if (confirm(chrome.i18n.getMessage("confirm_reset") || "Reset connection?")) {
            await chrome.storage.local.remove(["voicemux_room_id", "voicemux_token", "voicemux_key", "voicemux_paired"]);
            chrome.runtime.sendMessage({ action: "check_connection" });
            const data = await chrome.storage.local.get(["voicemux_hub_url"]);
            let hubOrigin = "https://hub.knc.jp";
            if (data.voicemux_hub_url) {
              hubOrigin = new URL(data.voicemux_hub_url).origin;
            }
            chrome.tabs.create({ url: `${hubOrigin}?action=reset` });
            window.close();
        }
    };

    const btnResetGlobal = document.getElementById("btn-global-reset");
    if (btnResetGlobal) {btnResetGlobal.onclick = handleReset;}

    // 1. Retrieve credentials from storage
    // [Intent: ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®å¤‰æ›´ï¼ˆHubå´ã‹ã‚‰ã®SYNC_AUTHãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚ˆã£ã¦ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹ï¼‰ã‚’ç›£è¦–ã—ã€ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«UIã‚’æ›´æ–°ã™ã‚‹ã€‚]
    async function updateUI() {
        const data = await chrome.storage.local.get(["voicemux_room_id", "voicemux_token", "voicemux_key", "voicemux_hub_url", "voicemux_paired"]);
        const roomId = data.voicemux_room_id;
        const token = data.voicemux_token;
        const keyBase64 = data.voicemux_key;
        const isPaired = data.voicemux_paired;
        
        let hubOrigin = "https://hub.knc.jp";
        try {
            const rawHubUrl = data.voicemux_hub_url || "https://hub.knc.jp";
            hubOrigin = new URL(rawHubUrl).origin;
        } catch (e) {
          console.warn("VoiceMux: Invalid hub URL in storage.", e);
        }

        if (roomId && token && keyBase64) {
            // --- LINKED STATE (READY) ---
            linkedView.style.display = "flex";
            unlinkedView.style.display = "none";
            statusIndicator?.classList.add("online");

            // Update Phone Status Text
            // [Intent: æˆåŠŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’Hubã«è­²ã‚Šã€æ‹¡å¼µæ©Ÿèƒ½å´ã¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ–‡å­—è‰²ã¨ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›´ã®ã¿ã‚’è¡Œã†ã“ã¨ã§UIãƒ­ã‚¸ãƒƒã‚¯ã‚’æ¥µå°åŒ–ã€‚]
            if (phoneStatusText) {
                if (isPaired) {
                    phoneStatusText.innerText = "Connected";
                    phoneStatusText.className = "status-value connected";
                } else {
                    phoneStatusText.innerText = "Waiting...";
                    phoneStatusText.className = "status-value";
                }
            }

            // Update Hub Link (Optional)
            if (hubLink) {hubLink.href = `${hubOrigin}/welcome`;}

            const btnReset = document.getElementById("btn-reset-connection");
            if (btnReset) {btnReset.onclick = handleReset;}

            // Construct Pairing URL (Pointing to the dedicated Hub QR page)
            // [Intent: UI is now fully centralized on hub.knc.jp/qr]
            let pairingUrl = `${hubOrigin}/qr`;
            
            const displayRoomId = roomId.substring(0, 4).toUpperCase();
            if (roomIdDisplay) {roomIdDisplay.innerText = displayRoomId;}
            if (qrcodeLink) {qrcodeLink.href = pairingUrl;}

            // Handle Copy Button
            const copyBtn = document.getElementById("copy-btn");
            const copyText = document.getElementById("copy-text");
            if (copyBtn) {
                copyBtn.onclick = async () => {
                    try {
                        await navigator.clipboard.writeText(pairingUrl);
                        if (copyText) {copyText.innerText = chrome.i18n.getMessage("btn_copy_success");}
                        copyBtn.classList.add("success");
                        setTimeout(() => {
                            if (copyText) {copyText.innerText = chrome.i18n.getMessage("btn_copy_link");}
                            copyBtn.classList.remove("success");
                        }, 2000);
                    } catch (err) {
                      console.error("VoiceMux: Failed to copy URL.", err);
                    }
                };
            }
        } else {
      // --- UNLINKED STATE ---
      unlinkedView.style.display = "flex";
      linkedView.style.display = "none";
      statusIndicator?.classList.remove("online");

      if (btnOpenHub) {
        btnOpenHub.onclick = () => {
          chrome.tabs.create({ url: hubOrigin + "/qr" });
        };
      }

      // Signal background to check connection
      chrome.runtime.sendMessage({ action: "check_connection" });
    }
  }

  // Initial update
  updateUI();
  
  // DESIGN INTENT: Reset pairing flag when opening to allow future re-pairs
  chrome.storage.local.set({ "voicemux_paired": false });

  // Listen for storage changes
  chrome.storage.onChanged.addListener((changes, namespace) => {
    if (namespace === "local" && (changes.voicemux_room_id || changes.voicemux_token || changes.voicemux_paired)) {
      updateUI();
    }
  });
});

function localize() {
  document.querySelectorAll("[data-i18n]").forEach(element => {
    const key = element.getAttribute("data-i18n");
    const message = chrome.i18n.getMessage(key);
    if (message) {
      if (element.tagName === "INPUT" || element.tagName === "TEXTAREA") {
        element.placeholder = message;
      } else {
        element.innerHTML = message;
      }
    }
  });

  // Localize specialized links
  const guideLink = document.getElementById("guide-link");
  if (guideLink) {
    guideLink.href = chrome.i18n.getMessage("url_guide");
  }
}

--- END OF FILE: ./popup.js ---

--- FILE: ./README.md ---
# VoiceMux Bridge v2.1.0 ğŸ›°ï¸

VoiceMux Bridge ã¯ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®éŸ³å£°å…¥åŠ›ã‚’ PC ä¸Šã®ã‚ã‚‰ã‚†ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆï¼ˆChatGPT, Gmail, Slack ç­‰ï¼‰ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æŒ¿å…¥ã™ã‚‹ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã§ã™ã€‚

## ğŸš€ v2.1.0 ã®æ–°æ©Ÿèƒ½: Multi-language Support & Secure Push-Sync
å¾“æ¥ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆv1.xï¼‰ã§è¡Œã£ã¦ã„ãŸã€Œå®šæœŸçš„ãªãƒšãƒ¼ã‚¸ç›£è¦–ã€ã‚„ã€Œæ‰‹å‹•ã§ã® ID å–å¾—ã€ã‚’å®Œå…¨ã«å»ƒæ­¢ã—ã¾ã—ãŸã€‚

- **å¤šè¨€èªå¯¾å¿œ (i18n)**: æ—¥æœ¬èªã¨è‹±èªã®è¡¨ç¤ºã«å®Œå…¨å¯¾å¿œã€‚
- **ã‚¼ãƒ­è¨­å®šåŒæœŸ**: [VoiceMux Hub](https://hub.knc.jp) ã‚’é–‹ãã ã‘ã§ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ãŒå®‰å…¨ã‹ã¤å³åº§ã«æ‹¡å¼µæ©Ÿèƒ½ã¸ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚
- **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ»ãƒšã‚¢ãƒªãƒ³ã‚°**: ä¸€åº¦é€£æºã™ã‚Œã°ã€æ¬¡å›ã‹ã‚‰ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ã—ã¦å³åº§ã« QR ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã€‚
- **ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ç¬¬ä¸€**: ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ã‚„æš—å·éµï¼‰ãŒ HTML ä¸Šã«éœ²å‡ºã™ã‚‹ã“ã¨ãªãã€ãƒ–ãƒ©ã‚¦ã‚¶ã®æ­£è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚° API ã§å—ã‘æ¸¡ã—ã•ã‚Œã¾ã™ã€‚

## ğŸ›  ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ä½¿ã„æ–¹
1. [Chrome ã‚¦ã‚§ãƒ–ã‚¹ãƒˆã‚¢](https://chromewebstore.google.com/detail/voicemux-bridge/agkglknmadfhdfobmgecllpgoecebdip) ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚
2. ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®ãƒ‘ã‚ºãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã‹ã‚‰ VoiceMux Bridge ã‚’ã€Œãƒ”ãƒ³ç•™ã‚ã€ã—ã¾ã™ã€‚
3. [VoiceMux Hub](https://hub.knc.jp) ã‚’é–‹ãã€åˆæœŸåŒ–ã‚’å®Œäº†ã•ã›ã¾ã™ï¼ˆè‡ªå‹•çš„ã«æ‹¡å¼µæ©Ÿèƒ½ã¸åŒæœŸã•ã‚Œã¾ã™ï¼‰ã€‚
4. æ‹¡å¼µã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€è¡¨ç¤ºã•ã‚ŒãŸ QR ã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ãƒãƒ›ã§ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚Œã°æº–å‚™å®Œäº†ã§ã™ã€‚

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ (E2EE)
VoiceMux ã¯ **End-to-End æš—å·åŒ– (E2EE)** ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚
éŸ³å£°ã‹ã‚‰å¤‰æ›ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é›¢ã‚Œã‚‹å‰ã«**ã‚ãªãŸã®ãƒ‡ãƒã‚¤ã‚¹ä¸Š**ã§æš—å·åŒ–ã•ã‚Œã¾ã™ã€‚ä¸­ç¶™ã‚µãƒ¼ãƒãƒ¼ï¼ˆv.knc.jpï¼‰ã¯æš—å·åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’è»¢é€ã—ã€ãã®ä¸­èº«ã‚’è§£èª­ã™ã‚‹ã“ã¨ã¯æš—å·å­¦çš„ã«ä¸å¯èƒ½ã§ã™ã€‚

è©³ç´°ãªå®Ÿè£…ã®è¨¼æ‹ ã¯ [E2EEå®Ÿè£…æŠ€è¡“ãƒ¬ãƒãƒ¼ãƒˆ](./docs/E2EE_IMPLEMENTATION_JA.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸ“Š ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçµ±è¨ˆ (v2.1.0)
VoiceMux Bridge ã¯ã€è»½é‡ã§é€æ˜æ€§ã®é«˜ã„è¨­è¨ˆã‚’ç¶­æŒã—ã¦ã„ã¾ã™ã€‚
- **ç·ã‚³ãƒ¼ãƒ‰è¡Œæ•°**: ç´„ 1,050 è¡Œ (JS/HTML/Manifest)
- **ä¾å­˜é–¢ä¿‚**: ã‚¼ãƒ­ (QRç”Ÿæˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª 1ã¤ã®ã¿ã‚’åŒæ¢±)
- **é€šä¿¡å…ˆ**: `knc.jp` ãƒ‰ãƒ¡ã‚¤ãƒ³ã«é™å®š

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹
ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ [LICENSE](./LICENSE) ã«åŸºã¥ã„ã¦å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®ã‚³ãƒ¼ãƒ‰ã¯å®Œå…¨ã«ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã‚ã‚Šã€èª°ã§ã‚‚ç›£æŸ»å¯èƒ½ã§ã™ã€‚

--- END OF FILE: ./README.md ---

--- FILE: ./LICENSE ---
MIT License

Copyright (c) 2026 Kohei Kaneta

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

--- END OF FILE: ./LICENSE ---

--- FILE: ./adapters.json ---
[
  {
    "id": "gemini",
    "name": "Google Gemini",
    "host": "gemini.google.com",
    "inputSelector": "div[contenteditable='true'], .rich-textarea, div[role='textbox']",
    "submitSelector": "button[aria-label*='é€ä¿¡'], button[aria-label*='Send'], button.send-button, button:has(span.material-symbols-outlined)"
  },
  {
    "id": "chatgpt",
    "name": "ChatGPT",
    "host": "chatgpt.com",
    "inputSelector": "#prompt-textarea",
    "submitSelector": "button[data-testid='send-button']"
  },
  {
    "id": "claude",
    "name": "Claude",
    "host": "claude.ai",
    "inputSelector": "div[contenteditable='true']",
    "submitSelector": "button[aria-label*='Send'], button[aria-label*='é€ä¿¡']"
  },
  {
    "id": "perplexity",
    "name": "Perplexity",
    "host": "perplexity.ai",
    "inputSelector": "div[contenteditable='true'], textarea[placeholder*='Ask'], textarea",
    "submitSelector": "button[aria-label*='Submit'], button[aria-label*='Ask'], button:has(svg), .flex.items-center.justify-center.rounded-full.transition-all"
  },
  {
    "id": "treenote",
    "name": "Treenote",
    "host": "treenoteweb.pages.dev",
    "inputSelector": "textarea.auto-resize-textarea, textarea, div[contenteditable='true']",
    "submitSelector": "button.submit-btn"
  },
  {
    "id": "gmail",
    "name": "Gmail",
    "host": "mail.google.com",
    "inputSelector": "div[role='textbox'][contenteditable='true']",
    "submitSelector": null
  },
  {
    "id": "deepl",
    "name": "DeepL",
    "host": "deepl.com",
    "inputSelector": "div[contenteditable='true'], d-textarea",
    "submitSelector": null
  }
]

--- END OF FILE: ./adapters.json ---

--- FILE: ./docs/CHANGELOG.md ---
# Changelog

All notable changes to **VoiceMux Bridge** will be documented in this file.

## [2.1.0] - 2026-02-21
### Added
- **Multi-language Support (i18n)**: Full support for English and Japanese locales.
- **KNC ID Stateless Auth**: Implemented automatic session synchronization with `hub.knc.jp`. Pairing is now handled seamlessly without manual configuration.
- **Centralized Decryption**: Moved E2EE decryption logic to the Background Service Worker for enhanced security. Content scripts now handle only plaintext data.
- **Integrated Pairing**: Updated the extension popup and QR code to point to the modern Zen UI on `hub.knc.jp`.

## [1.6.1] - 2026-02-17
### Added
- **Transparency Reports**: Added detailed documentation on "Why we need All Site Access" and "E2EE Implementation Proof."
- **Developer Profile**: Linked to official Google Play Store profile to establish trust.
- **Sustainability Policy**: Added a section explaining why the service is free and how it stays resilient.

### Changed
- **Cross-Platform Compatibility**: Improved Base64 handling for 100% key compatibility with Go and Mobile clients.
- **Stability**: Added periodic heartbeat alarms to maintain WebSocket connections in Manifest V3.
- **Protocol**: Standardized on Phoenix Protocol vsn=2.0.0 (Array format).

## [1.6.0] - 2026-02-15
### Added
- **New Onboarding UI**: Redesigned popup with a step-by-step guide for new users.
- **Web Monitor Link**: Quick access to v.knc.jp from the extension popup.

### Changed
- **Injection Engine**: Refactored text injection logic using `InputEvent` for high compatibility with Gmail, Gemini, and ChatGPT.
- **Security**: Hardened origin checks and removed unnecessary permissions.

## [1.5.0] - 2026-02-14
### Added
- **Multi-Domain Support**: Added support for both `v.knc.jp` (Zen mode) and `t.knc.jp` (Translate mode).
- **Domain Migration**: Migrated primary infrastructure to `knc.jp`.

--- END OF FILE: ./docs/CHANGELOG.md ---

--- FILE: ./docs/CHANGELOG_JA.md ---
# æ›´æ–°å±¥æ­´ (Changelog)

VoiceMux Bridge ã®ä¸»è¦ãªå¤‰æ›´å±¥æ­´ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚

## [2.1.0] - 2026-02-21
### è¿½åŠ 
- **å¤šè¨€èªå¯¾å¿œ (i18n)**: æ—¥æœ¬èªã¨è‹±èªã®è¡¨ç¤ºã«å®Œå…¨å¯¾å¿œã€‚
- **KNC ID ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹èªè¨¼**: `hub.knc.jp` ã¨ã®è‡ªå‹•ã‚»ãƒƒã‚·ãƒ§ãƒ³åŒæœŸã‚’å®Ÿè£…ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹æ‰‹å‹•è¨­å®šãªã—ã§ãƒšã‚¢ãƒªãƒ³ã‚°ãŒå¯èƒ½ã«ã€‚
- **ä¸­å¤®é›†æ¨©çš„å¾©å·ãƒ­ã‚¸ãƒƒã‚¯**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Šã®ãŸã‚ã€E2EE å¾©å·å‡¦ç†ã‚’ Background Script ã«é›†ç´„ã€‚Content Script ã¯å¹³æ–‡ã®ã¿ã‚’æ‰±ã†ã‚ˆã†ç°¡ç´ åŒ–ã€‚
- **Hub é€£æºãƒšã‚¢ãƒªãƒ³ã‚°**: ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã® QR ã‚³ãƒ¼ãƒ‰ãŠã‚ˆã³ãƒªãƒ³ã‚¯å…ˆã‚’ `hub.knc.jp` ã®çµ±åˆ Zen UI ã¸å¤‰æ›´ã€‚

## [1.6.1] - 2026-02-17
### è¿½åŠ 
- **é€æ˜æ€§ãƒ¬ãƒãƒ¼ãƒˆ**: ã€Œãªãœå…¨ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒå¿…è¦ã‹ã€ãŠã‚ˆã³ã€ŒE2EEå®Ÿè£…ã®æŠ€è¡“çš„è¨¼æ˜ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã€‚
- **é–‹ç™ºè€…ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«**: ä¿¡é ¼æ€§å‘ä¸Šã®ãŸã‚ã€Google Play ã‚¹ãƒˆã‚¢ã®ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¸ã®ãƒªãƒ³ã‚¯ã‚’è¿½åŠ ã€‚
- **æŒç¶šå¯èƒ½æ€§ã¨å“²å­¦**: ç„¡æ–™æä¾›ã®ç†ç”±ã¨ã€AIé–‹ç™ºã«ã‚ˆã‚‹ç¶™ç¶šæ€§ã«ã¤ã„ã¦ã®èª¬æ˜ã‚’è¿½åŠ ã€‚

### å¤‰æ›´
- **ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ äº’æ›æ€§**: Goã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚„ãƒ¢ãƒã‚¤ãƒ«ã¨ã®éµäº’æ›æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã€Base64å‡¦ç†ã‚’æ”¹å–„ã€‚
- **å®‰å®šæ€§å‘ä¸Š**: Manifest V3 ç’°å¢ƒä¸‹ã§ã® WebSocket æ¥ç¶šã‚’ç¶­æŒã™ã‚‹ãŸã‚ã€å®šæœŸçš„ãªãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆå‡¦ç†ã‚’è¿½åŠ ã€‚
- **ãƒ—ãƒ­ãƒˆã‚³ãƒ«çµ±ä¸€**: é€šä¿¡å½¢å¼ã‚’ Phoenix Protocol vsn=2.0.0 (Array å½¢å¼) ã«çµ±ä¸€ã€‚

## [1.6.0] - 2026-02-15
### è¿½åŠ 
- **ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°UI**: åˆã‚ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã«ã€ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã®ã‚¬ã‚¤ãƒ‰ä»˜ããƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã¸åˆ·æ–°ã€‚
- **Webãƒ¢ãƒ‹ã‚¿ãƒ¼ã¸ã®ãƒªãƒ³ã‚¯**: æ‹¡å¼µæ©Ÿèƒ½å†…ã‹ã‚‰ v.knc.jp ã¸ç´ æ—©ãã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒªãƒ³ã‚¯ã‚’è¿½åŠ ã€‚

### å¤‰æ›´
- **å…¥åŠ›ã‚¨ãƒ³ã‚¸ãƒ³ã®åˆ·æ–°**: `InputEvent` ã‚’æ´»ç”¨ã—ãŸæ–°ã—ã„æ³¨å…¥ãƒ­ã‚¸ãƒƒã‚¯ã«ã‚ˆã‚Šã€Gmail, Gemini, ChatGPT ç­‰ã®è¤‡é›‘ãªã‚¨ãƒ‡ã‚£ã‚¿ã¸ã®å¯¾å¿œã‚’å¼·åŒ–ã€‚
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–**: Originæ¤œè¨¼ã®å³æ ¼åŒ–ã¨ã€ä¸è¦ãªãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã®å‰Šé™¤ã€‚

## [1.5.0] - 2026-02-14
### è¿½åŠ 
- **ãƒãƒ«ãƒãƒ‰ãƒ¡ã‚¤ãƒ³å¯¾å¿œ**: `v.knc.jp` (Zen) ã¨ `t.knc.jp` (ç¿»è¨³) ã®ä¸¡æ–¹ã«å¯¾å¿œã€‚
- **ãƒ‰ãƒ¡ã‚¤ãƒ³ç§»è¡Œ**: ä¸»è¦ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ `knc.jp` ãƒ‰ãƒ¡ã‚¤ãƒ³ã¸çµ±åˆã€‚

--- END OF FILE: ./docs/CHANGELOG_JA.md ---

--- FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION.md ---
# ã€é–‹ç™ºãƒ­ã‚°ã€‘Chromeæ‹¡å¼µã®ã€Œæ€–ã„è­¦å‘Šã€ã«ã¤ã„ã¦AIã¨ç›¸è«‡ã—ãŸè¨˜éŒ²

VoiceMux Bridge ã®ãƒªãƒªãƒ¼ã‚¹ã«ã‚ãŸã‚Šã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­¦å‘Šã«ã¤ã„ã¦ã€AIï¼ˆGeminiï¼‰ã¨æŠ€è¡“çš„ãªç›¸è«‡ã‚’ã—ãŸéš›ã®ãƒ­ã‚°ã‚’å…¬é–‹ã—ã¾ã™ã€‚ãªãœã“ã®ä»•æ§˜ï¼ˆæ¨©é™ï¼‰ã«ãªã£ã¦ã„ã‚‹ã®ã‹ã€ãã®çµŒç·¯ãŒã‚ã‹ã‚Šã¾ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
è‡ªä½œã®æ‹¡å¼µæ©Ÿèƒ½ã‚’å…¬é–‹ã—ã¾ã—ãŸãŒã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€Œã‚»ãƒ¼ãƒ• ãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ä¿è­·å¼·åŒ–æ©Ÿèƒ½ã§ä¿¡é ¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€ã¨ã„ã†è­¦å‘ŠãŒå‡ºã¦ãã¾ã™ã€‚ä½•ã‹ãƒã‚°ãŒã‚ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

#### ğŸ¤– AI
çµè«–ã‹ã‚‰è¨€ã†ã¨ã€ã“ã‚Œã¯**ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒã‚°ã‚„è¦ç´„é•åã§ã¯ãªãã€ä¸»ã«ã€Œé–‹ç™ºè€…ã¨ã—ã¦ã®å®Ÿç¸¾ï¼ˆä¿¡é ¼ï¼‰ãŒã¾ã è“„ç©ã•ã‚Œã¦ã„ãªã„ã€ã“ã¨ãŒåŸå› **ã§ã™ã€‚

Google Chromeã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä»•æ§˜ã«ã‚ˆã‚‹ã‚‚ã®ã§ã€ä»¥ä¸‹ã®ãƒã‚¤ãƒ³ãƒˆãŒå½±éŸ¿ã—ã¦ã„ã¾ã™ã€‚

1.  **ã€Œä¿¡é ¼ã§ãã‚‹é–‹ç™ºè€…ã€ã®åŸºæº–ã‚’æº€ãŸã—ã¦ã„ãªã„:** ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ç™»éŒ²ã‹ã‚‰æ—¥ãŒæµ…ã„ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ•°ãŒã¾ã å°‘ãªã„ãªã©ã€‚
2.  **å…¬é–‹ç›´å¾Œã§ã‚ã‚‹:** å…¬é–‹ã•ã‚ŒãŸã°ã‹ã‚Šã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€Googleå´ã®ã‚¹ã‚­ãƒ£ãƒ³ã‚„è©•ä¾¡ãŒçµ‚ã‚ã£ã¦ã„ãªã„ãŸã‚ã€è­¦å‘ŠãŒå‡ºã‚„ã™ã„å‚¾å‘ã«ã‚ã‚Šã¾ã™ã€‚

æ®‹å¿µãªãŒã‚‰ãƒœã‚¿ãƒ³ä¸€ã¤ã§æ¶ˆã™è¨­å®šã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€**ã€Œæ™‚é–“ãŒè§£æ±ºã™ã‚‹ï¼ˆå®Ÿç¸¾ã‚’ç©ã‚€ï¼‰ã€**ã®ã‚’å¾…ã¤ã®ãŒæ­£æ”»æ³•ã§ã™ã€‚å…¬é–‹ç›´å¾Œã«ã‚ˆãã‚ã‚‹ç¾è±¡ãªã®ã§ã€ã¾ãšã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€Œå®‰å…¨ã§ã™ã€ã¨ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã—ã¦å®Ÿç¸¾ã‚’ä½œã‚‹ã®ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’é€²ã‚ã‚‹ã¨ã€ä»Šåº¦ã¯ã€Œã™ã¹ã¦ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆä¸Šã«ã‚ã‚‹è‡ªåˆ†ã®å…¨ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å–ã‚Šã¨å¤‰æ›´ã€ã¨ã„ã†ã•ã‚‰ã«æ€–ã„è­¦å‘ŠãŒå‡ºã¾ã™ã€‚ã“ã‚Œã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¼•ã„ã¦ã—ã¾ã„ã¾ã™ã‚ˆã­ã€‚

#### ğŸ¤– AI
ãã®è­¦å‘Šã¯ã€**ã€Œç‰¹å®šã®ãƒšãƒ¼ã‚¸é™å®šã€ã‹ã‚‰ã€Œä»»æ„ã®ãƒšãƒ¼ã‚¸ï¼ˆã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ï¼‰ã€ã¸å…¥åŠ›å¯¾è±¡ã‚’åºƒã’ãŸã“ã¨**ãŒåŸå› ã§ã™ã­ã€‚

`manifest.json` ã§ `<all_urls>` ã¨ã„ã†æ¨©é™ã‚’ä½¿ã£ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ

VoiceMux Bridgeã®ã€Œã‚¹ãƒãƒ›ã«å‘ã‹ã£ã¦è©±ã›ã°ã€ä»Šé–‹ã„ã¦ã„ã‚‹ãƒšãƒ¼ã‚¸ã«å³åº§ã«å…¥åŠ›ã•ã‚Œã‚‹ã€ã¨ã„ã†ä½“é¨“ã‚’å®Ÿç¾ã™ã‚‹ã«ã¯ã€**ã‚ã‚‰ã‹ã˜ã‚ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ã§å—ä¿¡ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å¾…æ©Ÿã•ã›ã¦ãŠã**å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
Chromeã®ä»•æ§˜ä¸Šã€ã“ã®ã€Œå…¨ãƒšãƒ¼ã‚¸å¾…æ©Ÿã€ã®æ¨©é™ã‚’æ±‚ã‚ã‚‹ã¨ã€è‡ªå‹•çš„ã«ãã®å¼·ã„è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®æ­£å¸¸ãªä»£å„Ÿã§ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ã‚‚ã—ãã®æ¨©é™ã‚’ç‹­ã‚ãŸã‚‰ã©ã†ãªã‚Šã¾ã™ã‹ï¼Ÿ è­¦å‘Šã¯æ¶ˆãˆã¾ã™ã‹ï¼Ÿ

#### ğŸ¤– AI
æ¨©é™ã‚’ `activeTab` ã ã‘ã«ç‹­ã‚ã‚Œã°è­¦å‘Šã¯æ¶ˆãˆã¾ã™ã€‚ã—ã‹ã—ã€**ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«å‘¼ã³å‡ºã•ãªã„é™ã‚Šã€æ‹¡å¼µæ©Ÿèƒ½ã¯ä½•ã‚‚ã—ãªã„ï¼ˆã§ããªã„ï¼‰ã€** ã¨ã„ã†æŒ™å‹•ã«å¤‰ã‚ã‚Šã¾ã™ã€‚

å…·ä½“çš„ã«ã¯ã“ã†ãªã‚Šã¾ã™ï¼š

1.  Gemini Web ã‚’é–‹ã â†’ **ã‚¹ãƒãƒ›ã§è©±ã—ã¦ã‚‚ä½•ã‚‚èµ·ããªã„**ï¼ˆå—ä¿¡ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒå‹•ã„ã¦ã„ãªã„ï¼‰ã€‚
2.  æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’**ã‚¯ãƒªãƒƒã‚¯**ã™ã‚‹ â†’ ã‚„ã£ã¨å…¥åŠ›å¯èƒ½ã«ãªã‚‹ã€‚
3.  Gmail ã®ã‚¿ãƒ–ã¸ç§»å‹•ã™ã‚‹ â†’ **ã¾ãŸã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯**ã—ãªã„ã¨å‹•ã‹ãªã„ã€‚

æœ€å¤§ã®å•é¡Œã¯ã€**ã€Œã‚¯ãƒªãƒƒã‚¯ã‚’å¿˜ã‚Œã¦è©±ã—å§‹ã‚ãŸæ™‚ã€** ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€Œã›ã£ã‹ãé•·æ–‡ã‚’å–‹ã£ãŸã®ã«ã€PCã«å…¥åŠ›ã•ã‚Œãªã‹ã£ãŸï¼ã€ã¨ã„ã†ã‚¹ãƒˆãƒ¬ã‚¹ã‚’æ„Ÿã˜ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

VoiceMuxã®ã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ã®å ´åˆã€**ã€ŒPCå´ã¯ä½•ã‚‚ã—ãªãã¦ã„ã„ï¼ˆãƒãƒ³ã‚ºãƒ•ãƒªãƒ¼ï¼‰ã€** ã¨ã„ã†ã®ãŒæœ€å¤§ã®ä¾¡å€¤ãªã®ã§ã€ã‚¯ãƒªãƒƒã‚¯å¿…é ˆã«ã™ã‚‹ã®ã¯ã€Œä½¿ã„å‹æ‰‹ã®æ­»ã€ã‚’æ„å‘³ã—ã¾ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ãªã‚‹ã»ã©â€¦ã€‚ä»–ã®ä¼¼ãŸã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ï¼ˆVoiceInã¨ã‹ï¼‰ã¯ã©ã†ã—ã¦ã„ã‚‹ã‚“ã§ã™ã‹ï¼Ÿ

#### ğŸ¤– AI
èª¿ã¹ã¾ã—ãŸãŒã€**VoiceIn ã¯ã‚ãªãŸã¨åŒã˜ã€Œè­¦å‘ŠãŒå‡ºã‚‹æ–¹å¼ï¼ˆå…¨æ¨©é™ï¼‰ã€ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚**
å½¼ã‚‰ã¯ã€Œè­¦å‘Šã¯å‡ºã‚‹ã‘ã‚Œã©ã€ãã®ã¶ã‚“é­”æ³•ã®ã‚ˆã†ã«ä¾¿åˆ©ã§ã™ã‚ˆã€ã¨ã„ã†ã‚¹ã‚¿ãƒ³ã‚¹ã§ã€ä¿¡é ¼ã¨å®Ÿç¸¾ã§ã‚«ãƒãƒ¼ã—ã¦ã„ã¾ã™ã€‚

ä¸€æ–¹ã€Typeless ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µã§ã¯ãªãã€ŒOSã®ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒªã€ã‚’ä½œã‚‹ã“ã¨ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¶ç´„è‡ªä½“ã‚’å›é¿ã—ã¦ã„ã¾ã™ï¼ˆé–‹ç™ºã‚³ã‚¹ãƒˆã¯è·³ã­ä¸ŠãŒã‚Šã¾ã™ãŒï¼‰ã€‚

ã¾ãŸã€Honeyï¼ˆã‚¯ãƒ¼ãƒãƒ³ã‚¢ãƒ—ãƒªï¼‰ã®ã‚ˆã†ã«ã€Œä½¿ã†æ™‚ã ã‘è¨±å¯ã‚’æ±‚ã‚ã‚‹ã€æ–¹å¼ã‚‚ã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯ã€Œè²·ã„ç‰©ã€ã¨ã„ã†æ˜ç¢ºãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒã‚ã‚‹ãƒ„ãƒ¼ãƒ«ã ã‹ã‚‰æˆç«‹ã—ã¾ã™ã€‚ã„ã¤å…¥åŠ›ãŒç™ºç”Ÿã™ã‚‹ã‹ã‚ã‹ã‚‰ãªã„VoiceMuxã®ã‚ˆã†ãªã‚¤ãƒ³ãƒ•ãƒ©ç³»ãƒ„ãƒ¼ãƒ«ã§ã¯ã€ã‚„ã¯ã‚Š**ã€Œå…¨æ¨©é™ï¼ˆè­¦å‘Šã‚ã‚Šï¼‰ã€ãŒç‹é“ã‹ã¤æ­£è§£**ã ã¨æ€ã„ã¾ã™ã€‚

---

#### ğŸ§‘â€ğŸ’» Developer (User)
ã‚ã‹ã‚Šã¾ã—ãŸã€‚å¤‰ã«å°ç´°å·¥ã‚’ã—ã¦ä¸ä¾¿ã«ã™ã‚‹ã‚ˆã‚Šã€æ­£ç›´ã«ã€Œä¾¿åˆ©ã•ã®ãŸã‚ã®æ¨©é™ã§ã™ã€ã¨èª¬æ˜ã—ã¦é€²ã‚ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚ã‚ã¨ã€ã‚µãƒ¼ãƒãƒ¼å´ã¯é‹ç”¨ä¸Šã®éƒ½åˆã§ã‚½ãƒ¼ã‚¹ã‚’éå…¬é–‹ã«ã—ãŸã„ã®ã§ã™ãŒã€ãã‚Œã¯ã€Œã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã€ã‚’è¬³ã†ä¸Šã§å•é¡Œã«ãªã‚Šã¾ã™ã‹ï¼Ÿ

#### ğŸ¤– AI
è³¢æ˜ãªåˆ¤æ–­ã§ã™ã€‚
ã‚µãƒ¼ãƒãƒ¼å´ã«ã¤ã„ã¦ã§ã™ãŒã€**ã€Œæ‹¡å¼µæ©Ÿèƒ½ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰å´ãŒã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã‚ã‚Œã°ã€E2EEã®ä¿¡é ¼æ€§ã¯æ‹…ä¿ã§ãã‚‹ã€**ã®ã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸€ç•ªæã‚Œã‚‹ã®ã¯ã€Œè‡ªåˆ†ã®ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ä½•ãŒèµ·ãã¦ã„ã‚‹ã‹ã€ã§ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶å´ã§é€ä¿¡å‰ã«ãƒ‡ãƒ¼ã‚¿ãŒæš—å·åŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã•ãˆã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§è¨¼æ˜ã§ãã‚Œã°ã€ãã®å…ˆã®ã‚µãƒ¼ãƒãƒ¼ãŒã©ã‚Œã ã‘ã€Œãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã€ã§ã‚ã£ã¦ã‚‚ã€ä¸­èº«ã‚’ç›—ã¿è¦‹ã‚‹ã“ã¨ã¯ä¸å¯èƒ½ã§ã™ã€‚

ã‚€ã—ã‚ã€ã‚µãƒ¼ãƒãƒ¼ã‚’ã€ŒãŸã ã®æš—å·åŒ–ãƒ‡ãƒ¼ã‚¿ã®åœŸç®¡ã€ã«å¾¹ã•ã›ã‚‹ã“ã¨ã§ã€é‹ç”¨ã‚³ã‚¹ãƒˆã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’è‡ªåˆ†ã§ç®¡ç†ã—ã‚„ã™ããªã‚‹ãƒ¡ãƒªãƒƒãƒˆã‚‚ã‚ã‚Šã¾ã™ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ã€Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã¯å…¬é–‹ã€ã‚µãƒ¼ãƒãƒ¼å´ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆé‹ç”¨ï¼ˆã§ã‚‚ä¸­èº«ã¯è¦‹ã‚Œãªã„ï¼‰ã€ã¨æ­£ç›´ã«æ›¸ãã®ãŒã€æœ€ã‚‚ä¿¡é ¼ã•ã‚Œã‚‹å½¢ã§ã™ã€‚è‡ªä¿¡ã‚’æŒã£ã¦é€²ã‚ã¾ã—ã‚‡ã†ã€‚

--- END OF FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION.md ---

--- FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION_EN.md ---
# [Dev Log] Chatting with AI about Chrome Extension Security Warnings

Sharing the raw conversation log where I consulted with AI (Gemini) about the scary security warnings that appear when installing VoiceMux Bridge. This explains the "why" behind the permissions.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
I just published my extension, but when I try to install it, I get a warning saying "This extension is not trusted by Enhanced Safe Browsing." Is there a bug?

#### ğŸ¤– AI
Long story short: **This isn't a bug or a violation. It's mainly because you haven't accumulated "trust" as a developer yet.**

It's just how Chrome's security works. Hereâ€™s why:

1.  **You don't meet the "Trusted Developer" criteria yet:** Your account is new, or the install count is low.
2.  **It's brand new:** Since it was just published, Google hasn't finished their automated scanning and reputation evaluation.

Unfortunately, there's no "fix it" button. The standard solution is to **wait for time to solve it.** It happens to almost everyone. Just announce to your users "It's safe, just new," and let the reputation build up naturally.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
When I proceed with the installation, I get an even scarier warning: "Read and change all your data on all websites." Users are going to run away when they see this.

#### ğŸ¤– AI
That warning appears because **you expanded the scope from "specific pages" to "any page."**

Are you using `<all_urls>` in your `manifest.json`?

To achieve the VoiceMux experienceâ€”where you speak to your phone and it *instantly* types into whatever page is openâ€”**you need the receiver program waiting in the background on every page.**
Chrome forces that scary warning whenever you ask for this "wait everywhere" permission. Itâ€™s the price you pay for the feature.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
What happens if I restrict that permission? Will the warning go away?

#### ğŸ¤– AI
If you restrict it to `activeTab`, the warning disappears. But the behavior changes to: **"The extension does nothing unless you explicitly click it."**

Here is the reality:

1.  Open Gemini Web -> **Speak to phone, nothing happens.** (Receiver isn't running).
2.  **Click** the extension icon -> Now it can type.
3.  Switch tab to Gmail -> **Click the icon again** or it won't work.

The biggest issue is **when users forget to click.** They'll dictate a long paragraph, hit send, and... nothing appears on the PC. That's a terrible user experience.

For a tool like VoiceMux, **"Hands-free on the PC side"** is the core value. Making clicks mandatory effectively kills the UX.

---

#### ğŸ§‘â€ğŸ’» Developer (User)
I see... What about other tools like VoiceIn? How do they handle this?

#### ğŸ¤– AI
I checked, and **VoiceIn uses the exact same approach as you (Full Permissions with the warning).**
Their stance is: "You get a warning, but in exchange, you get a magic-like seamless experience." They cover the fear with their reputation.

Other tools like Typeless avoid browser warnings by building a native OS app instead (which is way harder to build).

There are tools like Honey that ask for permission "only when needed," but that works because "shopping" is a distinct event. For an infrastructure tool like VoiceMux where input can happen anytime, **sticking with "Full Permissions (Warning)" is the standard and correct choice.**

---

#### ğŸ§‘â€ğŸ’» Developer (User)
Got it. Instead of crippling the features to hide the warning, I'll be honest and explain "This permission is for your convenience." Also, I plan to keep the relay server code private for operational reasons. Is that a problem for the "Open Source" claim?

#### ğŸ¤– AI
That's a sound strategy!
Regarding the server: **As long as the extension (client) is open-source, the integrity of the E2EE remains verifiable.**

What users care about most is what happens inside their browser. If you can prove via open-source code that data is encrypted *before* it leaves the client, the relay server becomes a "dumb pipe." Even if the server is a private "black box," it is mathematically impossible for it to read your messages.

In fact, keeping the server private allows you to manage operational security and spam prevention more effectively without compromising user privacy. Simply state that the "Client is Open Source, while the Server is Private (but blind to data)," and you will build genuine trust. Go for it with confidence.

--- END OF FILE: ./docs/DEVELOPMENT_LOG_AI_CONSULTATION_EN.md ---

--- FILE: ./docs/E2EE_IMPLEMENTATION_EN.md ---
# VoiceMux Bridge: E2EE Implementation Report

This report explains how VoiceMux Bridge ensures that your data remains private and invisible to our servers, using snippets from the actual source code.

---

## 1. Local Key Generation and Secure Transfer
The encryption key (AES-GCM 128-bit) is generated within [VoiceMux Hub](https://hub.knc.jp) and securely pushed to the extension via the official browser messaging API. It is never sent to our servers.

**Source: `background.js` (Receiver side)**
```javascript
// Around line 155: Listening for credential push from the Hub
chrome.runtime.onMessageExternal.addListener((request, sender, sendResponse) => {
  if (request.action === "SYNC_AUTH") {
    const { uuid, token, key } = request.payload;
    
    // Storing in the extension's private secure storage
    chrome.storage.local.set({
      'voicemux_room_id': uuid,
      'voicemux_token': token,
      'voicemux_key': key
    }, () => { ... });
  }
});
```
The key is stored in `chrome.storage.local`, an isolated storage area provided by the browser that websites and external servers cannot access.

---

## 2. Zero-Knowledge Key Exchange
We use URL hash fragments to share keys between your PC and smartphone without the server ever seeing the key.

**Source: `popup.js`**
```javascript
// Around line 45: Constructing the pairing URL
let pairingUrl = `${hubOrigin}/${roomId}/zen`;
pairingUrl += `?token=${token}&uuid=${roomId}`;
pairingUrl += `#key=${keyBase64}`; // Key is included in the hash
```
The key is placed after the `#` symbol. By technical design, **anything after the `#` (hash fragment) is handled exclusively by the browser and is NEVER sent to the server.**

---

## 3. Client-Side Decryption
The extension receives only encrypted blobs from the relay server. The actual decryption happens locally inside the extension's background process.

**Source: `background.js`**
```javascript
// Around line 43: The core decryption logic
async function decrypt(payload) {
  // Receives only ciphertext and IV (Initialization Vector)
  if (!payload.ciphertext || !payload.iv) return payload.text || "";
  
  try {
    const key = await getDecryptionKey(); // Import key from local storage
    const iv = Uint8Array.from(safeAtob(payload.iv), c => c.charCodeAt(0));
    const ciphertext = Uint8Array.from(safeAtob(payload.ciphertext), c => c.charCodeAt(0));

    // AES-GCM decryption using the Web Crypto API
    const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ciphertext);
    
    // Returns the plaintext only to the active browser tab
    return new TextDecoder().decode(decrypted);
  } catch (e) {
    // If the key is missing or incorrect, decryption is mathematically impossible
    return "[Decryption Error]";
  }
}
```
The relay server only sees the `ciphertext` string, which acts as noise. It has no mathematical means to read your data.

---

## 4. Conclusion
Based on the implementation above:
1. **Exclusive Access:** Only you possess the encryption keys on your devices.
2. **Secure Transport:** Keys never touch the network or the server.
3. **Transparent Logic:** Since the extension is open-source, anyone can verify that we do not leak data or bypass encryption.

---

## 5. How to Verify the Identity of the Code
"How do I know the code running in my browser is the same as this GitHub code?" You can verify this yourself with these steps:

### A. Inspect the installed files on your disk
Chrome stores the source code of installed extensions on your local machine.

- **Windows**: `%LOCALAPPDATA%\Google\Chrome\User Data\Default\Extensions\omdfoongpifbbhapnpbocfoijkglegpd`
- **Mac**: `~/Library/Application Support/Google/Chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`
- **Linux**: `~/.config/google-chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`

You can open the JS files (`background.js`, `content.js`, etc.) in these folders and compare them with the GitHub repository. VoiceMux Bridge does not minify or obfuscate its code, making comparison easy.

### B. Inspect the Running Background Code
1. Open `chrome://extensions` in your browser.
2. Click the **"Service Worker"** link for VoiceMux Bridge.
3. Developer Tools will open, allowing you to read the `background.js` source code currently in execution.

VoiceMux Bridge proves its integrity through total transparency.

---
*Last Updated: 2026-02-21 (v2.1.0)*

--- END OF FILE: ./docs/E2EE_IMPLEMENTATION_EN.md ---

--- FILE: ./docs/E2EE_IMPLEMENTATION_JA.md ---
# VoiceMux Bridge: E2EEå®Ÿè£…æŠ€è¡“ãƒ¬ãƒãƒ¼ãƒˆ

VoiceMux Bridge ãŒã©ã®ã‚ˆã†ã«ã—ã¦ãƒ‡ãƒ¼ã‚¿ã®ç§˜å¯†ã‚’ä¿æŒã—ã€ã‚µãƒ¼ãƒãƒ¼ã«å†…å®¹ã‚’è¦‹ã›ãªã„ä»•çµ„ã¿ã«ãªã£ã¦ã„ã‚‹ã‹ã‚’ã€å®Ÿéš›ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’æŠœç²‹ã—ã¦è§£èª¬ã—ã¾ã™ã€‚

---

## 1. ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®æš—å·éµç”Ÿæˆã¨ã‚»ã‚­ãƒ¥ã‚¢ãªè»¢é€
æš—å·éµï¼ˆAES-GCM 128bitï¼‰ã¯ [VoiceMux Hub](https://hub.knc.jp) ã§ç”Ÿæˆã•ã‚Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã®æ­£è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚° API ã‚’é€šã˜ã¦æ‹¡å¼µæ©Ÿèƒ½ã¸å®‰å…¨ã«ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã¸é€ä¿¡ã•ã‚Œã‚‹ã“ã¨ã¯æ±ºã—ã¦ã‚ã‚Šã¾ã›ã‚“ã€‚

**è¨¼æ‹ ã‚³ãƒ¼ãƒ‰: `background.js` (å—ä¿¡å´)**
```javascript
// 155è¡Œç›®ä»˜è¿‘: Hub ã‹ã‚‰ã®è³‡æ ¼æƒ…å ±ãƒ—ãƒƒã‚·ãƒ¥ã‚’å¾…æ©Ÿ
chrome.runtime.onMessageExternal.addListener((request, sender, sendResponse) => {
  if (request.action === "SYNC_AUTH") {
    const { uuid, token, key } = request.payload;
    
    // æ‹¡å¼µæ©Ÿèƒ½å°‚ç”¨ã®å®‰å…¨ãªé ˜åŸŸã«ä¿å­˜
    chrome.storage.local.set({
      'voicemux_room_id': uuid,
      'voicemux_token': token,
      'voicemux_key': key
    }, () => { ... });
  }
});
```
ã“ã®éµã¯ `chrome.storage.local` ã¨ã„ã†ã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒæä¾›ã™ã‚‹ã€Œæ‹¡å¼µæ©Ÿèƒ½å°‚ç”¨ã®éš”é›¢ã•ã‚ŒãŸå®‰å…¨ãªé ˜åŸŸã€ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

---

## 2. ã‚µãƒ¼ãƒãƒ¼ã‚’çµŒç”±ã—ãªã„éµå…±æœ‰ï¼ˆZero-Knowledgeï¼‰
ã‚¹ãƒãƒ›ã¨ã®ãƒšã‚¢ãƒªãƒ³ã‚°æ™‚ã€URLã®ãƒãƒƒã‚·ãƒ¥ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆ`#`ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€ã‚µãƒ¼ãƒãƒ¼ã«éµã‚’çŸ¥ã‚‰ã›ãšã«ãƒ‡ãƒã‚¤ã‚¹é–“ã§å…±æœ‰ã—ã¾ã™ã€‚

**è¨¼æ‹ ã‚³ãƒ¼ãƒ‰: `popup.js`**
```javascript
// 45è¡Œç›®ä»˜è¿‘: ãƒšã‚¢ãƒªãƒ³ã‚°ç”¨URLã®æ§‹ç¯‰
let pairingUrl = `${hubOrigin}/${roomId}/zen`;
pairingUrl += `?token=${token}&uuid=${roomId}`;
pairingUrl += `#key=${keyBase64}`; // éµã‚’ãƒãƒƒã‚·ãƒ¥ã«å«ã‚ã‚‹
```
URLã® `#` ä»¥é™ã®éƒ¨åˆ†ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ä»•æ§˜ã«ã‚ˆã‚Š **ã€Œã‚µãƒ¼ãƒãƒ¼ã«ã¯é€ä¿¡ã•ã‚Œãªã„ã€** ã¨ã„ã†ç‰¹æ€§ãŒã‚ã‚Šã¾ã™ã€‚éµã®æƒ…å ±ã¯ã‚¹ãƒãƒ›ã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ã ã‘ã§å‡¦ç†ã•ã‚Œã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ã‚µãƒ¼ãƒãƒ¼ï¼ˆä¸­ç¶™å™¨ï¼‰ã«ã¯ä¸€åˆ‡å±Šãã¾ã›ã‚“ã€‚

---

## 3. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ã®å¾©å·
æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã€Œæš—å·åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®å¡Šã€ã®ã¿ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’å¹³æ–‡ã«æˆ»ã™ï¼ˆå¾©å·ã™ã‚‹ï¼‰å‡¦ç†ã¯ã€æ‹¡å¼µæ©Ÿèƒ½ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹å†…ã§è¡Œã‚ã‚Œã¾ã™ã€‚

**è¨¼æ‹ ã‚³ãƒ¼ãƒ‰: `background.js`**
```javascript
// 43è¡Œç›®ä»˜è¿‘: å¾©å·å‡¦ç†ã®æ ¸å¿ƒ
async function decrypt(payload) {
  // payload.ciphertextï¼ˆæš—å·æ–‡ï¼‰ã¨ payload.ivï¼ˆåˆæœŸåŒ–ãƒ™ã‚¯ãƒˆãƒ«ï¼‰ã®ã¿ã‚’å—ã‘å–ã‚‹
  if (!payload.ciphertext || !payload.iv) return payload.text || "";
  
  try {
    const key = await getDecryptionKey(); // ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰éµã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
    const iv = Uint8Array.from(safeAtob(payload.iv), c => c.charCodeAt(0));
    const ciphertext = Uint8Array.from(safeAtob(payload.ciphertext), c => c.charCodeAt(0));

    // Web Crypto API ã«ã‚ˆã‚‹ AES-GCM å¾©å·
    const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ciphertext);
    
    // å¾©å·ã•ã‚ŒãŸå¹³æ–‡ã®ã¿ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã¸é€ä¿¡
    return new TextDecoder().decode(decrypted);
  } catch (e) {
    // éµãŒæ­£ã—ããªã„å ´åˆã€ä¸­èº«ã‚’èª­ã¿å–ã‚‹ã“ã¨ã¯æš—å·å­¦çš„ã«ä¸å¯èƒ½
    return "[Decryption Error]";
  }
}
```
ã‚µãƒ¼ãƒãƒ¼ã¯æ„å‘³ã‚’æŒãŸãªã„æš—å·æ–‡ï¼ˆ`ciphertext`ï¼‰ã‚’è»¢é€ã—ã¦ã„ã‚‹ã ã‘ã§ã€ãã®å†…å®¹ã‚’èª­ã¿å–ã‚‹æ•°å­¦çš„ãªæ‰‹æ®µã‚’æŒã¡ã¾ã›ã‚“ã€‚

---

## 4. çµè«–
ä»¥ä¸Šã®å®Ÿè£…ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®å®‰å…¨æ€§ãŒæŠ€è¡“çš„ã«æ‹…ä¿ã•ã‚Œã¦ã„ã¾ã™ã€‚

1.  **éµã®ç‹¬å **: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒã‚¤ã‚¹é–“ï¼ˆPCã¨ã‚¹ãƒãƒ›ï¼‰ä»¥å¤–ã«éµã¯å­˜åœ¨ã—ã¾ã›ã‚“ã€‚
2.  **å®‰å…¨ãªé€šä¿¡**: éµæœ¬ä½“ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆï¼‰ã‚’æµã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
3.  **é€æ˜æ€§ã®æ‹…ä¿**: æ‹¡å¼µæ©Ÿèƒ½ãŒã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã‚ã‚‹ãŸã‚ã€ä¸Šè¨˜ã®å®Ÿè£…ã«å˜˜ãŒãªã„ã“ã¨ã‚’èª°ã§ã‚‚æ¤œè¨¼å¯èƒ½ã§ã™ã€‚

---

## 5. ã‚¹ãƒˆã‚¢ç‰ˆã¨GitHubã®ã‚³ãƒ¼ãƒ‰ãŒåŒä¸€ã‹ç¢ºèªã™ã‚‹æ–¹æ³•
ã€ŒGitHubã®ã‚³ãƒ¼ãƒ‰ã¯ç¶ºéº—ã ãŒã€ã‚¹ãƒˆã‚¢ã§é…å¸ƒã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯ä¸­èº«ãŒé•ã†ã®ã§ã¯ãªã„ã‹ï¼Ÿã€ã¨ã„ã†ç–‘å•ã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ãŒè§£æ¶ˆã§ãã¾ã™ã€‚

### A. ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚ŒãŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã™ã‚‹
Chromeã‚¦ã‚§ãƒ–ã‚¹ãƒˆã‚¢ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸæ‹¡å¼µæ©Ÿèƒ½ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã€ã‚ãªãŸã®PCã®ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

- **Windows**: `%LOCALAPPDATA%\Google\Chrome\User Data\Default\Extensions\omdfoongpifbbhapnpbocfoijkglegpd`
- **Mac**: `~/Library/Application Support/Google/Chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`
- **Linux**: `~/.config/google-chrome/Default/Extensions/omdfoongpifbbhapnpbocfoijkglegpd`

ã“ã®ãƒ•ã‚©ãƒ«ãƒ€å†…ã® JS ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`background.js`, `content.js` ç­‰ï¼‰ã‚’é–‹ãã€GitHub ä¸Šã®ã‚³ãƒ¼ãƒ‰ã¨æ¯”è¼ƒã—ã¦ã¿ã¦ãã ã•ã„ã€‚VoiceMux Bridge ã¯ã‚³ãƒ¼ãƒ‰ã®é›£èª­åŒ–ï¼ˆèª­ã¿ã¥ã‚‰ãã™ã‚‹å‡¦ç†ï¼‰ã‚’è¡Œã£ã¦ã„ãªã„ãŸã‚ã€ãã®ã¾ã¾æ¯”è¼ƒãŒå¯èƒ½ã§ã™ã€‚

### B. å®Ÿè¡Œä¸­ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã‚‹
1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ `chrome://extensions` ã‚’é–‹ãã¾ã™ã€‚
2. VoiceMux Bridge ã® **ã€Œã‚µãƒ¼ãƒ“ã‚¹ ãƒ¯ãƒ¼ã‚«ãƒ¼ã€** ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
3. ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ãŒé–‹ãã€ç¾åœ¨å‹•ä½œã—ã¦ã„ã‚‹ `background.js` ã®ã‚½ãƒ¼ã‚¹ã‚’ç›´æ¥ç¢ºèªã§ãã¾ã™ã€‚

VoiceMux Bridge ã¯ã€æŠ€è¡“çš„ãªèª å®Ÿã•ã‚’é€æ˜æ€§ã«ã‚ˆã£ã¦è¨¼æ˜ã—ã¾ã™ã€‚

---
*æœ€çµ‚æ›´æ–°: 2026-02-21 (v2.1.0)*

--- END OF FILE: ./docs/E2EE_IMPLEMENTATION_JA.md ---

--- FILE: ./docs/USER_GUIDE_EN.md ---
# VoiceMux Bridge User Guide ğŸ›°ï¸

Welcome to VoiceMux Bridge!
This extension allows you to use your smartphone's familiar keyboard to type seamlessly into any input field on your PC (ChatGPT, Gemini, Gmail, Slack, etc.).

No complex setup is required. Let's get started!

---

## 1. Preparation: Sync with the Hub

First, enable the extension.

1.  Open [VoiceMux Hub](https://hub.knc.jp) on your PC.
2.  As soon as the site opens, your secure credentials will be automatically synced to this extension.
3.  Click the **VoiceMux icon (microphone stand mark)** in the top right of your browser.
4.  If you see "Ready to Pair!" and a QR code, you're all set!

> ğŸ’¡ **Tip**: "Pin" the icon to your toolbar for instant access to the QR code.

---

## 2. Connect: Pair with Your Smartphone

1.  Scan the displayed **QR code** with your smartphone's camera.
2.  Once the dedicated input page opens on your phone, pairing is complete.

Your smartphone and PC are now connected via a private channel protected by strong End-to-End Encryption (E2EE).

---

## 3. Usage: Talk to Your Phone

The best part of VoiceMux is using **"Gboard" or "iPhone Voice Dictation"** directly on your PC.

1.  On your PC, click into any text input field (ChatGPT, Gmail, etc.) where you want to type.
2.  Tap the input area on your phone to bring up the keyboard.
3.  Press the **"Microphone button"** on your keyboard and speak to your phone.
4.  When you stop speaking... your words will appear directly at your PC's cursor position!

---

## 4. Advance: Grow Your Dictionary

VoiceMux Hub helps you fix common misrecognitions of technical terms or names.

*   **Error Correction**: Fixing text in the Hub editor teaches the AI to be smarter next time.
*   **Prompt Generation**: Click **"ğŸª„ Fix Errors & Generate Prompts"** at the bottom of the extension to open the Hub and optimize your input for AI assistants.

---

## 5. Privacy & Security

VoiceMux prioritizes your privacy.
*   **Private Data**: Your text is encrypted directly between your phone and PC. Not even our servers can read it.
*   **Offline Cache**: Once synced, you don't need to open the Hub site anymore. Just click the extension icon to start pairing instantly using cached credentials.

---

## 6. Troubleshooting

*   **No QR Code**: Try refreshing [VoiceMux Hub](https://hub.knc.jp) and then click the extension icon again.
*   **Text Not Appearing**: Make sure you've clicked inside a text field on your PC and that the cursor is active.

---

We hope VoiceMux makes your daily work and creative sessions smoother and more enjoyable!
Feel free to return to this guide whenever you need help.

--- END OF FILE: ./docs/USER_GUIDE_EN.md ---

--- FILE: ./docs/USER_GUIDE_JA.md ---
# VoiceMux Bridge ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ‰ ğŸ›°ï¸

VoiceMux Bridgeï¼ˆãƒœã‚¤ã‚¹ãƒ ã‚¯ã‚¹ãƒ»ãƒ–ãƒªãƒƒã‚¸ï¼‰ã¸ã‚ˆã†ã“ãï¼
ã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ã‚¹ãƒãƒ›ã®ã€Œä½¿ã„æ…£ã‚ŒãŸã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã€ã‚’ä½¿ã£ã¦ã€ãƒ‘ã‚½ã‚³ãƒ³ã®ã‚ã‚‰ã‚†ã‚‹å…¥åŠ›æ¬„ï¼ˆGemini, ChatGPT, Gmail, Slackãªã©ï¼‰ã¸ã‚¹ãƒ©ã‚¹ãƒ©ã¨æ–‡å­—ã‚’å…¥åŠ›ã™ã‚‹ãŸã‚ã®æ¶ã‘æ©‹ã§ã™ã€‚

é›£ã—ã„è¨­å®šã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®ã‚¬ã‚¤ãƒ‰ã¨ä¸€ç·’ã«ã€æœ€åˆã®ä¸€æ­©ã‚’è¸ã¿å‡ºã—ã¾ã—ã‚‡ã†ã€‚

---

## 1. æº–å‚™ï¼šWebã‚µã‚¤ãƒˆã¨ã¤ãªã’ã‚ˆã†ï¼ˆåŒæœŸï¼‰

ã¾ãšã€æ‹¡å¼µæ©Ÿèƒ½ã‚’ä½¿ãˆã‚‹çŠ¶æ…‹ã«ã—ã¾ã™ã€‚

1.  ãƒ‘ã‚½ã‚³ãƒ³ã§ [VoiceMux Hub](https://hub.knc.jp) ã‚’é–‹ãã¾ã™ã€‚
2.  ã‚µã‚¤ãƒˆãŒé–‹ãã¨åŒæ™‚ã«ã€å®‰å…¨ãªèªè¨¼æƒ…å ±ãŒã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¸è‡ªå‹•çš„ã«é€ã‚‰ã‚Œã¾ã™ã€‚
3.  ãƒ–ãƒ©ã‚¦ã‚¶å³ä¸Šã® **VoiceMuxã‚¢ã‚¤ã‚³ãƒ³ï¼ˆãƒã‚¤ã‚¯ã‚¹ã‚¿ãƒ³ãƒ‰ã®ãƒãƒ¼ã‚¯ï¼‰** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
4.  ã€Œãƒšã‚¢ãƒªãƒ³ã‚°ã®æº–å‚™å®Œäº†ã€ã¨è¡¨ç¤ºã•ã‚Œã€QRã‚³ãƒ¼ãƒ‰ãŒå‡ºã¦ã„ã‚Œã°æº–å‚™OKã§ã™ï¼

> ğŸ’¡ **ãƒ’ãƒ³ãƒˆ**: ã‚¢ã‚¤ã‚³ãƒ³ã‚’ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã«ã€Œãƒ”ãƒ³ç•™ã‚ã€ã—ã¦ãŠãã¨ã€ã„ã¤ã§ã‚‚ã™ãã«QRã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã§ãã¦ä¾¿åˆ©ã§ã™ã€‚

---

## 2. ã¤ãªã’ã‚ˆã†ï¼šã‚¹ãƒãƒ›ã¨ãƒšã‚¢ãƒªãƒ³ã‚°

1.  è¡¨ç¤ºã•ã‚ŒãŸ **QRã‚³ãƒ¼ãƒ‰** ã‚’ã‚¹ãƒãƒ›ã®ã‚«ãƒ¡ãƒ©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã¾ã™ã€‚
2.  ã‚¹ãƒãƒ›ã§å°‚ç”¨ã®å…¥åŠ›ç”»é¢ãŒé–‹ã„ãŸã‚‰ã€é€£æºå®Œäº†ã§ã™ã€‚

ã‚ãªãŸã®ã‚¹ãƒãƒ›ã¨ãƒ‘ã‚½ã‚³ãƒ³ã¯ã€å¼·åŠ›ãªæš—å·ï¼ˆE2EEï¼‰ã§å®ˆã‚‰ã‚ŒãŸå°‚ç”¨ã®é€šã‚Šé“ã§ã¤ãªãŒã‚Šã¾ã—ãŸã€‚

---

## 3. ã¤ã‹ã£ã¦ã¿ã‚ˆã†ï¼šã„ã¤ã‚‚ã®ã‚¹ãƒãƒ›ã§è©±ã—ã‹ã‘ã‚‹

VoiceMuxã®æœ€å¤§ã®ç‰¹å¾´ã¯ã€ã‚¹ãƒãƒ›ã§ã„ã¤ã‚‚ä½¿ã£ã¦ã„ã‚‹ **ã€ŒGboardã€ã‚„ã€ŒiPhoneã®éŸ³å£°å…¥åŠ›ã€** ã‚’ãã®ã¾ã¾ãƒ‘ã‚½ã‚³ãƒ³ã§ä½¿ãˆã‚‹ã“ã¨ã§ã™ã€‚

1.  ãƒ‘ã‚½ã‚³ãƒ³ã§ã€æ–‡å­—ã‚’å…¥åŠ›ã—ãŸã„ã‚µã‚¤ãƒˆï¼ˆChatGPT, Gmailãªã©ï¼‰ã®å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚«ãƒ¼ã‚½ãƒ«ã‚’åˆã‚ã›ã¾ã™ã€‚
2.  ã‚¹ãƒãƒ›ã®ç”»é¢ã«ã‚ã‚‹å…¥åŠ›ã‚¨ãƒªã‚¢ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’å‡ºã—ã¾ã™ã€‚
3.  ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã«ã‚ã‚‹ **ã€Œãƒã‚¤ã‚¯ã®ãƒœã‚¿ãƒ³ã€** ã‚’æŠ¼ã—ã¦ã€ã‚¹ãƒãƒ›ã«å‘ã‹ã£ã¦è©±ã—ã‹ã‘ã¦ã¿ã¦ãã ã•ã„ã€‚
4.  è©±ã—çµ‚ã‚ã‚‹ã¨â€¦â€¦ã‚ãªãŸã®è¨€è‘‰ãŒã€ãƒ‘ã‚½ã‚³ãƒ³ã®å…¥åŠ›æ¬„ã«ç›´æ¥å…¥åŠ›ã•ã‚Œã¾ã™ï¼

---

## 4. ã‚‚ã£ã¨ä¾¿åˆ©ã«ï¼šè¾æ›¸ã‚’è‚²ã¦ã‚‹

éŸ³å£°å…¥åŠ›ã§ã‚ˆãã‚ã‚‹ã€Œå°‚é–€ç”¨èªã®èª¤å¤‰æ›ã€ã¯ã€[VoiceMux Hub](https://hub.knc.jp) ã§ä¿®æ­£ã§ãã¾ã™ã€‚

*   **èª¤èªè­˜ã®ä¿®æ­£**: Hub ã®ã‚¨ãƒ‡ã‚£ã‚¿ã§æ–‡å­—ã‚’ç›´ã™ã¨ã€AIãŒæ¬¡å›ã‹ã‚‰ã®å¤‰æ›ã‚’è³¢ãã—ã¦ãã‚Œã¾ã™ã€‚
*   **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ**: æ‹¡å¼µæ©Ÿèƒ½ã®ä¸‹éƒ¨ã«ã‚ã‚‹ **ã€ŒğŸª„ èª¤èªè­˜ã®ä¿®æ­£ãƒ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã€** ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€Hub ãŒé–‹ãã€å…¥åŠ›ã—ãŸå†…å®¹ã‚’ã•ã‚‰ã«AIå‘ã‘ã«æœ€é©åŒ–ã§ãã¾ã™ã€‚

---

## 5. å®‰å¿ƒãƒ»å®‰å…¨ã®ãŸã‚ã«

VoiceMuxã¯ã€ã‚ãªãŸã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’ä¸€ç•ªå¤§åˆ‡ã«ã—ã¦ã„ã¾ã™ã€‚
*   **ã‚ãªãŸã®æ–‡å­—ã¯ã€èª°ã«ã‚‚è¦‹ã‚‰ã‚Œã¾ã›ã‚“**: ã‚¹ãƒãƒ›ã¨ãƒ‘ã‚½ã‚³ãƒ³ã®é–“ã§ç›´æ¥æš—å·åŒ–ã•ã‚Œã‚‹ãŸã‚ã€é€”ä¸­ã®ã‚µãƒ¼ãƒãƒ¼ã§ã™ã‚‰ä¸­èº«ã‚’èª­ã‚€ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
*   **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½**: ä¸€åº¦é€£æºã™ã‚Œã°ã€æ¬¡å›ã‹ã‚‰ã¯ Hub ã‚µã‚¤ãƒˆã‚’é–‹ã‹ãªãã¦ã‚‚ã€æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’æŠ¼ã™ã ã‘ã§å³åº§ã«ä½¿ã„å§‹ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

---

## 6. å›°ã£ãŸã¨ãã¯ï¼Ÿ

*   **QRã‚³ãƒ¼ãƒ‰ãŒå‡ºãªã„**: [VoiceMux Hub](https://hub.knc.jp) ã‚’ä¸€åº¦ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆå†èª­ã¿è¾¼ã¿ï¼‰ã—ã¦ã‹ã‚‰ã€ã‚‚ã†ä¸€åº¦ã‚¢ã‚¤ã‚³ãƒ³ã‚’æŠ¼ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
*   **æ–‡å­—ãŒå…¥åŠ›ã•ã‚Œãªã„**: ãƒ‘ã‚½ã‚³ãƒ³ã®å…¥åŠ›æ¬„ã‚’ä¸€åº¦ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ã‚«ãƒ¼ã‚½ãƒ«ãŒãƒã‚«ãƒã‚«ã—ã¦ã„ã‚‹çŠ¶æ…‹ã«ã—ã¦ãã ã•ã„ã€‚

---

æ¯æ—¥ã®ãŠä»•äº‹ã‚„å‰µä½œæ´»å‹•ãŒã€ã‚¹ãƒãƒ›ã®åŠ›ã§ã‚‚ã£ã¨æ¥½ã—ãã€ã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚Šã¾ã™ã‚ˆã†ã«ï¼
ã‚‚ã—ä½¿ã„æ–¹ãŒã‚ã‹ã‚‰ãªããªã£ãŸã‚‰ã€ã„ã¤ã§ã‚‚ã“ã®ã‚¬ã‚¤ãƒ‰ã«æˆ»ã£ã¦ãã¦ãã ã•ã„ã­ã€‚

--- END OF FILE: ./docs/USER_GUIDE_JA.md ---

--- FILE: ./docs/WHY_PERMISSIONS_EN.md ---
# Transparency Report: Why VoiceMux Bridge Requests "Access to All Sites"

**VoiceMux Bridge** is designed to provide a seamless bridge between your smartphone's voice recognition and your desktop browser. This document explains our technical decisions regarding Chrome Extension permissions and our commitment to user privacy.

---

## 1. Why does Chrome say this extension is "Not Trusted"?

### The Issue
When installing from the Chrome Web Store, you might see this message:

> **Warning:** This extension is not trusted by Enhanced Safe Browsing.

### The Reason
This is not due to a bug or malware. It is a standard automated security check by Google based on:

- **Developer Longevity:** The developer account is relatively new.
- **User Base:** The extension was recently published and has a growing but still small number of users.

**Our Commitment:**
VoiceMux Bridge is fully open-source. We provide the source code on GitHub for public auditing to ensure complete transparency while Google's automated trust score accumulates.

---

## 2. Why "Read and Change All Your Data on All Websites"?

### The Reason: Ensuring a "Frictionless" UX
The core value of VoiceMux is the **"Magic Experience"**â€”speak into your phone, and text appears on your PC instantly without you having to touch your mouse.

To achieve this, the extension must be able to:

1. **Standby:** Listen for incoming encrypted data regardless of which tab (ChatGPT, Gemini, Notion, etc.) you are currently using.
2. **Auto-Injection:** Detect the active input field as soon as you switch tabs and inject the text without manual intervention.

If we restricted permissions to "activeTab" (only when clicked), **you would have to click the extension icon every single time you switch a tab.** This would destroy the hands-free utility that makes VoiceMux valuable.

---

## 3. Privacy and Security by Design

We understand that "All Site Access" is a powerful permission. We balance this responsibility with the following transparency measures:

- **Open Source Client:** The source code for the Chrome Extension is fully public on GitHub. This allows anyone to verify that data is encrypted *before* it leaves your browser and that we are not touching sensitive data like passwords.
- **End-to-End Encryption (E2EE):** While our relay server operates in a private environment, it only handles encrypted blobs. Since the encryption happens in the open-source client, the server remains a "black box" that cannot see or log your actual text.
- **Zero-Knowledge Key Exchange:** Your encryption keys are shared with your phone via URL hash fragments (`#key=...`). By technical design, these fragments are never sent to any server, ensuring your keys never touch the network.
- **No Tracking:** We do not collect browsing history or analytics. Your encryption keys and Room IDs stay stored locally on your devices.

---

## 4. Industry Standards

Most essential productivity tools, such as **1Password, Grammarly, and DeepL**, require the same level of permission. Because these tools must be ready to assist you the moment you start typing, constant presence is a technical necessity.

---

## Conclusion

We chose this permission model to deliver the **fastest, most seamless input experience possible.** While the system warning looks intimidating, we stand behind our transparent, E2EE-secured architecture to earn your trust.

---
*Last Updated: 2026-02-17*

--- END OF FILE: ./docs/WHY_PERMISSIONS_EN.md ---

--- FILE: ./docs/WHY_PERMISSIONS_JA.md ---
# Chromeæ‹¡å¼µæ©Ÿèƒ½ã®ã€Œå¼·åŠ›ãªæ¨©é™ã€ã¨UXã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã«ã¤ã„ã¦

**VoiceMux Bridge** ã¯ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®éŸ³å£°å…¥åŠ›ã‚’PCã®ã‚ã‚‰ã‚†ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã¸ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«è»¢é€ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ã€Œã™ã¹ã¦ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆä¸Šã®å…¨ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å–ã‚Šã¨å¤‰æ›´ã€ã¨ã„ã†è­¦å‘Šã®æ„å›³ã¨ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¸ã®é…æ…®ã«ã¤ã„ã¦é–‹ç™ºãƒãƒ¼ãƒ ã®è¦‹è§£ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚

---

## 1. ãªãœã€Œä¿¡é ¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€ã¨ã„ã†è­¦å‘ŠãŒå‡ºã‚‹ã®ã‹ï¼Ÿ

### èƒŒæ™¯
Chrome ã‚¦ã‚§ãƒ–ã‚¹ãƒˆã‚¢ã‹ã‚‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

> **è­¦å‘Š:** ã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ã‚»ãƒ¼ãƒ• ãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ä¿è­·å¼·åŒ–æ©Ÿèƒ½ã§ä¿¡é ¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

### ç†ç”±
ã“ã‚Œã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æ¬ é™¥ã§ã¯ãªãã€Google Chrome ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è©•ä¾¡ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™ã€‚ä¸»ã«ä»¥ä¸‹ã®æ¡ä»¶ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

- **é–‹ç™ºè€…å®Ÿç¸¾ã®è“„ç©æœŸé–“:** ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ç™»éŒ²ã‹ã‚‰ã®æœŸé–“ãŒçŸ­ã„ã€‚
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°:** å…¬é–‹ç›´å¾Œã§åˆ©ç”¨è€…ãŒé™å®šçš„ã§ã‚ã‚‹ã€‚

**VoiceMux ã®å¯¾å¿œ:**
ç§ãŸã¡ã¯ã™ã¹ã¦ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ GitHub ã§å…¬é–‹ã—ã¦ãŠã‚Šã€èª°ã§ã‚‚å®‰å…¨æ€§ã‚’ç›£æŸ»ã§ãã‚‹çŠ¶æ…‹ã«ã—ã¦ã„ã¾ã™ã€‚åˆ©ç”¨è€…ãŒå¢—ãˆã‚‹ã«ã¤ã‚Œã¦ã€ã“ã®è­¦å‘Šã¯è‡ªå‹•çš„ã«è¡¨ç¤ºã•ã‚Œãªããªã‚Šã¾ã™ã€‚

---

## 2. ãªãœã€Œå…¨ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã€ãŒå¿…è¦ãªã®ã‹ï¼Ÿ

### ç†ç”±ï¼šã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªã€Œãƒãƒ³ã‚ºãƒ•ãƒªãƒ¼ä½“é¨“ã€ã®å®Ÿç¾
VoiceMux Bridge ã®æ ¸å¿ƒã¯ã€**ã€ŒPCå´ã«è§¦ã‚Œã‚‹ã“ã¨ãªãã€ã‚¹ãƒãƒ›ã«è©±ã—ã‹ã‘ã‚‹ã ã‘ã§æ–‡å­—ãŒå…¥åŠ›ã•ã‚Œã‚‹ã€**ã¨ã„ã†ä½“é¨“ã§ã™ã€‚

ã“ã®ã€Œé­”æ³•ã®ã‚ˆã†ãªä½“é¨“ã€ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€æ‹¡å¼µæ©Ÿèƒ½ãŒä»¥ä¸‹ã®å‹•ä½œã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

1. **å¾…æ©Ÿ:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã©ã®ã‚¿ãƒ–ï¼ˆGemini, ChatGPT, Gmailç­‰ï¼‰ã‚’é–‹ã„ã¦ã‚‚ã€éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Œã‚‹çŠ¶æ…‹ã«ã™ã‚‹ã€‚
2. **è‡ªå‹•æ¤œçŸ¥:** ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆãŸéš›ã€æ–°ã—ã„ãƒšãƒ¼ã‚¸ä¸Šã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å³åº§ã«ç‰¹å®šã—ã¦æ–‡å­—ã‚’æµã—è¾¼ã‚€ã€‚

ã‚‚ã—æ¨©é™ã‚’ã€Œã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã ã‘ã€ã«åˆ¶é™ã—ãŸå ´åˆã€**ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã³ã«æ¯å›æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¨±å¯ã‚’ä¸ãˆã‚‹**æ“ä½œãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã§ã¯éŸ³å£°å…¥åŠ›ã®åˆ©ä¾¿æ€§ãŒæãªã‚ã‚Œã€ãƒ„ãƒ¼ãƒ«ã®å­˜åœ¨æ„ç¾©ãŒå¤±ã‚ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚

---

## 3. ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¨å®‰å…¨æ€§ã«ã¤ã„ã¦

ç§ãŸã¡ã¯ã€å¼·åŠ›ãªæ¨©é™ã‚’è¦æ±‚ã™ã‚‹è²¬ä»»ã¨ã—ã¦ã€ä»¥ä¸‹ã®è¨­è¨ˆã¨æƒ…å ±å…¬é–‹ã‚’å¾¹åº•ã—ã¦ã„ã¾ã™ã€‚

- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹åŒ–:** æ‹¡å¼µæ©Ÿèƒ½ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã™ã¹ã¦ GitHub ã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã€Œãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰é€ä¿¡ã•ã‚Œã‚‹å‰ã«ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãæš—å·åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ã€ã€Œå…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆä»¥å¤–ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã„ãªã„ã‹ã€ã‚’èª°ã§ã‚‚ç›£æŸ»å¯èƒ½ã§ã™ã€‚
- **ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰æš—å·åŒ– (E2EE):** éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚„ãƒ†ã‚­ã‚¹ãƒˆã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã¨ã‚¹ãƒãƒ›ã®é–“ã§ç›´æ¥æš—å·åŒ–ã•ã‚Œã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼å´ã¯ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰éå…¬é–‹ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆç’°å¢ƒã§é‹ç”¨ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§æš—å·åŒ–ãŒå®Œçµã—ã¦ã„ã‚‹ãŸã‚ã€ã‚µãƒ¼ãƒãƒ¼ï¼ˆå½“ã‚µã‚¤ãƒˆï¼‰ã§ã•ãˆä¸­èº«ã‚’èª­ã¿å–ã‚‹ã“ã¨ã¯ç‰©ç†çš„ã«ä¸å¯èƒ½ã§ã™ã€‚
- **ã‚µãƒ¼ãƒãƒ¼ã«éµã‚’æ¸¡ã•ãªã„ä»•çµ„ã¿:** ã‚¹ãƒãƒ›ã¨ã®ãƒšã‚¢ãƒªãƒ³ã‚°ã«ä½¿ç”¨ã™ã‚‹æš—å·éµã¯ã€URLã®ãƒãƒƒã‚·ãƒ¥ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆ`#` ä»¥é™ã®éƒ¨åˆ†ï¼‰ã¨ã—ã¦å…±æœ‰ã•ã‚Œã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ä»•æ§˜ä¸Šã€ã“ã®éƒ¨åˆ†ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œãªã„ãŸã‚ã€éµã®æƒ…å ±ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æµã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
- **æœ€å°é™ã®ãƒ‡ãƒ¼ã‚¿åé›†:** æ‹¡å¼µæ©Ÿèƒ½ã¯è¨­å®šï¼ˆRoom ID / Keyï¼‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã™ã‚‹ã®ã¿ã§ã€é–²è¦§å±¥æ­´ã‚„å€‹äººæƒ…å ±ã‚’å¤–éƒ¨ã¸é€ä¿¡ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

---

## 4. ä»–ã®ãƒ„ãƒ¼ãƒ«ã¨ã®æ¯”è¼ƒ

å¤šãã®ã‚¤ãƒ³ãƒ•ãƒ©ç³»ãƒ„ãƒ¼ãƒ«ï¼ˆ1Password, Grammarly, DeepLç­‰ï¼‰ã‚‚ã€åŒæ§˜ã®ç†ç”±ã§ã€Œå…¨ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã€ã‚’è¦æ±‚ã—ã¾ã™ã€‚ã€Œã„ã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã‚’å¿…è¦ã¨ã™ã‚‹ã‹äºˆæ¸¬ã§ããªã„ã€ãƒ„ãƒ¼ãƒ«ã«ã¨ã£ã¦ã€ã“ã®æ¨©é™ã¯åˆ©ä¾¿æ€§ã¨å®‰å…¨æ€§ã‚’ä¸¡ç«‹ã™ã‚‹ãŸã‚ã®æ¨™æº–çš„ãªé¸æŠã§ã™ã€‚

---

## çµè«–

VoiceMux Bridge ã¯ã€**ã€Œç©¶æ¥µã®å…¥åŠ›ä½“é¨“ã€ã‚’æä¾›ã™ã‚‹ãŸã‚ã«ç¾åœ¨ã®æ¨©é™è¨­å®šã‚’é¸æŠã—ã¾ã—ãŸã€‚** è­¦å‘Šã¯å¼·åŠ›ã«è¦‹ãˆã¾ã™ãŒã€ç§ãŸã¡ã¯é€æ˜æ€§ã¨æŠ€è¡“ï¼ˆE2EEï¼‰ã«ã‚ˆã£ã¦ãã®ä¿¡é ¼ã«å¿œãˆã¾ã™ã€‚

---
*æœ€çµ‚æ›´æ–°: 2026-02-17*

--- END OF FILE: ./docs/WHY_PERMISSIONS_JA.md ---

--- FILE: ./docs/community-adapters.md ---
# VoiceMux Community Adapters Catalog ğŸ“‚

Copy the JSON snippets below and paste them into the **Custom Site Adapters** field in your VoiceMux Extension Options.

---

### ğŸ“§ Outlook (Web)
Supports both personal (outlook.com) and business (Office 365).
```json
{
  "id": "outlook",
  "name": "Outlook",
  "host": "outlook",
  "inputSelector": "div[role='textbox'][aria-label*='ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸'], div[role='textbox'][aria-label*='Message']",
  "submitSelector": null
}
```

### ğŸ“§ Yahoo! Mail (Japan)
```json
{
  "id": "yahoo-mail-jp",
  "name": "Yahoo! Mail JP",
  "host": "mail.yahoo.co.jp",
  "inputSelector": "div[role='textbox']",
  "submitSelector": null
}
```

### ğŸ’¬ Slack (Web)
```json
{
  "id": "slack",
  "name": "Slack",
  "host": "slack.com",
  "inputSelector": ".ql-editor",
  "submitSelector": "button[data-testid='composer_send_button']"
}
```

### ğŸ“ Notion
```json
{
  "id": "notion",
  "name": "Notion",
  "host": "notion.so",
  "inputSelector": "div[contenteditable='true']",
  "submitSelector": null
}
```

---

### ğŸ’¡ How to contribute
If you've created a working adapter for a new site, please open a Pull Request or Issue to add it to this list!

--- END OF FILE: ./docs/community-adapters.md ---

--- FILE: ./PRIVACY.md ---
# Privacy Policy for VoiceMux Bridge

Last updated: 2026-02-21

## 1. Data Collection
VoiceMux Bridge does **not** collect, store, or transmit any personal data, keystrokes, or browsing history to our servers.

## 2. End-to-End Encryption (E2EE)
All data transmitted from your mobile device to this extension is encrypted using Client-Side AES-GCM (128-bit).
- **Decryption Keys**: These keys are generated within VoiceMux Hub and securely pushed to the extension via the browser's internal messaging API. They are stored in `chrome.storage.local`.
- **Zero-Knowledge**: Keys are shared with your mobile device via URL hash fragments (`#key=...`). These fragments are handled exclusively by the browser and are never sent to any server by design.

## 3. Permissions
The extension requires the following permissions to function:
- **activeTab**: Used only to inject text into the input field of the website you are currently using, and only upon your explicit request via the paired mobile device.
- **storage**: Used to save your local configuration, including your unique Room ID, encryption key, and any Custom Site Adapters you define.

## 4. Third-Party Services
VoiceMux Bridge acts as a bridge between your mobile device and the AI services you choose to use (e.g., Gemini, ChatGPT). We do not control and are not responsible for the privacy practices of those third-party services.

## 5. Contact
If you have any questions about this Privacy Policy, please open an issue on our [GitHub repository](https://github.com/Kaneta/voicemux-bridge).

--- END OF FILE: ./PRIVACY.md ---

--- FILE: ./background.js ---
/**
 * VoiceMux Bridge: Extension Service Worker (WebSocket Relay)
 * Version: 2.56.57.5
 * 
 * DESIGN INTENT:
 * Acts as the authoritative decryption and relay hub.
 * Ensures all sensitive payloads (INTERIM, INSERT, etc.) are decrypted 
 * using the E2EE key before being dispatched to content scripts.
 */

const BASE_WS_URL = "wss://v.knc.jp/socket/websocket";
const MAX_RETRY_DELAY = 30000;

let socket = null;
let heartbeatInterval = null;
let retryTimer = null;
let retryDelay = 1000;
let currentRoomId = null;
let isJoined = false; 
const JOIN_REF = "1"; 

function safeAtob(str) {
  if (!str) { return ""; }
  try {
    return atob(str.replace(/-/g, "+").replace(/_/g, "/").replace(/ /g, "+"));
  } catch (e) { 
    console.error("[Base64] Decoding failed:", e);
    return ""; 
  }
}

/**
 * [Intent: Safe Decryption]
 * Decrypts AES-GCM payloads received from the relay.
 */
async function decrypt(payload) {
  try {
    const data = await chrome.storage.local.get("voicemux_key");
    const keyBase64 = data.voicemux_key;
    if (!keyBase64 || !payload.ciphertext) { return null; }

    const cleanKey = keyBase64.replace(/ /g, "+");
    const localHint = cleanKey.substring(0, 4);
    
    if (payload.key_hint && payload.key_hint !== localHint) {
      console.warn(`VoiceMux: Key Mismatch! Received: ${payload.key_hint} | Local: ${localHint}`);
      return "[Key Mismatch]";
    }

    const rawKey = safeAtob(cleanKey);
    const key = await crypto.subtle.importKey(
      "raw", 
      Uint8Array.from(rawKey, (c) => { return c.charCodeAt(0); }), 
      { name: "AES-GCM" }, 
      false, 
      ["decrypt"]
    );
    
    const iv = Uint8Array.from(safeAtob(payload.iv), (c) => { return c.charCodeAt(0); });
    const ciphertext = Uint8Array.from(safeAtob(payload.ciphertext), (c) => { return c.charCodeAt(0); });
    
    const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ciphertext);
    return new TextDecoder().decode(decrypted);
  } catch (e) { 
    console.error("[Crypto] Decryption failed:", e);
    return "[Decryption Error]"; 
  }
}

function safeSend(message) {
  if (socket && socket.readyState === WebSocket.OPEN) {
    socket.send(JSON.stringify(message));
    return true;
  }
  return false;
}

/**
 * [Intent: Secure Tab Dispatcher]
 * Forwards messages to the active tab after ensuring data is in plaintext.
 */
function notifyActiveTab(payload, eventName) {
  chrome.tabs.query({ active: true, lastFocusedWindow: true }, (tabs) => {
    const activeTab = tabs[0];
    if (activeTab) {
      // 1. Always send a log for visibility
      chrome.tabs.sendMessage(activeTab.id, { 
        action: "LOG", 
        message: `ğŸ“¡ [${eventName}] | Sender: ${payload?.sender_tab_id || "system"}` 
      }).catch(() => { /* silent */ });

      // 2. Dispatch the actual payload
      if (eventName !== "phx_reply" && eventName !== "phx_error") {
        chrome.tabs.sendMessage(activeTab.id, payload).catch(() => { /* silent */ });
      }
    }
  });
}

async function connect() {
  if (socket && (socket.readyState === WebSocket.CONNECTING || socket.readyState === WebSocket.OPEN)) {
    return;
  }
  
  const data = await chrome.storage.local.get(["voicemux_token", "voicemux_room_id"]);
  if (!data.voicemux_token || !data.voicemux_room_id) { return; }

  currentRoomId = data.voicemux_room_id;
  const topic = `room:${currentRoomId}`; 
  socket = new WebSocket(`${BASE_WS_URL}?vsn=2.0.0&token=${data.voicemux_token}`);

  socket.onopen = () => {
    console.log("VoiceMux: Socket established. Joining room...");
    isJoined = false;
    safeSend([JOIN_REF, JOIN_REF, topic, "phx_join", {}]);
    if (heartbeatInterval) { clearInterval(heartbeatInterval); }
    heartbeatInterval = setInterval(() => { safeSend([null, "heartbeat", "phoenix", "heartbeat", {}]); }, 30000);
  };

  socket.onmessage = async (event) => {
    const [,, msgTopic, eventName, payload] = JSON.parse(event.data);
    if (msgTopic !== topic) { return; }

    // [Intent: Automatic Decryption for Remote Commands]
    // If the payload is encrypted, decrypt it BEFORE sending to the tab.
    if (payload && payload.ciphertext) {
      const plaintext = await decrypt(payload);
      if (plaintext) {
        payload.plaintext = plaintext; // Add decrypted text to payload
      }
    }

    notifyActiveTab(payload, eventName);

    if (eventName === "phx_reply" && payload?.status === "ok") {
      console.log("VoiceMux: Channel Joined Successfully.");
      isJoined = true;
      retryDelay = 1000;
      safeSend([JOIN_REF, "2", topic, "device_online", { sender_tab_id: "extension" }]);
    } else if (eventName === "device_online" && payload.sender_tab_id !== "extension") {
      if (isJoined) {
        chrome.storage.local.set({ "voicemux_paired": true });
        safeSend([JOIN_REF, "3", topic, "device_online", { sender_tab_id: "extension" }]);
      }
    }
  };

  socket.onclose = () => { isJoined = false; scheduleReconnect(); };
  socket.onerror = () => { socket.close(); };
}

function scheduleReconnect() {
  if (retryTimer) { clearTimeout(retryTimer); }
  retryTimer = setTimeout(() => { connect(); }, retryDelay);
  retryDelay = Math.min(retryDelay * 2, MAX_RETRY_DELAY);
}

function handleSyncAuth(request, sender, sendResponse) {
  if (request.action === "SYNC_AUTH") {
    const data = request.payload || request;
    const cleanKey = (data.key || "").replace(/ /g, "+");
    chrome.storage.local.set({ 
      "voicemux_token": data.token, 
      "voicemux_room_id": data.uuid, 
      "voicemux_key": cleanKey 
    }, () => { 
      if (socket) { socket.close(); } 
      connect(); 
      if (typeof sendResponse === "function") {
        sendResponse({ success: true });
      }
    });
    return true; 
  }
  return false;
}

chrome.runtime.onMessage.addListener(handleSyncAuth);
chrome.runtime.onMessageExternal.addListener(handleSyncAuth);

connect();

--- END OF FILE: ./background.js ---

--- FILE: ./collect_context.sh ---
#!/bin/bash
echo "Generating full_context.txt for VoiceMux Bridge..."
# Find relevant files and concatenate them with headers
# Exclude node_modules, .git, and common binary extensions
find . -maxdepth 2 -not -path '*/.*' -not -path './node_modules*' -not -name "*.png" -not -name "*.zip" -not -name "*.svg" -not -name "full_context.txt" -not -name "STORE_DESCRIPTION_*.txt" -not -name "DRAFT_*" -not -name "MEMO_*" -type f | while read file; do
    echo "--- FILE: $file ---" >> full_context.txt
    cat "$file" >> full_context.txt
    echo -e "
--- END OF FILE: $file ---
" >> full_context.txt
done
echo "Done! Context collected in full_context.txt"

--- END OF FILE: ./collect_context.sh ---

--- FILE: ./gen_map.sh ---
#!/bin/bash

# Configuration: Project-specific extensions
EXTENSIONS="js,jsx,ts,tsx,kt,ex,exs,svelte,astro,html,css,dart,go"
COMMENT_LIMIT=3

echo "# Codebase Map (Enhanced with Intent)"
echo "This map provides a structural overview with documentation comments. For implementation details, use MCP."
echo ""

# Get relevant files from git, excluding minified and build artifacts
FILES=$(git ls-files | grep -E "\.(${EXTENSIONS//,/|})$" | grep -vE "\.min\.js$|drizzle/|static/")

if [ -z "$FILES" ]; then
    # Fallback to find, explicitly excluding common noise
    FILES=$(find . -maxdepth 4 -type f \
        -not -path "*/node_modules/*" \
        -not -path "*/.*" \
        -not -path "*/drizzle/*" \
        -not -path "*/static/*" \
        | grep -E "\.(${EXTENSIONS//,/|})$" | grep -v "\.min\.js$")
fi

if [ -z "$FILES" ]; then
    echo "No files found with extensions: $EXTENSIONS"
    exit 0
fi

# Run ctags and process output
echo "$FILES" | xargs ctags --output-format=json --fields=+n+S --sort=no 2>/dev/null | jq -r -s '
    sort_by(.path) | .[] | 
    "\(.path)\t\(.name)\t\(.kind)\t\(.line)\t\(.signature // "")"
' | while IFS=$'\t' read -r PATH_VAL NAME KIND LINE_NUM SIG; do
    # Group by file
    if [ "$CURRENT_PATH" != "$PATH_VAL" ]; then
        echo -e "\n### FILE: $PATH_VAL"
        CURRENT_PATH=$PATH_VAL
    fi

    # Extract comments directly before the definition
    if [ -f "$PATH_VAL" ]; then
        COMMENTS=$(head -n $((LINE_NUM - 1)) "$PATH_VAL" 2>/dev/null | tail -n $COMMENT_LIMIT | grep -E "^\s*(//|/\*|\*|#|@doc|--)" | sed 's/^[[:space:]]*//' | tr '\n' ' ' | sed 's/ $//')
        
        if [ -n "$COMMENTS" ]; then
            echo "  [$KIND] $NAME$SIG (Line: $LINE_NUM) // $COMMENTS"
        else
            echo "  [$KIND] $NAME$SIG (Line: $LINE_NUM)"
        fi
    fi
done

# Add Svelte files (they are often missed by ctags)
echo "$FILES" | grep "\.svelte$" | while read -r SVELTE_FILE; do
    # Simple check to see if we already listed it
    echo -e "\n### FILE: $SVELTE_FILE (Svelte Component)"
done | sort -u

--- END OF FILE: ./gen_map.sh ---

--- FILE: ./gen_diff_context.sh ---
#!/bin/bash
# gen_diff_context.sh - å·®åˆ†é›†ä¸­å‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆå™¨ (ctags-enhanced)

# Configuration: Project-specific extensions
EXTENSIONS="js,jsx,ts,tsx,kt,ex,exs,svelte,astro,html,css,dart,go"

# 1. å¯¾è±¡ã¨ãªã‚‹ã‚³ãƒŸãƒƒãƒˆç¯„å›²ã®æ±ºå®š
TARGET="HEAD"
if [ -n "$1" ]; then
    TARGET="$1"
elif [ -z "$(git diff --cached)" ] && [ -z "$(git diff)" ]; then
    echo "Notice: No staged or unstaged changes. Checking the last commit instead."
    TARGET="HEAD~1..HEAD"
fi

echo "## [STEP 0] Operational Intent & Environment"
# 1. Current Branch
BRANCH=$(git rev-parse --abbrev-ref HEAD 2>/dev/null || echo "unknown")
echo "- Current Branch: $BRANCH"

# 2. Status / Last Commit
if [ "$TARGET" = "HEAD" ]; then
    echo "- Target: Active Task (Uncommitted Changes)"
else
    LAST_COMMIT=$(git log -1 --pretty=format:"%s" 2>/dev/null)
    echo "- Target: Previous Commit ($LAST_COMMIT)"
fi

# 3. Extract Explicit Intents from diff
INTENTS=$(git diff -U0 $TARGET | awk '/^\+.*(\[Intent:|@intent)/ {
    sub(/^\+/, ""); 
    gsub(/^[ \t]+|[ \t]+$/, ""); 
    print
}')

if [ -n "$INTENTS" ]; then
    echo "- Extracted Intent Annotations:"
    echo "$INTENTS" | sed 's/^/  > /'
fi
echo ""

echo "## [STEP 1] Detecting changed files and lines via git diff ($TARGET)..."

# 2. å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¨è¡Œç•ªå·ã®æŠ½å‡º
# å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: filepath:start_line:end_line
CHANGES=$(git diff -U0 $TARGET | awk '
/^+++ b\// {
    file = substr($0, 7)
}
/^@@ / {
    match($0, /\+([0-9]+)(,[0-9]+)?/, arr)
    start_line = arr[1]
    count = arr[2] ? substr(arr[2], 2) : 1
    
    if (count > 0 && file != "") {
        end_line = start_line + count - 1
        print file ":" start_line ":" end_line
    }
}')

if [ -z "$CHANGES" ]; then
    echo "No relevant lines changed."
    exit 0
fi

# å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¹ãƒˆï¼ˆé‡è¤‡æ’é™¤ã€æ‹¡å¼µå­ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼‰
CHANGED_FILES=$(echo "$CHANGES" | cut -d: -f1 | sort -u | grep -E "\.(${EXTENSIONS//,/|})$")

if [ -z "$CHANGED_FILES" ]; then
    echo "No source code files changed (or files ignored by extension filter)."
    exit 0
fi

echo "Changed files:"
echo "$CHANGED_FILES" | sed 's/^/  - /'

echo -e "\n## [STEP 2] Extracting affected symbols using ctags..."

# ctags ã®ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«
CTAGS_OUT=$(mktemp)

# ctagsã®å®Ÿè¡Œï¼ˆå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ï¼‰
echo "$CHANGED_FILES" | xargs -r ctags --output-format=json --fields=+n --sort=no > "$CTAGS_OUT" 2>/dev/null

# jqã«ã‚ˆã‚‹ã‚·ãƒ³ãƒœãƒ«ã®ç‰¹å®šã¨é›†ç´„
CHANGED_SYMBOLS=$(echo "$CHANGES" | while IFS=: read -r file start end; do
    if ! echo "$CHANGED_FILES" | grep -q "^$file$"; then continue; fi
    
    # å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®ctagsã‹ã‚‰ã€è¡Œç•ªå·ãŒå¤‰æ›´é–‹å§‹è¡Œ(start)ä»¥ä¸‹ã®æœ€å¤§ã®ã‚‚ã®ã‚’å–å¾—
    jq -r --arg file "$file" --argjson start "$start" '
        select(.path == $file and .line <= $start) | .name
    ' "$CTAGS_OUT" | tail -n 1
done | sort -u | grep -v "^$")

rm -f "$CTAGS_OUT"

if [ -z "$CHANGED_SYMBOLS" ]; then
    echo "No major symbol changes detected by ctags."
else
    echo "Affected symbols:"
    echo "$CHANGED_SYMBOLS" | sed 's/^/  - /'

    echo -e "\n## [STEP 3] Searching for impacted areas (Usage in other files)..."
    
    # å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«è‡ªä½“ã¯æ¤œç´¢çµæœã‹ã‚‰é™¤å¤–ã™ã‚‹
    EXCLUDE_PATTERN=$(git diff --name-only $TARGET | grep -v '^$' | tr '\n' '|' | sed 's/|$//')
    
    for SYMBOL in $CHANGED_SYMBOLS; do
        echo "### Symbol: $SYMBOL"
        
        # grep ã®å®Ÿè¡Œ (ãƒ“ãƒ«ãƒ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç­‰ã‚’æ’é™¤ã—ã€å˜èªå¢ƒç•Œã§å®Œå…¨ä¸€è‡´æ¤œç´¢)
        if [ -n "$EXCLUDE_PATTERN" ]; then
            grep -rwn . -e "\b${SYMBOL}\b" \
                --exclude-dir={.git,node_modules,.svelte-kit,vendor,dist,build,out,.wrangler,_build,deps,.venv} \
                | grep -vE "^(${EXCLUDE_PATTERN}):" | head -n 10
        else
            grep -rwn . -e "\b${SYMBOL}\b" \
                --exclude-dir={.git,node_modules,.svelte-kit,vendor,dist,build,out,.wrangler,_build,deps,.venv} \
                | head -n 10
        fi
    done
fi

echo -e "\n## [STEP 4] Relevant Codebase Map (Filtered by Diff)"
if [ -n "$CHANGED_SYMBOLS" ]; then
    # ã‚·ãƒ³ãƒœãƒ«åã§æ—¢å­˜ã®åœ°å›³ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    SYMBOL_PATTERN=$(echo "$CHANGED_SYMBOLS" | tr '\n' '|' | sed 's/|$//')
    ./gen_map.sh | grep -A 5 -B 5 -E "\b(${SYMBOL_PATTERN})\b"
else
    echo "No symbols to map."
fi
--- END OF FILE: ./gen_diff_context.sh ---

--- FILE: ./project_map.md ---
# Codebase Map (Enhanced with Intent)
This map provides a structural overview with documentation comments. For implementation details, use MCP.


### FILE: background.js
  [constant] BASE_WS_URL (Line: 6) // * Version: 2.2.31 */
  [constant] MAX_RETRY_DELAY (Line: 7) // */
  [variable] socket (Line: 9)
  [variable] heartbeatInterval (Line: 10)
  [variable] retryTimer (Line: 11)
  [variable] retryDelay (Line: 12)
  [variable] currentRoomId (Line: 13)
  [variable] isJoined (Line: 14)
  [constant] JOIN_REF (Line: 15)
  [function] safeAtob(str) (Line: 18) // /** @intent Synchronous Base64 conversion to prevent Promise leakage. */
  [function] decrypt(payload) (Line: 29) // /** @intent Robust AES-GCM decryption. */
  [variable] anonymousObject2ba477300105 (Line: 43)
  [property] name (Line: 43)
  [variable] anonymousObject2ba477300205 (Line: 46)
  [property] name (Line: 46)
  [property] iv (Line: 46)
  [function] connect() (Line: 53)
  [function] onopen() (Line: 62)
  [function] onmessage(event) (Line: 70)
  [variable] anonymousObject2ba477300505 (Line: 75) // // DESIGN INTENT: Remote logging mirror for PC console debugging.
  [property] active (Line: 75) // // DESIGN INTENT: Remote logging mirror for PC console debugging.
  [property] lastFocusedWindow (Line: 75) // // DESIGN INTENT: Remote logging mirror for PC console debugging.
  [variable] anonymousObject2ba477300605 (Line: 76) // // DESIGN INTENT: Remote logging mirror for PC console debugging.
  [property] action (Line: 76) // // DESIGN INTENT: Remote logging mirror for PC console debugging.
  [property] log_level (Line: 76) // // DESIGN INTENT: Remote logging mirror for PC console debugging.
  [property] message (Line: 76) // // DESIGN INTENT: Remote logging mirror for PC console debugging.
  [variable] anonymousObject2ba477300705 (Line: 83)
  [property] sender_tab_id (Line: 83)
  [variable] anonymousObject2ba477300805 (Line: 94)
  [property] active (Line: 94)
  [property] lastFocusedWindow (Line: 94)
  [variable] anonymousObject2ba477300905 (Line: 94)
  [property] action (Line: 94)
  [property] plaintext (Line: 94)
  [variable] anonymousObject2ba477300a05 (Line: 98) // // DESIGN INTENT: Bidirectional handshake. Reply to mobile that PC is online.
  [property] sender_tab_id (Line: 98) // // DESIGN INTENT: Bidirectional handshake. Reply to mobile that PC is online.
  [variable] anonymousObject2ba477300b05 (Line: 109)
  [property] active (Line: 109)
  [property] lastFocusedWindow (Line: 109)
  [variable] anonymousObject2ba477300c05 (Line: 110)
  [property] text (Line: 110)
  [variable] anonymousObject2ba477300d05 (Line: 114) // // @intent Activity awareness. If we receive a command, we are online.
  [property] sender_tab_id (Line: 114) // // @intent Activity awareness. If we receive a command, we are online.
  [function] onclose() (Line: 118)
  [function] onerror() (Line: 119)
  [function] scheduleReconnect() (Line: 122)
  [constant] data (Line: 127) // // [Intent: Robust Synchronization] Handle both flat and nested payload structures.
  [constant] rawKey (Line: 128) // // [Intent: Robust Synchronization] Handle both flat and nested payload structures.
  [constant] cleanKey (Line: 129) // // [Intent: Robust Synchronization] Handle both flat and nested payload structures.
  [constant] token (Line: 130)
  [constant] roomId (Line: 131)
  [variable] anonymousObject2ba477300e05 (Line: 139)
  [property] voicemux_token (Line: 140)
  [property] voicemux_room_id (Line: 141)
  [property] voicemux_key (Line: 142)

### FILE: content.js
  [function] safeAtob(base64) (Line: 13) // /** * decodes Base64 strings safely. */
  [variable] ADAPTERS_CACHE (Line: 27)
  [variable] loadPromise (Line: 28)
  [function] loadAdapters() (Line: 31) // // â˜… Initialize Adapters
  [function] loadPromise() (Line: 33) // // â˜… Initialize Adapters
  [variable] anonymousObjecta105fb4b0105 (Line: 40)
  [property] name (Line: 41)
  [property] host (Line: 42)
  [property] inputSelector (Line: 43)
  [property] submitSelector (Line: 44)
  [function] getTargetAndAdapter() (Line: 64) // // â˜… Target Selection
  [variable] lastUserInteraction (Line: 86)
  [variable] lastInterimLength (Line: 87)
  [constant] INPUT_LOCK_MS (Line: 88)
  [constant] SUBMIT_DELAY_MS (Line: 89)
  [function] forceInject(element, text) (Line: 98) // /**  * Hybrid Text Injection: v1.4 Stability + v2.2.2 Mirroring */
  [variable] anonymousObjecta105fb4b0205 (Line: 157) // // 3. Mandatory State Sync (Explicitly mark as replacement)
  [property] bubbles (Line: 158) // // 3. Mandatory State Sync (Explicitly mark as replacement)
  [property] inputType (Line: 159) // // 3. Mandatory State Sync (Explicitly mark as replacement)
  [property] data (Line: 160)
  [variable] anonymousObjecta105fb4b0305 (Line: 162)
  [property] bubbles (Line: 162)
  [function] moveCursorToEnd(element) (Line: 167)
  [function] performSubmit(target, adapter) (Line: 185) // /** * Aggressive Submission Logic: Wakes up the UI before clicking */
  [variable] anonymousObjecta105fb4b0405 (Line: 190) // // 1. Final focus ritual to ensure button states refresh
  [property] bubbles (Line: 190) // // 1. Final focus ritual to ensure button states refresh
  [function] triggerEnter(target) (Line: 210)
  [property] key (Line: 211)
  [property] code (Line: 211)
  [property] keyCode (Line: 211)
  [property] which (Line: 211)
  [property] bubbles (Line: 211)
  [property] cancelable (Line: 211)
  [property] composed (Line: 211)
  [property] view (Line: 211)
  [variable] opts (Line: 211)
  [constant] isHub (Line: 219) // // â˜… Message Listener (Plaintext from Background)
  [constant] target (Line: 228)
  [constant] adapter (Line: 228)
  [constant] plaintext (Line: 229)
  [variable] finalTarget (Line: 231)
  [constant] active (Line: 233)
  [constant] textToInsert (Line: 251) // // DESIGN INTENT: Real-time preview without duplication. // Delete the previous interim text before inserting the new one.
  [constant] textToInsert (Line: 268)
  [variable] anonymousObjecta105fb4b0505 (Line: 283) // // 2. ç¢ºå®šãƒ†ã‚­ã‚¹ãƒˆã‚’æŒ¿å…¥
  [property] bubbles (Line: 283) // // 2. ç¢ºå®šãƒ†ã‚­ã‚¹ãƒˆã‚’æŒ¿å…¥
  [property] inputType (Line: 283) // // 2. ç¢ºå®šãƒ†ã‚­ã‚¹ãƒˆã‚’æŒ¿å…¥
  [property] data (Line: 283) // // 2. ç¢ºå®šãƒ†ã‚­ã‚¹ãƒˆã‚’æŒ¿å…¥
  [variable] anonymousObjecta105fb4b0605 (Line: 284)
  [property] bubbles (Line: 284)
  [variable] anonymousObjecta105fb4b0705 (Line: 291)
  [property] bubbles (Line: 291)
  [property] inputType (Line: 291)
  [property] data (Line: 291)
  [variable] anonymousObjecta105fb4b0805 (Line: 292)
  [property] bubbles (Line: 292)
  [constant] proto (Line: 303) // // Native setter hack for clearing
  [variable] anonymousObjecta105fb4b0905 (Line: 313)
  [property] bubbles (Line: 313)
  [constant] style (Line: 315)
  [function] safeCheckConnection() (Line: 327)
  [variable] anonymousObjecta105fb4b0a05 (Line: 329)
  [property] action (Line: 329)

### FILE: options.html
  [heading3] VoiceMux Settings (Line: 5)
  [heading1] Custom Site Adapters (Line: 144)
  [id] custom-adapters (Line: 147)
  [id] save (Line: 156)
  [id] status (Line: 157)

### FILE: options.js
  [constant] textarea (Line: 2) // // VoiceMux Options JS
  [constant] saveBtn (Line: 3) // // VoiceMux Options JS
  [constant] status (Line: 4) // // VoiceMux Options JS
  [constant] data (Line: 9) // // Load saved settings
  [constant] rawValue (Line: 17) // // Save settings
  [variable] parsedValue (Line: 18) // // Save settings
  [variable] anonymousObject981ea4bc0105 (Line: 30)
  [property] custom_adapters (Line: 30)
  [function] localize() (Line: 39)

### FILE: popup.html
  [id] version-display (Line: 331)
  [heading1] VoiceMux Bridge v... (Line: 332)
  [id] status-indicator (Line: 334)
  [id] unlinked-view (Line: 339)
  [heading2] First, let's link with the Hub (Line: 346)
  [id] btn-open-hub (Line: 348)
  [id] linked-view (Line: 352)
  [id] maintenance-notice (Line: 353)
  [id] maintenance-link (Line: 354)
  [id] hub-status-text (Line: 360)
  [id] phone-status-text (Line: 364)
  [id] qrcode-link (Line: 368)
  [id] room-id (Line: 376)
  [id] copy-btn (Line: 378)
  [id] copy-text (Line: 379)
  [id] hub-link (Line: 382)
  [id] btn-reset-connection (Line: 386)
  [id] global-actions (Line: 391)
  [id] btn-global-reset (Line: 392)
  [id] guide-link (Line: 399)

### FILE: popup.js
  [constant] versionDisplay (Line: 8) // // Version Display
  [constant] unlinkedView (Line: 13)
  [constant] linkedView (Line: 14)
  [constant] statusRes (Line: 18) // // System Status Check (Non-blocking)
  [constant] status (Line: 20)
  [constant] notice (Line: 22)
  [constant] link (Line: 23)
  [constant] qrcodeLink (Line: 34)
  [constant] roomIdDisplay (Line: 35)
  [constant] btnOpenHub (Line: 36)
  [constant] statusIndicator (Line: 37)
  [constant] hubLink (Line: 38)
  [constant] phoneStatusText (Line: 39)
  [constant] hubStatusText (Line: 40)
  [function] handleReset() (Line: 43) // // Global Reset Connection Logic
  [variable] anonymousObject46c5f9c40105 (Line: 46)
  [property] action (Line: 46)
  [variable] anonymousObject46c5f9c40205 (Line: 49)
  [property] url (Line: 49)
  [constant] btnResetGlobal (Line: 54)
  [function] updateUI() (Line: 59) // // 1. Retrieve credentials from storage // [Intent: ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®å¤‰æ›´ï¼ˆHubå´ã‹ã‚‰ã®SYNC_AUTHãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚ˆã£ã¦ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹ï¼‰ã‚’ç›£è¦–ã—ã€ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«UIã‚’æ›´æ–°ã™ã‚‹ã€‚]
  [function] onclick() (Line: 108)
  [function] onclick() (Line: 127)
  [variable] anonymousObject46c5f9c40305 (Line: 128)
  [property] url (Line: 128)
  [variable] anonymousObject46c5f9c40405 (Line: 133) // // Signal background to check connection
  [property] action (Line: 133) // // Signal background to check connection
  [variable] anonymousObject46c5f9c40505 (Line: 141) // // DESIGN INTENT: Reset pairing flag when opening to allow future re-pairs
  [property] voicemux_paired (Line: 141) // // DESIGN INTENT: Reset pairing flag when opening to allow future re-pairs
  [function] localize() (Line: 151)

--- END OF FILE: ./project_map.md ---

--- FILE: ./content.js ---
/**
 * VoiceMux Bridge: Content Script
 * Version: 2.56.57.4
 * 
 * DESIGN INTENT:
 * Acts as the final execution layer for remote commands.
 * It is designed to be extremely verbose in logs to aid AI-based debugging
 * and uses redundant checks to ensure target stability.
 */

if (window.VOICEMUX_INITIALIZED) {
  console.log("VoiceMux: Already initialized in this tab.");
} else {
  window.VOICEMUX_INITIALIZED = true;
  const version = chrome.runtime.getManifest().version;
  console.log(`VoiceMux Bridge v${version} Loaded.`);

  let lastClickedElement = null;
  let lastInterimLength = 0;
  const INPUT_LOCK_MS = 2000;
  let lastUserInteraction = 0;

  // [Intent: Capture Explicit User Intent]
  // We track the last clicked element to respect where the user wants to type.
  document.addEventListener("mousedown", (e) => {
    lastUserInteraction = Date.now();
    const el = e.target;
    if (el && (el.tagName === "TEXTAREA" || el.tagName === "INPUT" || el.isContentEditable)) {
      lastClickedElement = el;
      console.log("[Intent: Focus] Target captured via click:", el.tagName);
    }
  }, true);

  document.addEventListener("keydown", () => {
    lastUserInteraction = Date.now();
  }, true);

  /**
   * [Intent: Predictable Target Selection]
   * Resolves the best candidate for text injection with redundant fallbacks.
   * @returns {HTMLElement|null}
   */
  async function getTarget() {
    // 1. Priority: Explicitly clicked element
    if (lastClickedElement && document.contains(lastClickedElement)) {
      return lastClickedElement;
    }

    // 2. Priority: Currently active (focused) element
    const active = document.activeElement;
    if (active && (active.tagName === "TEXTAREA" || active.tagName === "INPUT" || active.isContentEditable)) {
      return active;
    }

    // 3. Priority: Common search bars (Google Search etc.)
    // Note: Google uses textarea[name="q"] now.
    const searchSelectors = [
      "textarea[name='q']",
      "input[name='q']",
      "input[type='search']",
      "[role='combobox']",
      "textarea"
    ];
    
    for (const selector of searchSelectors) {
      const el = document.querySelector(selector);
      if (el) {
        console.log("[Intent: Fallback] Found target via selector:", selector);
        return el;
      }
    }

    return null;
  }

  /**
   * [Intent: Reliable Framework-Safe Injection]
   * Triggers native events to ensure React/Svelte/Vue apps pick up the change.
   */
  function forceInject(element, text) {
    if (!element) { return; }
    
    // Guard against local typing overlap
    const now = Date.now();
    if (now - lastUserInteraction < INPUT_LOCK_MS) {
      console.warn("[Intent: Guard] Injection blocked due to recent user activity.");
      return;
    }

    const isInput = (element.tagName === "TEXTAREA" || element.tagName === "INPUT");
    element.focus();
    
    try {
      if (isInput) {
        const proto = element.tagName === "INPUT" ? window.HTMLInputElement.prototype : window.HTMLTextAreaElement.prototype;
        const setter = Object.getOwnPropertyDescriptor(proto, "value")?.set;
        if (setter) {
          setter.call(element, text);
        } else {
          element.value = text;
        }
      } else {
        document.execCommand("selectAll", false, null);
        document.execCommand("delete", false, null);
        document.execCommand("insertText", false, text);
      }
    } catch (e) {
      console.error("[Intent: Error] Native injection failed, using fallback.", e);
      if (isInput) { element.value = text; }
      else { element.innerText = text; }
    }

    element.dispatchEvent(new InputEvent("input", { bubbles: true, inputType: "insertReplacementText", data: text }));
    element.dispatchEvent(new Event("change", { bubbles: true }));
  }

  // [Intent: Atomic Message Processing]
  chrome.runtime.onMessage.addListener(async (request) => {
    // 1. Log EVERY incoming message for absolute transparency
    console.debug("[Intent: Debug] Received message:", request);

    // 2. Hub-side protection: Don't echo on Hub itself except for logs.
    const isHub = window.location.hostname.includes("hub.knc.jp");
    if (isHub && request.action !== "LOG") { return; }

    // 3. Handle LOG commands (High visibility debugging)
    if (request.action === "LOG") {
      const style = "background: #6750A4; color: white; padding: 2px 4px; border-radius: 2px;";
      console.log("%cREMOTE", style, request.message);
      return;
    }

    // 4. Resolve Action and Data
    const action = request.action || request.command;
    let data = "";
    if (request.plaintext) { data = request.plaintext; }
    else if (request.text) { data = request.text; }
    else if (request.data) { data = request.data.text || ""; }

    if (!action) {
      console.warn("[Intent: Guard] Received message with no action/command.");
      return;
    }

    // 5. Execution Block
    try {
      const target = await getTarget();
      if (!target) {
        console.warn("[Intent: Guard] No target for injection. Active element:", document.activeElement?.tagName);
        return;
      }

      console.group(`VoiceMux Action: ${action}`);
      if (action === "update_text" || action === "MIRROR") {
        forceInject(target, data);
      } else if (action === "INTERIM") {
        target.focus();
        for (let i = 0; i < lastInterimLength; i++) {
          document.execCommand("delete", false, null);
        }
        if (data) {
          document.execCommand("insertText", false, data);
          lastInterimLength = data.length;
        } else {
          lastInterimLength = 0;
        }
      } else if (action === "INSERT") {
        target.focus();
        for (let i = 0; i < lastInterimLength; i++) {
          document.execCommand("delete", false, null);
        }
        lastInterimLength = 0;
        if (data) {
          document.execCommand("insertText", false, data);
          target.dispatchEvent(new InputEvent("input", { bubbles: true, inputType: "insertText", data: data }));
        }
      } else if (action === "NEWLINE") {
        target.focus();
        document.execCommand("insertText", false, "\n");
      } else if (action === "CLEAR") {
        target.focus();
        if (target.tagName === "INPUT" || target.tagName === "TEXTAREA") {
          target.value = "";
        } else {
          document.execCommand("selectAll", false, null);
          document.execCommand("delete", false, null);
        }
        target.dispatchEvent(new Event("input", { bubbles: true }));
      }
    } catch (err) {
      console.error("[Intent: Error] Command execution failed:", err);
    } finally {
      console.groupEnd();
    }
  });
}

--- END OF FILE: ./content.js ---

--- FILE: ./package.json ---
{
  "name": "voicemux-bridge",
  "version": "1.0.0",
  "description": "VoiceMux Bridge ã¯ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®éŸ³å£°å…¥åŠ›ã‚’ PC ä¸Šã®ã‚ã‚‰ã‚†ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆï¼ˆChatGPT, Gmail, Slack ç­‰ï¼‰ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æŒ¿å…¥ã™ã‚‹ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã§ã™ã€‚",
  "main": "background.js",
  "directories": {
    "doc": "docs"
  },
  "scripts": {
    "lint": "eslint .",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/Kaneta/voicemux-bridge.git"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "type": "commonjs",
  "bugs": {
    "url": "https://github.com/Kaneta/voicemux-bridge/issues"
  },
  "homepage": "https://github.com/Kaneta/voicemux-bridge#readme",
  "devDependencies": {
    "@eslint/js": "^10.0.1",
    "eslint": "^10.0.2",
    "globals": "^17.3.0"
  }
}

--- END OF FILE: ./package.json ---

--- FILE: ./package-lock.json ---
{
  "name": "voicemux-bridge",
  "version": "1.0.0",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {
    "": {
      "name": "voicemux-bridge",
      "version": "1.0.0",
      "license": "ISC",
      "devDependencies": {
        "@eslint/js": "^10.0.1",
        "eslint": "^10.0.2",
        "globals": "^17.3.0"
      }
    },
    "node_modules/@eslint-community/eslint-utils": {
      "version": "4.9.1",
      "resolved": "https://registry.npmjs.org/@eslint-community/eslint-utils/-/eslint-utils-4.9.1.tgz",
      "integrity": "sha512-phrYmNiYppR7znFEdqgfWHXR6NCkZEK7hwWDHZUjit/2/U0r6XvkDl0SYnoM51Hq7FhCGdLDT6zxCCOY1hexsQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "eslint-visitor-keys": "^3.4.3"
      },
      "engines": {
        "node": "^12.22.0 || ^14.17.0 || >=16.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      },
      "peerDependencies": {
        "eslint": "^6.0.0 || ^7.0.0 || >=8.0.0"
      }
    },
    "node_modules/@eslint-community/eslint-utils/node_modules/eslint-visitor-keys": {
      "version": "3.4.3",
      "resolved": "https://registry.npmjs.org/eslint-visitor-keys/-/eslint-visitor-keys-3.4.3.tgz",
      "integrity": "sha512-wpc+LXeiyiisxPlEkUzU6svyS1frIO3Mgxj1fdy7Pm8Ygzguax2N3Fa/D/ag1WqbOprdI+uY6wMUl8/a2G+iag==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": "^12.22.0 || ^14.17.0 || >=16.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/@eslint-community/regexpp": {
      "version": "4.12.2",
      "resolved": "https://registry.npmjs.org/@eslint-community/regexpp/-/regexpp-4.12.2.tgz",
      "integrity": "sha512-EriSTlt5OC9/7SXkRSCAhfSxxoSUgBm33OH+IkwbdpgoqsSsUg7y3uh+IICI/Qg4BBWr3U2i39RpmycbxMq4ew==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "^12.0.0 || ^14.0.0 || >=16.0.0"
      }
    },
    "node_modules/@eslint/config-array": {
      "version": "0.23.2",
      "resolved": "https://registry.npmjs.org/@eslint/config-array/-/config-array-0.23.2.tgz",
      "integrity": "sha512-YF+fE6LV4v5MGWRGj7G404/OZzGNepVF8fxk7jqmqo3lrza7a0uUcDnROGRBG1WFC1omYUS/Wp1f42i0M+3Q3A==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@eslint/object-schema": "^3.0.2",
        "debug": "^4.3.1",
        "minimatch": "^10.2.1"
      },
      "engines": {
        "node": "^20.19.0 || ^22.13.0 || >=24"
      }
    },
    "node_modules/@eslint/config-helpers": {
      "version": "0.5.2",
      "resolved": "https://registry.npmjs.org/@eslint/config-helpers/-/config-helpers-0.5.2.tgz",
      "integrity": "sha512-a5MxrdDXEvqnIq+LisyCX6tQMPF/dSJpCfBgBauY+pNZ28yCtSsTvyTYrMhaI+LK26bVyCJfJkT0u8KIj2i1dQ==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@eslint/core": "^1.1.0"
      },
      "engines": {
        "node": "^20.19.0 || ^22.13.0 || >=24"
      }
    },
    "node_modules/@eslint/core": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/@eslint/core/-/core-1.1.0.tgz",
      "integrity": "sha512-/nr9K9wkr3P1EzFTdFdMoLuo1PmIxjmwvPozwoSodjNBdefGujXQUF93u1DDZpEaTuDvMsIQddsd35BwtrW9Xw==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@types/json-schema": "^7.0.15"
      },
      "engines": {
        "node": "^20.19.0 || ^22.13.0 || >=24"
      }
    },
    "node_modules/@eslint/js": {
      "version": "10.0.1",
      "resolved": "https://registry.npmjs.org/@eslint/js/-/js-10.0.1.tgz",
      "integrity": "sha512-zeR9k5pd4gxjZ0abRoIaxdc7I3nDktoXZk2qOv9gCNWx3mVwEn32VRhyLaRsDiJjTs0xq/T8mfPtyuXu7GWBcA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "^20.19.0 || ^22.13.0 || >=24"
      },
      "funding": {
        "url": "https://eslint.org/donate"
      },
      "peerDependencies": {
        "eslint": "^10.0.0"
      },
      "peerDependenciesMeta": {
        "eslint": {
          "optional": true
        }
      }
    },
    "node_modules/@eslint/object-schema": {
      "version": "3.0.2",
      "resolved": "https://registry.npmjs.org/@eslint/object-schema/-/object-schema-3.0.2.tgz",
      "integrity": "sha512-HOy56KJt48Bx8KmJ+XGQNSUMT/6dZee/M54XyUyuvTvPXJmsERRvBchsUVx1UMe1WwIH49XLAczNC7V2INsuUw==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": "^20.19.0 || ^22.13.0 || >=24"
      }
    },
    "node_modules/@eslint/plugin-kit": {
      "version": "0.6.0",
      "resolved": "https://registry.npmjs.org/@eslint/plugin-kit/-/plugin-kit-0.6.0.tgz",
      "integrity": "sha512-bIZEUzOI1jkhviX2cp5vNyXQc6olzb2ohewQubuYlMXZ2Q/XjBO0x0XhGPvc9fjSIiUN0vw+0hq53BJ4eQSJKQ==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@eslint/core": "^1.1.0",
        "levn": "^0.4.1"
      },
      "engines": {
        "node": "^20.19.0 || ^22.13.0 || >=24"
      }
    },
    "node_modules/@humanfs/core": {
      "version": "0.19.1",
      "resolved": "https://registry.npmjs.org/@humanfs/core/-/core-0.19.1.tgz",
      "integrity": "sha512-5DyQ4+1JEUzejeK1JGICcideyfUbGixgS9jNgex5nqkW+cY7WZhxBigmieN5Qnw9ZosSNVC9KQKyb+GUaGyKUA==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">=18.18.0"
      }
    },
    "node_modules/@humanfs/node": {
      "version": "0.16.7",
      "resolved": "https://registry.npmjs.org/@humanfs/node/-/node-0.16.7.tgz",
      "integrity": "sha512-/zUx+yOsIrG4Y43Eh2peDeKCxlRt/gET6aHfaKpuq267qXdYDFViVHfMaLyygZOnl0kGWxFIgsBy8QFuTLUXEQ==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@humanfs/core": "^0.19.1",
        "@humanwhocodes/retry": "^0.4.0"
      },
      "engines": {
        "node": ">=18.18.0"
      }
    },
    "node_modules/@humanwhocodes/module-importer": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/@humanwhocodes/module-importer/-/module-importer-1.0.1.tgz",
      "integrity": "sha512-bxveV4V8v5Yb4ncFTT3rPSgZBOpCkjfK0y4oVVVJwIuDVBRMDXrPyXRL988i5ap9m9bnyEEjWfm5WkBmtffLfA==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">=12.22"
      },
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/nzakas"
      }
    },
    "node_modules/@humanwhocodes/retry": {
      "version": "0.4.3",
      "resolved": "https://registry.npmjs.org/@humanwhocodes/retry/-/retry-0.4.3.tgz",
      "integrity": "sha512-bV0Tgo9K4hfPCek+aMAn81RppFKv2ySDQeMoSZuvTASywNTnVJCArCZE2FWqpvIatKu7VMRLWlR1EazvVhDyhQ==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">=18.18"
      },
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/nzakas"
      }
    },
    "node_modules/@types/esrecurse": {
      "version": "4.3.1",
      "resolved": "https://registry.npmjs.org/@types/esrecurse/-/esrecurse-4.3.1.tgz",
      "integrity": "sha512-xJBAbDifo5hpffDBuHl0Y8ywswbiAp/Wi7Y/GtAgSlZyIABppyurxVueOPE8LUQOxdlgi6Zqce7uoEpqNTeiUw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@types/estree": {
      "version": "1.0.8",
      "resolved": "https://registry.npmjs.org/@types/estree/-/estree-1.0.8.tgz",
      "integrity": "sha512-dWHzHa2WqEXI/O1E9OjrocMTKJl2mSrEolh1Iomrv6U+JuNwaHXsXx9bLu5gG7BUWFIN0skIQJQ/L1rIex4X6w==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@types/json-schema": {
      "version": "7.0.15",
      "resolved": "https://registry.npmjs.org/@types/json-schema/-/json-schema-7.0.15.tgz",
      "integrity": "sha512-5+fP8P8MFNC+AyZCDxrB2pkZFPGzqQWUzpSeuuVLvm8VMcorNYavBqoFcxK8bQz4Qsbn4oUEEem4wDLfcysGHA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/acorn": {
      "version": "8.16.0",
      "resolved": "https://registry.npmjs.org/acorn/-/acorn-8.16.0.tgz",
      "integrity": "sha512-UVJyE9MttOsBQIDKw1skb9nAwQuR5wuGD3+82K6JgJlm/Y+KI92oNsMNGZCYdDsVtRHSak0pcV5Dno5+4jh9sw==",
      "dev": true,
      "license": "MIT",
      "peer": true,
      "bin": {
        "acorn": "bin/acorn"
      },
      "engines": {
        "node": ">=0.4.0"
      }
    },
    "node_modules/acorn-jsx": {
      "version": "5.3.2",
      "resolved": "https://registry.npmjs.org/acorn-jsx/-/acorn-jsx-5.3.2.tgz",
      "integrity": "sha512-rq9s+JNhf0IChjtDXxllJ7g41oZk5SlXtp0LHwyA5cejwn7vKmKp4pPri6YEePv2PU65sAsegbXtIinmDFDXgQ==",
      "dev": true,
      "license": "MIT",
      "peerDependencies": {
        "acorn": "^6.0.0 || ^7.0.0 || ^8.0.0"
      }
    },
    "node_modules/ajv": {
      "version": "6.14.0",
      "resolved": "https://registry.npmjs.org/ajv/-/ajv-6.14.0.tgz",
      "integrity": "sha512-IWrosm/yrn43eiKqkfkHis7QioDleaXQHdDVPKg0FSwwd/DuvyX79TZnFOnYpB7dcsFAMmtFztZuXPDvSePkFw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "fast-deep-equal": "^3.1.1",
        "fast-json-stable-stringify": "^2.0.0",
        "json-schema-traverse": "^0.4.1",
        "uri-js": "^4.2.2"
      },
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/epoberezkin"
      }
    },
    "node_modules/balanced-match": {
      "version": "4.0.4",
      "resolved": "https://registry.npmjs.org/balanced-match/-/balanced-match-4.0.4.tgz",
      "integrity": "sha512-BLrgEcRTwX2o6gGxGOCNyMvGSp35YofuYzw9h1IMTRmKqttAZZVU67bdb9Pr2vUHA8+j3i2tJfjO6C6+4myGTA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "18 || 20 || >=22"
      }
    },
    "node_modules/brace-expansion": {
      "version": "5.0.4",
      "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-5.0.4.tgz",
      "integrity": "sha512-h+DEnpVvxmfVefa4jFbCf5HdH5YMDXRsmKflpf1pILZWRFlTbJpxeU55nJl4Smt5HQaGzg1o6RHFPJaOqnmBDg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "balanced-match": "^4.0.2"
      },
      "engines": {
        "node": "18 || 20 || >=22"
      }
    },
    "node_modules/cross-spawn": {
      "version": "7.0.6",
      "resolved": "https://registry.npmjs.org/cross-spawn/-/cross-spawn-7.0.6.tgz",
      "integrity": "sha512-uV2QOWP2nWzsy2aMp8aRibhi9dlzF5Hgh5SHaB9OiTGEyDTiJJyx0uy51QXdyWbtAHNua4XJzUKca3OzKUd3vA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "path-key": "^3.1.0",
        "shebang-command": "^2.0.0",
        "which": "^2.0.1"
      },
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/debug": {
      "version": "4.4.3",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.4.3.tgz",
      "integrity": "sha512-RGwwWnwQvkVfavKVt22FGLw+xYSdzARwm0ru6DhTVA3umU5hZc28V3kO4stgYryrTlLpuvgI9GiijltAjNbcqA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": ">=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/deep-is": {
      "version": "0.1.4",
      "resolved": "https://registry.npmjs.org/deep-is/-/deep-is-0.1.4.tgz",
      "integrity": "sha512-oIPzksmTg4/MriiaYGO+okXDT7ztn/w3Eptv/+gSIdMdKsJo0u4CfYNFJPy+4SKMuCqGw2wxnA+URMg3t8a/bQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/escape-string-regexp": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/escape-string-regexp/-/escape-string-regexp-4.0.0.tgz",
      "integrity": "sha512-TtpcNJ3XAzx3Gq8sWRzJaVajRs0uVxA2YAkdb1jm2YkPz4G6egUFAyA3n5vtEIZefPk5Wa4UXbKuS5fKkJWdgA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/eslint": {
      "version": "10.0.2",
      "resolved": "https://registry.npmjs.org/eslint/-/eslint-10.0.2.tgz",
      "integrity": "sha512-uYixubwmqJZH+KLVYIVKY1JQt7tysXhtj21WSvjcSmU5SVNzMus1bgLe+pAt816yQ8opKfheVVoPLqvVMGejYw==",
      "dev": true,
      "license": "MIT",
      "peer": true,
      "dependencies": {
        "@eslint-community/eslint-utils": "^4.8.0",
        "@eslint-community/regexpp": "^4.12.2",
        "@eslint/config-array": "^0.23.2",
        "@eslint/config-helpers": "^0.5.2",
        "@eslint/core": "^1.1.0",
        "@eslint/plugin-kit": "^0.6.0",
        "@humanfs/node": "^0.16.6",
        "@humanwhocodes/module-importer": "^1.0.1",
        "@humanwhocodes/retry": "^0.4.2",
        "@types/estree": "^1.0.6",
        "ajv": "^6.14.0",
        "cross-spawn": "^7.0.6",
        "debug": "^4.3.2",
        "escape-string-regexp": "^4.0.0",
        "eslint-scope": "^9.1.1",
        "eslint-visitor-keys": "^5.0.1",
        "espree": "^11.1.1",
        "esquery": "^1.7.0",
        "esutils": "^2.0.2",
        "fast-deep-equal": "^3.1.3",
        "file-entry-cache": "^8.0.0",
        "find-up": "^5.0.0",
        "glob-parent": "^6.0.2",
        "ignore": "^5.2.0",
        "imurmurhash": "^0.1.4",
        "is-glob": "^4.0.0",
        "json-stable-stringify-without-jsonify": "^1.0.1",
        "minimatch": "^10.2.1",
        "natural-compare": "^1.4.0",
        "optionator": "^0.9.3"
      },
      "bin": {
        "eslint": "bin/eslint.js"
      },
      "engines": {
        "node": "^20.19.0 || ^22.13.0 || >=24"
      },
      "funding": {
        "url": "https://eslint.org/donate"
      },
      "peerDependencies": {
        "jiti": "*"
      },
      "peerDependenciesMeta": {
        "jiti": {
          "optional": true
        }
      }
    },
    "node_modules/eslint-scope": {
      "version": "9.1.1",
      "resolved": "https://registry.npmjs.org/eslint-scope/-/eslint-scope-9.1.1.tgz",
      "integrity": "sha512-GaUN0sWim5qc8KVErfPBWmc31LEsOkrUJbvJZV+xuL3u2phMUK4HIvXlWAakfC8W4nzlK+chPEAkYOYb5ZScIw==",
      "dev": true,
      "license": "BSD-2-Clause",
      "dependencies": {
        "@types/esrecurse": "^4.3.1",
        "@types/estree": "^1.0.8",
        "esrecurse": "^4.3.0",
        "estraverse": "^5.2.0"
      },
      "engines": {
        "node": "^20.19.0 || ^22.13.0 || >=24"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/eslint-visitor-keys": {
      "version": "5.0.1",
      "resolved": "https://registry.npmjs.org/eslint-visitor-keys/-/eslint-visitor-keys-5.0.1.tgz",
      "integrity": "sha512-tD40eHxA35h0PEIZNeIjkHoDR4YjjJp34biM0mDvplBe//mB+IHCqHDGV7pxF+7MklTvighcCPPZC7ynWyjdTA==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": "^20.19.0 || ^22.13.0 || >=24"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/espree": {
      "version": "11.1.1",
      "resolved": "https://registry.npmjs.org/espree/-/espree-11.1.1.tgz",
      "integrity": "sha512-AVHPqQoZYc+RUM4/3Ly5udlZY/U4LS8pIG05jEjWM2lQMU/oaZ7qshzAl2YP1tfNmXfftH3ohurfwNAug+MnsQ==",
      "dev": true,
      "license": "BSD-2-Clause",
      "dependencies": {
        "acorn": "^8.16.0",
        "acorn-jsx": "^5.3.2",
        "eslint-visitor-keys": "^5.0.1"
      },
      "engines": {
        "node": "^20.19.0 || ^22.13.0 || >=24"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/esquery": {
      "version": "1.7.0",
      "resolved": "https://registry.npmjs.org/esquery/-/esquery-1.7.0.tgz",
      "integrity": "sha512-Ap6G0WQwcU/LHsvLwON1fAQX9Zp0A2Y6Y/cJBl9r/JbW90Zyg4/zbG6zzKa2OTALELarYHmKu0GhpM5EO+7T0g==",
      "dev": true,
      "license": "BSD-3-Clause",
      "dependencies": {
        "estraverse": "^5.1.0"
      },
      "engines": {
        "node": ">=0.10"
      }
    },
    "node_modules/esrecurse": {
      "version": "4.3.0",
      "resolved": "https://registry.npmjs.org/esrecurse/-/esrecurse-4.3.0.tgz",
      "integrity": "sha512-KmfKL3b6G+RXvP8N1vr3Tq1kL/oCFgn2NYXEtqP8/L3pKapUA4G8cFVaoF3SU323CD4XypR/ffioHmkti6/Tag==",
      "dev": true,
      "license": "BSD-2-Clause",
      "dependencies": {
        "estraverse": "^5.2.0"
      },
      "engines": {
        "node": ">=4.0"
      }
    },
    "node_modules/estraverse": {
      "version": "5.3.0",
      "resolved": "https://registry.npmjs.org/estraverse/-/estraverse-5.3.0.tgz",
      "integrity": "sha512-MMdARuVEQziNTeJD8DgMqmhwR11BRQ/cBP+pLtYdSTnf3MIO8fFeiINEbX36ZdNlfU/7A9f3gUw49B3oQsvwBA==",
      "dev": true,
      "license": "BSD-2-Clause",
      "engines": {
        "node": ">=4.0"
      }
    },
    "node_modules/esutils": {
      "version": "2.0.3",
      "resolved": "https://registry.npmjs.org/esutils/-/esutils-2.0.3.tgz",
      "integrity": "sha512-kVscqXk4OCp68SZ0dkgEKVi6/8ij300KBWTJq32P/dYeWTSwK41WyTxalN1eRmA5Z9UU/LX9D7FWSmV9SAYx6g==",
      "dev": true,
      "license": "BSD-2-Clause",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/fast-deep-equal": {
      "version": "3.1.3",
      "resolved": "https://registry.npmjs.org/fast-deep-equal/-/fast-deep-equal-3.1.3.tgz",
      "integrity": "sha512-f3qQ9oQy9j2AhBe/H9VC91wLmKBCCU/gDOnKNAYG5hswO7BLKj09Hc5HYNz9cGI++xlpDCIgDaitVs03ATR84Q==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/fast-json-stable-stringify": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/fast-json-stable-stringify/-/fast-json-stable-stringify-2.1.0.tgz",
      "integrity": "sha512-lhd/wF+Lk98HZoTCtlVraHtfh5XYijIjalXck7saUtuanSDyLMxnHhSXEDJqHxD7msR8D0uCmqlkwjCV8xvwHw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/fast-levenshtein": {
      "version": "2.0.6",
      "resolved": "https://registry.npmjs.org/fast-levenshtein/-/fast-levenshtein-2.0.6.tgz",
      "integrity": "sha512-DCXu6Ifhqcks7TZKY3Hxp3y6qphY5SJZmrWMDrKcERSOXWQdMhU9Ig/PYrzyw/ul9jOIyh0N4M0tbC5hodg8dw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/file-entry-cache": {
      "version": "8.0.0",
      "resolved": "https://registry.npmjs.org/file-entry-cache/-/file-entry-cache-8.0.0.tgz",
      "integrity": "sha512-XXTUwCvisa5oacNGRP9SfNtYBNAMi+RPwBFmblZEF7N7swHYQS6/Zfk7SRwx4D5j3CH211YNRco1DEMNVfZCnQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "flat-cache": "^4.0.0"
      },
      "engines": {
        "node": ">=16.0.0"
      }
    },
    "node_modules/find-up": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/find-up/-/find-up-5.0.0.tgz",
      "integrity": "sha512-78/PXT1wlLLDgTzDs7sjq9hzz0vXD+zn+7wypEe4fXQxCmdmqfGsEPQxmiCSQI3ajFV91bVSsvNtrJRiW6nGng==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "locate-path": "^6.0.0",
        "path-exists": "^4.0.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/flat-cache": {
      "version": "4.0.1",
      "resolved": "https://registry.npmjs.org/flat-cache/-/flat-cache-4.0.1.tgz",
      "integrity": "sha512-f7ccFPK3SXFHpx15UIGyRJ/FJQctuKZ0zVuN3frBo4HnK3cay9VEW0R6yPYFHC0AgqhukPzKjq22t5DmAyqGyw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "flatted": "^3.2.9",
        "keyv": "^4.5.4"
      },
      "engines": {
        "node": ">=16"
      }
    },
    "node_modules/flatted": {
      "version": "3.3.3",
      "resolved": "https://registry.npmjs.org/flatted/-/flatted-3.3.3.tgz",
      "integrity": "sha512-GX+ysw4PBCz0PzosHDepZGANEuFCMLrnRTiEy9McGjmkCQYwRq4A/X786G/fjM/+OjsWSU1ZrY5qyARZmO/uwg==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/glob-parent": {
      "version": "6.0.2",
      "resolved": "https://registry.npmjs.org/glob-parent/-/glob-parent-6.0.2.tgz",
      "integrity": "sha512-XxwI8EOhVQgWp6iDL+3b0r86f4d6AX6zSU55HfB4ydCEuXLXc5FcYeOu+nnGftS4TEju/11rt4KJPTMgbfmv4A==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "is-glob": "^4.0.3"
      },
      "engines": {
        "node": ">=10.13.0"
      }
    },
    "node_modules/globals": {
      "version": "17.3.0",
      "resolved": "https://registry.npmjs.org/globals/-/globals-17.3.0.tgz",
      "integrity": "sha512-yMqGUQVVCkD4tqjOJf3TnrvaaHDMYp4VlUSObbkIiuCPe/ofdMBFIAcBbCSRFWOnos6qRiTVStDwqPLUclaxIw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=18"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/ignore": {
      "version": "5.3.2",
      "resolved": "https://registry.npmjs.org/ignore/-/ignore-5.3.2.tgz",
      "integrity": "sha512-hsBTNUqQTDwkWtcdYI2i06Y/nUBEsNEDJKjWdigLvegy8kDuJAS8uRlpkkcQpyEXL0Z/pjDy5HBmMjRCJ2gq+g==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 4"
      }
    },
    "node_modules/imurmurhash": {
      "version": "0.1.4",
      "resolved": "https://registry.npmjs.org/imurmurhash/-/imurmurhash-0.1.4.tgz",
      "integrity": "sha512-JmXMZ6wuvDmLiHEml9ykzqO6lwFbof0GG4IkcGaENdCRDDmMVnny7s5HsIgHCbaq0w2MyPhDqkhTUgS2LU2PHA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=0.8.19"
      }
    },
    "node_modules/is-extglob": {
      "version": "2.1.1",
      "resolved": "https://registry.npmjs.org/is-extglob/-/is-extglob-2.1.1.tgz",
      "integrity": "sha512-SbKbANkN603Vi4jEZv49LeVJMn4yGwsbzZworEoyEiutsN3nJYdbO36zfhGJ6QEDpOZIFkDtnq5JRxmvl3jsoQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/is-glob": {
      "version": "4.0.3",
      "resolved": "https://registry.npmjs.org/is-glob/-/is-glob-4.0.3.tgz",
      "integrity": "sha512-xelSayHH36ZgE7ZWhli7pW34hNbNl8Ojv5KVmkJD4hBdD3th8Tfk9vYasLM+mXWOZhFkgZfxhLSnrwRr4elSSg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "is-extglob": "^2.1.1"
      },
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/isexe": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/isexe/-/isexe-2.0.0.tgz",
      "integrity": "sha512-RHxMLp9lnKHGHRng9QFhRCMbYAcVpn69smSGcq3f36xjgVVWThj4qqLbTLlq7Ssj8B+fIQ1EuCEGI2lKsyQeIw==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/json-buffer": {
      "version": "3.0.1",
      "resolved": "https://registry.npmjs.org/json-buffer/-/json-buffer-3.0.1.tgz",
      "integrity": "sha512-4bV5BfR2mqfQTJm+V5tPPdf+ZpuhiIvTuAB5g8kcrXOZpTT/QwwVRWBywX1ozr6lEuPdbHxwaJlm9G6mI2sfSQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/json-schema-traverse": {
      "version": "0.4.1",
      "resolved": "https://registry.npmjs.org/json-schema-traverse/-/json-schema-traverse-0.4.1.tgz",
      "integrity": "sha512-xbbCH5dCYU5T8LcEhhuh7HJ88HXuW3qsI3Y0zOZFKfZEHcpWiHU/Jxzk629Brsab/mMiHQti9wMP+845RPe3Vg==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/json-stable-stringify-without-jsonify": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/json-stable-stringify-without-jsonify/-/json-stable-stringify-without-jsonify-1.0.1.tgz",
      "integrity": "sha512-Bdboy+l7tA3OGW6FjyFHWkP5LuByj1Tk33Ljyq0axyzdk9//JSi2u3fP1QSmd1KNwq6VOKYGlAu87CisVir6Pw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/keyv": {
      "version": "4.5.4",
      "resolved": "https://registry.npmjs.org/keyv/-/keyv-4.5.4.tgz",
      "integrity": "sha512-oxVHkHR/EJf2CNXnWxRLW6mg7JyCCUcG0DtEGmL2ctUo1PNTin1PUil+r/+4r5MpVgC/fn1kjsx7mjSujKqIpw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "json-buffer": "3.0.1"
      }
    },
    "node_modules/levn": {
      "version": "0.4.1",
      "resolved": "https://registry.npmjs.org/levn/-/levn-0.4.1.tgz",
      "integrity": "sha512-+bT2uH4E5LGE7h/n3evcS/sQlJXCpIp6ym8OWJ5eV6+67Dsql/LaaT7qJBAt2rzfoa/5QBGBhxDix1dMt2kQKQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "prelude-ls": "^1.2.1",
        "type-check": "~0.4.0"
      },
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/locate-path": {
      "version": "6.0.0",
      "resolved": "https://registry.npmjs.org/locate-path/-/locate-path-6.0.0.tgz",
      "integrity": "sha512-iPZK6eYjbxRu3uB4/WZ3EsEIMJFMqAoopl3R+zuq0UjcAm/MO6KCweDgPfP3elTztoKP3KtnVHxTn2NHBSDVUw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "p-locate": "^5.0.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/minimatch": {
      "version": "10.2.4",
      "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-10.2.4.tgz",
      "integrity": "sha512-oRjTw/97aTBN0RHbYCdtF1MQfvusSIBQM0IZEgzl6426+8jSC0nF1a/GmnVLpfB9yyr6g6FTqWqiZVbxrtaCIg==",
      "dev": true,
      "license": "BlueOak-1.0.0",
      "dependencies": {
        "brace-expansion": "^5.0.2"
      },
      "engines": {
        "node": "18 || 20 || >=22"
      },
      "funding": {
        "url": "https://github.com/sponsors/isaacs"
      }
    },
    "node_modules/ms": {
      "version": "2.1.3",
      "resolved": "https://registry.npmjs.org/ms/-/ms-2.1.3.tgz",
      "integrity": "sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/natural-compare": {
      "version": "1.4.0",
      "resolved": "https://registry.npmjs.org/natural-compare/-/natural-compare-1.4.0.tgz",
      "integrity": "sha512-OWND8ei3VtNC9h7V60qff3SVobHr996CTwgxubgyQYEpg290h9J0buyECNNJexkFm5sOajh5G116RYA1c8ZMSw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/optionator": {
      "version": "0.9.4",
      "resolved": "https://registry.npmjs.org/optionator/-/optionator-0.9.4.tgz",
      "integrity": "sha512-6IpQ7mKUxRcZNLIObR0hz7lxsapSSIYNZJwXPGeF0mTVqGKFIXj1DQcMoT22S3ROcLyY/rz0PWaWZ9ayWmad9g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "deep-is": "^0.1.3",
        "fast-levenshtein": "^2.0.6",
        "levn": "^0.4.1",
        "prelude-ls": "^1.2.1",
        "type-check": "^0.4.0",
        "word-wrap": "^1.2.5"
      },
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/p-limit": {
      "version": "3.1.0",
      "resolved": "https://registry.npmjs.org/p-limit/-/p-limit-3.1.0.tgz",
      "integrity": "sha512-TYOanM3wGwNGsZN2cVTYPArw454xnXj5qmWF1bEoAc4+cU/ol7GVh7odevjp1FNHduHc3KZMcFduxU5Xc6uJRQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "yocto-queue": "^0.1.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/p-locate": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/p-locate/-/p-locate-5.0.0.tgz",
      "integrity": "sha512-LaNjtRWUBY++zB5nE/NwcaoMylSPk+S+ZHNB1TzdbMJMny6dynpAGt7X/tl/QYq3TIeE6nxHppbo2LGymrG5Pw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "p-limit": "^3.0.2"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/path-exists": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/path-exists/-/path-exists-4.0.0.tgz",
      "integrity": "sha512-ak9Qy5Q7jYb2Wwcey5Fpvg2KoAc/ZIhLSLOSBmRmygPsGwkVVt0fZa0qrtMz+m6tJTAHfZQ8FnmB4MG4LWy7/w==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/path-key": {
      "version": "3.1.1",
      "resolved": "https://registry.npmjs.org/path-key/-/path-key-3.1.1.tgz",
      "integrity": "sha512-ojmeN0qd+y0jszEtoY48r0Peq5dwMEkIlCOu6Q5f41lfkswXuKtYrhgoTpLnyIcHm24Uhqx+5Tqm2InSwLhE6Q==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/prelude-ls": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/prelude-ls/-/prelude-ls-1.2.1.tgz",
      "integrity": "sha512-vkcDPrRZo1QZLbn5RLGPpg/WmIQ65qoWWhcGKf/b5eplkkarX0m9z8ppCat4mlOqUsWpyNuYgO3VRyrYHSzX5g==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/punycode": {
      "version": "2.3.1",
      "resolved": "https://registry.npmjs.org/punycode/-/punycode-2.3.1.tgz",
      "integrity": "sha512-vYt7UD1U9Wg6138shLtLOvdAu+8DsC/ilFtEVHcH+wydcSpNE20AfSOduf6MkRFahL5FY7X1oU7nKVZFtfq8Fg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/shebang-command": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/shebang-command/-/shebang-command-2.0.0.tgz",
      "integrity": "sha512-kHxr2zZpYtdmrN1qDjrrX/Z1rR1kG8Dx+gkpK1G4eXmvXswmcE1hTWBWYUzlraYw1/yZp6YuDY77YtvbN0dmDA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "shebang-regex": "^3.0.0"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/shebang-regex": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/shebang-regex/-/shebang-regex-3.0.0.tgz",
      "integrity": "sha512-7++dFhtcx3353uBaq8DDR4NuxBetBzC7ZQOhmTQInHEd6bSrXdiEyzCvG07Z44UYdLShWUyXt5M/yhz8ekcb1A==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/type-check": {
      "version": "0.4.0",
      "resolved": "https://registry.npmjs.org/type-check/-/type-check-0.4.0.tgz",
      "integrity": "sha512-XleUoc9uwGXqjWwXaUTZAmzMcFZ5858QA2vvx1Ur5xIcixXIP+8LnFDgRplU30us6teqdlskFfu+ae4K79Ooew==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "prelude-ls": "^1.2.1"
      },
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/uri-js": {
      "version": "4.4.1",
      "resolved": "https://registry.npmjs.org/uri-js/-/uri-js-4.4.1.tgz",
      "integrity": "sha512-7rKUyy33Q1yc98pQ1DAmLtwX109F7TIfWlW1Ydo8Wl1ii1SeHieeh0HHfPeL2fMXK6z0s8ecKs9frCuLJvndBg==",
      "dev": true,
      "license": "BSD-2-Clause",
      "dependencies": {
        "punycode": "^2.1.0"
      }
    },
    "node_modules/which": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/which/-/which-2.0.2.tgz",
      "integrity": "sha512-BLI3Tl1TW3Pvl70l3yq3Y64i+awpwXqsGBYWkkqMtnbXgrMD+yj7rhW0kuEDxzJaYXGjEW5ogapKNMEKNMjibA==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "isexe": "^2.0.0"
      },
      "bin": {
        "node-which": "bin/node-which"
      },
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/word-wrap": {
      "version": "1.2.5",
      "resolved": "https://registry.npmjs.org/word-wrap/-/word-wrap-1.2.5.tgz",
      "integrity": "sha512-BN22B5eaMMI9UMtjrGd5g5eCYPpCPDUy0FJXbYsaT5zYxjFOckS53SQDE3pWkVoWpHXVb3BrYcEN4Twa55B5cA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/yocto-queue": {
      "version": "0.1.0",
      "resolved": "https://registry.npmjs.org/yocto-queue/-/yocto-queue-0.1.0.tgz",
      "integrity": "sha512-rVksvsnNCdJ/ohGc6xgPwyN8eheCxsiLM8mxuE/t/mOVqJewPuO1miLpTHQiRgTKCLexL4MeAFVagts7HmNZ2Q==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    }
  }
}

--- END OF FILE: ./package-lock.json ---

--- FILE: ./eslint.config.mjs ---
import js from "@eslint/js";
import globals from "globals";

/**
 * [Intent: AI-Agent Patch Reliability Config]
 * This ESLint configuration enforces explicit coding styles to ensure 
 * that AI agents can reliably match and patch code blocks without ambiguity.
 */
export default [
  js.configs.recommended,
  {
    languageOptions: {
      ecmaVersion: 2022,
      sourceType: "module",
      globals: {
        ...globals.browser,
        ...globals.webextensions,
        chrome: "readonly",
      },
    },
    rules: {
      // 1. Mandatory Braces: No implicit arrow returns.
      // Ensures AI can always find stable '{' and '}' markers for patching.
      "arrow-body-style": ["error", "always"],
      "curly": ["error", "all"],

      // 2. No Complex Ternaries: Prefer explicit if/else blocks.
      "no-nested-ternary": "error",
      "no-ternary": "warn", // Optional but encouraged for AI reliability

      // 3. Error Prevention
      "no-unused-vars": "warn",
      "no-console": "off",
      "no-undef": "error",
      "no-empty": "error",

      // 4. Stylistic Consistency
      "semi": ["error", "always"],
      "quotes": ["error", "double"],
    },
  },
];

--- END OF FILE: ./eslint.config.mjs ---

--- FILE: ./manifest.json ---
{
  "manifest_version": 3,
  "name": "__MSG_name__",
  "version": "2.56.57.3",
  "description": "__MSG_description__",
  "default_locale": "en",
  "permissions": [
    "activeTab",
    "storage",
    "alarms"
  ],
  "host_permissions": [
    "http://localhost:4000/*",
    "https://v.knc.jp/*",
    "https://hub.knc.jp/*"
  ],
  "action": {
    "default_popup": "popup.html",
    "default_icon": {
      "128": "icon128.png"
    }
  },
  "externally_connectable": {
    "matches": [
      "https://hub.knc.jp/*",
      "http://localhost/*"
    ]
  },
  "options_page": "options.html",
  "background": {
    "service_worker": "background.js"
  },
  "content_scripts": [
    {
      "matches": [
        "<all_urls>"
      ],
      "exclude_matches": [
        "https://t.knc.jp/*"
      ],
      "js": [
        "content.js"
      ]
    }
  ],
  "icons": {
    "128": "icon128.png"
  },
  "web_accessible_resources": [
    {
      "resources": ["adapters.json"],
      "matches": ["<all_urls>"]
    }
  ]
}

--- END OF FILE: ./manifest.json ---

