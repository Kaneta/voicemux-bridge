# 【開発ログ】Chrome拡張の「怖い警告」についてAIと相談した記録

VoiceMux Bridge のリリースにあたり、インストール時に表示されるセキュリティ警告について、AI（Gemini）と技術的な相談をした際のログを公開します。なぜこの仕様（権限）になっているのか、その経緯がわかります。

---

#### 🧑‍💻 Developer (User)
自作の拡張機能を公開しましたが、インストールしようとすると「セーフ ブラウジング保護強化機能で信頼されていません」という警告が出てきます。何かバグがあるのでしょうか？

#### 🤖 AI
結論から言うと、これは**プログラムのバグや規約違反ではなく、主に「開発者としての実績（信頼）がまだ蓄積されていない」ことが原因**です。

Google Chromeのセキュリティ仕様によるもので、以下のポイントが影響しています。

1.  **「信頼できる開発者」の基準を満たしていない:** デベロッパー登録から日が浅い、インストール数がまだ少ないなど。
2.  **公開直後である:** 公開されたばかりの拡張機能は、Google側のスキャンや評価が終わっていないため、警告が出やすい傾向にあります。

残念ながらボタン一つで消す設定はありませんが、**「時間が解決する（実績を積む）」**のを待つのが正攻法です。公開直後によくある現象なので、まずはユーザーに「安全です」とアナウンスして実績を作るのが良いでしょう。

---

#### 🧑‍💻 Developer (User)
インストールを進めると、今度は「すべてのウェブサイト上にある自分の全データの読み取りと変更」というさらに怖い警告が出ます。これはユーザーが引いてしまいますよね。

#### 🤖 AI
その警告は、**「特定のページ限定」から「任意のページ（すべてのページ）」へ入力対象を広げたこと**が原因ですね。

`manifest.json` で `<all_urls>` という権限を使っていませんか？

VoiceMux Bridgeの「スマホに向かって話せば、今開いているページに即座に入力される」という体験を実現するには、**あらかじめすべてのページで受信プログラムを待機させておく**必要があります。
Chromeの仕様上、この「全ページ待機」の権限を求めると、自動的にその強い警告が表示されます。これは機能を実現するための正常な代償です。

---

#### 🧑‍💻 Developer (User)
もしその権限を狭めたらどうなりますか？ 警告は消えますか？

#### 🤖 AI
権限を `activeTab` だけに狭めれば警告は消えます。しかし、**「ユーザーが明示的に呼び出さない限り、拡張機能は何もしない（できない）」** という挙動に変わります。

具体的にはこうなります：

1.  Gemini Web を開く → **スマホで話しても何も起きない**（受信プログラムが動いていない）。
2.  拡張機能のアイコンを**クリック**する → やっと入力可能になる。
3.  Gmail のタブへ移動する → **またアイコンをクリック**しないと動かない。

最大の問題は、**「クリックを忘れて話し始めた時」** です。ユーザーは「せっかく長文を喋ったのに、PCに入力されなかった！」というストレスを感じることになります。

VoiceMuxのようなツールの場合、**「PC側は何もしなくていい（ハンズフリー）」** というのが最大の価値なので、クリック必須にするのは「使い勝手の死」を意味します。

---

#### 🧑‍💻 Developer (User)
なるほど…。他の似たようなツール（VoiceInとか）はどうしているんですか？

#### 🤖 AI
調べましたが、**VoiceIn はあなたと同じ「警告が出る方式（全権限）」を採用しています。**
彼らは「警告は出るけれど、そのぶん魔法のように便利ですよ」というスタンスで、信頼と実績でカバーしています。

一方、Typeless というツールは、ブラウザ拡張ではなく「OSのネイティブアプリ」を作ることで、ブラウザの制約自体を回避しています（開発コストは跳ね上がりますが）。

また、Honey（クーポンアプリ）のように「使う時だけ許可を求める」方式もありますが、これは「買い物」という明確なタイミングがあるツールだから成立します。いつ入力が発生するかわからないVoiceMuxのようなインフラ系ツールでは、やはり**「全権限（警告あり）」が王道かつ正解**だと思います。

---

#### 🧑‍💻 Developer (User)
わかりました。変に小細工をして不便にするより、正直に「便利さのための権限です」と説明して進めることにします。あと、サーバー側は運用上の都合でソースを非公開にしたいのですが、それは「オープンソース」を謳う上で問題になりますか？

#### 🤖 AI
賢明な判断です。
サーバー側についてですが、**「拡張機能（クライアント）側がオープンソースであれば、E2EEの信頼性は担保できる」**ので問題ありません。

ユーザーが一番恐れるのは「自分のブラウザ上で何が起きているか」です。ブラウザ側で送信前にデータが暗号化されていることさえソースコードで証明できれば、その先のサーバーがどれだけ「ブラックボックス」であっても、中身を盗み見ることは不可能です。

むしろ、サーバーを「ただの暗号化データの土管」に徹させることで、運用コストやセキュリティを自分で管理しやすくなるメリットもあります。ドキュメントには「クライアント側は公開、サーバー側はプライベート運用（でも中身は見れない）」と正直に書くのが、最も信頼される形です。自信を持って進めましょう。
